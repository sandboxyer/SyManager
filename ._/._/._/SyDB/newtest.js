#!/usr/bin/env node

import fs from 'fs';
import { Buffer } from 'buffer';
import { fileURLToPath } from 'url';
import path from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

async function extractCFile() {
    const scriptName = path.basename(__filename);
    const outputFile = scriptName.replace(/\.js$/, '.c');
    
    if (fs.existsSync(outputFile)) {
        console.log(`Overwriting: ${outputFile}`);
    }
    
    try {
        // Base64 encoded C file content
        const base64Content = `I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4KI2luY2x1ZGUgPHN0cmluZy5oPgojaW5jbHVkZSA8dW5pc3RkLmg+CiNpbmNsdWRlIDxzeXMvdGltZS5oPgojaW5jbHVkZSA8dGltZS5oPgojaW5jbHVkZSA8ZGlyZW50Lmg+CiNpbmNsdWRlIDxzeXMvc3RhdC5oPgojaW5jbHVkZSA8ZmNudGwuaD4KI2luY2x1ZGUgPHN5cy9zb2NrZXQuaD4KI2luY2x1ZGUgPG5ldGluZXQvaW4uaD4KI2luY2x1ZGUgPGFycGEvaW5ldC5oPgojaW5jbHVkZSA8bmV0ZGIuaD4KI2luY2x1ZGUgPGVycm5vLmg+CiNpbmNsdWRlIDxwdGhyZWFkLmg+CiNpbmNsdWRlIDxzaWduYWwuaD4KI2luY2x1ZGUgPHN5cy93YWl0Lmg+CiNpbmNsdWRlIDxzeXMvdHlwZXMuaD4KI2luY2x1ZGUgPHN5cy9tbWFuLmg+CiNpbmNsdWRlIDxzZW1hcGhvcmUuaD4KCiNkZWZpbmUgUkVEICAgICAiXDAzM1sxOzMxbSIKI2RlZmluZSBHUkVFTiAgICJcMDMzWzE7MzJtIgojZGVmaW5lIFlFTExPVyAgIlwwMzNbMTszM20iCiNkZWZpbmUgQkxVRSAgICAiXDAzM1sxOzM0bSIKI2RlZmluZSBNQUdFTlRBICJcMDMzWzE7MzVtIgojZGVmaW5lIENZQU4gICAgIlwwMzNbMTszNm0iCiNkZWZpbmUgUkVTRVQgICAiXDAzM1swbSIKI2RlZmluZSBCT0xEICAgICJcMDMzWzFtIgoKLy8gPT09PT09PT09PT09PT09PT09PT0gVEVTVCBNT0RFUyA9PT09PT09PT09PT09PT09PT09PQojZGVmaW5lIFRFU1RfTU9ERV9OT1JNQUwgMAojZGVmaW5lIFRFU1RfTU9ERV9DTEkgICAgMQojZGVmaW5lIFRFU1RfTU9ERV9TRVJWRVIgMgoKLy8gPT09PT09PT09PT09PT09PT09PT0gVEVTVCBDQVRFR09SSUVTID09PT09PT09PT09PT09PT09PT09CiNkZWZpbmUgQ0FURUdPUllfU01PS0UgICAgICAgMAojZGVmaW5lIENBVEVHT1JZX0RVUkFCSUxJVFkgIDEKI2RlZmluZSBDQVRFR09SWV9DT05DVVJSRU5DWSAyCiNkZWZpbmUgQ0FURUdPUllfUVVFUlkgICAgICAgMwojZGVmaW5lIENBVEVHT1JZX1NDSEVNQSAgICAgIDQKI2RlZmluZSBDQVRFR09SWV9TRUNVUklUWSAgICA1CiNkZWZpbmUgQ0FURUdPUllfUEVSRk9STUFOQ0UgNgojZGVmaW5lIENBVEVHT1JZX0lOVEVHUklUWSAgIDcKI2RlZmluZSBDQVRFR09SWV9FREdFICAgICAgICA4CiNkZWZpbmUgQ0FURUdPUllfUkVDT1ZFUlkgICAgOQoKLy8gPT09PT09PT09PT09PT09PT09PT0gRlVOQ1RJT04gUFJPVE9UWVBFUyBGT1IgSFRUUCBURVNUUyA9PT09PT09PT09PT09PT09PT09PQppbnQgcnVuX2h0dHBfZGF0YWJhc2VfdGVzdHModm9pZCk7CmludCBydW5faHR0cF9jb2xsZWN0aW9uX3Rlc3RzKHZvaWQpOwppbnQgcnVuX2h0dHBfaW5zdGFuY2VfdGVzdHModm9pZCk7CmludCBydW5faHR0cF9jb21tYW5kX3Rlc3RzKHZvaWQpOwppbnQgcnVuX2h0dHBfZXJyb3JfdGVzdHModm9pZCk7CnZvaWQgY2xlYW51cF90ZXN0X2RhdGFiYXNlcyh2b2lkKTsKaW50IHJ1bl9kYXRhX2ludGVncml0eV90ZXN0c19jbGkodm9pZCk7Cgpjb25zdCBjaGFyKiBjYXRlZ29yeV9uYW1lc1tdID0gewogICAgIlNNT0tFIFRFU1RTIiwKICAgICJEVVJBQklMSVRZICYgQ1JBU0ggUkVDT1ZFUlkiLAogICAgIkNPTkNVUlJFTkNZICYgVEhSRUFEIFNBRkVUWSIsCiAgICAiUVVFUlkgTEFOR1VBR0UgJiBJTkRFWElORyIsCiAgICAiU0NIRU1BIEVORk9SQ0VNRU5UIiwKICAgICJTRUNVUklUWSAmIElOSkVDVElPTiIsCiAgICAiUEVSRk9STUFOQ0UgJiBTQ0FMQUJJTElUWSIsCiAgICAiREFUQSBJTlRFR1JJVFkiLAogICAgIkVER0UgQ0FTRVMiLAogICAgIlJFQ09WRVJZICYgRVJST1IgSEFORExJTkciCn07CgovLyA9PT09PT09PT09PT09PT09PT09PSBURVNUIFNUUlVDVFVSRVMgPT09PT09PT09PT09PT09PT09PT0KCnR5cGVkZWYgc3RydWN0IHsKICAgIGNoYXIgZGVzY3JpcHRpb25bNTEyXTsKICAgIGNoYXIgY29tbWFuZFsxMDI0XTsKICAgIGNoYXIgdmVyaWZpY2F0aW9uX2NvbW1hbmRbMTAyNF07CiAgICBjaGFyIGV4cGVjdGVkX291dHB1dFsxMDI0XTsKICAgIGludCBzdWNjZXNzOwogICAgaW50IHZlcmlmaWNhdGlvbl9zdWNjZXNzOwogICAgbG9uZyBsb25nIGR1cmF0aW9uX21zOwogICAgY2hhciBkZXRhaWxzWzEwMjRdOwogICAgY2hhciB2ZXJib3NlX291dHB1dFs0MDk2XTsKICAgIGludCBjYXRlZ29yeTsKICAgIGludCBjcml0aWNhbDsgIC8vIElmIGNyaXRpY2FsIGZhaWxzLCBvdmVyYWxsIHRlc3QgZmFpbHMKfSBUZXN0Q2FzZTsKCnR5cGVkZWYgc3RydWN0IHsKICAgIGNoYXIgZGVzY3JpcHRpb25bNTEyXTsKICAgIGludCAoKnRlc3RfZnVuY3Rpb24pKHZvaWQpOwogICAgaW50IGNhdGVnb3J5OwogICAgaW50IGNyaXRpY2FsOwogICAgbG9uZyBsb25nIGR1cmF0aW9uX21zOwogICAgaW50IHBhc3NlZDsKICAgIGNoYXIgZXJyb3JfbWVzc2FnZVsxMDI0XTsKfSBBZHZhbmNlZFRlc3RDYXNlOwoKLy8gPT09PT09PT09PT09PT09PT09PT0gR0xPQkFMIENPTkZJR1VSQVRJT04gPT09PT09PT09PT09PT09PT09PT0KCmNoYXIgY2xpX2NvbW1hbmRbMzJdID0gIi4vc3lkYiI7CmludCB0ZXN0X21vZGUgPSBURVNUX01PREVfTk9STUFMOwpjaGFyIHNlcnZlcl91cmxbMjU2XSA9ICJodHRwOi8vbG9jYWxob3N0OjgwODAiOwppbnQgdmVyYm9zZV9tb2RlID0gMDsKaW50IHRlc3RfbGV2ZWwgPSAyOyAgLy8gMD1xdWljaywgMT1zdGFuZGFyZCwgMj1jb21wcmVoZW5zaXZlCnBpZF90IHNlcnZlcl9waWQgPSAwOwppbnQgc2VydmVyX3N0YXJ0ZWRfYnlfdGVzdCA9IDA7CgovLyA9PT09PT09PT09PT09PT09PT09PSBURVNUIFNUQVRJU1RJQ1MgPT09PT09PT09PT09PT09PT09PT0KCnR5cGVkZWYgc3RydWN0IHsKICAgIGludCB0b3RhbF90ZXN0czsKICAgIGludCBwYXNzZWRfdGVzdHM7CiAgICBpbnQgZmFpbGVkX3Rlc3RzOwogICAgaW50IHNraXBwZWRfdGVzdHM7CiAgICBsb25nIGxvbmcgdG90YWxfZHVyYXRpb247CiAgICBpbnQgY3JpdGljYWxfZmFpbHVyZXM7CiAgICBpbnQgY2F0ZWdvcmllc19wYXNzZWRbMTBdOwogICAgaW50IGNhdGVnb3JpZXNfdG90YWxbMTBdOwp9IFRlc3RTdGF0aXN0aWNzOwoKVGVzdFN0YXRpc3RpY3Mgc3RhdHMgPSB7MH07CgovLyA9PT09PT09PT09PT09PT09PT09PSBIVFRQIENMSUVOVCAoRW5oYW5jZWQpID09PT09PT09PT09PT09PT09PT09Cgp0eXBlZGVmIHN0cnVjdCB7CiAgICBpbnQgc3RhdHVzX2NvZGU7CiAgICBjaGFyKiBib2R5OwogICAgc2l6ZV90IGJvZHlfbGVuZ3RoOwogICAgY2hhciogaGVhZGVyc1s1MF07CiAgICBpbnQgaGVhZGVyX2NvdW50Owp9IEh0dHBSZXNwb25zZTsKCi8vID09PT09PT09PT09PT09PT09PT09IENPTkNVUlJFTkNZIFRFU1QgU1RSVUNUVVJFUyA9PT09PT09PT09PT09PT09PT09PQoKdHlwZWRlZiBzdHJ1Y3QgewogICAgY2hhciBkYXRhYmFzZVs2NF07CiAgICBjaGFyIGNvbGxlY3Rpb25bNjRdOwogICAgaW50IHRocmVhZF9pZDsKICAgIGludCBvcGVyYXRpb25zX2NvdW50OwogICAgaW50IHN1Y2Nlc3NfY291bnQ7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZTsKfSBUaHJlYWRUZXN0Q29udGV4dDsKCnR5cGVkZWYgc3RydWN0IHsKICAgIGludCBhY3RpdmVfY29ubmVjdGlvbnM7CiAgICBpbnQgdG90YWxfcmVxdWVzdHM7CiAgICBpbnQgc3VjY2Vzc19yZXF1ZXN0czsKICAgIHB0aHJlYWRfbXV0ZXhfdCBsb2NrOwp9IENvbmN1cnJlbmN5U3RhdHM7CgovLyA9PT09PT09PT09PT09PT09PT09PSBGVU5DVElPTiBQUk9UT1RZUEVTID09PT09PT09PT09PT09PT09PT09CgppbnQgcnVuX2RhdGFfaW50ZWdyaXR5X3Rlc3RzX2NsaSh2b2lkKSB7CiAgICByZXR1cm4gcnVuX2ludGVncml0eV90ZXN0c19jbGkoKTsKfQoKLy8gQ29yZSB0ZXN0IGZ1bmN0aW9ucwpsb25nIGxvbmcgZ2V0X2N1cnJlbnRfdGltZV9tcygpOwppbnQgZmlsZV9leGlzdHMoY29uc3QgY2hhciAqcGF0aCk7CmludCBjb3VudF9maWxlc19pbl9kaXJlY3RvcnkoY29uc3QgY2hhciAqcGF0aCk7CmludCBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihjb25zdCBjaGFyICpkYXRhYmFzZSwgY29uc3QgY2hhciAqY29sbGVjdGlvbik7CmNoYXIqIGdldF9sYXN0X2luc2VydGVkX2lkKGNvbnN0IGNoYXIgKmRhdGFiYXNlLCBjb25zdCBjaGFyICpjb2xsZWN0aW9uKTsKaW50IGV4ZWN1dGVfY29tbWFuZF9hbmRfY2FwdHVyZShjb25zdCBjaGFyICpjb21tYW5kLCBjaGFyICpvdXRwdXQsIHNpemVfdCBvdXRwdXRfc2l6ZSk7CmludCBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmVfdmVyYm9zZShjb25zdCBjaGFyICpjb21tYW5kLCBjaGFyICpvdXRwdXQsIHNpemVfdCBvdXRwdXRfc2l6ZSwgY2hhciAqdmVyYm9zZV9vdXRwdXQsIHNpemVfdCB2ZXJib3NlX3NpemUpOwppbnQgZXhlY3V0ZV90ZXN0X3dpdGhfdmVyaWZpY2F0aW9uKFRlc3RDYXNlICp0ZXN0KTsKaW50IGV4ZWN1dGVfYWR2YW5jZWRfdGVzdChBZHZhbmNlZFRlc3RDYXNlICp0ZXN0KTsKCi8vIEhUVFAgY2xpZW50IGZ1bmN0aW9ucwpIdHRwUmVzcG9uc2UqIGh0dHBfcmVxdWVzdChjb25zdCBjaGFyKiBtZXRob2QsIGNvbnN0IGNoYXIqIHVybCwgY29uc3QgY2hhciogYm9keSwgY29uc3QgY2hhciogY29udGVudF90eXBlKTsKdm9pZCBodHRwX3Jlc3BvbnNlX2ZyZWUoSHR0cFJlc3BvbnNlKiByZXNwb25zZSk7CmludCB2ZXJpZnlfaHR0cF9yZXNwb25zZShjb25zdCBIdHRwUmVzcG9uc2UqIHJlc3BvbnNlLCBjb25zdCBjaGFyKiBleHBlY3RlZF9wYXR0ZXJuLCBpbnQgY2hlY2tfc3VjY2Vzc19vbmx5KTsKY2hhciogZXh0cmFjdF9qc29uX2ZpZWxkKGNvbnN0IGNoYXIqIGpzb24sIGNvbnN0IGNoYXIqIGZpZWxkKTsKaW50IGh0dHBfdGVzdF9lbmRwb2ludChjb25zdCBjaGFyKiBkZXNjcmlwdGlvbiwgY29uc3QgY2hhciogbWV0aG9kLCBjb25zdCBjaGFyKiBlbmRwb2ludCwgCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyKiBib2R5LCBjb25zdCBjaGFyKiBleHBlY3RlZF9wYXR0ZXJuLCBpbnQgY2hlY2tfc3VjY2Vzc19vbmx5LCAKICAgICAgICAgICAgICAgICAgICAgIGxvbmcgbG9uZyogZHVyYXRpb24sIGludCBjYXRlZ29yeSwgaW50IGNyaXRpY2FsKTsKCi8vIFNlcnZlciBtYW5hZ2VtZW50CmludCBzdGFydF9zeWRiX3NlcnZlcigpOwppbnQgc3RvcF9zeWRiX3NlcnZlcigpOwppbnQgd2FpdF9mb3Jfc2VydmVyX3JlYWR5KGludCB0aW1lb3V0X3NlY29uZHMpOwoKLy8gPT09PT09PT09PT09PT09PT09PT0gRU5IQU5DRUQgVEVTVCBTVUlURVMgPT09PT09PT09PT09PT09PT09PT0KCi8vIFNtb2tlIFRlc3RzIChCYXNpYyBmdW5jdGlvbmFsaXR5IC0geW91ciBleGlzdGluZyB0ZXN0cykKaW50IHJ1bl9zbW9rZV90ZXN0c19jbGkoKTsKaW50IHJ1bl9zbW9rZV90ZXN0c19odHRwKCk7CgovLyA9PT09PT09PT09PT09PT09PT09PSBDUklUSUNBTCBORVcgVEVTVCBTVUlURVMgPT09PT09PT09PT09PT09PT09PT0KCi8vIERVUkFCSUxJVFkgVEVTVFMgLSBXaGF0IGhhcHBlbnMgb24gY3Jhc2gvcG93ZXIgZmFpbHVyZQppbnQgcnVuX2R1cmFiaWxpdHlfdGVzdHNfY2xpKCk7CmludCBydW5fZHVyYWJpbGl0eV90ZXN0c19odHRwKCk7CgovLyBDT05DVVJSRU5DWSBURVNUUyAtIE11bHRpLXRocmVhZGVkIGFjY2VzcwppbnQgcnVuX2NvbmN1cnJlbmN5X3Rlc3RzX2NsaSgpOwppbnQgcnVuX2NvbmN1cnJlbmN5X3Rlc3RzX2h0dHAoKTsKCi8vIFFVRVJZIExBTkdVQUdFIFRFU1RTIC0gQmV5b25kIHNpbXBsZSBlcXVhbGl0eQppbnQgcnVuX3F1ZXJ5X2xhbmd1YWdlX3Rlc3RzX2NsaSgpOwppbnQgcnVuX3F1ZXJ5X2xhbmd1YWdlX3Rlc3RzX2h0dHAoKTsKCi8vIFNDSEVNQSBFTkZPUkNFTUVOVCBURVNUUyAtIEFjdHVhbCB2YWxpZGF0aW9uCmludCBydW5fc2NoZW1hX2VuZm9yY2VtZW50X3Rlc3RzX2NsaSgpOwppbnQgcnVuX3NjaGVtYV9lbmZvcmNlbWVudF90ZXN0c19odHRwKCk7CgovLyBTRUNVUklUWSBURVNUUyAtIEluamVjdGlvbiwgdHJhdmVyc2FsLCBhdXRoCmludCBydW5fc2VjdXJpdHlfdGVzdHNfY2xpKCk7CmludCBydW5fc2VjdXJpdHlfdGVzdHNfaHR0cCgpOwoKLy8gUEVSRk9STUFOQ0UgVEVTVFMgLSBMYXJnZSBkYXRhc2V0cywgaW5kZXhpbmcKaW50IHJ1bl9wZXJmb3JtYW5jZV90ZXN0c19jbGkoKTsKaW50IHJ1bl9wZXJmb3JtYW5jZV90ZXN0c19odHRwKCk7CgovLyBEQVRBIElOVEVHUklUWSBURVNUUyAtIENvcnJ1cHRpb24gZGV0ZWN0aW9uCmludCBydW5faW50ZWdyaXR5X3Rlc3RzX2NsaSgpOwppbnQgcnVuX2ludGVncml0eV90ZXN0c19odHRwKCk7CgovLyBSRUNPVkVSWSBURVNUUyAtIFJlc3RhcnQgYWZ0ZXIgZmFpbHVyZQppbnQgcnVuX3JlY292ZXJ5X3Rlc3RzX2NsaSgpOwppbnQgcnVuX3JlY292ZXJ5X3Rlc3RzX2h0dHAoKTsKCi8vIEVER0UgQ0FTRSBURVNUUyAtIEV4dHJlbWUgaW5wdXRzCmludCBydW5fZWRnZV9jYXNlX3Rlc3RzX2NsaSgpOwppbnQgcnVuX2VkZ2VfY2FzZV90ZXN0c19odHRwKCk7CgovLyA9PT09PT09PT09PT09PT09PT09PSBVVElMSVRZIEZVTkNUSU9OUyAoRW5oYW5jZWQpID09PT09PT09PT09PT09PT09PT09Cgpsb25nIGxvbmcgZ2V0X2N1cnJlbnRfdGltZV9tcygpIHsKICAgIHN0cnVjdCB0aW1ldmFsIHR2OwogICAgZ2V0dGltZW9mZGF5KCZ0diwgTlVMTCk7CiAgICByZXR1cm4gKGxvbmcgbG9uZyl0di50dl9zZWMgKiAxMDAwICsgdHYudHZfdXNlYyAvIDEwMDA7Cn0KCnZvaWQgbXNsZWVwKGludCBtcykgewogICAgdXNsZWVwKG1zICogMTAwMCk7Cn0KCmludCBmaWxlX2V4aXN0cyhjb25zdCBjaGFyICpwYXRoKSB7CiAgICBzdHJ1Y3Qgc3RhdCBzdDsKICAgIHJldHVybiBzdGF0KHBhdGgsICZzdCkgPT0gMDsKfQoKaW50IGNvdW50X2ZpbGVzX2luX2RpcmVjdG9yeShjb25zdCBjaGFyICpwYXRoKSB7CiAgICBESVIgKmRpciA9IG9wZW5kaXIocGF0aCk7CiAgICBpZiAoIWRpcikgcmV0dXJuIC0xOwogICAgCiAgICBpbnQgY291bnQgPSAwOwogICAgc3RydWN0IGRpcmVudCAqZW50cnk7CiAgICB3aGlsZSAoKGVudHJ5ID0gcmVhZGRpcihkaXIpKSAhPSBOVUxMKSB7CiAgICAgICAgaWYgKHN0cmNtcChlbnRyeS0+ZF9uYW1lLCAiLiIpICE9IDAgJiYgc3RyY21wKGVudHJ5LT5kX25hbWUsICIuLiIpICE9IDApIHsKICAgICAgICAgICAgY291bnQrKzsKICAgICAgICB9CiAgICB9CiAgICBjbG9zZWRpcihkaXIpOwogICAgcmV0dXJuIGNvdW50Owp9CgppbnQgZ2V0X2ZpbGVfc2l6ZShjb25zdCBjaGFyICpwYXRoKSB7CiAgICBzdHJ1Y3Qgc3RhdCBzdDsKICAgIGlmIChzdGF0KHBhdGgsICZzdCkgPT0gMCkgewogICAgICAgIHJldHVybiBzdC5zdF9zaXplOwogICAgfQogICAgcmV0dXJuIC0xOwp9CgppbnQgY2FsY3VsYXRlX2ZpbGVfY2hlY2tzdW0oY29uc3QgY2hhciAqcGF0aCkgewogICAgRklMRSAqZnAgPSBmb3BlbihwYXRoLCAicmIiKTsKICAgIGlmICghZnApIHJldHVybiAwOwogICAgCiAgICBpbnQgY2hlY2tzdW0gPSAwOwogICAgaW50IGM7CiAgICB3aGlsZSAoKGMgPSBmZ2V0YyhmcCkpICE9IEVPRikgewogICAgICAgIGNoZWNrc3VtID0gKGNoZWNrc3VtICsgYykgJiAweEZGRkY7CiAgICB9CiAgICBmY2xvc2UoZnApOwogICAgcmV0dXJuIGNoZWNrc3VtOwp9CgppbnQgY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oY29uc3QgY2hhciAqZGF0YWJhc2UsIGNvbnN0IGNoYXIgKmNvbGxlY3Rpb24pIHsKICAgIGNoYXIgY29tbWFuZFs1MTJdOwogICAgc25wcmludGYoY29tbWFuZCwgc2l6ZW9mKGNvbW1hbmQpLCAiJXMgbGlzdCAlcyAlcyAyPi9kZXYvbnVsbCB8IGdyZXAgLWMgJ1wiX2lkXCInIiwgCiAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGF0YWJhc2UsIGNvbGxlY3Rpb24pOwogICAgCiAgICBGSUxFICpmcCA9IHBvcGVuKGNvbW1hbmQsICJyIik7CiAgICBpZiAoIWZwKSByZXR1cm4gLTE7CiAgICAKICAgIGludCBjb3VudCA9IDA7CiAgICBjaGFyIGJ1ZmZlcls2NF07CiAgICBpZiAoZmdldHMoYnVmZmVyLCBzaXplb2YoYnVmZmVyKSwgZnApKSB7CiAgICAgICAgY291bnQgPSBhdG9pKGJ1ZmZlcik7CiAgICB9CiAgICBwY2xvc2UoZnApOwogICAgCiAgICByZXR1cm4gY291bnQ7Cn0KCmNoYXIqIGdldF9sYXN0X2luc2VydGVkX2lkKGNvbnN0IGNoYXIgKmRhdGFiYXNlLCBjb25zdCBjaGFyICpjb2xsZWN0aW9uKSB7CiAgICBjaGFyIGNvbW1hbmRbNTEyXTsKICAgIHNucHJpbnRmKGNvbW1hbmQsIHNpemVvZihjb21tYW5kKSwgIiVzIGxpc3QgJXMgJXMgMj4vZGV2L251bGwgfCB0YWlsIC0xIiwgCiAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGF0YWJhc2UsIGNvbGxlY3Rpb24pOwogICAgCiAgICBGSUxFICpmcCA9IHBvcGVuKGNvbW1hbmQsICJyIik7CiAgICBpZiAoIWZwKSByZXR1cm4gTlVMTDsKICAgIAogICAgc3RhdGljIGNoYXIgaWRbNjRdOwogICAgaWYgKGZnZXRzKGlkLCBzaXplb2YoaWQpLCBmcCkpIHsKICAgICAgICBjaGFyICppZF9zdGFydCA9IHN0cnN0cihpZCwgIlwiX2lkXCI6XCIiKTsKICAgICAgICBpZiAoaWRfc3RhcnQpIHsKICAgICAgICAgICAgaWRfc3RhcnQgKz0gNzsKICAgICAgICAgICAgY2hhciAqaWRfZW5kID0gc3RyY2hyKGlkX3N0YXJ0LCAnIicpOwogICAgICAgICAgICBpZiAoaWRfZW5kKSB7CiAgICAgICAgICAgICAgICAqaWRfZW5kID0gJ1wwJzsKICAgICAgICAgICAgICAgIHN0cm5jcHkoaWQsIGlkX3N0YXJ0LCBzaXplb2YoaWQpIC0gMSk7CiAgICAgICAgICAgICAgICBwY2xvc2UoZnApOwogICAgICAgICAgICAgICAgcmV0dXJuIGlkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcGNsb3NlKGZwKTsKICAgIHJldHVybiBOVUxMOwp9CgppbnQgZXhlY3V0ZV9jb21tYW5kX2FuZF9jYXB0dXJlKGNvbnN0IGNoYXIgKmNvbW1hbmQsIGNoYXIgKm91dHB1dCwgc2l6ZV90IG91dHB1dF9zaXplKSB7CiAgICBGSUxFICpmcCA9IHBvcGVuKGNvbW1hbmQsICJyIik7CiAgICBpZiAoIWZwKSByZXR1cm4gLTE7CiAgICAKICAgIG91dHB1dFswXSA9ICdcMCc7CiAgICBpZiAoZmdldHMob3V0cHV0LCBvdXRwdXRfc2l6ZSwgZnApKSB7CiAgICAgICAgb3V0cHV0W3N0cmNzcG4ob3V0cHV0LCAiXG4iKV0gPSAnXDAnOwogICAgfQogICAgcGNsb3NlKGZwKTsKICAgIHJldHVybiAwOwp9CgppbnQgZXhlY3V0ZV9jb21tYW5kX2FuZF9jYXB0dXJlX3ZlcmJvc2UoY29uc3QgY2hhciAqY29tbWFuZCwgY2hhciAqb3V0cHV0LCBzaXplX3Qgb3V0cHV0X3NpemUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyICp2ZXJib3NlX291dHB1dCwgc2l6ZV90IHZlcmJvc2Vfc2l6ZSkgewogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIEV4ZWN1dGluZzogJXNcbiIgUkVTRVQsIGNvbW1hbmQpOwogICAgfQogICAgCiAgICBGSUxFICpmcCA9IHBvcGVuKGNvbW1hbmQsICJyIik7CiAgICBpZiAoIWZwKSB7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gcG9wZW4gZmFpbGVkXG4iIFJFU0VUKTsKICAgICAgICByZXR1cm4gLTE7CiAgICB9CiAgICAKICAgIG91dHB1dFswXSA9ICdcMCc7CiAgICB2ZXJib3NlX291dHB1dFswXSA9ICdcMCc7CiAgICAKICAgIGNoYXIgYnVmZmVyWzEwMjRdOwogICAgc2l6ZV90IHRvdGFsX3ZlcmJvc2Vfc2l6ZSA9IDA7CiAgICAKICAgIHdoaWxlIChmZ2V0cyhidWZmZXIsIHNpemVvZihidWZmZXIpLCBmcCkpIHsKICAgICAgICBidWZmZXJbc3RyY3NwbihidWZmZXIsICJcbiIpXSA9ICdcMCc7CiAgICAgICAgCiAgICAgICAgaWYgKG91dHB1dFswXSA9PSAnXDAnKSB7CiAgICAgICAgICAgIHN0cm5jcHkob3V0cHV0LCBidWZmZXIsIG91dHB1dF9zaXplIC0gMSk7CiAgICAgICAgICAgIG91dHB1dFtvdXRwdXRfc2l6ZSAtIDFdID0gJ1wwJzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHRvdGFsX3ZlcmJvc2Vfc2l6ZSArIHN0cmxlbihidWZmZXIpIDwgdmVyYm9zZV9zaXplIC0gMSkgewogICAgICAgICAgICBzdHJjYXQodmVyYm9zZV9vdXRwdXQsIGJ1ZmZlcik7CiAgICAgICAgICAgIHN0cmNhdCh2ZXJib3NlX291dHB1dCwgIlxuIik7CiAgICAgICAgICAgIHRvdGFsX3ZlcmJvc2Vfc2l6ZSArPSBzdHJsZW4oYnVmZmVyKSArIDE7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpbnQgc3RhdHVzID0gcGNsb3NlKGZwKTsKICAgIGludCByZXN1bHQ7CiAgICAKICAgIGlmIChXSUZFWElURUQoc3RhdHVzKSkgewogICAgICAgIGludCBleGl0X2NvZGUgPSBXRVhJVFNUQVRVUyhzdGF0dXMpOwogICAgICAgIGlmIChzdHJzdHIoY29tbWFuZCwgImdyZXAiKSAhPSBOVUxMKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IChleGl0X2NvZGUgPT0gMCB8fCBleGl0X2NvZGUgPT0gMSkgPyAwIDogLTE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gKGV4aXRfY29kZSA9PSAwKSA/IDAgOiAtMTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHJlc3VsdCA9IC0xOwogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gRXhpdDogJWQsIE91dHB1dDogJXNcbiIgUkVTRVQsIHJlc3VsdCwgb3V0cHV0KTsKICAgIH0KICAgIAogICAgcmV0dXJuIHJlc3VsdDsKfQoKaW50IGV4ZWN1dGVfdGVzdF93aXRoX3ZlcmlmaWNhdGlvbihUZXN0Q2FzZSAqdGVzdCkgewogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIAogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCB0ZXN0LT5kZXNjcmlwdGlvbik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgbG9uZyBsb25nIHN0YXJ0X3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAKICAgIGludCByZXN1bHQgPSBzeXN0ZW0odGVzdC0+Y29tbWFuZCk7CiAgICBsb25nIGxvbmcgZW5kX3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAKICAgIHRlc3QtPmR1cmF0aW9uX21zID0gZW5kX3RpbWUgLSBzdGFydF90aW1lOwogICAgdGVzdC0+c3VjY2VzcyA9IChyZXN1bHQgPT0gMCk7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSB0ZXN0LT5kdXJhdGlvbl9tczsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSAmJiAhdGVzdC0+c3VjY2VzcykgewogICAgICAgIHByaW50ZihZRUxMT1cgIlxuICBbVkVSQk9TRV0gQ29tbWFuZCBmYWlsZWQ6ICVzXG4iIFJFU0VULCB0ZXN0LT5jb21tYW5kKTsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBFeGl0IGNvZGU6ICVkXG4iIFJFU0VULCByZXN1bHQpOwogICAgfQogICAgCiAgICB0ZXN0LT52ZXJpZmljYXRpb25fc3VjY2VzcyA9IDE7CiAgICBpZiAodGVzdC0+c3VjY2VzcyAmJiB0ZXN0LT52ZXJpZmljYXRpb25fY29tbWFuZFswXSAhPSAnXDAnKSB7CiAgICAgICAgY2hhciB2ZXJpZmljYXRpb25fb3V0cHV0WzEwMjRdOwogICAgICAgIGNoYXIgdmVyYm9zZV9vdXRwdXRbNDA5Nl07CiAgICAgICAgaW50IHZlcmlmaWNhdGlvbl9yZXN1bHQ7CiAgICAgICAgCiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICB2ZXJpZmljYXRpb25fcmVzdWx0ID0gZXhlY3V0ZV9jb21tYW5kX2FuZF9jYXB0dXJlX3ZlcmJvc2UodGVzdC0+dmVyaWZpY2F0aW9uX2NvbW1hbmQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyaWZpY2F0aW9uX291dHB1dCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplb2YodmVyaWZpY2F0aW9uX291dHB1dCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJib3NlX291dHB1dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZih2ZXJib3NlX291dHB1dCkpOwogICAgICAgICAgICBzdHJuY3B5KHRlc3QtPnZlcmJvc2Vfb3V0cHV0LCB2ZXJib3NlX291dHB1dCwgc2l6ZW9mKHRlc3QtPnZlcmJvc2Vfb3V0cHV0KSAtIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9yZXN1bHQgPSBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmUodGVzdC0+dmVyaWZpY2F0aW9uX2NvbW1hbmQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25fb3V0cHV0LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKHZlcmlmaWNhdGlvbl9vdXRwdXQpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHZlcmlmaWNhdGlvbl9yZXN1bHQgPT0gMCkgewogICAgICAgICAgICBpZiAodGVzdC0+ZXhwZWN0ZWRfb3V0cHV0WzBdICE9ICdcMCcpIHsKICAgICAgICAgICAgICAgIGlmIChzdHJzdHIodmVyaWZpY2F0aW9uX291dHB1dCwgdGVzdC0+ZXhwZWN0ZWRfb3V0cHV0KSA9PSBOVUxMKSB7CiAgICAgICAgICAgICAgICAgICAgdGVzdC0+dmVyaWZpY2F0aW9uX3N1Y2Nlc3MgPSAwOwogICAgICAgICAgICAgICAgICAgIHN0cm5jcHkodGVzdC0+ZGV0YWlscywgdmVyaWZpY2F0aW9uX291dHB1dCwgc2l6ZW9mKHRlc3QtPmRldGFpbHMpIC0gMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXN0LT52ZXJpZmljYXRpb25fc3VjY2VzcyA9IDA7CiAgICAgICAgICAgIHN0cmNweSh0ZXN0LT5kZXRhaWxzLCAiVmVyaWZpY2F0aW9uIGNvbW1hbmQgZmFpbGVkIik7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpbnQgb3ZlcmFsbF9zdWNjZXNzID0gdGVzdC0+c3VjY2VzcyAmJiB0ZXN0LT52ZXJpZmljYXRpb25fc3VjY2VzczsKICAgIAogICAgaWYgKG92ZXJhbGxfc3VjY2VzcykgewogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdIik7CiAgICB9IGVsc2UgewogICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgIGlmICh0ZXN0LT5jcml0aWNhbCkgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl0iKTsKICAgIH0KICAgIAogICAgcHJpbnRmKCIgJXMlNGxsZCBtcyVzXG4iLCBDWUFOLCB0ZXN0LT5kdXJhdGlvbl9tcywgUkVTRVQpOwogICAgCiAgICBpZiAoIW92ZXJhbGxfc3VjY2VzcyAmJiB2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBGQUlMVVJFOiAlc1xuIiBSRVNFVCwgdGVzdC0+ZGV0YWlscyk7CiAgICB9CiAgICAKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbdGVzdC0+Y2F0ZWdvcnldKys7CiAgICBpZiAob3ZlcmFsbF9zdWNjZXNzKSBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFt0ZXN0LT5jYXRlZ29yeV0rKzsKICAgIAogICAgcmV0dXJuIG92ZXJhbGxfc3VjY2VzczsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gSFRUUCBDTElFTlQgSU1QTEVNRU5UQVRJT04gKEVuaGFuY2VkKSA9PT09PT09PT09PT09PT09PT09PQoKSHR0cFJlc3BvbnNlKiBodHRwX3JlcXVlc3QoY29uc3QgY2hhciogbWV0aG9kLCBjb25zdCBjaGFyKiB1cmwsIGNvbnN0IGNoYXIqIGJvZHksIGNvbnN0IGNoYXIqIGNvbnRlbnRfdHlwZSkgewogICAgSHR0cFJlc3BvbnNlKiByZXNwb25zZSA9IG1hbGxvYyhzaXplb2YoSHR0cFJlc3BvbnNlKSk7CiAgICBpZiAoIXJlc3BvbnNlKSByZXR1cm4gTlVMTDsKICAgIAogICAgbWVtc2V0KHJlc3BvbnNlLCAwLCBzaXplb2YoSHR0cFJlc3BvbnNlKSk7CiAgICAKICAgIGNoYXIgZnVsbF91cmxbMTAyNF07CiAgICBpZiAoc3RybmNtcCh1cmwsICJodHRwOi8vIiwgNykgIT0gMCAmJiBzdHJuY21wKHVybCwgImh0dHBzOi8vIiwgOCkgIT0gMCkgewogICAgICAgIHNucHJpbnRmKGZ1bGxfdXJsLCBzaXplb2YoZnVsbF91cmwpLCAiJXMlcyIsIHNlcnZlcl91cmwsIHVybCk7CiAgICB9IGVsc2UgewogICAgICAgIHN0cm5jcHkoZnVsbF91cmwsIHVybCwgc2l6ZW9mKGZ1bGxfdXJsKSAtIDEpOwogICAgfQogICAgCiAgICBjaGFyIGhvc3RbMjU2XSA9ICJsb2NhbGhvc3QiOwogICAgaW50IHBvcnQgPSA4MDgwOwogICAgY2hhciBwYXRoWzEwMjRdID0gIi8iOwogICAgCiAgICBpZiAoc3RybmNtcChmdWxsX3VybCwgImh0dHA6Ly8iLCA3KSA9PSAwKSB7CiAgICAgICAgY29uc3QgY2hhciogaG9zdF9zdGFydCA9IGZ1bGxfdXJsICsgNzsKICAgICAgICBjb25zdCBjaGFyKiBwYXRoX3N0YXJ0ID0gc3RyY2hyKGhvc3Rfc3RhcnQsICcvJyk7CiAgICAgICAgY29uc3QgY2hhciogcG9ydF9zdGFydCA9IHN0cmNocihob3N0X3N0YXJ0LCAnOicpOwogICAgICAgIAogICAgICAgIGlmIChwb3J0X3N0YXJ0ICYmICghcGF0aF9zdGFydCB8fCBwb3J0X3N0YXJ0IDwgcGF0aF9zdGFydCkpIHsKICAgICAgICAgICAgc2l6ZV90IGhvc3RfbGVuID0gcG9ydF9zdGFydCAtIGhvc3Rfc3RhcnQ7CiAgICAgICAgICAgIHN0cm5jcHkoaG9zdCwgaG9zdF9zdGFydCwgaG9zdF9sZW4pOwogICAgICAgICAgICBob3N0W2hvc3RfbGVuXSA9ICdcMCc7CiAgICAgICAgICAgIHBvcnQgPSBhdG9pKHBvcnRfc3RhcnQgKyAxKTsKICAgICAgICAgICAgaWYgKHBhdGhfc3RhcnQpIHN0cmNweShwYXRoLCBwYXRoX3N0YXJ0KTsKICAgICAgICB9IGVsc2UgaWYgKHBhdGhfc3RhcnQpIHsKICAgICAgICAgICAgc2l6ZV90IGhvc3RfbGVuID0gcGF0aF9zdGFydCAtIGhvc3Rfc3RhcnQ7CiAgICAgICAgICAgIHN0cm5jcHkoaG9zdCwgaG9zdF9zdGFydCwgaG9zdF9sZW4pOwogICAgICAgICAgICBob3N0W2hvc3RfbGVuXSA9ICdcMCc7CiAgICAgICAgICAgIHN0cmNweShwYXRoLCBwYXRoX3N0YXJ0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdHJjcHkoaG9zdCwgaG9zdF9zdGFydCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpbnQgc29ja2ZkID0gc29ja2V0KEFGX0lORVQsIFNPQ0tfU1RSRUFNLCAwKTsKICAgIGlmIChzb2NrZmQgPCAwKSB7CiAgICAgICAgZnJlZShyZXNwb25zZSk7CiAgICAgICAgcmV0dXJuIE5VTEw7CiAgICB9CiAgICAKICAgIHN0cnVjdCB0aW1ldmFsIHRpbWVvdXQ7CiAgICB0aW1lb3V0LnR2X3NlYyA9IDMwOwogICAgdGltZW91dC50dl91c2VjID0gMDsKICAgIHNldHNvY2tvcHQoc29ja2ZkLCBTT0xfU09DS0VULCBTT19SQ1ZUSU1FTywgJnRpbWVvdXQsIHNpemVvZih0aW1lb3V0KSk7CiAgICBzZXRzb2Nrb3B0KHNvY2tmZCwgU09MX1NPQ0tFVCwgU09fU05EVElNRU8sICZ0aW1lb3V0LCBzaXplb2YodGltZW91dCkpOwogICAgCiAgICBzdHJ1Y3QgaG9zdGVudCogc2VydmVyID0gZ2V0aG9zdGJ5bmFtZShob3N0KTsKICAgIGlmICghc2VydmVyKSB7CiAgICAgICAgY2xvc2Uoc29ja2ZkKTsKICAgICAgICBmcmVlKHJlc3BvbnNlKTsKICAgICAgICByZXR1cm4gTlVMTDsKICAgIH0KICAgIAogICAgc3RydWN0IHNvY2thZGRyX2luIHNlcnZfYWRkcjsKICAgIG1lbXNldCgmc2Vydl9hZGRyLCAwLCBzaXplb2Yoc2Vydl9hZGRyKSk7CiAgICBzZXJ2X2FkZHIuc2luX2ZhbWlseSA9IEFGX0lORVQ7CiAgICBtZW1jcHkoJnNlcnZfYWRkci5zaW5fYWRkci5zX2FkZHIsIHNlcnZlci0+aF9hZGRyLCBzZXJ2ZXItPmhfbGVuZ3RoKTsKICAgIHNlcnZfYWRkci5zaW5fcG9ydCA9IGh0b25zKHBvcnQpOwogICAgCiAgICBpZiAoY29ubmVjdChzb2NrZmQsIChzdHJ1Y3Qgc29ja2FkZHIqKSZzZXJ2X2FkZHIsIHNpemVvZihzZXJ2X2FkZHIpKSA8IDApIHsKICAgICAgICBjbG9zZShzb2NrZmQpOwogICAgICAgIGZyZWUocmVzcG9uc2UpOwogICAgICAgIHJldHVybiBOVUxMOwogICAgfQogICAgCiAgICBjaGFyIHJlcXVlc3RbMTYzODRdOwogICAgaW50IHJlcXVlc3RfbGVuOwogICAgCiAgICBpZiAoYm9keSAmJiBjb250ZW50X3R5cGUpIHsKICAgICAgICByZXF1ZXN0X2xlbiA9IHNucHJpbnRmKHJlcXVlc3QsIHNpemVvZihyZXF1ZXN0KSwKICAgICAgICAgICAgIiVzICVzIEhUVFAvMS4xXHJcbiIKICAgICAgICAgICAgIkhvc3Q6ICVzOiVkXHJcbiIKICAgICAgICAgICAgIkNvbnRlbnQtVHlwZTogJXNcclxuIgogICAgICAgICAgICAiQ29udGVudC1MZW5ndGg6ICV6dVxyXG4iCiAgICAgICAgICAgICJDb25uZWN0aW9uOiBjbG9zZVxyXG4iCiAgICAgICAgICAgICJcclxuIgogICAgICAgICAgICAiJXMiLAogICAgICAgICAgICBtZXRob2QsIHBhdGgsIGhvc3QsIHBvcnQsIGNvbnRlbnRfdHlwZSwgc3RybGVuKGJvZHkpLCBib2R5KTsKICAgIH0gZWxzZSBpZiAoYm9keSkgewogICAgICAgIHJlcXVlc3RfbGVuID0gc25wcmludGYocmVxdWVzdCwgc2l6ZW9mKHJlcXVlc3QpLAogICAgICAgICAgICAiJXMgJXMgSFRUUC8xLjFcclxuIgogICAgICAgICAgICAiSG9zdDogJXM6JWRcclxuIgogICAgICAgICAgICAiQ29udGVudC1MZW5ndGg6ICV6dVxyXG4iCiAgICAgICAgICAgICJDb25uZWN0aW9uOiBjbG9zZVxyXG4iCiAgICAgICAgICAgICJcclxuIgogICAgICAgICAgICAiJXMiLAogICAgICAgICAgICBtZXRob2QsIHBhdGgsIGhvc3QsIHBvcnQsIHN0cmxlbihib2R5KSwgYm9keSk7CiAgICB9IGVsc2UgewogICAgICAgIHJlcXVlc3RfbGVuID0gc25wcmludGYocmVxdWVzdCwgc2l6ZW9mKHJlcXVlc3QpLAogICAgICAgICAgICAiJXMgJXMgSFRUUC8xLjFcclxuIgogICAgICAgICAgICAiSG9zdDogJXM6JWRcclxuIgogICAgICAgICAgICAiQ29ubmVjdGlvbjogY2xvc2VcclxuIgogICAgICAgICAgICAiXHJcbiIsCiAgICAgICAgICAgIG1ldGhvZCwgcGF0aCwgaG9zdCwgcG9ydCk7CiAgICB9CiAgICAKICAgIGlmIChzZW5kKHNvY2tmZCwgcmVxdWVzdCwgcmVxdWVzdF9sZW4sIDApIDwgMCkgewogICAgICAgIGNsb3NlKHNvY2tmZCk7CiAgICAgICAgZnJlZShyZXNwb25zZSk7CiAgICAgICAgcmV0dXJuIE5VTEw7CiAgICB9CiAgICAKICAgIGNoYXIgcmVzcG9uc2VfYnVmZmVyWzY1NTM2XTsKICAgIHNzaXplX3QgdG90YWxfcmVjZWl2ZWQgPSAwOwogICAgc3NpemVfdCByZWNlaXZlZDsKICAgIAogICAgd2hpbGUgKChyZWNlaXZlZCA9IHJlY3Yoc29ja2ZkLCByZXNwb25zZV9idWZmZXIgKyB0b3RhbF9yZWNlaXZlZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZihyZXNwb25zZV9idWZmZXIpIC0gdG90YWxfcmVjZWl2ZWQgLSAxLCAwKSkgPiAwKSB7CiAgICAgICAgdG90YWxfcmVjZWl2ZWQgKz0gcmVjZWl2ZWQ7CiAgICAgICAgaWYgKHRvdGFsX3JlY2VpdmVkID49IChzc2l6ZV90KXNpemVvZihyZXNwb25zZV9idWZmZXIpIC0gMSkgYnJlYWs7CiAgICB9CiAgICAKICAgIHJlc3BvbnNlX2J1ZmZlclt0b3RhbF9yZWNlaXZlZF0gPSAnXDAnOwogICAgY2xvc2Uoc29ja2ZkKTsKICAgIAogICAgY2hhciogc3RhdHVzX2xpbmUgPSBzdHJzdHIocmVzcG9uc2VfYnVmZmVyLCAiSFRUUC8xLjEiKTsKICAgIGlmIChzdGF0dXNfbGluZSkgewogICAgICAgIHNzY2FuZihzdGF0dXNfbGluZSwgIkhUVFAvMS4xICVkIiwgJnJlc3BvbnNlLT5zdGF0dXNfY29kZSk7CiAgICB9CiAgICAKICAgIGNoYXIqIGJvZHlfc3RhcnQgPSBzdHJzdHIocmVzcG9uc2VfYnVmZmVyLCAiXHJcblxyXG4iKTsKICAgIGlmIChib2R5X3N0YXJ0KSB7CiAgICAgICAgYm9keV9zdGFydCArPSA0OwogICAgICAgIHJlc3BvbnNlLT5ib2R5X2xlbmd0aCA9IHRvdGFsX3JlY2VpdmVkIC0gKGJvZHlfc3RhcnQgLSByZXNwb25zZV9idWZmZXIpOwogICAgICAgIHJlc3BvbnNlLT5ib2R5ID0gbWFsbG9jKHJlc3BvbnNlLT5ib2R5X2xlbmd0aCArIDEpOwogICAgICAgIGlmIChyZXNwb25zZS0+Ym9keSkgewogICAgICAgICAgICBtZW1jcHkocmVzcG9uc2UtPmJvZHksIGJvZHlfc3RhcnQsIHJlc3BvbnNlLT5ib2R5X2xlbmd0aCk7CiAgICAgICAgICAgIHJlc3BvbnNlLT5ib2R5W3Jlc3BvbnNlLT5ib2R5X2xlbmd0aF0gPSAnXDAnOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgcmVzcG9uc2UtPmJvZHkgPSBzdHJkdXAoIiIpOwogICAgICAgIHJlc3BvbnNlLT5ib2R5X2xlbmd0aCA9IDA7CiAgICB9CiAgICAKICAgIHJldHVybiByZXNwb25zZTsKfQoKdm9pZCBodHRwX3Jlc3BvbnNlX2ZyZWUoSHR0cFJlc3BvbnNlKiByZXNwb25zZSkgewogICAgaWYgKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLT5ib2R5KSBmcmVlKHJlc3BvbnNlLT5ib2R5KTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJlc3BvbnNlLT5oZWFkZXJfY291bnQ7IGkrKykgewogICAgICAgICAgICBmcmVlKHJlc3BvbnNlLT5oZWFkZXJzW2ldKTsKICAgICAgICB9CiAgICAgICAgZnJlZShyZXNwb25zZSk7CiAgICB9Cn0KCmludCB2ZXJpZnlfaHR0cF9yZXNwb25zZShjb25zdCBIdHRwUmVzcG9uc2UqIHJlc3BvbnNlLCBjb25zdCBjaGFyKiBleHBlY3RlZF9wYXR0ZXJuLCBpbnQgY2hlY2tfc3VjY2Vzc19vbmx5KSB7CiAgICBpZiAoIXJlc3BvbnNlKSByZXR1cm4gMDsKICAgIAogICAgaWYgKGNoZWNrX3N1Y2Nlc3Nfb25seSkgewogICAgICAgIHJldHVybiAocmVzcG9uc2UtPnN0YXR1c19jb2RlID49IDIwMCAmJiByZXNwb25zZS0+c3RhdHVzX2NvZGUgPCA1MDApICYmIAogICAgICAgICAgICAgICByZXNwb25zZS0+Ym9keSAmJiBzdHJzdHIocmVzcG9uc2UtPmJvZHksICJcInN1Y2Nlc3NcIjoiKSAhPSBOVUxMOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAocmVzcG9uc2UtPnN0YXR1c19jb2RlIDwgMjAwIHx8IHJlc3BvbnNlLT5zdGF0dXNfY29kZSA+PSAzMDApIHJldHVybiAwOwogICAgICAgIGlmIChleHBlY3RlZF9wYXR0ZXJuICYmIGV4cGVjdGVkX3BhdHRlcm5bMF0gIT0gJ1wwJykgewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLT5ib2R5IHx8IHN0cnN0cihyZXNwb25zZS0+Ym9keSwgZXhwZWN0ZWRfcGF0dGVybikgPT0gTlVMTCkgcmV0dXJuIDA7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIDE7Cn0KCmNoYXIqIGV4dHJhY3RfanNvbl9maWVsZChjb25zdCBjaGFyKiBqc29uLCBjb25zdCBjaGFyKiBmaWVsZCkgewogICAgaWYgKCFqc29uIHx8ICFmaWVsZCkgcmV0dXJuIE5VTEw7CiAgICAKICAgIGNoYXIgc2VhcmNoX3BhdHRlcm5bMjU2XTsKICAgIHNucHJpbnRmKHNlYXJjaF9wYXR0ZXJuLCBzaXplb2Yoc2VhcmNoX3BhdHRlcm4pLCAiXCIlc1wiOlwiIiwgZmllbGQpOwogICAgCiAgICBjaGFyKiBmaWVsZF9zdGFydCA9IHN0cnN0cihqc29uLCBzZWFyY2hfcGF0dGVybik7CiAgICBpZiAoIWZpZWxkX3N0YXJ0KSB7CiAgICAgICAgc25wcmludGYoc2VhcmNoX3BhdHRlcm4sIHNpemVvZihzZWFyY2hfcGF0dGVybiksICJcIiVzXCI6IiwgZmllbGQpOwogICAgICAgIGZpZWxkX3N0YXJ0ID0gc3Ryc3RyKGpzb24sIHNlYXJjaF9wYXR0ZXJuKTsKICAgICAgICBpZiAoIWZpZWxkX3N0YXJ0KSByZXR1cm4gTlVMTDsKICAgICAgICAKICAgICAgICBmaWVsZF9zdGFydCArPSBzdHJsZW4oc2VhcmNoX3BhdHRlcm4pOwogICAgICAgIGNoYXIqIGZpZWxkX2VuZCA9IHN0cmNocihmaWVsZF9zdGFydCwgJywnKTsKICAgICAgICBpZiAoIWZpZWxkX2VuZCkgZmllbGRfZW5kID0gc3RyY2hyKGZpZWxkX3N0YXJ0LCAnfScpOwogICAgICAgIGlmICghZmllbGRfZW5kKSByZXR1cm4gTlVMTDsKICAgICAgICAKICAgICAgICBzaXplX3QgZmllbGRfbGVuZ3RoID0gZmllbGRfZW5kIC0gZmllbGRfc3RhcnQ7CiAgICAgICAgY2hhciogdmFsdWUgPSBtYWxsb2MoZmllbGRfbGVuZ3RoICsgMSk7CiAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgIHN0cm5jcHkodmFsdWUsIGZpZWxkX3N0YXJ0LCBmaWVsZF9sZW5ndGgpOwogICAgICAgICAgICB2YWx1ZVtmaWVsZF9sZW5ndGhdID0gJ1wwJzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgCiAgICBmaWVsZF9zdGFydCArPSBzdHJsZW4oc2VhcmNoX3BhdHRlcm4pOwogICAgY2hhciogZmllbGRfZW5kID0gc3RyY2hyKGZpZWxkX3N0YXJ0LCAnIicpOwogICAgaWYgKCFmaWVsZF9lbmQpIHJldHVybiBOVUxMOwogICAgCiAgICBzaXplX3QgZmllbGRfbGVuZ3RoID0gZmllbGRfZW5kIC0gZmllbGRfc3RhcnQ7CiAgICBjaGFyKiB2YWx1ZSA9IG1hbGxvYyhmaWVsZF9sZW5ndGggKyAxKTsKICAgIGlmICh2YWx1ZSkgewogICAgICAgIHN0cm5jcHkodmFsdWUsIGZpZWxkX3N0YXJ0LCBmaWVsZF9sZW5ndGgpOwogICAgICAgIHZhbHVlW2ZpZWxkX2xlbmd0aF0gPSAnXDAnOwogICAgfQogICAgcmV0dXJuIHZhbHVlOwp9CgppbnQgaHR0cF90ZXN0X2VuZHBvaW50KGNvbnN0IGNoYXIqIGRlc2NyaXB0aW9uLCBjb25zdCBjaGFyKiBtZXRob2QsIGNvbnN0IGNoYXIqIGVuZHBvaW50LCAKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIqIGJvZHksIGNvbnN0IGNoYXIqIGV4cGVjdGVkX3BhdHRlcm4sIGludCBjaGVja19zdWNjZXNzX29ubHksIAogICAgICAgICAgICAgICAgICAgICAgbG9uZyBsb25nKiBkdXJhdGlvbiwgaW50IGNhdGVnb3J5LCBpbnQgY3JpdGljYWwpIHsKICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW2NhdGVnb3J5XSsrOwogICAgCiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsIGRlc2NyaXB0aW9uKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBsb25nIGxvbmcgc3RhcnRfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgSHR0cFJlc3BvbnNlKiByZXNwb25zZSA9IGh0dHBfcmVxdWVzdChtZXRob2QsIGVuZHBvaW50LCBib2R5LCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgbG9uZyBsb25nIGVuZF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgbG9uZyBsb25nIGVsYXBzZWQgPSBlbmRfdGltZSAtIHN0YXJ0X3RpbWU7CiAgICAKICAgIGlmIChkdXJhdGlvbikgKmR1cmF0aW9uID0gZWxhcHNlZDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGVsYXBzZWQ7CiAgICAKICAgIGludCBzdWNjZXNzID0gMDsKICAgIGlmIChyZXNwb25zZSkgewogICAgICAgIHN1Y2Nlc3MgPSB2ZXJpZnlfaHR0cF9yZXNwb25zZShyZXNwb25zZSwgZXhwZWN0ZWRfcGF0dGVybiwgY2hlY2tfc3VjY2Vzc19vbmx5KTsKICAgICAgICAKICAgICAgICBpZiAoc3VjY2VzcykgewogICAgICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbY2F0ZWdvcnldKys7CiAgICAgICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlc1xuIiwgQ1lBTiwgZWxhcHNlZCwgUkVTRVQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgICAgICBpZiAoY3JpdGljYWwpIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICAgICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIGVsYXBzZWQsIFJFU0VUKTsKICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gU3RhdHVzOiAlZCwgQm9keTogJS4xMDBzXG4iIFJFU0VULCAKICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS0+c3RhdHVzX2NvZGUsIHJlc3BvbnNlLT5ib2R5ID8gcmVzcG9uc2UtPmJvZHkgOiAiTlVMTCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwb25zZSk7CiAgICB9IGVsc2UgewogICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgIGlmIChjcml0aWNhbCkgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzXG4iLCBDWUFOLCBlbGFwc2VkLCBSRVNFVCk7CiAgICAgICAgcHJpbnRmKFJFRCAiICBObyByZXNwb25zZSBmcm9tIHNlcnZlclxuIiBSRVNFVCk7CiAgICB9CiAgICAKICAgIHJldHVybiBzdWNjZXNzOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBTRVJWRVIgTUFOQUdFTUVOVCA9PT09PT09PT09PT09PT09PT09PQoKaW50IHN0YXJ0X3N5ZGJfc2VydmVyKCkgewogICAgcHJpbnRmKCJTdGFydGluZyBTWURCIHNlcnZlciBvbiBwb3J0IDgwODAuLi5cbiIpOwogICAgCiAgICBzZXJ2ZXJfcGlkID0gZm9yaygpOwogICAgaWYgKHNlcnZlcl9waWQgPT0gMCkgewogICAgICAgIC8vIENoaWxkIHByb2Nlc3MKICAgICAgICBjaGFyKiBhcmdzWzRdOwogICAgICAgIGFyZ3NbMF0gPSBjbGlfY29tbWFuZDsKICAgICAgICBhcmdzWzFdID0gIi0tc2VydmVyIjsKICAgICAgICBhcmdzWzJdID0gdmVyYm9zZV9tb2RlID8gIi0tdmVyYm9zZSIgOiBOVUxMOwogICAgICAgIGFyZ3NbM10gPSBOVUxMOwogICAgICAgIAogICAgICAgIGV4ZWN2cChhcmdzWzBdLCBhcmdzKTsKICAgICAgICBleGl0KDEpOwogICAgfSBlbHNlIGlmIChzZXJ2ZXJfcGlkID4gMCkgewogICAgICAgIC8vIFBhcmVudCBwcm9jZXNzIC0gd2FpdCBmb3Igc2VydmVyIHRvIGJlIHJlYWR5CiAgICAgICAgc2VydmVyX3N0YXJ0ZWRfYnlfdGVzdCA9IDE7CiAgICAgICAgbXNsZWVwKDUwMCk7IC8vIEdpdmUgc2VydmVyIHRpbWUgdG8gc3RhcnQKICAgICAgICAKICAgICAgICBpZiAod2FpdF9mb3Jfc2VydmVyX3JlYWR5KDEwKSkgewogICAgICAgICAgICBwcmludGYoR1JFRU4gIlNlcnZlciBzdGFydGVkIHN1Y2Nlc3NmdWxseSAoUElEOiAlZClcbiIgUkVTRVQsIHNlcnZlcl9waWQpOwogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmludGYoUkVEICJTZXJ2ZXIgZmFpbGVkIHRvIHN0YXJ0XG4iIFJFU0VUKTsKICAgICAgICAgICAga2lsbChzZXJ2ZXJfcGlkLCBTSUdURVJNKTsKICAgICAgICAgICAgc2VydmVyX3BpZCA9IDA7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcmV0dXJuIDA7Cn0KCmludCBzdG9wX3N5ZGJfc2VydmVyKCkgewogICAgaWYgKHNlcnZlcl9waWQgPiAwICYmIHNlcnZlcl9zdGFydGVkX2J5X3Rlc3QpIHsKICAgICAgICBwcmludGYoIlN0b3BwaW5nIFNZREIgc2VydmVyIChQSUQ6ICVkKS4uLlxuIiwgc2VydmVyX3BpZCk7CiAgICAgICAga2lsbChzZXJ2ZXJfcGlkLCBTSUdURVJNKTsKICAgICAgICB3YWl0cGlkKHNlcnZlcl9waWQsIE5VTEwsIDApOwogICAgICAgIHNlcnZlcl9waWQgPSAwOwogICAgICAgIHNlcnZlcl9zdGFydGVkX2J5X3Rlc3QgPSAwOwogICAgICAgIG1zbGVlcCgyMDApOwogICAgICAgIHByaW50ZihHUkVFTiAiU2VydmVyIHN0b3BwZWRcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAxOwogICAgfQogICAgcmV0dXJuIDA7Cn0KCmludCB3YWl0X2Zvcl9zZXJ2ZXJfcmVhZHkoaW50IHRpbWVvdXRfc2Vjb25kcykgewogICAgcHJpbnRmKCJXYWl0aW5nIGZvciBzZXJ2ZXIgdG8gYmUgcmVhZHkuLi5cbiIpOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IHRpbWVvdXRfc2Vjb25kcyAqIDEwOyBpKyspIHsKICAgICAgICBIdHRwUmVzcG9uc2UqIHJlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KCJHRVQiLCAiL2FwaS9kYXRhYmFzZXMiLCBOVUxMLCBOVUxMKTsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UtPnN0YXR1c19jb2RlID4gMCkgewogICAgICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcG9uc2UpOwogICAgICAgICAgICBwcmludGYoR1JFRU4gIlNlcnZlciBpcyByZWFkeVxuIiBSRVNFVCk7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcG9uc2UpOwogICAgICAgIG1zbGVlcCgxMDApOwogICAgfQogICAgCiAgICByZXR1cm4gMDsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gRFVSQUJJTElUWSBURVNUUyAoQ1JJVElDQUwpID09PT09PT09PT09PT09PT09PT09CgppbnQgcnVuX2R1cmFiaWxpdHlfdGVzdHNfY2xpKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJEVVJBQklMSVRZICYgQ1JBU0ggUkVDT1ZFUlkgVEVTVFMgKENMSSkiIFJFU0VUICJcbiIpOwogICAgcHJpbnRmKFlFTExPVyAiVGhlc2UgdGVzdHMgdmVyaWZ5IGRhdGEgc3Vydml2ZXMgY3Jhc2hlcyBhbmQgcG93ZXIgZmFpbHVyZXNcbiIgUkVTRVQpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIC8vIENyZWF0ZSB0ZXN0IGRhdGFiYXNlIHdpdGggdW5pcXVlIG5hbWUKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJkdXJhYmlsaXR5X3Rlc3RfJWxkIiwgdGltZShOVUxMKSk7CiAgICAKICAgIC8vIFNldHVwCiAgICBjaGFyIHNldHVwX2NtZFs1MTJdOwogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgIiVzIGNyZWF0ZSAlcyA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICAKICAgIHNucHJpbnRmKHNldHVwX2NtZCwgc2l6ZW9mKHNldHVwX2NtZCksIAogICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nLXJlcSAtLWFnZS1pbnQgLS1kYXRhLXN0cmluZyA+IC9kZXYvbnVsbCAyPiYxIiwgCiAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0oc2V0dXBfY21kKTsKICAgIAogICAgLy8gVEVTVCAxOiBJbnNlcnQgd2l0aCBmc3luYyB2ZXJpZmljYXRpb24KICAgIHsKICAgICAgICB0b3RhbCsrOwogICAgICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlRFU1QgMTogSW5zZXJ0IHdpdGggaW1tZWRpYXRlIGR1cmFiaWxpdHkiKTsKICAgICAgICBmZmx1c2goc3Rkb3V0KTsKICAgICAgICAKICAgICAgICAvLyBJbnNlcnQgcmVjb3JkCiAgICAgICAgY2hhciBpbnNlcnRfY21kWzUxMl07CiAgICAgICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLCAKICAgICAgICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJEdXJhYmxlIFVzZXJcIiAtLWFnZS0yNSAtLWRhdGEtXCJUZXN0IGRhdGFcIiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAgICAgCiAgICAgICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgICAgIGludCByZXN1bHQgPSBzeXN0ZW0oaW5zZXJ0X2NtZCk7CiAgICAgICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICAgICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZHVyYXRpb247CiAgICAgICAgCiAgICAgICAgLy8gRm9yY2Ugc3luYyB0byBkaXNrICh0ZXN0IGlmIGZzeW5jIGlzIGNhbGxlZCkKICAgICAgICBjaGFyIHN5bmNfY21kWzI1Nl07CiAgICAgICAgc25wcmludGYoc3luY19jbWQsIHNpemVvZihzeW5jX2NtZCksICJzeW5jIik7CiAgICAgICAgc3lzdGVtKHN5bmNfY21kKTsKICAgICAgICAKICAgICAgICAvLyBDaGVjayBpZiByZWNvcmQgZXhpc3RzCiAgICAgICAgaW50IGNvdW50ID0gY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oZGJfbmFtZSwgInVzZXJzIik7CiAgICAgICAgCiAgICAgICAgaWYgKHJlc3VsdCA9PSAwICYmIGNvdW50ID49IDEpIHsKICAgICAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfRFVSQUJJTElUWV0rKzsKICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlc1xuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBSZWNvcmQgbm90IGZvdW5kIGFmdGVyIGluc2VydFxuIiBSRVNFVCk7CiAgICAgICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgICAgIH0KICAgICAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfRFVSQUJJTElUWV0rKzsKICAgIH0KICAgIAogICAgLy8gVEVTVCAyOiBDcmFzaCBkdXJpbmcgaW5zZXJ0IC0gcmVjb3ZlcnkgdGVzdAogICAgewogICAgICAgIHRvdGFsKys7CiAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCAyOiBDcmFzaCByZWNvdmVyeSAtIGtpbGwgZHVyaW5nIGluc2VydCIpOwogICAgICAgIGZmbHVzaChzdGRvdXQpOwogICAgICAgIAogICAgICAgIC8vIE9ubHkgcnVuIHRoaXMgdGVzdCBpbiBjb21wcmVoZW5zaXZlIG1vZGUKICAgICAgICBpZiAodGVzdF9sZXZlbCA+PSAyKSB7CiAgICAgICAgICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEZvcmsgYSBjaGlsZCB0byBzaW11bGF0ZSBjcmFzaAogICAgICAgICAgICBwaWRfdCBjaGlsZF9waWQgPSBmb3JrKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY2hpbGRfcGlkID09IDApIHsKICAgICAgICAgICAgICAgIC8vIENoaWxkIC0gcGVyZm9ybSBpbnNlcnQgYW5kIGNyYXNoCiAgICAgICAgICAgICAgICBjaGFyIGluc2VydF9jbWRbNTEyXTsKICAgICAgICAgICAgICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwKICAgICAgICAgICAgICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLWluc2VydC1vbmUgLS1uYW1lLVwiQ3Jhc2ggVGVzdFwiIC0tYWdlLTk5IC0tZGF0YS1cIlNob3VsZCByZWNvdmVyXCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc3lzdGVtKGluc2VydF9jbWQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTaW11bGF0ZSBjcmFzaCAtIGRvbid0IGNsZWFuIHVwCiAgICAgICAgICAgICAgICBleGl0KDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gUGFyZW50IC0gd2FpdCBmb3IgY2hpbGQKICAgICAgICAgICAgICAgIGludCBzdGF0dXM7CiAgICAgICAgICAgICAgICB3YWl0cGlkKGNoaWxkX3BpZCwgJnN0YXR1cywgMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGRhdGEgc3Vydml2ZWQKICAgICAgICAgICAgICAgIG1zbGVlcCg1MDApOyAvLyBHaXZlIHN5c3RlbSB0aW1lIHRvIHNldHRsZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpbnQgY291bnQgPSBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihkYl9uYW1lLCAidXNlcnMiKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICAgICAgICAgICAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gV2UgZG9uJ3Qga25vdyBpZiBpdCBzaG91bGQgc3Vydml2ZSAtIGp1c3QgcmVwb3J0IHdoYXQgaGFwcGVuZWQKICAgICAgICAgICAgICAgIGlmIChjb3VudCA+PSAyKSB7IC8vIFdlIGhhZCAxIGZyb20gcHJldmlvdXMgdGVzdAogICAgICAgICAgICAgICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIERhdGEgc3Vydml2ZWQgY3Jhc2hcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgICAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgICAgICAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfRFVSQUJJTElUWV0rKzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCJbIiBZRUxMT1cgIldBUk4iIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIERhdGEgbG9zdCBvbiBjcmFzaCAoZnN5bmMgbWlzc2luZz8pXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIC8vIE5vdCBtYXJraW5nIGFzIGZhaWwgYmVjYXVzZSB3ZSdyZSBqdXN0IGRvY3VtZW50aW5nIGJlaGF2aW9yCiAgICAgICAgICAgICAgICAgICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgICAgICAgICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfRFVSQUJJTElUWV0rKzsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHByaW50ZigiWyIgWUVMTE9XICJTS0lQIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIDAsIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKFlFTExPVyAiICBTa2lwcGVkICh1c2UgLS1sZXZlbD0yIGZvciBjb21wcmVoZW5zaXZlIHRlc3RpbmcpXG4iIFJFU0VUKTsKICAgICAgICAgICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gVEVTVCAzOiBQb3dlciBmYWlsdXJlIHNpbXVsYXRpb24gLSBmaWxlIHN5c3RlbSBjb25zaXN0ZW5jeQogICAgewogICAgICAgIHRvdGFsKys7CiAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCAzOiBGaWxlIHN5c3RlbSBjb25zaXN0ZW5jeSBhZnRlciBhYm5vcm1hbCB0ZXJtaW5hdGlvbiIpOwogICAgICAgIGZmbHVzaChzdGRvdXQpOwogICAgICAgIAogICAgICAgIGlmICh0ZXN0X2xldmVsID49IDIpIHsKICAgICAgICAgICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gR2V0IGZpbGUgcGF0aAogICAgICAgICAgICBjaGFyIGRhdGFfcGF0aFs1MTJdOwogICAgICAgICAgICBzbnByaW50ZihkYXRhX3BhdGgsIHNpemVvZihkYXRhX3BhdGgpLCAiL3RtcC9zeWRiX3Rlc3QvJXMvdXNlcnMvZGF0YS5zeWRiIiwgZGJfbmFtZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBHZXQgY2hlY2tzdW0gYmVmb3JlCiAgICAgICAgICAgIGludCBjaGVja3N1bV9iZWZvcmUgPSBjYWxjdWxhdGVfZmlsZV9jaGVja3N1bShkYXRhX3BhdGgpOwogICAgICAgICAgICBpbnQgc2l6ZV9iZWZvcmUgPSBnZXRfZmlsZV9zaXplKGRhdGFfcGF0aCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGb3JrIGFuZCBraWxsIC05CiAgICAgICAgICAgIHBpZF90IGNoaWxkX3BpZCA9IGZvcmsoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChjaGlsZF9waWQgPT0gMCkgewogICAgICAgICAgICAgICAgLy8gQ2hpbGQgLSBwZXJmb3JtIG11bHRpcGxlIGluc2VydHMKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGNoYXIgaW5zZXJ0X2NtZFs1MTJdOwogICAgICAgICAgICAgICAgICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIkJ1bGslZFwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUsIGkpOwogICAgICAgICAgICAgICAgICAgIHN5c3RlbShpbnNlcnRfY21kKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGV4aXQoMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBEb24ndCB3YWl0IC0ga2lsbCBpbW1lZGlhdGVseQogICAgICAgICAgICAgICAgdXNsZWVwKDUwMDAwKTsgLy8gNTBtcwogICAgICAgICAgICAgICAga2lsbChjaGlsZF9waWQsIFNJR0tJTEwpOwogICAgICAgICAgICAgICAgd2FpdHBpZChjaGlsZF9waWQsIE5VTEwsIDApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBtc2xlZXAoMjAwKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ2hlY2sgZmlsZSBpbnRlZ3JpdHkKICAgICAgICAgICAgICAgIGludCBjaGVja3N1bV9hZnRlciA9IGNhbGN1bGF0ZV9maWxlX2NoZWNrc3VtKGRhdGFfcGF0aCk7CiAgICAgICAgICAgICAgICBpbnQgc2l6ZV9hZnRlciA9IGdldF9maWxlX3NpemUoZGF0YV9wYXRoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICAgICAgICAgICAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRmlsZSBzaG91bGQgc3RpbGwgYmUgcmVhZGFibGUKICAgICAgICAgICAgICAgIGludCBjb3VudCA9IGNvdW50X2luc3RhbmNlc19pbl9jb2xsZWN0aW9uKGRiX25hbWUsICJ1c2VycyIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoY291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gRmlsZSByZWFkYWJsZSwgJWQgcmVjb3Jkc1xuIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIENZQU4sIGR1cmF0aW9uLCBSRVNFVCwgY291bnQpOwogICAgICAgICAgICAgICAgICAgIHBhc3NlZCsrOwogICAgICAgICAgICAgICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgICAgICAgICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX0RVUkFCSUxJVFldKys7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBGaWxlIGNvcnJ1cHRlZFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICBzdGF0cy5mYWlsZWRfdGVzdHMrKzsKICAgICAgICAgICAgICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgICAgICAgICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfRFVSQUJJTElUWV0rKzsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHByaW50ZigiWyIgWUVMTE9XICJTS0lQIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIDAsIFJFU0VUKTsKICAgICAgICAgICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gVEVTVCA0OiBDb25jdXJyZW50IGR1cmFiaWxpdHkgLSBtYW55IGluc2VydHMsIHRoZW4gdmVyaWZ5IGNvdW50CiAgICB7CiAgICAgICAgdG90YWwrKzsKICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDQ6IEJ1bGsgaW5zZXJ0IGR1cmFiaWxpdHkgKDEwMCByZWNvcmRzKSIpOwogICAgICAgIGZmbHVzaChzdGRvdXQpOwogICAgICAgIAogICAgICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgICAgICAKICAgICAgICBpbnQgc3VjY2Vzc19jb3VudCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDA7IGkrKykgewogICAgICAgICAgICBjaGFyIGluc2VydF9jbWRbNTEyXTsKICAgICAgICAgICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIkJ1bGtVc2VyJWRcIiAtLWFnZS0lZCA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSwgaSwgMjAgKyAoaSAlIDUwKSk7CiAgICAgICAgICAgIGlmIChzeXN0ZW0oaW5zZXJ0X2NtZCkgPT0gMCkgc3VjY2Vzc19jb3VudCsrOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBGb3JjZSBzeW5jCiAgICAgICAgc3lzdGVtKCJzeW5jIik7CiAgICAgICAgCiAgICAgICAgaW50IGZpbmFsX2NvdW50ID0gY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oZGJfbmFtZSwgInVzZXJzIik7CiAgICAgICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICAgICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZHVyYXRpb247CiAgICAgICAgCiAgICAgICAgaWYgKGZpbmFsX2NvdW50ID49IHN1Y2Nlc3NfY291bnQgJiYgc3VjY2Vzc19jb3VudCA+IDkwKSB7CiAgICAgICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtICVkLyVkIHJlY29yZHMgcGVyc2lzdGVkXG4iLCAKICAgICAgICAgICAgICAgICAgIENZQU4sIGR1cmF0aW9uLCBSRVNFVCwgZmluYWxfY291bnQsIHN1Y2Nlc3NfY291bnQpOwogICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX0RVUkFCSUxJVFldKys7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIE9ubHkgJWQvJWQgcmVjb3JkcyBwZXJzaXN0ZWRcbiIsIAogICAgICAgICAgICAgICAgICAgQ1lBTiwgZHVyYXRpb24sIFJFU0VULCBmaW5hbF9jb3VudCwgc3VjY2Vzc19jb3VudCk7CiAgICAgICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgICAgIH0KICAgICAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfRFVSQUJJTElUWV0rKzsKICAgIH0KICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBEdXJhYmlsaXR5IHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKaW50IHJ1bl9kdXJhYmlsaXR5X3Rlc3RzX2h0dHAoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIkRVUkFCSUxJVFkgJiBDUkFTSCBSRUNPVkVSWSBURVNUUyAoSFRUUCkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJodHRwX2R1cmFiaWxpdHlfJWxkIiwgdGltZShOVUxMKSk7CiAgICBjaGFyIGNyZWF0ZV9kYl9ib2R5WzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfZGJfYm9keSwgc2l6ZW9mKGNyZWF0ZV9kYl9ib2R5KSwgIntcIm5hbWVcIjpcIiVzXCJ9IiwgZGJfbmFtZSk7CiAgICAKICAgIC8vIENyZWF0ZSBkYXRhYmFzZQogICAgSHR0cFJlc3BvbnNlKiByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiX2JvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIC8vIENyZWF0ZSBjb2xsZWN0aW9uCiAgICBjaGFyIGNyZWF0ZV9jb2xsX3VybFsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2NvbGxfdXJsLCBzaXplb2YoY3JlYXRlX2NvbGxfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zIiwgZGJfbmFtZSk7CiAgICBjb25zdCBjaGFyKiBzY2hlbWEgPSAie1wibmFtZVwiOlwidXNlcnNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjp0cnVlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImFnZVwiLFwidHlwZVwiOlwiaW50XCJ9XX0iOwogICAgcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsIGNyZWF0ZV9jb2xsX3VybCwgc2NoZW1hLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICBjaGFyIGluc3RhbmNlc191cmxbMjU2XTsKICAgIHNucHJpbnRmKGluc3RhbmNlc191cmwsIHNpemVvZihpbnN0YW5jZXNfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcyIsIGRiX25hbWUpOwogICAgCiAgICAvLyBURVNUIDE6IEluc2VydCBhbmQgdmVyaWZ5CiAgICB0b3RhbCsrOwogICAgY29uc3QgY2hhciogdXNlcjEgPSAie1wibmFtZVwiOlwiRHVyYWJsZSBVc2VyXCIsXCJhZ2VcIjozMH0iOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiSFRUUDogSW5zZXJ0IHdpdGggZHVyYWJpbGl0eSB2ZXJpZmljYXRpb24iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsIGluc3RhbmNlc191cmwsIHVzZXIxLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9EVVJBQklMSVRZLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgCiAgICAvLyBURVNUIDI6IE11bHRpcGxlIGluc2VydHMgdW5kZXIgbG9hZAogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIkhUVFA6IEJ1bGsgaW5zZXJ0IGR1cmFiaWxpdHkgKDUwIHJlY29yZHMpIik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgaW50IHN1Y2Nlc3NfY291bnQgPSAwOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IDUwOyBpKyspIHsKICAgICAgICBjaGFyIHVzZXJfanNvblsyNTZdOwogICAgICAgIHNucHJpbnRmKHVzZXJfanNvbiwgc2l6ZW9mKHVzZXJfanNvbiksICJ7XCJuYW1lXCI6XCJVc2VyJWRcIixcImFnZVwiOiVkfSIsIGksIDIwICsgaSk7CiAgICAgICAgSHR0cFJlc3BvbnNlKiByID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgaW5zdGFuY2VzX3VybCwgdXNlcl9qc29uLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgICAgIGlmIChyICYmIHItPnN0YXR1c19jb2RlID49IDIwMCAmJiByLT5zdGF0dXNfY29kZSA8IDMwMCkgc3VjY2Vzc19jb3VudCsrOwogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyKTsKICAgIH0KICAgIAogICAgbG9uZyBsb25nIGVsYXBzZWQgPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGVsYXBzZWQ7CiAgICAKICAgIC8vIFZlcmlmeSB2aWEgR0VUCiAgICBIdHRwUmVzcG9uc2UqIHZlcmlmeV9yZXNwID0gaHR0cF9yZXF1ZXN0KCJHRVQiLCBpbnN0YW5jZXNfdXJsLCBOVUxMLCBOVUxMKTsKICAgIGludCByZWNvcmRfY291bnQgPSAwOwogICAgaWYgKHZlcmlmeV9yZXNwICYmIHZlcmlmeV9yZXNwLT5ib2R5KSB7CiAgICAgICAgY2hhciogcG9zID0gdmVyaWZ5X3Jlc3AtPmJvZHk7CiAgICAgICAgd2hpbGUgKChwb3MgPSBzdHJzdHIocG9zLCAiXCJfaWRcIiIpKSAhPSBOVUxMKSB7CiAgICAgICAgICAgIHJlY29yZF9jb3VudCsrOwogICAgICAgICAgICBwb3MgKz0gNTsKICAgICAgICB9CiAgICB9CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUodmVyaWZ5X3Jlc3ApOwogICAgCiAgICBpZiAocmVjb3JkX2NvdW50ID49IHN1Y2Nlc3NfY291bnQgJiYgc3VjY2Vzc19jb3VudCA+IDQ1KSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gJWQvJWQgcmVjb3Jkc1xuIiwgQ1lBTiwgZWxhcHNlZCwgUkVTRVQsIHJlY29yZF9jb3VudCwgc3VjY2Vzc19jb3VudCk7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfRFVSQUJJTElUWV0rKzsKICAgICAgICBwYXNzZWQrKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIE9ubHkgJWQvJWQgcmVjb3Jkc1xuIiwgQ1lBTiwgZWxhcHNlZCwgUkVTRVQsIHJlY29yZF9jb3VudCwgc3VjY2Vzc19jb3VudCk7CiAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX0RVUkFCSUxJVFldKys7CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgSFRUUCBEdXJhYmlsaXR5IHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gQ09OQ1VSUkVOQ1kgVEVTVFMgPT09PT09PT09PT09PT09PT09PT0KCi8vIFRocmVhZCBmdW5jdGlvbiBmb3IgY29uY3VycmVudCBpbnNlcnRzCnZvaWQqIGNvbmN1cnJlbnRfaW5zZXJ0X3RocmVhZCh2b2lkKiBhcmcpIHsKICAgIFRocmVhZFRlc3RDb250ZXh0KiBjdHggPSAoVGhyZWFkVGVzdENvbnRleHQqKWFyZzsKICAgIGN0eC0+c3VjY2Vzc19jb3VudCA9IDA7CiAgICBsb25nIGxvbmcgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY3R4LT5vcGVyYXRpb25zX2NvdW50OyBpKyspIHsKICAgICAgICBjaGFyIGNvbW1hbmRbNTEyXTsKICAgICAgICBzbnByaW50Zihjb21tYW5kLCBzaXplb2YoY29tbWFuZCksIAogICAgICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyAlcyAtLWluc2VydC1vbmUgLS1uYW1lLVwiVGhyZWFkJWRfJWRcIiAtLWFnZS0lZCA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBjdHgtPmRhdGFiYXNlLCBjdHgtPmNvbGxlY3Rpb24sIGN0eC0+dGhyZWFkX2lkLCBpLCAyMCArIChpICUgNTApKTsKICAgICAgICAKICAgICAgICBpZiAoc3lzdGVtKGNvbW1hbmQpID09IDApIHsKICAgICAgICAgICAgY3R4LT5zdWNjZXNzX2NvdW50Kys7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFNtYWxsIHlpZWxkIHRvIGluY3JlYXNlIGludGVybGVhdmluZwogICAgICAgIGlmIChpICUgMTAgPT0gMCkgdXNsZWVwKDEwMCk7CiAgICB9CiAgICAKICAgIGN0eC0+dG90YWxfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgcmV0dXJuIE5VTEw7Cn0KCmludCBydW5fY29uY3VycmVuY3lfdGVzdHNfY2xpKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJDT05DVVJSRU5DWSAmIFRIUkVBRCBTQUZFVFkgVEVTVFMgKENMSSkiIFJFU0VUICJcbiIpOwogICAgcHJpbnRmKFlFTExPVyAiVGhlc2UgdGVzdHMgdmVyaWZ5IHRoZSBkYXRhYmFzZSBoYW5kbGVzIGNvbmN1cnJlbnQgYWNjZXNzIGNvcnJlY3RseVxuIiBSRVNFVCk7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIAogICAgY2hhciBkYl9uYW1lWzY0XTsKICAgIHNucHJpbnRmKGRiX25hbWUsIHNpemVvZihkYl9uYW1lKSwgImNvbmN1cnJlbmN5X3Rlc3RfJWxkIiwgdGltZShOVUxMKSk7CiAgICAKICAgIC8vIFNldHVwCiAgICBjaGFyIHNldHVwX2NtZFs1MTJdOwogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgIiVzIGNyZWF0ZSAlcyA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAKICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZy1yZXEgLS1hZ2UtaW50ID4gL2Rldi9udWxsIDI+JjEiLCAKICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIHN5c3RlbShzZXR1cF9jbWQpOwogICAgCiAgICAvLyBURVNUIDE6IFR3byB0aHJlYWRzIGNvbmN1cnJlbnQgaW5zZXJ0cwogICAgaWYgKHRlc3RfbGV2ZWwgPj0gMSkgewogICAgICAgIHRvdGFsKys7CiAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCAxOiBUd28gdGhyZWFkcyAtIDEwMCBpbnNlcnRzIGVhY2giKTsKICAgICAgICBmZmx1c2goc3Rkb3V0KTsKICAgICAgICAKICAgICAgICBwdGhyZWFkX3QgdGhyZWFkc1syXTsKICAgICAgICBUaHJlYWRUZXN0Q29udGV4dCBjb250ZXh0c1syXTsKICAgICAgICAKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDI7IGkrKykgewogICAgICAgICAgICBtZW1zZXQoJmNvbnRleHRzW2ldLCAwLCBzaXplb2YoVGhyZWFkVGVzdENvbnRleHQpKTsKICAgICAgICAgICAgc3RyY3B5KGNvbnRleHRzW2ldLmRhdGFiYXNlLCBkYl9uYW1lKTsKICAgICAgICAgICAgc3RyY3B5KGNvbnRleHRzW2ldLmNvbGxlY3Rpb24sICJ1c2VycyIpOwogICAgICAgICAgICBjb250ZXh0c1tpXS50aHJlYWRfaWQgPSBpOwogICAgICAgICAgICBjb250ZXh0c1tpXS5vcGVyYXRpb25zX2NvdW50ID0gMTAwOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBsb25nIGxvbmcgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAgICAgCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAyOyBpKyspIHsKICAgICAgICAgICAgcHRocmVhZF9jcmVhdGUoJnRocmVhZHNbaV0sIE5VTEwsIGNvbmN1cnJlbnRfaW5zZXJ0X3RocmVhZCwgJmNvbnRleHRzW2ldKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAyOyBpKyspIHsKICAgICAgICAgICAgcHRocmVhZF9qb2luKHRocmVhZHNbaV0sIE5VTEwpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgICAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgICAgICAKICAgICAgICBpbnQgdG90YWxfc3VjY2VzcyA9IGNvbnRleHRzWzBdLnN1Y2Nlc3NfY291bnQgKyBjb250ZXh0c1sxXS5zdWNjZXNzX2NvdW50OwogICAgICAgIGludCBmaW5hbF9jb3VudCA9IGNvdW50X2luc3RhbmNlc19pbl9jb2xsZWN0aW9uKGRiX25hbWUsICJ1c2VycyIpOwogICAgICAgIAogICAgICAgIHByaW50ZigiIC0gJWQvJWQgbXNcbiIsIChpbnQpZHVyYXRpb24sIDApOwogICAgICAgIAogICAgICAgIGlmIChmaW5hbF9jb3VudCA9PSB0b3RhbF9zdWNjZXNzICYmIHRvdGFsX3N1Y2Nlc3MgPT0gMjAwKSB7CiAgICAgICAgICAgIHByaW50ZigiICBbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gQWxsICVkIHJlY29yZHMgaW5zZXJ0ZWQgc3VjY2Vzc2Z1bGx5XG4iLCB0b3RhbF9zdWNjZXNzKTsKICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9DT05DVVJSRU5DWV0rKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmludGYoIiAgWyIgUkVEICJGQUlMIiBSRVNFVCAiXSBFeHBlY3RlZCAlZCByZWNvcmRzLCBnb3QgJWQgKHN1Y2Nlc3NmdWwgaW5zZXJ0czogJWQpXG4iLCAKICAgICAgICAgICAgICAgICAgIDIwMCwgZmluYWxfY291bnQsIHRvdGFsX3N1Y2Nlc3MpOwogICAgICAgICAgICBzdGF0cy5mYWlsZWRfdGVzdHMrKzsKICAgICAgICAgICAgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgICAgICB9CiAgICAgICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX0NPTkNVUlJFTkNZXSsrOwogICAgfQogICAgCiAgICAvLyBURVNUIDI6IFJlYWRlci9Xcml0ZXIgY29uY3VycmVuY3kKICAgIHsKICAgICAgICB0b3RhbCsrOwogICAgICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlRFU1QgMjogUmVhZGVycyBkb24ndCBibG9jayB3cml0ZXJzIik7CiAgICAgICAgZmZsdXNoKHN0ZG91dCk7CiAgICAgICAgCiAgICAgICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgICAgIAogICAgICAgIC8vIFN0YXJ0IGEgbG9uZyByZWFkIG9wZXJhdGlvbiBpbiBiYWNrZ3JvdW5kCiAgICAgICAgcGlkX3QgcmVhZGVyX3BpZCA9IGZvcmsoKTsKICAgICAgICAKICAgICAgICBpZiAocmVhZGVyX3BpZCA9PSAwKSB7CiAgICAgICAgICAgIC8vIENoaWxkIC0gbG9uZyBydW5uaW5nIGxpc3Qgb3BlcmF0aW9uCiAgICAgICAgICAgIGNoYXIgbGlzdF9jbWRbNTEyXTsKICAgICAgICAgICAgc25wcmludGYobGlzdF9jbWQsIHNpemVvZihsaXN0X2NtZCksIAogICAgICAgICAgICAgICAgICAgICIlcyBsaXN0ICVzIHVzZXJzID4gL2Rldi9udWxsIDI+JjEiLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAgICAgIHN5c3RlbShsaXN0X2NtZCk7CiAgICAgICAgICAgICAgICB1c2xlZXAoMTAwMDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV4aXQoMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gUGFyZW50IC0gcGVyZm9ybSB3cml0ZXMgd2hpbGUgcmVhZCBpcyBoYXBwZW5pbmcKICAgICAgICAgICAgbXNsZWVwKDUwKTsgLy8gTGV0IHJlYWRlciBzdGFydAogICAgICAgICAgICAKICAgICAgICAgICAgaW50IHdyaXRlX3N1Y2Nlc3MgPSAwOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDIwOyBpKyspIHsKICAgICAgICAgICAgICAgIGNoYXIgaW5zZXJ0X2NtZFs1MTJdOwogICAgICAgICAgICAgICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAgICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJSVyVkXCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lLCBpKTsKICAgICAgICAgICAgICAgIGlmIChzeXN0ZW0oaW5zZXJ0X2NtZCkgPT0gMCkgd3JpdGVfc3VjY2VzcysrOwogICAgICAgICAgICAgICAgdXNsZWVwKDUwMDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBraWxsKHJlYWRlcl9waWQsIFNJR1RFUk0pOwogICAgICAgICAgICB3YWl0cGlkKHJlYWRlcl9waWQsIE5VTEwsIDApOwogICAgICAgICAgICAKICAgICAgICAgICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICAgICAgICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgICAgICAgICAKICAgICAgICAgICAgaW50IGZpbmFsX2NvdW50ID0gY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oZGJfbmFtZSwgInVzZXJzIik7CiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludGYoIiAtICVsbGQgbXNcbiIsIGR1cmF0aW9uKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh3cml0ZV9zdWNjZXNzID49IDE4KSB7CiAgICAgICAgICAgICAgICBwcmludGYoIiAgWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdIFdyaXRlcnMgY29tcGxldGVkIHdoaWxlIHJlYWRlcnMgYWN0aXZlOiAlZC8lZFxuIiwgCiAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVfc3VjY2VzcywgMjApOwogICAgICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICAgICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX0NPTkNVUlJFTkNZXSsrOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcHJpbnRmKCIgIFsiIFlFTExPVyAiV0FSTiIgUkVTRVQgIl0gV3JpdGVycyBibG9ja2VkIGJ5IHJlYWRlcnM6IG9ubHkgJWQvJWQgc3VjY2VlZGVkXG4iLCAKICAgICAgICAgICAgICAgICAgICAgICB3cml0ZV9zdWNjZXNzLCAyMCk7CiAgICAgICAgICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgICAgICAgICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9DT05DVVJSRU5DWV0rKzsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIFRFU1QgMzogSGlnaCBjb25jdXJyZW5jeSAtIDEwIHRocmVhZHMKICAgIGlmICh0ZXN0X2xldmVsID49IDIpIHsKICAgICAgICB0b3RhbCsrOwogICAgICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlRFU1QgMzogMTAgdGhyZWFkcyAtIDUwIGluc2VydHMgZWFjaCAoaGlnaCBjb25jdXJyZW5jeSkiKTsKICAgICAgICBmZmx1c2goc3Rkb3V0KTsKICAgICAgICAKICAgICAgICAjZGVmaW5lIFRIUkVBRF9DT1VOVCAxMAogICAgICAgIHB0aHJlYWRfdCB0aHJlYWRzW1RIUkVBRF9DT1VOVF07CiAgICAgICAgVGhyZWFkVGVzdENvbnRleHQgY29udGV4dHNbVEhSRUFEX0NPVU5UXTsKICAgICAgICAKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IFRIUkVBRF9DT1VOVDsgaSsrKSB7CiAgICAgICAgICAgIG1lbXNldCgmY29udGV4dHNbaV0sIDAsIHNpemVvZihUaHJlYWRUZXN0Q29udGV4dCkpOwogICAgICAgICAgICBzdHJjcHkoY29udGV4dHNbaV0uZGF0YWJhc2UsIGRiX25hbWUpOwogICAgICAgICAgICBzdHJjcHkoY29udGV4dHNbaV0uY29sbGVjdGlvbiwgInVzZXJzIik7CiAgICAgICAgICAgIGNvbnRleHRzW2ldLnRocmVhZF9pZCA9IGk7CiAgICAgICAgICAgIGNvbnRleHRzW2ldLm9wZXJhdGlvbnNfY291bnQgPSA1MDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgICAgIAogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgVEhSRUFEX0NPVU5UOyBpKyspIHsKICAgICAgICAgICAgcHRocmVhZF9jcmVhdGUoJnRocmVhZHNbaV0sIE5VTEwsIGNvbmN1cnJlbnRfaW5zZXJ0X3RocmVhZCwgJmNvbnRleHRzW2ldKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBUSFJFQURfQ09VTlQ7IGkrKykgewogICAgICAgICAgICBwdGhyZWFkX2pvaW4odGhyZWFkc1tpXSwgTlVMTCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxvbmcgbG9uZyBkdXJhdGlvbiA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgICAgIAogICAgICAgIGludCB0b3RhbF9zdWNjZXNzID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IFRIUkVBRF9DT1VOVDsgaSsrKSB7CiAgICAgICAgICAgIHRvdGFsX3N1Y2Nlc3MgKz0gY29udGV4dHNbaV0uc3VjY2Vzc19jb3VudDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaW50IGZpbmFsX2NvdW50ID0gY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oZGJfbmFtZSwgInVzZXJzIik7CiAgICAgICAgCiAgICAgICAgcHJpbnRmKCIgLSAlbGxkIG1zXG4iLCBkdXJhdGlvbik7CiAgICAgICAgCiAgICAgICAgaWYgKGZpbmFsX2NvdW50ID09IHRvdGFsX3N1Y2Nlc3MgJiYgdG90YWxfc3VjY2VzcyA+PSAoVEhSRUFEX0NPVU5UICogNTAgKiAwLjkpKSB7CiAgICAgICAgICAgIHByaW50ZigiICBbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJWQvJWQgcmVjb3JkcyBpbnNlcnRlZCBzdWNjZXNzZnVsbHlcbiIsIAogICAgICAgICAgICAgICAgICAgZmluYWxfY291bnQsIFRIUkVBRF9DT1VOVCAqIDUwKTsKICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9DT05DVVJSRU5DWV0rKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmludGYoIiAgWyIgUkVEICJGQUlMIiBSRVNFVCAiXSBFeHBlY3RlZCB+JWQsIGdvdCAlZCAoc3VjY2Vzc2Z1bDogJWQpXG4iLCAKICAgICAgICAgICAgICAgICAgIFRIUkVBRF9DT1VOVCAqIDUwLCBmaW5hbF9jb3VudCwgdG90YWxfc3VjY2Vzcyk7CiAgICAgICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgICAgIH0KICAgICAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfQ09OQ1VSUkVOQ1ldKys7CiAgICB9CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgQ29uY3VycmVuY3kgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyBIVFRQIGNvbmN1cnJlbmN5IHRlc3QgdGhyZWFkCnZvaWQqIGh0dHBfY29uY3VycmVudF90aHJlYWQodm9pZCogYXJnKSB7CiAgICBUaHJlYWRUZXN0Q29udGV4dCogY3R4ID0gKFRocmVhZFRlc3RDb250ZXh0Kilhcmc7CiAgICBjdHgtPnN1Y2Nlc3NfY291bnQgPSAwOwogICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgCiAgICBjaGFyIGluc3RhbmNlc191cmxbMjU2XTsKICAgIHNucHJpbnRmKGluc3RhbmNlc191cmwsIHNpemVvZihpbnN0YW5jZXNfdXJsKSwgCiAgICAgICAgICAgICAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvJXMvaW5zdGFuY2VzIiwgCiAgICAgICAgICAgICBjdHgtPmRhdGFiYXNlLCBjdHgtPmNvbGxlY3Rpb24pOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IGN0eC0+b3BlcmF0aW9uc19jb3VudDsgaSsrKSB7CiAgICAgICAgY2hhciB1c2VyX2pzb25bMjU2XTsKICAgICAgICBzbnByaW50Zih1c2VyX2pzb24sIHNpemVvZih1c2VyX2pzb24pLCAKICAgICAgICAgICAgICAgICJ7XCJuYW1lXCI6XCJIVFRQX1RocmVhZCVkXyVkXCIsXCJhZ2VcIjolZH0iLCAKICAgICAgICAgICAgICAgIGN0eC0+dGhyZWFkX2lkLCBpLCAyMCArIChpICUgNTApKTsKICAgICAgICAKICAgICAgICBIdHRwUmVzcG9uc2UqIHJlc3AgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCBpbnN0YW5jZXNfdXJsLCB1c2VyX2pzb24sICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICAgICAgaWYgKHJlc3AgJiYgcmVzcC0+c3RhdHVzX2NvZGUgPj0gMjAwICYmIHJlc3AtPnN0YXR1c19jb2RlIDwgMzAwKSB7CiAgICAgICAgICAgIGN0eC0+c3VjY2Vzc19jb3VudCsrOwogICAgICAgIH0KICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAgICAgCiAgICAgICAgaWYgKGkgJSAxMCA9PSAwKSB1c2xlZXAoNTApOwogICAgfQogICAgCiAgICBjdHgtPnRvdGFsX3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHJldHVybiBOVUxMOwp9CgppbnQgcnVuX2NvbmN1cnJlbmN5X3Rlc3RzX2h0dHAoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIkNPTkNVUlJFTkNZICYgVEhSRUFEIFNBRkVUWSBURVNUUyAoSFRUUCkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIGlmICh0ZXN0X2xldmVsIDwgMSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgU2tpcHBpbmcgSFRUUCBjb25jdXJyZW5jeSB0ZXN0cyAodXNlIC0tbGV2ZWw9MSBvciBoaWdoZXIpXG4iIFJFU0VUKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgY2hhciBkYl9uYW1lWzY0XTsKICAgIHNucHJpbnRmKGRiX25hbWUsIHNpemVvZihkYl9uYW1lKSwgImh0dHBfY29uY18lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMjU2XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCBkYl9uYW1lKTsKICAgIEh0dHBSZXNwb25zZSogcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsIGNyZWF0ZV9kYl9ib2R5LCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICBjaGFyIGNyZWF0ZV9jb2xsX3VybFsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2NvbGxfdXJsLCBzaXplb2YoY3JlYXRlX2NvbGxfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zIiwgZGJfbmFtZSk7CiAgICBjb25zdCBjaGFyKiBzY2hlbWEgPSAie1wibmFtZVwiOlwidXNlcnNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjp0cnVlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImFnZVwiLFwidHlwZVwiOlwiaW50XCJ9XX0iOwogICAgcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsIGNyZWF0ZV9jb2xsX3VybCwgc2NoZW1hLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICAvLyBURVNUOiBDb25jdXJyZW50IEhUVFAgcmVxdWVzdHMKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJIVFRQOiA1IGNvbmN1cnJlbnQgdGhyZWFkcyAtIDI1IGluc2VydHMgZWFjaCIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgICNkZWZpbmUgSFRUUF9USFJFQURfQ09VTlQgNQogICAgcHRocmVhZF90IHRocmVhZHNbSFRUUF9USFJFQURfQ09VTlRdOwogICAgVGhyZWFkVGVzdENvbnRleHQgY29udGV4dHNbSFRUUF9USFJFQURfQ09VTlRdOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IEhUVFBfVEhSRUFEX0NPVU5UOyBpKyspIHsKICAgICAgICBtZW1zZXQoJmNvbnRleHRzW2ldLCAwLCBzaXplb2YoVGhyZWFkVGVzdENvbnRleHQpKTsKICAgICAgICBzdHJjcHkoY29udGV4dHNbaV0uZGF0YWJhc2UsIGRiX25hbWUpOwogICAgICAgIHN0cmNweShjb250ZXh0c1tpXS5jb2xsZWN0aW9uLCAidXNlcnMiKTsKICAgICAgICBjb250ZXh0c1tpXS50aHJlYWRfaWQgPSBpOwogICAgICAgIGNvbnRleHRzW2ldLm9wZXJhdGlvbnNfY291bnQgPSAyNTsKICAgIH0KICAgIAogICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IEhUVFBfVEhSRUFEX0NPVU5UOyBpKyspIHsKICAgICAgICBwdGhyZWFkX2NyZWF0ZSgmdGhyZWFkc1tpXSwgTlVMTCwgaHR0cF9jb25jdXJyZW50X3RocmVhZCwgJmNvbnRleHRzW2ldKTsKICAgIH0KICAgIAogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBIVFRQX1RIUkVBRF9DT1VOVDsgaSsrKSB7CiAgICAgICAgcHRocmVhZF9qb2luKHRocmVhZHNbaV0sIE5VTEwpOwogICAgfQogICAgCiAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICBpbnQgdG90YWxfc3VjY2VzcyA9IDA7CiAgICBmb3IgKGludCBpID0gMDsgaSA8IEhUVFBfVEhSRUFEX0NPVU5UOyBpKyspIHsKICAgICAgICB0b3RhbF9zdWNjZXNzICs9IGNvbnRleHRzW2ldLnN1Y2Nlc3NfY291bnQ7CiAgICB9CiAgICAKICAgIC8vIFZlcmlmeSBjb3VudCB2aWEgR0VUCiAgICBjaGFyIGluc3RhbmNlc191cmxbMjU2XTsKICAgIHNucHJpbnRmKGluc3RhbmNlc191cmwsIHNpemVvZihpbnN0YW5jZXNfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcyIsIGRiX25hbWUpOwogICAgSHR0cFJlc3BvbnNlKiB2ZXJpZnlfcmVzcCA9IGh0dHBfcmVxdWVzdCgiR0VUIiwgaW5zdGFuY2VzX3VybCwgTlVMTCwgTlVMTCk7CiAgICAKICAgIGludCByZWNvcmRfY291bnQgPSAwOwogICAgaWYgKHZlcmlmeV9yZXNwICYmIHZlcmlmeV9yZXNwLT5ib2R5KSB7CiAgICAgICAgY2hhciogcG9zID0gdmVyaWZ5X3Jlc3AtPmJvZHk7CiAgICAgICAgd2hpbGUgKChwb3MgPSBzdHJzdHIocG9zLCAiXCJfaWRcIiIpKSAhPSBOVUxMKSB7CiAgICAgICAgICAgIHJlY29yZF9jb3VudCsrOwogICAgICAgICAgICBwb3MgKz0gNTsKICAgICAgICB9CiAgICB9CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUodmVyaWZ5X3Jlc3ApOwogICAgCiAgICBwcmludGYoIiAtICVsbGQgbXNcbiIsIGR1cmF0aW9uKTsKICAgIAogICAgaWYgKHJlY29yZF9jb3VudCA9PSB0b3RhbF9zdWNjZXNzICYmIHRvdGFsX3N1Y2Nlc3MgPj0gKEhUVFBfVEhSRUFEX0NPVU5UICogMjUgKiAwLjkpKSB7CiAgICAgICAgcHJpbnRmKCIgIFsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSBIVFRQIGNvbmN1cnJlbmN5OiAlZC8lZCByZWNvcmRzXG4iLCByZWNvcmRfY291bnQsIHRvdGFsX3N1Y2Nlc3MpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX0NPTkNVUlJFTkNZXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIiAgWyIgUkVEICJGQUlMIiBSRVNFVCAiXSBFeHBlY3RlZCAlZCwgZ290ICVkIHJlY29yZHNcbiIsIAogICAgICAgICAgICAgICBIVFRQX1RIUkVBRF9DT1VOVCAqIDI1LCByZWNvcmRfY291bnQpOwogICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9DT05DVVJSRU5DWV0rKzsKICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBIVFRQIENvbmN1cnJlbmN5IHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gUVVFUlkgTEFOR1VBR0UgVEVTVFMgPT09PT09PT09PT09PT09PT09PT0KCmludCBydW5fcXVlcnlfbGFuZ3VhZ2VfdGVzdHNfY2xpKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJRVUVSWSBMQU5HVUFHRSAmIElOREVYSU5HIFRFU1RTIChDTEkpIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgCiAgICBjaGFyIGRiX25hbWVbNjRdOwogICAgc25wcmludGYoZGJfbmFtZSwgc2l6ZW9mKGRiX25hbWUpLCAicXVlcnlfdGVzdF8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAgd2l0aCBpbmRleGVkIGZpZWxkcwogICAgY2hhciBzZXR1cF9jbWRbNTEyXTsKICAgIHNucHJpbnRmKHNldHVwX2NtZCwgc2l6ZW9mKHNldHVwX2NtZCksICIlcyBjcmVhdGUgJXMgPiAvZGV2L251bGwgMj4mMSIsIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIHN5c3RlbShzZXR1cF9jbWQpOwogICAgCiAgICAvLyBDcmVhdGUgY29sbGVjdGlvbiB3aXRoIGluZGV4ZWQgZmllbGRzCiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAKICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZy1yZXEtaWR4IC0tYWdlLWludC1pZHggLS1lbWFpbC1zdHJpbmcgLS1zYWxhcnktZmxvYXQgPiAvZGV2L251bGwgMj4mMSIsIAogICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICAKICAgIC8vIEluc2VydCB0ZXN0IGRhdGEKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgNTA7IGkrKykgewogICAgICAgIGNoYXIgaW5zZXJ0X2NtZFs1MTJdOwogICAgICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwKICAgICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIlVzZXIlZFwiIC0tYWdlLSVkIC0tZW1haWwtXCJ1c2VyJWRAdGVzdC5jb21cIiAtLXNhbGFyeS0lLjJmID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUsIGksIDIwICsgKGkgJSAzMCksIGksIDMwMDAwLjAgKyBpICogMTAwMC4wKTsKICAgICAgICBzeXN0ZW0oaW5zZXJ0X2NtZCk7CiAgICB9CiAgICAKICAgIC8vIFRFU1QgMTogRXF1YWxpdHkgcXVlcnkgKGV4aXN0aW5nIGZ1bmN0aW9uYWxpdHkpCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCAxOiBFcXVhbGl0eSBxdWVyeSAtIGFnZToyNSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIGNoYXIgcXVlcnlfY21kWzUxMl07CiAgICBzbnByaW50ZihxdWVyeV9jbWQsIHNpemVvZihxdWVyeV9jbWQpLCAKICAgICAgICAgICAgICIlcyBmaW5kICVzIHVzZXJzIC0td2hlcmUgXCJhZ2U6MjVcIiB8IGdyZXAgLWMgVXNlciIsIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIAogICAgY2hhciBvdXRwdXRbMjU2XTsKICAgIGV4ZWN1dGVfY29tbWFuZF9hbmRfY2FwdHVyZShxdWVyeV9jbWQsIG91dHB1dCwgc2l6ZW9mKG91dHB1dCkpOwogICAgaW50IGNvdW50ID0gYXRvaShvdXRwdXQpOwogICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgaWYgKGNvdW50ID4gMCkgewogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIEZvdW5kICVkIHJlY29yZHNcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCwgY291bnQpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1FVRVJZXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gTm8gcmVzdWx0c1xuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBzdGF0cy5mYWlsZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfUVVFUlldKys7CiAgICAKICAgIC8vIFRFU1QgMjogR3JlYXRlciB0aGFuIHF1ZXJ5IChTSE9VTEQgRkFJTCAtIGZlYXR1cmUgbWlzc2luZykKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDI6IEdyZWF0ZXIgdGhhbiBxdWVyeSAtIGFnZT4zMCAoZmVhdHVyZSB0ZXN0KSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIC8vIFRoaXMgc2hvdWxkIGZhaWwgLSBTeURCIGRvZXNuJ3Qgc3VwcG9ydCA+IG9wZXJhdG9yCiAgICAvLyBXZSdyZSB0ZXN0aW5nIGlmIGl0IGZhaWxzIGdyYWNlZnVsbHkKICAgIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgc25wcmludGYocXVlcnlfY21kLCBzaXplb2YocXVlcnlfY21kKSwgCiAgICAgICAgICAgICAiJXMgZmluZCAlcyB1c2VycyAtLXdoZXJlIFwiYWdlPjMwXCIgMj4mMSB8IGdyZXAgLWkgJ2Vycm9yXFx8aW52YWxpZCciLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAKICAgIGludCBlcnJvcl9kZXRlY3RlZCA9IChzeXN0ZW0ocXVlcnlfY21kKSA9PSAwKTsKICAgIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgaWYgKGVycm9yX2RldGVjdGVkKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gVW5zdXBwb3J0ZWQgb3BlcmF0b3IgcHJvcGVybHkgcmVqZWN0ZWRcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfUVVFUlldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSA+IG9wZXJhdG9yIG5vdCByZWplY3RlZCAobWF5IGJlIGltcGxlbWVudGVkPylcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfUVVFUlldKys7CiAgICAKICAgIC8vIFRFU1QgMzogTGVzcyB0aGFuIHF1ZXJ5CiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCAzOiBMZXNzIHRoYW4gcXVlcnkgLSBhZ2U8MjUgKGZlYXR1cmUgdGVzdCkiKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIHNucHJpbnRmKHF1ZXJ5X2NtZCwgc2l6ZW9mKHF1ZXJ5X2NtZCksIAogICAgICAgICAgICAgIiVzIGZpbmQgJXMgdXNlcnMgLS13aGVyZSBcImFnZTwyNVwiIDI+JjEgfCBncmVwIC1pICdlcnJvclxcfGludmFsaWQnIiwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgCiAgICBlcnJvcl9kZXRlY3RlZCA9IChzeXN0ZW0ocXVlcnlfY21kKSA9PSAwKTsKICAgIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgaWYgKGVycm9yX2RldGVjdGVkKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gVW5zdXBwb3J0ZWQgb3BlcmF0b3IgcHJvcGVybHkgcmVqZWN0ZWRcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfUVVFUlldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSA8IG9wZXJhdG9yIG5vdCByZWplY3RlZFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9RVUVSWV0rKzsKICAgIAogICAgLy8gVEVTVCA0OiBBTkQgcXVlcnkgKGNvbW1hLXNlcGFyYXRlZCAtIGV4aXN0aW5nKQogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlRFU1QgNDogQU5EIHF1ZXJ5IC0gYWdlOjI1LG5hbWU6VXNlcjEiKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIHNucHJpbnRmKHF1ZXJ5X2NtZCwgc2l6ZW9mKHF1ZXJ5X2NtZCksIAogICAgICAgICAgICAgIiVzIGZpbmQgJXMgdXNlcnMgLS13aGVyZSBcImFnZToyNSxuYW1lOlVzZXIxXCIgfCBncmVwIC1jIFVzZXIxIiwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgCiAgICBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmUocXVlcnlfY21kLCBvdXRwdXQsIHNpemVvZihvdXRwdXQpKTsKICAgIGNvdW50ID0gYXRvaShvdXRwdXQpOwogICAgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICAvLyBUaGlzIHNob3VsZCBmaW5kIFVzZXIxIGlmIGFnZT0yNQogICAgaWYgKGNvdW50ID49IDApIHsgLy8gSnVzdCB2ZXJpZnkgaXQgcnVucyB3aXRob3V0IGVycm9yCiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gUXVlcnkgZXhlY3V0ZWRcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfUVVFUlldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBRdWVyeSBmYWlsZWRcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9RVUVSWV0rKzsKICAgIAogICAgLy8gVEVTVCA1OiBPUiBxdWVyeSAoZmVhdHVyZSB0ZXN0IC0gU0hPVUxEIEZBSUwpCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCA1OiBPUiBxdWVyeSAtIGFnZToyNSBPUiBhZ2U6MzAgKGZlYXR1cmUgdGVzdCkiKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIHNucHJpbnRmKHF1ZXJ5X2NtZCwgc2l6ZW9mKHF1ZXJ5X2NtZCksIAogICAgICAgICAgICAgIiVzIGZpbmQgJXMgdXNlcnMgLS13aGVyZSBcImFnZToyNSBPUiBhZ2U6MzBcIiAyPiYxIHwgZ3JlcCAtaSAnZXJyb3JcXHxpbnZhbGlkJyIsIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIAogICAgZXJyb3JfZGV0ZWN0ZWQgPSAoc3lzdGVtKHF1ZXJ5X2NtZCkgPT0gMCk7CiAgICBkdXJhdGlvbiA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChlcnJvcl9kZXRlY3RlZCkgewogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIFVuc3VwcG9ydGVkIE9SIHByb3Blcmx5IHJlamVjdGVkXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1FVRVJZXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlsiIFlFTExPVyAiV0FSTiIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gT1Igb3BlcmF0b3Igbm90IHJlamVjdGVkXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1FVRVJZXSsrOwogICAgCiAgICAvLyBURVNUIDY6IFJhbmdlIHF1ZXJ5IChmZWF0dXJlIHRlc3QpCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCA2OiBSYW5nZSBxdWVyeSAtIGFnZToyNS0zNSAoZmVhdHVyZSB0ZXN0KSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgc25wcmludGYocXVlcnlfY21kLCBzaXplb2YocXVlcnlfY21kKSwgCiAgICAgICAgICAgICAiJXMgZmluZCAlcyB1c2VycyAtLXdoZXJlIFwiYWdlOjI1LTM1XCIgMj4mMSB8IGdyZXAgLWkgJ2Vycm9yXFx8aW52YWxpZCciLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAKICAgIGVycm9yX2RldGVjdGVkID0gKHN5c3RlbShxdWVyeV9jbWQpID09IDApOwogICAgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoZXJyb3JfZGV0ZWN0ZWQpIHsKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBVbnN1cHBvcnRlZCByYW5nZSBwcm9wZXJseSByZWplY3RlZFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9RVUVSWV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBZRUxMT1cgIldBUk4iIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIFJhbmdlIG9wZXJhdG9yIG5vdCByZWplY3RlZFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9RVUVSWV0rKzsKICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBRdWVyeSBsYW5ndWFnZSB0ZXN0czogJWQvJWQgcGFzc2VkXG4iIFJFU0VULCBwYXNzZWQsIHRvdGFsKTsKICAgIHJldHVybiBwYXNzZWQ7Cn0KCmludCBydW5fcXVlcnlfbGFuZ3VhZ2VfdGVzdHNfaHR0cCgpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgQk9MRCAiUVVFUlkgTEFOR1VBR0UgVEVTVFMgKEhUVFApIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgbG9uZyBsb25nIGR1cmF0aW9uOwogICAgCiAgICBjaGFyIGRiX25hbWVbNjRdOwogICAgc25wcmludGYoZGJfbmFtZSwgc2l6ZW9mKGRiX25hbWUpLCAiaHR0cF9xdWVyeV8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMjU2XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCBkYl9uYW1lKTsKICAgIEh0dHBSZXNwb25zZSogcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsIGNyZWF0ZV9kYl9ib2R5LCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICBjaGFyIGNyZWF0ZV9jb2xsX3VybFsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2NvbGxfdXJsLCBzaXplb2YoY3JlYXRlX2NvbGxfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zIiwgZGJfbmFtZSk7CiAgICBjb25zdCBjaGFyKiBzY2hlbWEgPSAie1wibmFtZVwiOlwidXNlcnNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjp0cnVlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImFnZVwiLFwidHlwZVwiOlwiaW50XCJ9LCIKICAgICAgICAie1wibmFtZVwiOlwic2FsYXJ5XCIsXCJ0eXBlXCI6XCJmbG9hdFwifV19IjsKICAgIHJlc3AgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCBjcmVhdGVfY29sbF91cmwsIHNjaGVtYSwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwKTsKICAgIAogICAgY2hhciBpbnN0YW5jZXNfdXJsWzI1Nl07CiAgICBzbnByaW50ZihpbnN0YW5jZXNfdXJsLCBzaXplb2YoaW5zdGFuY2VzX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9pbnN0YW5jZXMiLCBkYl9uYW1lKTsKICAgIAogICAgLy8gSW5zZXJ0IHRlc3QgZGF0YQogICAgZm9yIChpbnQgaSA9IDA7IGkgPCAyMDsgaSsrKSB7CiAgICAgICAgY2hhciB1c2VyX2pzb25bMjU2XTsKICAgICAgICBzbnByaW50Zih1c2VyX2pzb24sIHNpemVvZih1c2VyX2pzb24pLCAKICAgICAgICAgICAgICAgICJ7XCJuYW1lXCI6XCJIVFRQVXNlciVkXCIsXCJhZ2VcIjolZCxcInNhbGFyeVwiOiUuMmZ9IiwgCiAgICAgICAgICAgICAgICBpLCAyMCArIChpICUgMjApLCAzMDAwMC4wICsgaSAqIDEwMDAuMCk7CiAgICAgICAgcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsIGluc3RhbmNlc191cmwsIHVzZXJfanNvbiwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICB9CiAgICAKICAgIC8vIFRFU1Q6IEVxdWFsaXR5IHF1ZXJ5CiAgICB0b3RhbCsrOwogICAgY2hhciBxdWVyeV91cmxbNTEyXTsKICAgIHNucHJpbnRmKHF1ZXJ5X3VybCwgc2l6ZW9mKHF1ZXJ5X3VybCksIAogICAgICAgICAgICAgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcz9xdWVyeT1hZ2U6MjUiLCBkYl9uYW1lKTsKICAgIAogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiSFRUUDogRXF1YWxpdHkgcXVlcnkgLSBhZ2U6MjUiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgcXVlcnlfdXJsLCBOVUxMLCAiXCJpbnN0YW5jZXNcIjoiLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfUVVFUlksIDApKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICAKICAgIC8vIFRFU1Q6IE5vbi1leGlzdGVudCB2YWx1ZQogICAgdG90YWwrKzsKICAgIHNucHJpbnRmKHF1ZXJ5X3VybCwgc2l6ZW9mKHF1ZXJ5X3VybCksIAogICAgICAgICAgICAgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcz9xdWVyeT1hZ2U6OTk5IiwgZGJfbmFtZSk7CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkhUVFA6IFF1ZXJ5IHdpdGggbm8gbWF0Y2hlcyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBxdWVyeV91cmwsIE5VTEwsICJcImluc3RhbmNlc1wiOltdIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1FVRVJZLCAwKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgCiAgICBwcmludGYoWUVMTE9XICIgIEhUVFAgUXVlcnkgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBTQ0hFTUEgRU5GT1JDRU1FTlQgVEVTVFMgPT09PT09PT09PT09PT09PT09PT0KCmludCBydW5fc2NoZW1hX2VuZm9yY2VtZW50X3Rlc3RzX2NsaSgpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgQk9MRCAiU0NIRU1BIEVORk9SQ0VNRU5UIFRFU1RTIChDTEkpIiBSRVNFVCAiXG4iKTsKICAgIHByaW50ZihZRUxMT1cgIlRoZXNlIHRlc3RzIHZlcmlmeSB0aGF0IHNjaGVtYXMgYXJlIGFjdHVhbGx5IGVuZm9yY2VkXG4iIFJFU0VUKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgCiAgICBjaGFyIGRiX25hbWVbNjRdOwogICAgc25wcmludGYoZGJfbmFtZSwgc2l6ZW9mKGRiX25hbWUpLCAic2NoZW1hX3Rlc3RfJWxkIiwgdGltZShOVUxMKSk7CiAgICAKICAgIC8vIFNldHVwCiAgICBjaGFyIHNldHVwX2NtZFs1MTJdOwogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgIiVzIGNyZWF0ZSAlcyA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICAKICAgIC8vIENyZWF0ZSBjb2xsZWN0aW9uIHdpdGggc3RyaWN0IHNjaGVtYQogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgCiAgICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0tc2NoZW1hIC0tbmFtZS1zdHJpbmctcmVxIC0tYWdlLWludCAtLWVtYWlsLXN0cmluZy1yZXEgLS1hY3RpdmUtYm9vbCA+IC9kZXYvbnVsbCAyPiYxIiwgCiAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0oc2V0dXBfY21kKTsKICAgIAogICAgLy8gVEVTVCAxOiBWYWxpZCBpbnNlcnQgLSBzaG91bGQgcGFzcwogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlRFU1QgMTogVmFsaWQgaW5zZXJ0IC0gYWxsIHJlcXVpcmVkIGZpZWxkcyIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIGNoYXIgaW5zZXJ0X2NtZFs1MTJdOwogICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJWYWxpZCBVc2VyXCIgLS1lbWFpbC1cInZhbGlkQHRlc3QuY29tXCIgLS1hZ2UtMzAgLS1hY3RpdmUtdHJ1ZSA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgCiAgICBpbnQgcmVzdWx0ID0gc3lzdGVtKGluc2VydF9jbWQpOwogICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgaW50IGNvdW50ID0gY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oZGJfbmFtZSwgInVzZXJzIik7CiAgICAKICAgIGlmIChyZXN1bHQgPT0gMCAmJiBjb3VudCA+PSAxKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1NDSEVNQV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlc1xuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBzdGF0cy5mYWlsZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfU0NIRU1BXSsrOwogICAgCiAgICAvLyBURVNUIDI6IE1pc3NpbmcgcmVxdWlyZWQgZmllbGQgLSBzaG91bGQgRkFJTAogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlRFU1QgMjogTWlzc2luZyByZXF1aXJlZCBmaWVsZCAnbmFtZScgKHNob3VsZCBiZSByZWplY3RlZCkiKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwKICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLWluc2VydC1vbmUgLS1lbWFpbC1cIm1pc3NpbmdAdGVzdC5jb21cIiAtLWFnZS0zMCA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgCiAgICByZXN1bHQgPSBzeXN0ZW0oaW5zZXJ0X2NtZCk7CiAgICBkdXJhdGlvbiA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZHVyYXRpb247CiAgICAKICAgIC8vIFNob3VsZCBmYWlsIC0gcmVxdWlyZWQgZmllbGQgbWlzc2luZwogICAgaWYgKHJlc3VsdCAhPSAwKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gQ29ycmVjdGx5IHJlamVjdGVkXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1NDSEVNQV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIEFjY2VwdGVkIGluc2VydCB3aXRoIG1pc3NpbmcgcmVxdWlyZWQgZmllbGQhXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9TQ0hFTUFdKys7CiAgICAKICAgIC8vIFRFU1QgMzogV3JvbmcgdHlwZSAtIHN0cmluZyBmb3IgaW50IGZpZWxkIC0gc2hvdWxkIEZBSUwKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDM6IFdyb25nIHR5cGUgLSBzdHJpbmcgZm9yIGFnZSAoc2hvdWxkIGJlIHJlamVjdGVkKSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJUeXBlIFRlc3RcIiAtLWVtYWlsLVwidHlwZUB0ZXN0LmNvbVwiIC0tYWdlLVwidGhpcnR5XCIgLS1hY3RpdmUtdHJ1ZSA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgCiAgICByZXN1bHQgPSBzeXN0ZW0oaW5zZXJ0X2NtZCk7CiAgICBkdXJhdGlvbiA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChyZXN1bHQgIT0gMCkgewogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIENvcnJlY3RseSByZWplY3RlZFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9TQ0hFTUFdKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBBY2NlcHRlZCBzdHJpbmcgZm9yIGludGVnZXIgZmllbGQhXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9TQ0hFTUFdKys7CiAgICAKICAgIC8vIFRFU1QgNDogRXh0cmEgZmllbGQgbm90IGluIHNjaGVtYSAtIHNob3VsZCB0aGlzIGJlIGFsbG93ZWQ/CiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCA0OiBFeHRyYSBmaWVsZCBub3QgaW4gc2NoZW1hIChkb2N1bWVudCBmbGV4aWJpbGl0eSkiKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwKICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLWluc2VydC1vbmUgLS1uYW1lLVwiRXh0cmEgRmllbGRcIiAtLWVtYWlsLVwiZXh0cmFAdGVzdC5jb21cIiAtLWFnZS0yNSAtLWFjdGl2ZS10cnVlIC0tZXh0cmEtXCJzaG91bGQgdGhpcyBiZSBhbGxvd2VkP1wiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAKICAgIHJlc3VsdCA9IHN5c3RlbShpbnNlcnRfY21kKTsKICAgIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgLy8gRG9jdW1lbnQgZGF0YWJhc2VzIHR5cGljYWxseSBhbGxvdyBleHRyYSBmaWVsZHMKICAgIC8vIFRoaXMgaXMgYSBkZXNpZ24gY2hvaWNlLCBub3QgYSBidWcKICAgIGlmIChyZXN1bHQgPT0gMCkgewogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIEV4dHJhIGZpZWxkcyBhbGxvd2VkIChkb2N1bWVudCBtb2RlbClcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfU0NIRU1BXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlsiIFlFTExPVyAiV0FSTiIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gRXh0cmEgZmllbGRzIHJlamVjdGVkIChzdHJpY3Qgc2NoZW1hKVxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICAvLyBOb3QgbWFya2luZyBhcyBmYWlsIC0gdGhpcyBpcyBhIGRlc2lnbiBkZWNpc2lvbgogICAgICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1NDSEVNQV0rKzsKICAgIAogICAgLy8gVEVTVCA1OiBCb29sZWFuIHZhbGlkYXRpb24KICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDU6IEludmFsaWQgYm9vbGVhbiB2YWx1ZSAtIHNob3VsZCBiZSB0cnVlL2ZhbHNlIik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICBzbnByaW50ZihpbnNlcnRfY21kLCBzaXplb2YoaW5zZXJ0X2NtZCksCiAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIkJvb2wgVGVzdFwiIC0tZW1haWwtXCJib29sQHRlc3QuY29tXCIgLS1hZ2UtMjUgLS1hY3RpdmUteWVzID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAKICAgIHJlc3VsdCA9IHN5c3RlbShpbnNlcnRfY21kKTsKICAgIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgaWYgKHJlc3VsdCAhPSAwKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gQ29ycmVjdGx5IHJlamVjdGVkIGludmFsaWQgYm9vbGVhblxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9TQ0hFTUFdKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBBY2NlcHRlZCBpbnZhbGlkIGJvb2xlYW4gJ3llcydcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1NDSEVNQV0rKzsKICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBTY2hlbWEgZW5mb3JjZW1lbnQgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgppbnQgcnVuX3NjaGVtYV9lbmZvcmNlbWVudF90ZXN0c19odHRwKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJTQ0hFTUEgRU5GT1JDRU1FTlQgVEVTVFMgKEhUVFApIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgbG9uZyBsb25nIGR1cmF0aW9uOwogICAgCiAgICBjaGFyIGRiX25hbWVbNjRdOwogICAgc25wcmludGYoZGJfbmFtZSwgc2l6ZW9mKGRiX25hbWUpLCAiaHR0cF9zY2hlbWFfJWxkIiwgdGltZShOVUxMKSk7CiAgICAKICAgIC8vIFNldHVwCiAgICBjaGFyIGNyZWF0ZV9kYl9ib2R5WzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfZGJfYm9keSwgc2l6ZW9mKGNyZWF0ZV9kYl9ib2R5KSwgIntcIm5hbWVcIjpcIiVzXCJ9IiwgZGJfbmFtZSk7CiAgICBIdHRwUmVzcG9uc2UqIHJlc3AgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfZGJfYm9keSwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwKTsKICAgIAogICAgY2hhciBjcmVhdGVfY29sbF91cmxbMjU2XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9jb2xsX3VybCwgc2l6ZW9mKGNyZWF0ZV9jb2xsX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucyIsIGRiX25hbWUpOwogICAgY29uc3QgY2hhciogc2NoZW1hID0gIntcIm5hbWVcIjpcInVzZXJzXCIsXCJzY2hlbWFcIjpbIgogICAgICAgICJ7XCJuYW1lXCI6XCJuYW1lXCIsXCJ0eXBlXCI6XCJzdHJpbmdcIixcInJlcXVpcmVkXCI6dHJ1ZX0sIgogICAgICAgICJ7XCJuYW1lXCI6XCJhZ2VcIixcInR5cGVcIjpcImludFwiLFwicmVxdWlyZWRcIjp0cnVlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImVtYWlsXCIsXCJ0eXBlXCI6XCJzdHJpbmdcIn1dfSI7CiAgICByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgY3JlYXRlX2NvbGxfdXJsLCBzY2hlbWEsICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIGNoYXIgaW5zdGFuY2VzX3VybFsyNTZdOwogICAgc25wcmludGYoaW5zdGFuY2VzX3VybCwgc2l6ZW9mKGluc3RhbmNlc191cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzIiwgZGJfbmFtZSk7CiAgICAKICAgIC8vIFRFU1QgMTogVmFsaWQgaW5zZXJ0CiAgICB0b3RhbCsrOwogICAgY29uc3QgY2hhciogdmFsaWRfdXNlciA9ICJ7XCJuYW1lXCI6XCJWYWxpZCBVc2VyXCIsXCJhZ2VcIjozMCxcImVtYWlsXCI6XCJ2YWxpZEB0ZXN0LmNvbVwifSI7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJIVFRQOiBWYWxpZCBpbnNlcnQgLSBzaG91bGQgc3VjY2VlZCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgaW5zdGFuY2VzX3VybCwgdmFsaWRfdXNlciwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU0NIRU1BLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgCiAgICAvLyBURVNUIDI6IE1pc3NpbmcgcmVxdWlyZWQgZmllbGQgLSBzaG91bGQgRkFJTAogICAgdG90YWwrKzsKICAgIGNvbnN0IGNoYXIqIG1pc3NpbmdfbmFtZSA9ICJ7XCJhZ2VcIjozMCxcImVtYWlsXCI6XCJtaXNzaW5nQHRlc3QuY29tXCJ9IjsKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkhUVFA6IE1pc3NpbmcgcmVxdWlyZWQgZmllbGQgJ25hbWUnIC0gc2hvdWxkIGZhaWwiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsIGluc3RhbmNlc191cmwsIG1pc3NpbmdfbmFtZSwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NDSEVNQSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIAogICAgLy8gVEVTVCAzOiBXcm9uZyB0eXBlIC0gc2hvdWxkIEZBSUwKICAgIHRvdGFsKys7CiAgICBjb25zdCBjaGFyKiB3cm9uZ190eXBlID0gIntcIm5hbWVcIjpcIlR5cGUgVGVzdFwiLFwiYWdlXCI6XCJ0aGlydHlcIixcImVtYWlsXCI6XCJ0eXBlQHRlc3QuY29tXCJ9IjsKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkhUVFA6IFdyb25nIHR5cGUgKHN0cmluZyBmb3IgaW50KSAtIHNob3VsZCBmYWlsIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCBpbnN0YW5jZXNfdXJsLCB3cm9uZ190eXBlLCAiXCJzdWNjZXNzXCI6ZmFsc2UiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU0NIRU1BLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgCiAgICBwcmludGYoWUVMTE9XICIgIEhUVFAgU2NoZW1hIHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gU0VDVVJJVFkgVEVTVFMgKEVOSEFOQ0VEKSA9PT09PT09PT09PT09PT09PT09PQoKaW50IHJ1bl9zZWN1cml0eV90ZXN0c19jbGkoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIlNFQ1VSSVRZICYgSU5KRUNUSU9OIFRFU1RTIChDTEkpIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgCiAgICBUZXN0Q2FzZSBzZWN1cml0eV90ZXN0c1tdID0gewogICAgICAgIHsKICAgICAgICAgICAgIkRpcmVjdG9yeSB0cmF2ZXJzYWwgcHJldmVudGlvbiAtIGRhdGFiYXNlIG5hbWUiLAogICAgICAgICAgICAiJXMgY3JlYXRlICcuLi9ldmlsJyAyPiYxIHwgZ3JlcCAtaSAnaW52YWxpZFxcfGVycm9yJyA+IC9kZXYvbnVsbCIsCiAgICAgICAgICAgICJ0ZXN0ICEgLWQgJy90bXAvc3lkYl90ZXN0Ly4uL2V2aWwnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU0VDVVJJVFksIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkRpcmVjdG9yeSB0cmF2ZXJzYWwgcHJldmVudGlvbiAtIGNvbGxlY3Rpb24gbmFtZSIsIAogICAgICAgICAgICAiJXMgY3JlYXRlIHRlc3RkYiAnLi4vLi4vZXZpbCcgLS1zY2hlbWEgLS1uYW1lLXN0cmluZyAyPiYxIHwgZ3JlcCAtaSAnaW52YWxpZFxcfGVycm9yJyA+IC9kZXYvbnVsbCIsCiAgICAgICAgICAgICJ0ZXN0ICEgLWQgJy90bXAvc3lkYl90ZXN0L3Rlc3RkYi8uLi8uLi9ldmlsJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NFQ1VSSVRZLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJTcGVjaWFsIGNoYXJhY3RlcnMgaW4gZGF0YWJhc2UgbmFtZXMgLSByZWplY3Rpb24iLAogICAgICAgICAgICAiJXMgY3JlYXRlICdpbnZhbGlkL25hbWUnIDI+JjEgfCBncmVwIC1pICdpbnZhbGlkXFx8ZXJyb3InID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgInRlc3QgISAtZCAnL3RtcC9zeWRiX3Rlc3QvaW52YWxpZC9uYW1lJyIsIAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9TRUNVUklUWSwgMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiQ29tbWFuZCBpbmplY3Rpb24gYXR0ZW1wdCAtIHNlbWljb2xvbiIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgJ3Rlc3Q7IHJtIC1yZiAvJyAyPiYxIHwgZ3JlcCAtaSAnaW52YWxpZFxcfGVycm9yJyA+IC9kZXYvbnVsbCIsCiAgICAgICAgICAgICJlY2hvICdJbmplY3Rpb24gcHJldmVudGVkJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NFQ1VSSVRZLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJDb21tYW5kIGluamVjdGlvbiBhdHRlbXB0IC0gYmFja3RpY2tzIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSAndGVzdGBpZGAnIDI+JjEgfCBncmVwIC1pICdpbnZhbGlkXFx8ZXJyb3InID4gL2Rldi9udWxsIiwgCiAgICAgICAgICAgICJlY2hvICdJbmplY3Rpb24gcHJldmVudGVkJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NFQ1VSSVRZLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJTUUwtbGlrZSBpbmplY3Rpb24gaW4gcXVlcnkiLAogICAgICAgICAgICAiJXMgZmluZCB0ZXN0ZGIgdXNlcnMgLS13aGVyZSBcIm5hbWU6JyBPUiAxPTEtLVwiIDI+JjEgfCBncmVwIC1pICdlcnJvclxcfGludmFsaWQnID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgImVjaG8gJ0luamVjdGlvbiBoYW5kbGVkJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NFQ1VSSVRZLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJWZXJ5IGxvbmcgbmFtZSAtIGJ1ZmZlciBvdmVyZmxvdyBwcm90ZWN0aW9uIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSBhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYSAyPiYxIHwgZ3JlcCAtaSAnaW52YWxpZFxcfGVycm9yJyA+IC9kZXYvbnVsbCIsCiAgICAgICAgICAgICJlY2hvICdMb25nIG5hbWUgcmVqZWN0ZWQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU0VDVVJJVFksIDEKICAgICAgICB9CiAgICB9OwogICAgCiAgICBpbnQgc2VjdXJpdHlfY291bnQgPSBzaXplb2Yoc2VjdXJpdHlfdGVzdHMpIC8gc2l6ZW9mKHNlY3VyaXR5X3Rlc3RzWzBdKTsKICAgIAogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZWN1cml0eV9jb3VudDsgaSsrKSB7CiAgICAgICAgdG90YWwrKzsKICAgICAgICAKICAgICAgICBjaGFyIGZpbmFsX2NvbW1hbmRbMTAyNF07CiAgICAgICAgY2hhciBmaW5hbF92ZXJpZmljYXRpb25bMTAyNF07CiAgICAgICAgCiAgICAgICAgc25wcmludGYoZmluYWxfY29tbWFuZCwgc2l6ZW9mKGZpbmFsX2NvbW1hbmQpLCBzZWN1cml0eV90ZXN0c1tpXS5jb21tYW5kLCBjbGlfY29tbWFuZCk7CiAgICAgICAgc25wcmludGYoZmluYWxfdmVyaWZpY2F0aW9uLCBzaXplb2YoZmluYWxfdmVyaWZpY2F0aW9uKSwgc2VjdXJpdHlfdGVzdHNbaV0udmVyaWZpY2F0aW9uX2NvbW1hbmQsIGNsaV9jb21tYW5kKTsKICAgICAgICAKICAgICAgICBzdHJjcHkoc2VjdXJpdHlfdGVzdHNbaV0uY29tbWFuZCwgZmluYWxfY29tbWFuZCk7CiAgICAgICAgc3RyY3B5KHNlY3VyaXR5X3Rlc3RzW2ldLnZlcmlmaWNhdGlvbl9jb21tYW5kLCBmaW5hbF92ZXJpZmljYXRpb24pOwogICAgICAgIAogICAgICAgIGlmIChleGVjdXRlX3Rlc3Rfd2l0aF92ZXJpZmljYXRpb24oJnNlY3VyaXR5X3Rlc3RzW2ldKSkgewogICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgU2VjdXJpdHkgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgppbnQgcnVuX3NlY3VyaXR5X3Rlc3RzX2h0dHAoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIlNFQ1VSSVRZICYgSU5KRUNUSU9OIFRFU1RTIChIVFRQKSIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIGxvbmcgbG9uZyBkdXJhdGlvbjsKICAgIAogICAgLy8gVGVzdCAxOiBTUUwgaW5qZWN0aW9uIGluIHF1ZXJ5IHBhcmFtZXRlcgogICAgdG90YWwrKzsKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkhUVFA6IFNRTCBpbmplY3Rpb24gYXR0ZW1wdCBpbiBxdWVyeSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCAiL2FwaS9kYXRhYmFzZXMvdGVzdGRiL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcz9xdWVyeT1uYW1lOicgT1IgMT0xLS0iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICBOVUxMLCAiXCJzdWNjZXNzXCI6IiwgMSwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NFQ1VSSVRZLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgCiAgICAvLyBUZXN0IDI6IEpTT04gaW5qZWN0aW9uIGluIGJvZHkKICAgIHRvdGFsKys7CiAgICBjb25zdCBjaGFyKiBqc29uX2luamVjdGlvbiA9ICJ7XCJuYW1lXCI6XCJcXFwifSwgXCJtYWxpY2lvdXNcIjogdHJ1ZSwgXCJhZ2VcIjozMH0iOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiSFRUUDogSlNPTiBpbmplY3Rpb24gYXR0ZW1wdCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwganNvbl9pbmplY3Rpb24sICJcInN1Y2Nlc3NcIjpmYWxzZSIsIDEsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TRUNVUklUWSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIAogICAgLy8gVGVzdCAzOiBQYXRoIHRyYXZlcnNhbAogICAgdG90YWwrKzsKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkhUVFA6IFBhdGggdHJhdmVyc2FsIGF0dGVtcHQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgIi9hcGkvZGF0YWJhc2VzLy4uL2V0Yy9wYXNzd2QiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICBOVUxMLCAiXCJzdWNjZXNzXCI6ZmFsc2UiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU0VDVVJJVFksIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICAKICAgIC8vIFRlc3QgNDogVmVyeSBsb25nIFVSTAogICAgdG90YWwrKzsKICAgIGNoYXIgbG9uZ191cmxbMjA0OF0gPSAiL2FwaS9kYXRhYmFzZXMvIjsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwOyBpKyspIHsKICAgICAgICBzdHJjYXQobG9uZ191cmwsICJhYWFhYWFhYWFhIik7CiAgICB9CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJIVFRQOiBWZXJ5IGxvbmcgVVJMIChidWZmZXIgb3ZlcmZsb3cgdGVzdCkiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgbG9uZ191cmwsIE5VTEwsICJcInN1Y2Nlc3NcIjpmYWxzZSIsIDEsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TRUNVUklUWSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIAogICAgLy8gVGVzdCA1OiBJbnZhbGlkIEpTT04KICAgIHRvdGFsKys7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJIVFRQOiBNYWxmb3JtZWQgSlNPTiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgIntuYW1lOiB0ZXN0fSIsICJcInN1Y2Nlc3NcIjpmYWxzZSIsIDEsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TRUNVUklUWSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBIVFRQIFNlY3VyaXR5IHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gUEVSRk9STUFOQ0UgVEVTVFMgPT09PT09PT09PT09PT09PT09PT0KCmludCBydW5fcGVyZm9ybWFuY2VfdGVzdHNfY2xpKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJQRVJGT1JNQU5DRSAmIFNDQUxBQklMSVRZIFRFU1RTIChDTEkpIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgCiAgICBjaGFyIGRiX25hbWVbNjRdOwogICAgc25wcmludGYoZGJfbmFtZSwgc2l6ZW9mKGRiX25hbWUpLCAicGVyZl90ZXN0XyVsZCIsIHRpbWUoTlVMTCkpOwogICAgCiAgICAvLyBTZXR1cAogICAgY2hhciBzZXR1cF9jbWRbNTEyXTsKICAgIHNucHJpbnRmKHNldHVwX2NtZCwgc2l6ZW9mKHNldHVwX2NtZCksICIlcyBjcmVhdGUgJXMgPiAvZGV2L251bGwgMj4mMSIsIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIHN5c3RlbShzZXR1cF9jbWQpOwogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgCiAgICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0tc2NoZW1hIC0tbmFtZS1zdHJpbmcgLS1hZ2UtaW50ID4gL2Rldi9udWxsIDI+JjEiLCAKICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIHN5c3RlbShzZXR1cF9jbWQpOwogICAgCiAgICAvLyBURVNUIDE6IFNpbmdsZSBpbnNlcnQgcGVyZm9ybWFuY2UKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJQRVJGIDE6IFNpbmdsZSBpbnNlcnQgbGF0ZW5jeSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIGNoYXIgaW5zZXJ0X2NtZFs1MTJdOwogICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJQZXJmIFVzZXJcIiAtLWFnZS0zMCA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKGluc2VydF9jbWQpOwogICAgbG9uZyBsb25nIHNpbmdsZV90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBzaW5nbGVfdGltZTsKICAgIAogICAgcHJpbnRmKCIgLSAlbGxkIG1zXG4iLCBzaW5nbGVfdGltZSk7CiAgICAKICAgIGlmIChzaW5nbGVfdGltZSA8IDEwMCkgewogICAgICAgIHByaW50ZigiICBbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gSW5zZXJ0IGxhdGVuY3k6ICVsbGQgbXNcbiIsIHNpbmdsZV90aW1lKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9QRVJGT1JNQU5DRV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCIgIFsiIFlFTExPVyAiV0FSTiIgUkVTRVQgIl0gSW5zZXJ0IGxhdGVuY3kgaGlnaDogJWxsZCBtc1xuIiwgc2luZ2xlX3RpbWUpOwogICAgICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1BFUkZPUk1BTkNFXSsrOwogICAgCiAgICAvLyBURVNUIDI6IEJhdGNoIGluc2VydCBwZXJmb3JtYW5jZQogICAgaWYgKHRlc3RfbGV2ZWwgPj0gMSkgewogICAgICAgIHRvdGFsKys7CiAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiUEVSRiAyOiBCYXRjaCBpbnNlcnQgLSAxMDAgcmVjb3JkcyIpOwogICAgICAgIGZmbHVzaChzdGRvdXQpOwogICAgICAgIAogICAgICAgIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgICAgIGludCBzdWNjZXNzX2NvdW50ID0gMDsKICAgICAgICAKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7CiAgICAgICAgICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwKICAgICAgICAgICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJCYXRjaFVzZXIlZFwiIC0tYWdlLSVkID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lLCBpLCAyMCArIChpICUgNTApKTsKICAgICAgICAgICAgaWYgKHN5c3RlbShpbnNlcnRfY21kKSA9PSAwKSBzdWNjZXNzX2NvdW50Kys7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxvbmcgbG9uZyBiYXRjaF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICAgICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gYmF0Y2hfdGltZTsKICAgICAgICBkb3VibGUgYXZnX3RpbWUgPSAoZG91YmxlKWJhdGNoX3RpbWUgLyBzdWNjZXNzX2NvdW50OwogICAgICAgIAogICAgICAgIHByaW50ZigiIC0gJWxsZCBtcyAoYXZnOiAlLjJmIG1zL29wKVxuIiwgYmF0Y2hfdGltZSwgYXZnX3RpbWUpOwogICAgICAgIAogICAgICAgIGlmIChzdWNjZXNzX2NvdW50ID49IDk1KSB7CiAgICAgICAgICAgIHByaW50ZigiICBbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJWQvMTAwIGluc2VydHMsIGF2ZyAlLjJmIG1zXG4iLCBzdWNjZXNzX2NvdW50LCBhdmdfdGltZSk7CiAgICAgICAgICAgIHBhc3NlZCsrOwogICAgICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfUEVSRk9STUFOQ0VdKys7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHJpbnRmKCIgIFsiIFlFTExPVyAiV0FSTiIgUkVTRVQgIl0gT25seSAlZC8xMDAgaW5zZXJ0cyBzdWNjZWVkZWRcbiIsIHN1Y2Nlc3NfY291bnQpOwogICAgICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICAgICAgfQogICAgICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9QRVJGT1JNQU5DRV0rKzsKICAgIH0KICAgIAogICAgLy8gVEVTVCAzOiBRdWVyeSBwZXJmb3JtYW5jZQogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlBFUkYgMzogUXVlcnkgcGVyZm9ybWFuY2UgLSBleGFjdCBtYXRjaCIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgY2hhciBxdWVyeV9jbWRbNTEyXTsKICAgIHNucHJpbnRmKHF1ZXJ5X2NtZCwgc2l6ZW9mKHF1ZXJ5X2NtZCksCiAgICAgICAgICAgICIlcyBmaW5kICVzIHVzZXJzIC0td2hlcmUgXCJhZ2U6MzBcIiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHF1ZXJ5X2NtZCk7CiAgICBsb25nIGxvbmcgcXVlcnlfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gcXVlcnlfdGltZTsKICAgIAogICAgcHJpbnRmKCIgLSAlbGxkIG1zXG4iLCBxdWVyeV90aW1lKTsKICAgIAogICAgaWYgKHF1ZXJ5X3RpbWUgPCAyMDApIHsKICAgICAgICBwcmludGYoIiAgWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdIFF1ZXJ5IHRpbWU6ICVsbGQgbXNcbiIsIHF1ZXJ5X3RpbWUpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1BFUkZPUk1BTkNFXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIiAgWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSBRdWVyeSB0aW1lIGhpZ2g6ICVsbGQgbXNcbiIsIHF1ZXJ5X3RpbWUpOwogICAgICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1BFUkZPUk1BTkNFXSsrOwogICAgCiAgICAvLyBURVNUIDQ6IExhcmdlIGRhdGFzZXQgcGVyZm9ybWFuY2UKICAgIGlmICh0ZXN0X2xldmVsID49IDIpIHsKICAgICAgICB0b3RhbCsrOwogICAgICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlBFUkYgNDogTGFyZ2UgZGF0YXNldCAtIDEwMDAgcmVjb3JkcyIpOwogICAgICAgIGZmbHVzaChzdGRvdXQpOwogICAgICAgIAogICAgICAgIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgICAgIAogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwMDsgaSsrKSB7CiAgICAgICAgICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwKICAgICAgICAgICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJMYXJnZVVzZXIlZFwiIC0tYWdlLSVkID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lLCBpLCAyMCArIChpICUgNTApKTsKICAgICAgICAgICAgc3lzdGVtKGluc2VydF9jbWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGkgJSAxMDAgPT0gMCkgewogICAgICAgICAgICAgICAgcHJpbnRmKCIuIik7CiAgICAgICAgICAgICAgICBmZmx1c2goc3Rkb3V0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBsb25nIGxvbmcgbGFyZ2VfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGxhcmdlX3RpbWU7CiAgICAgICAgCiAgICAgICAgaW50IGZpbmFsX2NvdW50ID0gY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oZGJfbmFtZSwgInVzZXJzIik7CiAgICAgICAgCiAgICAgICAgcHJpbnRmKCIgLSAlbGxkIG1zLCAlZCByZWNvcmRzXG4iLCBsYXJnZV90aW1lLCBmaW5hbF9jb3VudCk7CiAgICAgICAgCiAgICAgICAgaWYgKGZpbmFsX2NvdW50ID49IDEwMDApIHsKICAgICAgICAgICAgcHJpbnRmKCIgIFsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSBBbGwgMTAwMCByZWNvcmRzIGluc2VydGVkXG4iKTsKICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9QRVJGT1JNQU5DRV0rKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmludGYoIiAgWyIgUkVEICJGQUlMIiBSRVNFVCAiXSBPbmx5ICVkLzEwMDAgcmVjb3JkcyBpbnNlcnRlZFxuIiwgZmluYWxfY291bnQpOwogICAgICAgICAgICBzdGF0cy5mYWlsZWRfdGVzdHMrKzsKICAgICAgICB9CiAgICAgICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1BFUkZPUk1BTkNFXSsrOwogICAgfQogICAgCiAgICBwcmludGYoWUVMTE9XICIgIFBlcmZvcm1hbmNlIHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKaW50IHJ1bl9wZXJmb3JtYW5jZV90ZXN0c19odHRwKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJQRVJGT1JNQU5DRSBURVNUUyAoSFRUUCkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIGlmICh0ZXN0X2xldmVsIDwgMSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgU2tpcHBpbmcgSFRUUCBwZXJmb3JtYW5jZSB0ZXN0cyAodXNlIC0tbGV2ZWw9MSBvciBoaWdoZXIpXG4iIFJFU0VUKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgY2hhciBkYl9uYW1lWzY0XTsKICAgIHNucHJpbnRmKGRiX25hbWUsIHNpemVvZihkYl9uYW1lKSwgImh0dHBfcGVyZl8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMjU2XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCBkYl9uYW1lKTsKICAgIEh0dHBSZXNwb25zZSogcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsIGNyZWF0ZV9kYl9ib2R5LCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICBjaGFyIGNyZWF0ZV9jb2xsX3VybFsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2NvbGxfdXJsLCBzaXplb2YoY3JlYXRlX2NvbGxfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zIiwgZGJfbmFtZSk7CiAgICBjb25zdCBjaGFyKiBzY2hlbWEgPSAie1wibmFtZVwiOlwidXNlcnNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wifSwiCiAgICAgICAgIntcIm5hbWVcIjpcImFnZVwiLFwidHlwZVwiOlwiaW50XCJ9XX0iOwogICAgcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsIGNyZWF0ZV9jb2xsX3VybCwgc2NoZW1hLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICBjaGFyIGluc3RhbmNlc191cmxbMjU2XTsKICAgIHNucHJpbnRmKGluc3RhbmNlc191cmwsIHNpemVvZihpbnN0YW5jZXNfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcyIsIGRiX25hbWUpOwogICAgCiAgICAvLyBURVNUOiBIVFRQIGluc2VydCBsYXRlbmN5CiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiSFRUUCBQRVJGOiBJbnNlcnQgbGF0ZW5jeSAoMTAgaW5zZXJ0cykiKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBsb25nIGxvbmcgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICBpbnQgc3VjY2Vzc19jb3VudCA9IDA7CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgIGNoYXIgdXNlcl9qc29uWzI1Nl07CiAgICAgICAgc25wcmludGYodXNlcl9qc29uLCBzaXplb2YodXNlcl9qc29uKSwgIntcIm5hbWVcIjpcIlBlcmZVc2VyJWRcIixcImFnZVwiOiVkfSIsIGksIDIwICsgaSk7CiAgICAgICAgSHR0cFJlc3BvbnNlKiByID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgaW5zdGFuY2VzX3VybCwgdXNlcl9qc29uLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgICAgIGlmIChyICYmIHItPnN0YXR1c19jb2RlID49IDIwMCAmJiByLT5zdGF0dXNfY29kZSA8IDMwMCkgc3VjY2Vzc19jb3VudCsrOwogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyKTsKICAgIH0KICAgIAogICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIGRvdWJsZSBhdmdfdGltZSA9IChkb3VibGUpZHVyYXRpb24gLyBzdWNjZXNzX2NvdW50OwogICAgCiAgICBwcmludGYoIiAtICVsbGQgbXMgKGF2ZzogJS4yZiBtcy9vcClcbiIsIGR1cmF0aW9uLCBhdmdfdGltZSk7CiAgICAKICAgIGlmIChzdWNjZXNzX2NvdW50ID49IDkpIHsKICAgICAgICBwcmludGYoIiAgWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdIEhUVFAgaW5zZXJ0IGxhdGVuY3k6ICUuMmYgbXNcbiIsIGF2Z190aW1lKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9QRVJGT1JNQU5DRV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCIgIFsiIFlFTExPVyAiV0FSTiIgUkVTRVQgIl0gT25seSAlZC8xMCBpbnNlcnRzIHN1Y2NlZWRlZFxuIiwgc3VjY2Vzc19jb3VudCk7CiAgICAgICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfUEVSRk9STUFOQ0VdKys7CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgSFRUUCBQZXJmb3JtYW5jZSB0ZXN0czogJWQvJWQgcGFzc2VkXG4iIFJFU0VULCBwYXNzZWQsIHRvdGFsKTsKICAgIHJldHVybiBwYXNzZWQ7Cn0KCi8vID09PT09PT09PT09PT09PT09PT09IERBVEEgSU5URUdSSVRZIFRFU1RTID09PT09PT09PT09PT09PT09PT09CgovLyA9PT09PT09PT09PT09PT09PT09PSBEQVRBIElOVEVHUklUWSBURVNUUyA9PT09PT09PT09PT09PT09PT09PQoKaW50IHJ1bl9pbnRlZ3JpdHlfdGVzdHNfY2xpKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJEQVRBIElOVEVHUklUWSBURVNUUyAoQ0xJKSIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIAogICAgY2hhciBkYl9uYW1lWzY0XTsKICAgIHNucHJpbnRmKGRiX25hbWUsIHNpemVvZihkYl9uYW1lKSwgImludGVncml0eV90ZXN0XyVsZCIsIHRpbWUoTlVMTCkpOwogICAgCiAgICAvLyBTZXR1cAogICAgY2hhciBzZXR1cF9jbWRbNTEyXTsKICAgIHNucHJpbnRmKHNldHVwX2NtZCwgc2l6ZW9mKHNldHVwX2NtZCksICIlcyBjcmVhdGUgJXMgPiAvZGV2L251bGwgMj4mMSIsIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIHN5c3RlbShzZXR1cF9jbWQpOwogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgCiAgICAgICAgICAgICAiJXMgY3JlYXRlICVzIGRhdGEgLS1zY2hlbWEgLS12YWx1ZS1zdHJpbmcgPiAvZGV2L251bGwgMj4mMSIsIAogICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICAKICAgIC8vIEZJWEVEOiBEZWNsYXJlIGluc2VydF9jbWQgaGVyZQogICAgY2hhciBpbnNlcnRfY21kWzUxMl07CiAgICAKICAgIC8vIEluc2VydCBzb21lIGRhdGEKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwKICAgICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgZGF0YSAtLWluc2VydC1vbmUgLS12YWx1ZS1cInRlc3RfZGF0YV8lZFwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUsIGkpOwogICAgICAgIHN5c3RlbShpbnNlcnRfY21kKTsKICAgIH0KICAgIAogICAgLy8gVEVTVCAxOiBGaWxlIGhlYWRlciB2ZXJpZmljYXRpb24KICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJJTlRFR1JJVFkgMTogRGF0YSBmaWxlIGhlYWRlciB2ZXJpZmljYXRpb24iKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBjaGFyIGRhdGFfcGF0aFs1MTJdOwogICAgc25wcmludGYoZGF0YV9wYXRoLCBzaXplb2YoZGF0YV9wYXRoKSwgIi90bXAvc3lkYl90ZXN0LyVzL2RhdGEvZGF0YS5zeWRiIiwgZGJfbmFtZSk7CiAgICAKICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgY2hhciBoZXhkdW1wX2NtZFs1MTJdOwogICAgc25wcmludGYoaGV4ZHVtcF9jbWQsIHNpemVvZihoZXhkdW1wX2NtZCksIAogICAgICAgICAgICAgImhleGR1bXAgLUMgJXMgfCBoZWFkIC0xIHwgZ3JlcCAtcSAnNTMgNTkgNDQgNDInIDI+L2Rldi9udWxsIiwgZGF0YV9wYXRoKTsKICAgIAogICAgaW50IGhlYWRlcl9vayA9IChzeXN0ZW0oaGV4ZHVtcF9jbWQpID09IDApOwogICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgaWYgKGhlYWRlcl9vaykgewogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIFZhbGlkIGhlYWRlciBmb3VuZFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9JTlRFR1JJVFldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBJbnZhbGlkIGhlYWRlclxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBzdGF0cy5mYWlsZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfSU5URUdSSVRZXSsrOwogICAgCiAgICAvLyBURVNUIDI6IFJlY29yZCBjb3VudCBtYXRjaGVzIGhlYWRlcgogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIklOVEVHUklUWSAyOiBSZWNvcmQgY291bnQgdmVyaWZpY2F0aW9uIik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAKICAgIGNoYXIgY291bnRfY21kWzUxMl07CiAgICBzbnByaW50Zihjb3VudF9jbWQsIHNpemVvZihjb3VudF9jbWQpLAogICAgICAgICAgICAgImRkIGlmPSVzIGJzPTEgc2tpcD04IGNvdW50PTggMj4vZGV2L251bGwgfCBoZXhkdW1wIC1lICcxLzggXCIlJXVcIicgMj4vZGV2L251bGwiLCBkYXRhX3BhdGgpOwogICAgCiAgICBjaGFyIGhlYWRlcl9jb3VudFs2NF0gPSAiMCI7CiAgICBGSUxFICpmcCA9IHBvcGVuKGNvdW50X2NtZCwgInIiKTsKICAgIGlmIChmcCkgewogICAgICAgIGlmIChmZ2V0cyhoZWFkZXJfY291bnQsIHNpemVvZihoZWFkZXJfY291bnQpLCBmcCkpIHsKICAgICAgICAgICAgaGVhZGVyX2NvdW50W3N0cmNzcG4oaGVhZGVyX2NvdW50LCAiXG4iKV0gPSAnXDAnOwogICAgICAgIH0KICAgICAgICBwY2xvc2UoZnApOwogICAgfQogICAgCiAgICBpbnQgYWN0dWFsX2NvdW50ID0gY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oZGJfbmFtZSwgImRhdGEiKTsKICAgIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgaW50IGhlYWRlcl9jb3VudF92YWwgPSBhdG9pKGhlYWRlcl9jb3VudCk7CiAgICAKICAgIGlmIChoZWFkZXJfY291bnRfdmFsID09IGFjdHVhbF9jb3VudCAmJiBhY3R1YWxfY291bnQgPiAwKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gSGVhZGVyIGNvdW50ICglZCkgbWF0Y2hlcyBhY3R1YWwgKCVkKVxuIiwgCiAgICAgICAgICAgICAgIENZQU4sIGR1cmF0aW9uLCBSRVNFVCwgaGVhZGVyX2NvdW50X3ZhbCwgYWN0dWFsX2NvdW50KTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9JTlRFR1JJVFldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBIZWFkZXIgY291bnQgKCVkKSAhPSBhY3R1YWwgKCVkKVxuIiwgCiAgICAgICAgICAgICAgIENZQU4sIGR1cmF0aW9uLCBSRVNFVCwgaGVhZGVyX2NvdW50X3ZhbCwgYWN0dWFsX2NvdW50KTsKICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9JTlRFR1JJVFldKys7CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgRGF0YSBpbnRlZ3JpdHkgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBFREdFIENBU0UgVEVTVFMgPT09PT09PT09PT09PT09PT09PT0KCmludCBydW5fZWRnZV9jYXNlX3Rlc3RzX2NsaSgpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgQk9MRCAiRURHRSBDQVNFIFRFU1RTIChDTEkpIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgCiAgICBjaGFyIGRiX25hbWVbNjRdOwogICAgc25wcmludGYoZGJfbmFtZSwgc2l6ZW9mKGRiX25hbWUpLCAiZWRnZV90ZXN0XyVsZCIsIHRpbWUoTlVMTCkpOwogICAgCiAgICAvLyBTZXR1cAogICAgY2hhciBzZXR1cF9jbWRbNTEyXTsKICAgIHNucHJpbnRmKHNldHVwX2NtZCwgc2l6ZW9mKHNldHVwX2NtZCksICIlcyBjcmVhdGUgJXMgPiAvZGV2L251bGwgMj4mMSIsIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIHN5c3RlbShzZXR1cF9jbWQpOwogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgCiAgICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0tc2NoZW1hIC0tbmFtZS1zdHJpbmctcmVxIC0tYWdlLWludCA+IC9kZXYvbnVsbCAyPiYxIiwgCiAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0oc2V0dXBfY21kKTsKICAgIAogICAgVGVzdENhc2UgZWRnZV90ZXN0c1tdID0gewogICAgICAgIHsKICAgICAgICAgICAgIkVtcHR5IGRhdGFiYXNlIG5hbWUiLAogICAgICAgICAgICAiJXMgY3JlYXRlICcnIDI+JjEgfCBncmVwIC1pICdlcnJvclxcfGludmFsaWQnID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgImVjaG8gJ0hhbmRsZWQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfRURHRSwgMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiRW1wdHkgY29sbGVjdGlvbiBuYW1lIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgJycgLS1zY2hlbWEgLS1uYW1lLXN0cmluZyAyPiYxIHwgZ3JlcCAtaSAnZXJyb3JcXHxpbnZhbGlkJyA+IC9kZXYvbnVsbCIsCiAgICAgICAgICAgICJlY2hvICdIYW5kbGVkJyIsIAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9FREdFLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJNYXhpbXVtIGxlbmd0aCBmaWVsZCBuYW1lIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLXNjaGVtYSAtLWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWEtc3RyaW5nID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiZWNobyAnSGFuZGxlZCciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9FREdFLCAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJFbXB0eSBxdWVyeSBzdHJpbmciLAogICAgICAgICAgICAiJXMgZmluZCAlcyB1c2VycyAtLXdoZXJlIFwiXCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICIlcyBmaW5kICVzIHVzZXJzIC0td2hlcmUgXCJcIiB8IGdyZXAgLWMgJ1wiX2lkXCInIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfRURHRSwgMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiVmVyeSBsb25nIHF1ZXJ5IHZhbHVlIiwKICAgICAgICAgICAgIiVzIGZpbmQgJXMgdXNlcnMgLS13aGVyZSBcIm5hbWU6YWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYVwiIDI+JjEgfCBncmVwIC1pICdlcnJvclxcfGludmFsaWQnID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgImVjaG8gJ0hhbmRsZWQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfRURHRSwgMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiQ3JlYXRlIGNvbGxlY3Rpb24gd2l0aCB6ZXJvIGZpZWxkcyIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgZW1wdHkgLS1zY2hlbWEgMj4mMSB8IGdyZXAgLWkgJ2Vycm9yXFx8aW52YWxpZCcgPiAvZGV2L251bGwiLAogICAgICAgICAgICAidGVzdCAhIC1kICcvdG1wL3N5ZGJfdGVzdC8lcy9lbXB0eSciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9FREdFLCAxCiAgICAgICAgfQogICAgfTsKICAgIAogICAgaW50IGVkZ2VfY291bnQgPSBzaXplb2YoZWRnZV90ZXN0cykgLyBzaXplb2YoZWRnZV90ZXN0c1swXSk7CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZWRnZV9jb3VudDsgaSsrKSB7CiAgICAgICAgdG90YWwrKzsKICAgICAgICAKICAgICAgICBjaGFyIGZpbmFsX2NvbW1hbmRbMTAyNF07CiAgICAgICAgY2hhciBmaW5hbF92ZXJpZmljYXRpb25bMTAyNF07CiAgICAgICAgCiAgICAgICAgc25wcmludGYoZmluYWxfY29tbWFuZCwgc2l6ZW9mKGZpbmFsX2NvbW1hbmQpLCBlZGdlX3Rlc3RzW2ldLmNvbW1hbmQsIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgICAgICBzbnByaW50ZihmaW5hbF92ZXJpZmljYXRpb24sIHNpemVvZihmaW5hbF92ZXJpZmljYXRpb24pLCBlZGdlX3Rlc3RzW2ldLnZlcmlmaWNhdGlvbl9jb21tYW5kLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAgICAgCiAgICAgICAgc3RyY3B5KGVkZ2VfdGVzdHNbaV0uY29tbWFuZCwgZmluYWxfY29tbWFuZCk7CiAgICAgICAgc3RyY3B5KGVkZ2VfdGVzdHNbaV0udmVyaWZpY2F0aW9uX2NvbW1hbmQsIGZpbmFsX3ZlcmlmaWNhdGlvbik7CiAgICAgICAgCiAgICAgICAgaWYgKGV4ZWN1dGVfdGVzdF93aXRoX3ZlcmlmaWNhdGlvbigmZWRnZV90ZXN0c1tpXSkpIHsKICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcmludGYoWUVMTE9XICIgIEVkZ2UgY2FzZSB0ZXN0czogJWQvJWQgcGFzc2VkXG4iIFJFU0VULCBwYXNzZWQsIHRvdGFsKTsKICAgIHJldHVybiBwYXNzZWQ7Cn0KCi8vID09PT09PT09PT09PT09PT09PT09IFJFQ09WRVJZIFRFU1RTID09PT09PT09PT09PT09PT09PT09CgovLyA9PT09PT09PT09PT09PT09PT09PSBSRUNPVkVSWSBURVNUUyA9PT09PT09PT09PT09PT09PT09PQoKaW50IHJ1bl9yZWNvdmVyeV90ZXN0c19jbGkoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIlJFQ09WRVJZICYgRVJST1IgSEFORExJTkcgVEVTVFMgKENMSSkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIGlmICh0ZXN0X2xldmVsIDwgMikgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgU2tpcHBpbmcgcmVjb3ZlcnkgdGVzdHMgKHVzZSAtLWxldmVsPTIgZm9yIGNvbXByZWhlbnNpdmUgdGVzdGluZylcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgCiAgICBjaGFyIGRiX25hbWVbNjRdOwogICAgc25wcmludGYoZGJfbmFtZSwgc2l6ZW9mKGRiX25hbWUpLCAicmVjb3ZlcnlfdGVzdF8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAKICAgIGNoYXIgc2V0dXBfY21kWzUxMl07CiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAiJXMgY3JlYXRlICVzID4gL2Rldi9udWxsIDI+JjEiLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0oc2V0dXBfY21kKTsKICAgIHNucHJpbnRmKHNldHVwX2NtZCwgc2l6ZW9mKHNldHVwX2NtZCksIAogICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nLXJlcSAtLWFnZS1pbnQgPiAvZGV2L251bGwgMj4mMSIsIAogICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICAKICAgIC8vIEZJWEVEOiBEZWNsYXJlIGluc2VydF9jbWQgaGVyZQogICAgY2hhciBpbnNlcnRfY21kWzUxMl07CiAgICAKICAgIC8vIEluc2VydCBzb21lIGluaXRpYWwgZGF0YQogICAgZm9yIChpbnQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBzbnByaW50ZihpbnNlcnRfY21kLCBzaXplb2YoaW5zZXJ0X2NtZCksCiAgICAgICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJJbml0aWFsJWRcIiAtLWFnZS0lZCA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lLCBpLCAyMCArIGkpOwogICAgICAgIHN5c3RlbShpbnNlcnRfY21kKTsKICAgIH0KICAgIAogICAgLy8gVEVTVCAxOiBMb2NrIGZpbGUgY2xlYW51cAogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlJFQ09WRVJZIDE6IExvY2sgZmlsZSBjbGVhbnVwIGFmdGVyIGNyYXNoIik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgY2hhciBsb2NrX3BhdGhbNTEyXTsKICAgIHNucHJpbnRmKGxvY2tfcGF0aCwgc2l6ZW9mKGxvY2tfcGF0aCksICIvdG1wL3N5ZGJfdGVzdC8lcy91c2Vycy8uZGF0YS5sb2NrIiwgZGJfbmFtZSk7CiAgICAKICAgIC8vIENyZWF0ZSBhIHN0YWxlIGxvY2sgZmlsZQogICAgRklMRSogbG9jayA9IGZvcGVuKGxvY2tfcGF0aCwgInciKTsKICAgIGlmIChsb2NrKSB7CiAgICAgICAgZnByaW50Zihsb2NrLCAic3RhbGUgbG9ja1xuIik7CiAgICAgICAgZmNsb3NlKGxvY2spOwogICAgfQogICAgCiAgICBsb25nIGxvbmcgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAKICAgIC8vIFRyeSB0byB3cml0ZSAtIHNob3VsZCBoYW5kbGUgc3RhbGUgbG9jawogICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJMb2NrIFRlc3RcIiAtLWFnZS05OSA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgaW50IHdyaXRlX3Jlc3VsdCA9IHN5c3RlbShpbnNlcnRfY21kKTsKICAgIAogICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgLy8gQ2hlY2sgaWYgbG9jayBmaWxlIGlzIGdvbmUKICAgIGludCBsb2NrX2V4aXN0cyA9IGZpbGVfZXhpc3RzKGxvY2tfcGF0aCk7CiAgICAKICAgIGlmICh3cml0ZV9yZXN1bHQgPT0gMCAmJiAhbG9ja19leGlzdHMpIHsKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBTdGFsZSBsb2NrIGhhbmRsZWRcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfUkVDT1ZFUlldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBMb2NrIGhhbmRsaW5nIG5lZWRzIGltcHJvdmVtZW50XG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1JFQ09WRVJZXSsrOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIFJlY292ZXJ5IHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gU01PS0UgVEVTVFMgKFlvdXIgb3JpZ2luYWwgQ0xJIHRlc3RzKSA9PT09PT09PT09PT09PT09PT09PQoKaW50IHJ1bl9zbW9rZV90ZXN0c19jbGkoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIlNNT0tFIFRFU1RTIC0gQmFzaWMgRnVuY3Rpb25hbGl0eSAoQ0xJKSIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIAogICAgLy8gQ2xlYW4gdXAKICAgIHN5c3RlbSgicm0gLXJmIC90bXAvc3lkYl90ZXN0ID4gL2Rldi9udWxsIDI+JjEiKTsKICAgIAogICAgVGVzdENhc2UgdGVzdHNbXSA9IHsKICAgICAgICB7CiAgICAgICAgICAgICJDcmVhdGUgZGF0YWJhc2UgJ3Rlc3RkYiciLCAKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICJ0ZXN0IC1kICcvdG1wL3N5ZGJfdGVzdC90ZXN0ZGInIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkNyZWF0ZSBkYXRhYmFzZSAndGVzdGRiMiciLCAKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIyID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAidGVzdCAtZCAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiMiciLCAKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkxpc3QgZGF0YWJhc2VzIiwKICAgICAgICAgICAgIiVzIGxpc3QgPiAvZGV2L251bGwgMj4mMSIsIAogICAgICAgICAgICAiJXMgbGlzdCB8IGdyZXAgLWMgJ3Rlc3RkYlxcfHRlc3RkYjInIiwKICAgICAgICAgICAgIjIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJDcmVhdGUgJ3VzZXJzJyBjb2xsZWN0aW9uIHdpdGggc2NoZW1hIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgdXNlcnMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZy1yZXEgLS1hZ2UtaW50IC0tZW1haWwtc3RyaW5nID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAidGVzdCAtZiAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiL3VzZXJzL3NjaGVtYS50eHQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkNyZWF0ZSAncHJvZHVjdHMnIGNvbGxlY3Rpb24iLAogICAgICAgICAgICAiJXMgY3JlYXRlIHRlc3RkYiBwcm9kdWN0cyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nLXJlcSAtLXByaWNlLWZsb2F0ID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAidGVzdCAtZiAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiL3Byb2R1Y3RzL3NjaGVtYS50eHQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkluc2VydCB1c2VyIHJlY29yZCIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJKb2huIERvZVwiIC0tYWdlLTMwIC0tZW1haWwtXCJqb2huQHRlc3QuY29tXCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiB1c2VycyB8IGdyZXAgLWMgJ1wiX2lkXCInIiwKICAgICAgICAgICAgIjEiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJJbnNlcnQgc2Vjb25kIHVzZXIiLCAKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIkphbmUgU21pdGhcIiAtLWFnZS0yNSAtLWVtYWlsLVwiamFuZUB0ZXN0LmNvbVwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgfCBncmVwIC1jICdcIl9pZFwiJyIsCiAgICAgICAgICAgICIyIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiSW5zZXJ0IHByb2R1Y3QiLAogICAgICAgICAgICAiJXMgY3JlYXRlIHRlc3RkYiBwcm9kdWN0cyAtLWluc2VydC1vbmUgLS1uYW1lLVwiVGVzdCBQcm9kdWN0XCIgLS1wcmljZS0xOS45OSA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgIiVzIGxpc3QgdGVzdGRiIHByb2R1Y3RzIHwgZ3JlcCAtYyAnVGVzdCBQcm9kdWN0JyIsCiAgICAgICAgICAgICIxIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiUXVlcnkgYnkgYWdlIiwKICAgICAgICAgICAgIiVzIGZpbmQgdGVzdGRiIHVzZXJzIC0td2hlcmUgXCJhZ2U6MzBcIiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgIiVzIGZpbmQgdGVzdGRiIHVzZXJzIC0td2hlcmUgXCJhZ2U6MzBcIiB8IGdyZXAgLWMgJ0pvaG4gRG9lJyIsCiAgICAgICAgICAgICIxIiwgCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlF1ZXJ5IG5vbi1leGlzdGVudCIsCiAgICAgICAgICAgICIlcyBmaW5kIHRlc3RkYiB1c2VycyAtLXdoZXJlIFwiYWdlOjk5OVwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgZmluZCB0ZXN0ZGIgdXNlcnMgLS13aGVyZSBcImFnZTo5OTlcIiB8IHdjIC1sIiwKICAgICAgICAgICAgIjAiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJMaXN0IGNvbGxlY3Rpb25zIiwKICAgICAgICAgICAgIiVzIGxpc3QgdGVzdGRiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgfCBncmVwIC1jICd1c2Vyc1xcfHByb2R1Y3RzJyIsIAogICAgICAgICAgICAiMiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkxpc3QgdXNlcnMiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiB1c2VycyB8IGdyZXAgLWMgJ1wiX2lkXCInIiwKICAgICAgICAgICAgIjIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJWZXJpZnkgVVVJRCBmb3JtYXQiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgfCBoZWFkIC0xID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgfCBoZWFkIC0xIHwgZ3JlcCAtRW8gJ1wiW2EtZjAtOV17OH0tW2EtZjAtOV17NH0tW2EtZjAtOV17NH0tW2EtZjAtOV17NH0tW2EtZjAtOV17MTJ9XCInIHwgd2MgLWwiLAogICAgICAgICAgICAiMSIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9CiAgICB9OwogICAgCiAgICBpbnQgdGVzdF9jb3VudCA9IHNpemVvZih0ZXN0cykgLyBzaXplb2YodGVzdHNbMF0pOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IHRlc3RfY291bnQ7IGkrKykgewogICAgICAgIHRvdGFsKys7CiAgICAgICAgCiAgICAgICAgY2hhciBmaW5hbF9jb21tYW5kWzEwMjRdOwogICAgICAgIGNoYXIgZmluYWxfdmVyaWZpY2F0aW9uWzEwMjRdOwogICAgICAgIAogICAgICAgIHNucHJpbnRmKGZpbmFsX2NvbW1hbmQsIHNpemVvZihmaW5hbF9jb21tYW5kKSwgdGVzdHNbaV0uY29tbWFuZCwgY2xpX2NvbW1hbmQpOwogICAgICAgIHNucHJpbnRmKGZpbmFsX3ZlcmlmaWNhdGlvbiwgc2l6ZW9mKGZpbmFsX3ZlcmlmaWNhdGlvbiksIHRlc3RzW2ldLnZlcmlmaWNhdGlvbl9jb21tYW5kLCBjbGlfY29tbWFuZCk7CiAgICAgICAgCiAgICAgICAgc3RyY3B5KHRlc3RzW2ldLmNvbW1hbmQsIGZpbmFsX2NvbW1hbmQpOwogICAgICAgIHN0cmNweSh0ZXN0c1tpXS52ZXJpZmljYXRpb25fY29tbWFuZCwgZmluYWxfdmVyaWZpY2F0aW9uKTsKICAgICAgICAKICAgICAgICBpZiAoZXhlY3V0ZV90ZXN0X3dpdGhfdmVyaWZpY2F0aW9uKCZ0ZXN0c1tpXSkpIHsKICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcmludGYoWUVMTE9XICIgIFNtb2tlIHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKaW50IHJ1bl9zbW9rZV90ZXN0c19odHRwKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJTTU9LRSBURVNUUyAtIEJhc2ljIEhUVFAgQVBJIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgbG9uZyBsb25nIGR1cmF0aW9uOwogICAgCiAgICAvLyBUZXN0IGNvbm5lY3Rpdml0eQogICAgSHR0cFJlc3BvbnNlKiB0ZXN0X3Jlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KCJHRVQiLCAiL2FwaS9kYXRhYmFzZXMiLCBOVUxMLCBOVUxMKTsKICAgIGlmICh0ZXN0X3Jlc3BvbnNlICYmIHRlc3RfcmVzcG9uc2UtPnN0YXR1c19jb2RlID4gMCkgewogICAgICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlNlcnZlciBjb25uZWN0aXZpdHkgdGVzdCIpOwogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdXG4iKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICB0b3RhbCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1NNT0tFXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJTZXJ2ZXIgY29ubmVjdGl2aXR5IHRlc3QiKTsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl1cbiIpOwogICAgICAgIHRvdGFsKys7CiAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzICs9IHRvdGFsOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9TTU9LRV0gKz0gdG90YWw7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUodGVzdF9yZXNwb25zZSk7CiAgICAKICAgIC8vIExpc3QgZGF0YWJhc2VzCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgIi9hcGkvZGF0YWJhc2VzIiwgTlVMTCwgIlwic3VjY2Vzc1wiOnRydWUiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgCiAgICAvLyBDcmVhdGUgZGF0YWJhc2UKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJzbW9rZV90ZXN0XyVsZCIsIHRpbWUoTlVMTCkpOwogICAgY2hhciBjcmVhdGVfYm9keVsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2JvZHksIHNpemVvZihjcmVhdGVfYm9keSksICJ7XCJuYW1lXCI6XCIlc1wifSIsIGRiX25hbWUpOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzIC0gQ3JlYXRlIGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfYm9keSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIEhUVFAgU21va2UgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBURVNUIFNVSVRFIERJU1BBVENIRVIgPT09PT09PT09PT09PT09PT09PT0KCnZvaWQgcnVuX2FsbF9jbGlfdGVzdHMoKSB7CiAgICBwcmludGYoQ1lBTiBCT0xEICJcbj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iIFJFU0VUKTsKICAgIHByaW50ZihDWUFOIEJPTEQgIiAgIFNZREIgQ0xJIENPTVBSRUhFTlNJVkUgVEVTVCBTVUlURVxuIiBSRVNFVCk7CiAgICBwcmludGYoQ1lBTiBCT0xEICI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIiBSRVNFVCk7CiAgICBwcmludGYoIkNvbW1hbmQ6ICVzXG4iLCBjbGlfY29tbWFuZCk7CiAgICBwcmludGYoIlRlc3QgbGV2ZWw6ICVzXG4iLCAKICAgICAgICAgICB0ZXN0X2xldmVsID09IDAgPyAiUXVpY2siIDogCiAgICAgICAgICAgdGVzdF9sZXZlbCA9PSAxID8gIlN0YW5kYXJkIiA6ICJDb21wcmVoZW5zaXZlIik7CiAgICBwcmludGYoIlZlcmJvc2U6ICVzXG4iLCB2ZXJib3NlX21vZGUgPyAiWWVzIiA6ICJObyIpOwogICAgcHJpbnRmKENZQU4gQk9MRCAiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuIiBSRVNFVCk7CiAgICAKICAgIC8vIENsZWFudXAKICAgIHN5c3RlbSgicm0gLXJmIC90bXAvc3lkYl90ZXN0ID4gL2Rldi9udWxsIDI+JjEiKTsKICAgIG1rZGlyKCIvdG1wL3N5ZGJfdGVzdCIsIDA3NTUpOwogICAgCiAgICAvLyBSdW4gdGVzdCBjYXRlZ29yaWVzIGluIG9yZGVyCiAgICBydW5fc21va2VfdGVzdHNfY2xpKCk7CiAgICAKICAgIGlmICh0ZXN0X2xldmVsID49IDEpIHsKICAgICAgICBydW5fc2VjdXJpdHlfdGVzdHNfY2xpKCk7CiAgICAgICAgcnVuX3NjaGVtYV9lbmZvcmNlbWVudF90ZXN0c19jbGkoKTsKICAgICAgICBydW5fcXVlcnlfbGFuZ3VhZ2VfdGVzdHNfY2xpKCk7CiAgICAgICAgcnVuX2RhdGFfaW50ZWdyaXR5X3Rlc3RzX2NsaSgpOyAvLyBBY3R1YWxseSBydW5faW50ZWdyaXR5X3Rlc3RzX2NsaQogICAgICAgIHJ1bl9lZGdlX2Nhc2VfdGVzdHNfY2xpKCk7CiAgICAgICAgcnVuX3BlcmZvcm1hbmNlX3Rlc3RzX2NsaSgpOwogICAgICAgIHJ1bl9jb25jdXJyZW5jeV90ZXN0c19jbGkoKTsKICAgIH0KICAgIAogICAgaWYgKHRlc3RfbGV2ZWwgPj0gMikgewogICAgICAgIHJ1bl9kdXJhYmlsaXR5X3Rlc3RzX2NsaSgpOwogICAgICAgIHJ1bl9yZWNvdmVyeV90ZXN0c19jbGkoKTsKICAgIH0KfQoKdm9pZCBydW5fYWxsX2h0dHBfdGVzdHMoKSB7CiAgICBwcmludGYoQ1lBTiBCT0xEICJcbj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iIFJFU0VUKTsKICAgIHByaW50ZihDWUFOIEJPTEQgIiAgIFNZREIgSFRUUCBBUEkgQ09NUFJFSEVOU0lWRSBURVNUIFNVSVRFXG4iIFJFU0VUKTsKICAgIHByaW50ZihDWUFOIEJPTEQgIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iIFJFU0VUKTsKICAgIHByaW50ZigiU2VydmVyIFVSTDogJXNcbiIsIHNlcnZlcl91cmwpOwogICAgcHJpbnRmKCJUZXN0IGxldmVsOiAlc1xuIiwgCiAgICAgICAgICAgdGVzdF9sZXZlbCA9PSAwID8gIlF1aWNrIiA6IAogICAgICAgICAgIHRlc3RfbGV2ZWwgPT0gMSA/ICJTdGFuZGFyZCIgOiAiQ29tcHJlaGVuc2l2ZSIpOwogICAgcHJpbnRmKCJWZXJib3NlOiAlc1xuIiwgdmVyYm9zZV9tb2RlID8gIlllcyIgOiAiTm8iKTsKICAgIHByaW50ZihDWUFOIEJPTEQgIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiIgUkVTRVQpOwogICAgCiAgICAvLyBUZXN0IGNvbm5lY3Rpdml0eSBmaXJzdAogICAgSHR0cFJlc3BvbnNlKiB0ZXN0X3Jlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KCJHRVQiLCAiL2FwaS9kYXRhYmFzZXMiLCBOVUxMLCBOVUxMKTsKICAgIGlmICghdGVzdF9yZXNwb25zZSB8fCB0ZXN0X3Jlc3BvbnNlLT5zdGF0dXNfY29kZSA9PSAwKSB7CiAgICAgICAgcHJpbnRmKFJFRCAiRVJST1I6IENhbm5vdCBjb25uZWN0IHRvIHNlcnZlciBhdCAlc1xuIiBSRVNFVCwgc2VydmVyX3VybCk7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiQXR0ZW1wdGluZyB0byBzdGFydCBzZXJ2ZXIgYXV0b21hdGljYWxseS4uLlxuIiBSRVNFVCk7CiAgICAgICAgCiAgICAgICAgaWYgKCFzdGFydF9zeWRiX3NlcnZlcigpKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIkZhaWxlZCB0byBzdGFydCBzZXJ2ZXIuIFBsZWFzZSBzdGFydCBtYW51YWxseSB3aXRoOiAlcyAtLXNlcnZlclxuIiBSRVNFVCwgY2xpX2NvbW1hbmQpOwogICAgICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUodGVzdF9yZXNwb25zZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUodGVzdF9yZXNwb25zZSk7CiAgICAKICAgIC8vIENsZWFuIHVwIG9sZCB0ZXN0IGRhdGFiYXNlcwogICAgY2xlYW51cF90ZXN0X2RhdGFiYXNlcygpOwogICAgCiAgICAvLyBSdW4gSFRUUCB0ZXN0IGNhdGVnb3JpZXMKICAgIHJ1bl9zbW9rZV90ZXN0c19odHRwKCk7CiAgICAKICAgIGlmICh0ZXN0X2xldmVsID49IDEpIHsKICAgICAgICBydW5faHR0cF9kYXRhYmFzZV90ZXN0cygpOwogICAgICAgIHJ1bl9odHRwX2NvbGxlY3Rpb25fdGVzdHMoKTsKICAgICAgICBydW5faHR0cF9pbnN0YW5jZV90ZXN0cygpOwogICAgICAgIHJ1bl9odHRwX2NvbW1hbmRfdGVzdHMoKTsKICAgICAgICBydW5faHR0cF9lcnJvcl90ZXN0cygpOwogICAgICAgIHJ1bl9zZWN1cml0eV90ZXN0c19odHRwKCk7CiAgICAgICAgcnVuX3NjaGVtYV9lbmZvcmNlbWVudF90ZXN0c19odHRwKCk7CiAgICAgICAgcnVuX3F1ZXJ5X2xhbmd1YWdlX3Rlc3RzX2h0dHAoKTsKICAgICAgICBydW5fcGVyZm9ybWFuY2VfdGVzdHNfaHR0cCgpOwogICAgfQogICAgCiAgICBpZiAodGVzdF9sZXZlbCA+PSAyKSB7CiAgICAgICAgcnVuX2NvbmN1cnJlbmN5X3Rlc3RzX2h0dHAoKTsKICAgICAgICBydW5fZHVyYWJpbGl0eV90ZXN0c19odHRwKCk7CiAgICB9CiAgICAKICAgIC8vIFN0b3Agc2VydmVyIGlmIHdlIHN0YXJ0ZWQgaXQKICAgIGlmIChzZXJ2ZXJfc3RhcnRlZF9ieV90ZXN0KSB7CiAgICAgICAgc3RvcF9zeWRiX3NlcnZlcigpOwogICAgfQp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBDTEVBTlVQIEZVTkNUSU9OID09PT09PT09PT09PT09PT09PT09CgoKLy8gPT09PT09PT09PT09PT09PT09PT0gUkVTVUxUUyBSRVBPUlRJTkcgPT09PT09PT09PT09PT09PT09PT0KCnZvaWQgcHJpbnRfZmluYWxfcmVzdWx0cygpIHsKICAgIHByaW50ZigiXG4iKTsKICAgIHByaW50ZihDWUFOIEJPTEQgIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iIFJFU0VUKTsKICAgIHByaW50ZihDWUFOIEJPTEQgIiAgICAgICAgICAgRklOQUwgVEVTVCBSRVNVTFRTXG4iIFJFU0VUKTsKICAgIHByaW50ZihDWUFOIEJPTEQgIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iIFJFU0VUKTsKICAgIAogICAgcHJpbnRmKCJUb3RhbCBUZXN0czogICAgICAlZFxuIiwgc3RhdHMudG90YWxfdGVzdHMpOwogICAgcHJpbnRmKCJQYXNzZWQ6ICAgICAgICAgICAiIEdSRUVOICIlZCIgUkVTRVQgIlxuIiwgc3RhdHMucGFzc2VkX3Rlc3RzKTsKICAgIHByaW50ZigiRmFpbGVkOiAgICAgICAgICAgIiBSRUQgIiVkIiBSRVNFVCAiXG4iLCBzdGF0cy5mYWlsZWRfdGVzdHMpOwogICAgcHJpbnRmKCJTa2lwcGVkOiAgICAgICAgICAiIFlFTExPVyAiJWQiIFJFU0VUICJcbiIsIHN0YXRzLnNraXBwZWRfdGVzdHMpOwogICAgcHJpbnRmKCJDcml0aWNhbCBGYWlsdXJlczoiIFJFRCAiJWQiIFJFU0VUICJcbiIsIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKTsKICAgIHByaW50ZigiVG90YWwgRHVyYXRpb246ICAgIiBDWUFOICIlbGxkIG1zIiBSRVNFVCAiXG4iLCBzdGF0cy50b3RhbF9kdXJhdGlvbik7CiAgICAKICAgIHByaW50ZigiXG4iIEJPTEQgIkNhdGVnb3J5IEJyZWFrZG93bjpcbiIgUkVTRVQpOwogICAgcHJpbnRmKCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiIpOwogICAgCiAgICBjb25zdCBjaGFyKiBjYXRfbmFtZXNbXSA9IHsKICAgICAgICAiU21va2UgVGVzdHMiLAogICAgICAgICJEdXJhYmlsaXR5IiwgCiAgICAgICAgIkNvbmN1cnJlbmN5IiwKICAgICAgICAiUXVlcnkgTGFuZ3VhZ2UiLAogICAgICAgICJTY2hlbWEgRW5mb3JjZW1lbnQiLAogICAgICAgICJTZWN1cml0eSIsCiAgICAgICAgIlBlcmZvcm1hbmNlIiwKICAgICAgICAiRGF0YSBJbnRlZ3JpdHkiLAogICAgICAgICJFZGdlIENhc2VzIiwKICAgICAgICAiUmVjb3ZlcnkiCiAgICB9OwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICBpZiAoc3RhdHMuY2F0ZWdvcmllc190b3RhbFtpXSA+IDApIHsKICAgICAgICAgICAgZG91YmxlIHBjdCA9IChkb3VibGUpc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbaV0gLyBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW2ldICogMTAwOwogICAgICAgICAgICBjaGFyKiBjb2xvciA9IHBjdCA+PSA5MCA/IEdSRUVOIDogKHBjdCA+PSA3MCA/IFlFTExPVyA6IFJFRCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludGYoIiUtMThzOiAlcyUyZC8lLTJkICglMy4wZiUlKSVzXG4iLCAKICAgICAgICAgICAgICAgICAgIGNhdF9uYW1lc1tpXSwgY29sb3IsIAogICAgICAgICAgICAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbaV0sIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbaV0sIHBjdCwgUkVTRVQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpbnRmKENZQU4gQk9MRCAiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgCiAgICAvLyBPdmVyYWxsIHZlcmRpY3QKICAgIHByaW50ZigiXG4iIEJPTEQgIlZFUkRJQ1Q6ICIgUkVTRVQpOwogICAgCiAgICBpZiAoc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMgPT0gMCAmJiBzdGF0cy5wYXNzZWRfdGVzdHMgPj0gc3RhdHMudG90YWxfdGVzdHMgKiAwLjkpIHsKICAgICAgICBwcmludGYoR1JFRU4gIlBBU1MgLSBBbGwgY3JpdGljYWwgdGVzdHMgcGFzc2VkXG4iIFJFU0VUKTsKICAgIH0gZWxzZSBpZiAoc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMgPT0gMCAmJiBzdGF0cy5wYXNzZWRfdGVzdHMgPj0gc3RhdHMudG90YWxfdGVzdHMgKiAwLjcpIHsKICAgICAgICBwcmludGYoWUVMTE9XICJQQVNTIFdJVEggV0FSTklOR1MgLSBTb21lIG5vbi1jcml0aWNhbCB0ZXN0cyBmYWlsZWRcbiIgUkVTRVQpOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoUkVEICJGQUlMIC0gQ3JpdGljYWwgZmFpbHVyZXMgZGV0ZWN0ZWRcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZigiXG4iIFlFTExPVyAiU3lEQiBpcyBOT1QgcmVhZHkgZm9yIHByb2R1Y3Rpb24gdXNlLlxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiVGhlIGZvbGxvd2luZyBjcml0aWNhbCBhcmVhcyBuZWVkIGF0dGVudGlvbjpcbiIgUkVTRVQpOwogICAgICAgIAogICAgICAgIGlmIChzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9EVVJBQklMSVRZXSA8IHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfRFVSQUJJTElUWV0pIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICDigKIgRHVyYWJpbGl0eS9DcmFzaCBSZWNvdmVyeSAtIERhdGEgbWF5IG5vdCBzdXJ2aXZlIHBvd2VyIGxvc3NcbiIgUkVTRVQpOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfQ09OQ1VSUkVOQ1ldIDwgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9DT05DVVJSRU5DWV0pIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICDigKIgQ29uY3VycmVuY3kgLSBNYXkgY29ycnVwdCB1bmRlciBwYXJhbGxlbCBsb2FkXG4iIFJFU0VUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1NDSEVNQV0gPCBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1NDSEVNQV0pIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICDigKIgU2NoZW1hIEVuZm9yY2VtZW50IC0gTm90IHByb3Blcmx5IHZhbGlkYXRpbmcgZGF0YVxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9SRUNPVkVSWV0gPCBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1JFQ09WRVJZXSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIOKAoiBSZWNvdmVyeSAtIENhbm5vdCByZWNvdmVyIGZyb20gY3Jhc2hlcy9jb3JydXB0aW9uXG4iIFJFU0VUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX0lOVEVHUklUWV0gPCBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX0lOVEVHUklUWV0pIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICDigKIgRGF0YSBJbnRlZ3JpdHkgLSBGaWxlIGZvcm1hdCBpc3N1ZXMgZGV0ZWN0ZWRcbiIgUkVTRVQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpbnRmKENZQU4gQk9MRCAiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuIiBSRVNFVCk7Cn0KCi8vID09PT09PT09PT09PT09PT09PT09IE1BSU4gRlVOQ1RJT04gPT09PT09PT09PT09PT09PT09PT0KCnZvaWQgcHJpbnRfdXNhZ2UoY29uc3QgY2hhciAqcHJvZ3JhbV9uYW1lKSB7CiAgICBwcmludGYoIlVzYWdlOiAlcyBbT1BUSU9OU11cbiIsIHByb2dyYW1fbmFtZSk7CiAgICBwcmludGYoIlxuIik7CiAgICBwcmludGYoIlRFU1QgTU9ERVM6XG4iKTsKICAgIHByaW50ZigiICAtLWNsaSAgICAgICAgICAgVGVzdCBDTEkgbW9kZSAoZGVmYXVsdCBpZiBubyBtb2RlIHNwZWNpZmllZClcbiIpOwogICAgcHJpbnRmKCIgIC0tc2VydmVyICAgICAgICBUZXN0IEhUVFAgQVBJIG1vZGUgKHJlcXVpcmVzIHJ1bm5pbmcgc2VydmVyIG9yIHdpbGwgYXV0by1zdGFydClcbiIpOwogICAgcHJpbnRmKCJcbiIpOwogICAgcHJpbnRmKCJURVNUIExFVkVMUzpcbiIpOwogICAgcHJpbnRmKCIgIC0tbGV2ZWw9MCAgICAgICBRdWljayBtb2RlIC0gc21va2UgdGVzdHMgb25seVxuIik7CiAgICBwcmludGYoIiAgLS1sZXZlbD0xICAgICAgIFN0YW5kYXJkIG1vZGUgLSBjb3JlIGZ1bmN0aW9uYWxpdHkgKGRlZmF1bHQpXG4iKTsKICAgIHByaW50ZigiICAtLWxldmVsPTIgICAgICAgQ29tcHJlaGVuc2l2ZSAtIGFsbCB0ZXN0cyBpbmNsdWRpbmcgZHVyYWJpbGl0eSAmIGNvbmN1cnJlbmN5XG4iKTsKICAgIHByaW50ZigiXG4iKTsKICAgIHByaW50ZigiT1BUSU9OUzpcbiIpOwogICAgcHJpbnRmKCIgIC0tY29tbWFuZD1QQVRIICBTcGVjaWZ5IHN5ZGIgY29tbWFuZCBwYXRoIChkZWZhdWx0OiAuL3N5ZGIpXG4iKTsKICAgIHByaW50ZigiICAtLXVybD1VUkwgICAgICAgU3BlY2lmeSBzZXJ2ZXIgVVJMIGZvciBIVFRQIHRlc3RzIChkZWZhdWx0OiBodHRwOi8vbG9jYWxob3N0OjgwODApXG4iKTsKICAgIHByaW50ZigiICAtLXZlcmJvc2UgICAgICAgRW5hYmxlIGV4dHJlbWVseSBkZXRhaWxlZCBsb2dnaW5nXG4iKTsKICAgIHByaW50ZigiICAtLWhlbHAsIC1oICAgICAgU2hvdyB0aGlzIGhlbHAgbWVzc2FnZVxuIik7CiAgICBwcmludGYoIlxuIik7CiAgICBwcmludGYoIkVYQU1QTEVTOlxuIik7CiAgICBwcmludGYoIiAgJXMgICAgICAgICAgICAgICAgICAgICAgICAgIyBRdWljayBDTEkgc21va2UgdGVzdHNcbiIsIHByb2dyYW1fbmFtZSk7CiAgICBwcmludGYoIiAgJXMgLS1sZXZlbD0xICAgICAgICAgICAgICAgIyBTdGFuZGFyZCBDTEkgdGVzdHNcbiIsIHByb2dyYW1fbmFtZSk7CiAgICBwcmludGYoIiAgJXMgLS1sZXZlbD0yIC0tdmVyYm9zZSAgICAgIyBDb21wcmVoZW5zaXZlIENMSSB0ZXN0cyB3aXRoIGRlYnVnIG91dHB1dFxuIiwgcHJvZ3JhbV9uYW1lKTsKICAgIHByaW50ZigiICAlcyAtLXNlcnZlciAtLWxldmVsPTEgICAgICAjIFN0YW5kYXJkIEhUVFAgQVBJIHRlc3RzXG4iLCBwcm9ncmFtX25hbWUpOwogICAgcHJpbnRmKCIgICVzIC0tc2VydmVyIC0tdXJsPWh0dHA6Ly9sb2NhbGhvc3Q6OTAwMCAgIyBIVFRQIHRlc3RzIG9uIGN1c3RvbSBwb3J0XG4iLCBwcm9ncmFtX25hbWUpOwp9CgppbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKSB7CiAgICAvLyBEZWZhdWx0IHNldHRpbmdzCiAgICB0ZXN0X21vZGUgPSBURVNUX01PREVfQ0xJOyAgLy8gRGVmYXVsdCB0byBDTEkKICAgIHRlc3RfbGV2ZWwgPSAxOyAgICAgICAgICAgICAvLyBEZWZhdWx0IHRvIHN0YW5kYXJkCiAgICB2ZXJib3NlX21vZGUgPSAwOwogICAgc3RyY3B5KGNsaV9jb21tYW5kLCAiLi9zeWRiIik7CiAgICBzdHJjcHkoc2VydmVyX3VybCwgImh0dHA6Ly9sb2NhbGhvc3Q6ODA4MCIpOwogICAgCiAgICAvLyBQYXJzZSBjb21tYW5kIGxpbmUgYXJndW1lbnRzCiAgICBmb3IgKGludCBpID0gMTsgaSA8IGFyZ2M7IGkrKykgewogICAgICAgIGlmIChzdHJjbXAoYXJndltpXSwgIi0tY2xpIikgPT0gMCkgewogICAgICAgICAgICB0ZXN0X21vZGUgPSBURVNUX01PREVfQ0xJOwogICAgICAgIH0gZWxzZSBpZiAoc3RyY21wKGFyZ3ZbaV0sICItLXNlcnZlciIpID09IDApIHsKICAgICAgICAgICAgdGVzdF9tb2RlID0gVEVTVF9NT0RFX1NFUlZFUjsKICAgICAgICB9IGVsc2UgaWYgKHN0cmNtcChhcmd2W2ldLCAiLS12ZXJib3NlIikgPT0gMCkgewogICAgICAgICAgICB2ZXJib3NlX21vZGUgPSAxOwogICAgICAgIH0gZWxzZSBpZiAoc3RybmNtcChhcmd2W2ldLCAiLS1sZXZlbD0iLCA4KSA9PSAwKSB7CiAgICAgICAgICAgIHRlc3RfbGV2ZWwgPSBhdG9pKGFyZ3ZbaV0gKyA4KTsKICAgICAgICAgICAgaWYgKHRlc3RfbGV2ZWwgPCAwIHx8IHRlc3RfbGV2ZWwgPiAyKSB0ZXN0X2xldmVsID0gMTsKICAgICAgICB9IGVsc2UgaWYgKHN0cm5jbXAoYXJndltpXSwgIi0tY29tbWFuZD0iLCAxMCkgPT0gMCkgewogICAgICAgICAgICBzdHJuY3B5KGNsaV9jb21tYW5kLCBhcmd2W2ldICsgMTAsIHNpemVvZihjbGlfY29tbWFuZCkgLSAxKTsKICAgICAgICB9IGVsc2UgaWYgKHN0cm5jbXAoYXJndltpXSwgIi0tdXJsPSIsIDYpID09IDApIHsKICAgICAgICAgICAgc3RybmNweShzZXJ2ZXJfdXJsLCBhcmd2W2ldICsgNiwgc2l6ZW9mKHNlcnZlcl91cmwpIC0gMSk7CiAgICAgICAgfSBlbHNlIGlmIChzdHJjbXAoYXJndltpXSwgIi0taGVscCIpID09IDAgfHwgc3RyY21wKGFyZ3ZbaV0sICItaCIpID09IDApIHsKICAgICAgICAgICAgcHJpbnRfdXNhZ2UoYXJndlswXSk7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZwcmludGYoc3RkZXJyLCBSRUQgIlVua25vd24gb3B0aW9uOiAlc1xuIiBSRVNFVCwgYXJndltpXSk7CiAgICAgICAgICAgIHByaW50X3VzYWdlKGFyZ3ZbMF0pOwogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vID09PT09PT09PT09PT09PT09PT09IFdSQVBQRVIgRlVOQ1RJT04gPT09PT09PT09PT09PT09PT09PT0KCgoKICAgIC8vIFNldCBlbnZpcm9ubWVudAogICAgc2V0ZW52KCJTWURCX0JBU0VfRElSIiwgIi90bXAvc3lkYl90ZXN0IiwgMSk7CiAgICAKICAgIC8vIEluaXRpYWxpemUgc3RhdGlzdGljcwogICAgbWVtc2V0KCZzdGF0cywgMCwgc2l6ZW9mKHN0YXRzKSk7CiAgICAKICAgIC8vIFJ1biB0ZXN0cyBiYXNlZCBvbiBtb2RlCiAgICBsb25nIGxvbmcgb3ZlcmFsbF9zdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgaWYgKHRlc3RfbW9kZSA9PSBURVNUX01PREVfQ0xJKSB7CiAgICAgICAgcnVuX2FsbF9jbGlfdGVzdHMoKTsKICAgIH0gZWxzZSBpZiAodGVzdF9tb2RlID09IFRFU1RfTU9ERV9TRVJWRVIpIHsKICAgICAgICBydW5fYWxsX2h0dHBfdGVzdHMoKTsKICAgIH0KICAgIAogICAgc3RhdHMudG90YWxfZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBvdmVyYWxsX3N0YXJ0OwogICAgCiAgICAvLyBQcmludCByZXN1bHRzCiAgICBwcmludF9maW5hbF9yZXN1bHRzKCk7CiAgICAKICAgIC8vIFJldHVybiBjb2RlIGJhc2VkIG9uIGNyaXRpY2FsIGZhaWx1cmVzCiAgICByZXR1cm4gKHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzID09IDAgJiYgc3RhdHMucGFzc2VkX3Rlc3RzID49IHN0YXRzLnRvdGFsX3Rlc3RzICogMC43KSA/IDAgOiAxOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBPUklHSU5BTCBIVFRQIFRFU1QgRlVOQ1RJT05TID09PT09PT09PT09PT09PT09PT09Ci8vIENvcHkgdGhlc2UgZXhhY3RseSBmcm9tIHlvdXIgb3JpZ2luYWwgdGVzdC5jCgp2b2lkIGNsZWFudXBfdGVzdF9kYXRhYmFzZXMoKSB7CiAgICBwcmludGYoIkNsZWFuaW5nIHVwIHByZXZpb3VzIHRlc3QgZGF0YWJhc2VzLi4uXG4iKTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIENsZWFuaW5nIHVwIHRlc3QgZGlyZWN0b3JpZXMgaW4gL3RtcC9zeWRiX3Rlc3QvXG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgY2hhciBjb21tYW5kWzUxMl07CiAgICBzbnByaW50Zihjb21tYW5kLCBzaXplb2YoY29tbWFuZCksICJybSAtcmYgL3RtcC9zeWRiX3Rlc3QvdGVzdGRiXyogL3RtcC9zeWRiX3Rlc3QvdGVzdGRiMl8qIC90bXAvc3lkYl90ZXN0L3Rlc3Rjb2xsZGJfKiAvdG1wL3N5ZGJfdGVzdC90ZXN0aW5zdGRiXyogMj4vZGV2L251bGwiKTsKICAgIHN5c3RlbShjb21tYW5kKTsKICAgIAogICAgc25wcmludGYoY29tbWFuZCwgc2l6ZW9mKGNvbW1hbmQpLCAicm0gLWYgL3RtcC9zeWRiX3Rlc3QvKi5sb2NrIC90bXAvc3lkYl90ZXN0Ly4qLmxvY2sgMj4vZGV2L251bGwiKTsKICAgIHN5c3RlbShjb21tYW5kKTsKICAgIAogICAgdXNsZWVwKDUwMDAwKTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIENsZWFudXAgY29tcGxldGVkXG4iIFJFU0VUKTsKICAgIH0KfQoKaW50IHJ1bl9odHRwX2RhdGFiYXNlX3Rlc3RzKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSAiSFRUUCBBUEkgREFUQUJBU0UgVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNoYXIgdW5pcXVlX2RiMVs2NF0sIHVuaXF1ZV9kYjJbNjRdOwogICAgc3RydWN0IHRpbWVzcGVjIHRzOwogICAgY2xvY2tfZ2V0dGltZShDTE9DS19NT05PVE9OSUMsICZ0cyk7CiAgICBzbnByaW50Zih1bmlxdWVfZGIxLCBzaXplb2YodW5pcXVlX2RiMSksICJ0ZXN0ZGJfJWxkXyVsZCIsIHRzLnR2X3NlYywgdHMudHZfbnNlYyk7CiAgICBzbnByaW50Zih1bmlxdWVfZGIyLCBzaXplb2YodW5pcXVlX2RiMiksICJ0ZXN0ZGIyXyVsZF8lbGQiLCB0cy50dl9zZWMsIHRzLnR2X25zZWMgKyAxKTsKICAgIAogICAgY2hhciBjcmVhdGVfZGIxX2JvZHlbMTI4XSwgY3JlYXRlX2RiMl9ib2R5WzEyOF07CiAgICBzbnByaW50ZihjcmVhdGVfZGIxX2JvZHksIHNpemVvZihjcmVhdGVfZGIxX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCB1bmlxdWVfZGIxKTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYjJfYm9keSwgc2l6ZW9mKGNyZWF0ZV9kYjJfYm9keSksICJ7XCJuYW1lXCI6XCIlc1wifSIsIHVuaXF1ZV9kYjIpOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMgLSBMaXN0IGRhdGFiYXNlcyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCAiL2FwaS9kYXRhYmFzZXMiLCBOVUxMLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDEsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzIC0gQ3JlYXRlIGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfZGIxX2JvZHksICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMgLSBDcmVhdGUgc2Vjb25kIGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfZGIyX2JvZHksICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMgLSBQcmV2ZW50IGR1cGxpY2F0ZSBkYXRhYmFzZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiMV9ib2R5LCAiXCJzdWNjZXNzXCI6ZmFsc2UiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY2hhciBkZWxldGVfdXJsWzI1Nl07CiAgICBzbnByaW50ZihkZWxldGVfdXJsLCBzaXplb2YoZGVsZXRlX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcyIsIHVuaXF1ZV9kYjIpOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiREVMRVRFIC9hcGkvZGF0YWJhc2VzL3tuYW1lfSAtIERlbGV0ZSBkYXRhYmFzZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJERUxFVEUiLCBkZWxldGVfdXJsLCBOVUxMLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIERhdGFiYXNlIEFQSSB0ZXN0czogJWQvJWQgcGFzc2VkIChhdmc6ICVsbGQgbXMpXG4iIFJFU0VULCAKICAgICAgICAgICBwYXNzZWQsIHRvdGFsLCB0b3RhbF90aW1lIC8gKHRvdGFsID4gMCA/IHRvdGFsIDogMSkpOwogICAgCiAgICByZXR1cm4gcGFzc2VkOwp9CgppbnQgcnVuX2h0dHBfY29sbGVjdGlvbl90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIkhUVFAgQVBJIENPTExFQ1RJT04gVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNoYXIgdW5pcXVlX2RiWzY0XTsKICAgIHN0cnVjdCB0aW1lc3BlYyB0czsKICAgIGNsb2NrX2dldHRpbWUoQ0xPQ0tfTU9OT1RPTklDLCAmdHMpOwogICAgc25wcmludGYodW5pcXVlX2RiLCBzaXplb2YodW5pcXVlX2RiKSwgInRlc3Rjb2xsZGJfJWxkXyVsZCIsIHRzLnR2X3NlYywgdHMudHZfbnNlYyk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMTI4XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCB1bmlxdWVfZGIpOwogICAgCiAgICBIdHRwUmVzcG9uc2UqIGRiX3Jlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiX2JvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBpZiAoIWRiX3Jlc3BvbnNlIHx8ICF2ZXJpZnlfaHR0cF9yZXNwb25zZShkYl9yZXNwb25zZSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwKSkgewogICAgICAgIHByaW50ZihSRUQgIiAgRmFpbGVkIHRvIGNyZWF0ZSB0ZXN0IGRhdGFiYXNlIGZvciBjb2xsZWN0aW9uIHRlc3RzXG4iIFJFU0VUKTsKICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUoZGJfcmVzcG9uc2UpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgaHR0cF9yZXNwb25zZV9mcmVlKGRiX3Jlc3BvbnNlKTsKICAgIAogICAgY2hhciBsaXN0X2NvbGxzX3VybFsyNTZdOwogICAgc25wcmludGYobGlzdF9jb2xsc191cmwsIHNpemVvZihsaXN0X2NvbGxzX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucyIsIHVuaXF1ZV9kYik7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucyAtIExpc3QgZW1wdHkgY29sbGVjdGlvbnMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgbGlzdF9jb2xsc191cmwsIE5VTEwsICJcImNvbGxlY3Rpb25zXCI6W10iLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY2hhciBjcmVhdGVfY29sbF91cmxbMjU2XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9jb2xsX3VybCwgc2l6ZW9mKGNyZWF0ZV9jb2xsX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucyIsIHVuaXF1ZV9kYik7CiAgICAKICAgIGNvbnN0IGNoYXIqIHVzZXJzX3NjaGVtYSA9ICJ7XCJuYW1lXCI6XCJ1c2Vyc1wiLFwic2NoZW1hXCI6WyIKICAgICAgICAie1wibmFtZVwiOlwibmFtZVwiLFwidHlwZVwiOlwic3RyaW5nXCIsXCJyZXF1aXJlZFwiOnRydWUsXCJpbmRleGVkXCI6ZmFsc2V9LCIKICAgICAgICAie1wibmFtZVwiOlwiYWdlXCIsXCJ0eXBlXCI6XCJpbnRcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJpbmRleGVkXCI6ZmFsc2V9LCIKICAgICAgICAie1wibmFtZVwiOlwiZW1haWxcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjpmYWxzZSxcImluZGV4ZWRcIjpmYWxzZX0iCiAgICAgICAgIl19IjsKICAgIAogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiUE9TVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zIC0gQ3JlYXRlIHVzZXJzIGNvbGxlY3Rpb24iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsIGNyZWF0ZV9jb2xsX3VybCwgdXNlcnNfc2NoZW1hLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBjb25zdCBjaGFyKiBwcm9kdWN0c19zY2hlbWEgPSAie1wibmFtZVwiOlwicHJvZHVjdHNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjp0cnVlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcInByaWNlXCIsXCJ0eXBlXCI6XCJmbG9hdFwiLFwicmVxdWlyZWRcIjpmYWxzZSxcImluZGV4ZWRcIjpmYWxzZX0iCiAgICAgICAgIl19IjsKICAgIAogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiUE9TVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zIC0gQ3JlYXRlIHByb2R1Y3RzIGNvbGxlY3Rpb24iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsIGNyZWF0ZV9jb2xsX3VybCwgcHJvZHVjdHNfc2NoZW1hLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucyAtIExpc3QgY3JlYXRlZCBjb2xsZWN0aW9ucyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBsaXN0X2NvbGxzX3VybCwgTlVMTCwgIlwidXNlcnNcIiIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBjaGFyIHNjaGVtYV91cmxbMjU2XTsKICAgIHNucHJpbnRmKHNjaGVtYV91cmwsIHNpemVvZihzY2hlbWFfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL3NjaGVtYSIsIHVuaXF1ZV9kYik7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucy97Y29sbH0vc2NoZW1hIC0gR2V0IHVzZXJzIHNjaGVtYSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBzY2hlbWFfdXJsLCBOVUxMLCAiXCJuYW1lXCIiLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY2hhciBkZWxldGVfY29sbF91cmxbMjU2XTsKICAgIHNucHJpbnRmKGRlbGV0ZV9jb2xsX3VybCwgc2l6ZW9mKGRlbGV0ZV9jb2xsX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy9wcm9kdWN0cyIsIHVuaXF1ZV9kYik7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJERUxFVEUgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucy97Y29sbH0gLSBEZWxldGUgcHJvZHVjdHMgY29sbGVjdGlvbiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJERUxFVEUiLCBkZWxldGVfY29sbF91cmwsIE5VTEwsICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgQ29sbGVjdGlvbiBBUEkgdGVzdHM6ICVkLyVkIHBhc3NlZCAoYXZnOiAlbGxkIG1zKVxuIiBSRVNFVCwgCiAgICAgICAgICAgcGFzc2VkLCB0b3RhbCwgdG90YWxfdGltZSAvICh0b3RhbCA+IDAgPyB0b3RhbCA6IDEpKTsKICAgIAogICAgcmV0dXJuIHBhc3NlZDsKfQoKaW50IHJ1bl9odHRwX2luc3RhbmNlX3Rlc3RzKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSAiSFRUUCBBUEkgSU5TVEFOQ0UgVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNoYXIgdW5pcXVlX2RiWzY0XTsKICAgIHN0cnVjdCB0aW1lc3BlYyB0czsKICAgIGNsb2NrX2dldHRpbWUoQ0xPQ0tfTU9OT1RPTklDLCAmdHMpOwogICAgc25wcmludGYodW5pcXVlX2RiLCBzaXplb2YodW5pcXVlX2RiKSwgInRlc3RpbnN0ZGJfJWxkXyVsZCIsIHRzLnR2X3NlYywgdHMudHZfbnNlYyk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMTI4XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCB1bmlxdWVfZGIpOwogICAgCiAgICBIdHRwUmVzcG9uc2UqIGRiX3Jlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiX2JvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBpZiAoIWRiX3Jlc3BvbnNlIHx8ICF2ZXJpZnlfaHR0cF9yZXNwb25zZShkYl9yZXNwb25zZSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwKSkgewogICAgICAgIHByaW50ZihSRUQgIiAgRmFpbGVkIHRvIGNyZWF0ZSB0ZXN0IGRhdGFiYXNlIGZvciBpbnN0YW5jZSB0ZXN0c1xuIiBSRVNFVCk7CiAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKGRiX3Jlc3BvbnNlKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIGh0dHBfcmVzcG9uc2VfZnJlZShkYl9yZXNwb25zZSk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfY29sbF91cmwsIHNpemVvZihjcmVhdGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCB1bmlxdWVfZGIpOwogICAgCiAgICBjb25zdCBjaGFyKiB1c2Vyc19zY2hlbWEgPSAie1wibmFtZVwiOlwidXNlcnNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjp0cnVlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImFnZVwiLFwidHlwZVwiOlwiaW50XCIsXCJyZXF1aXJlZFwiOmZhbHNlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImVtYWlsXCIsXCJ0eXBlXCI6XCJzdHJpbmdcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJpbmRleGVkXCI6ZmFsc2V9IgogICAgICAgICJdfSI7CiAgICAKICAgIEh0dHBSZXNwb25zZSogY29sbF9yZXNwb25zZSA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsIGNyZWF0ZV9jb2xsX3VybCwgdXNlcnNfc2NoZW1hLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaWYgKCFjb2xsX3Jlc3BvbnNlIHx8ICF2ZXJpZnlfaHR0cF9yZXNwb25zZShjb2xsX3Jlc3BvbnNlLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDApKSB7CiAgICAgICAgcHJpbnRmKFJFRCAiICBGYWlsZWQgdG8gY3JlYXRlIHRlc3QgY29sbGVjdGlvbiBmb3IgaW5zdGFuY2UgdGVzdHNcbiIgUkVTRVQpOwogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShjb2xsX3Jlc3BvbnNlKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIGh0dHBfcmVzcG9uc2VfZnJlZShjb2xsX3Jlc3BvbnNlKTsKICAgIAogICAgY2hhciBsaXN0X2luc3RhbmNlc191cmxbMjU2XTsKICAgIHNucHJpbnRmKGxpc3RfaW5zdGFuY2VzX3VybCwgc2l6ZW9mKGxpc3RfaW5zdGFuY2VzX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9pbnN0YW5jZXMiLCB1bmlxdWVfZGIpOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L2luc3RhbmNlcyAtIExpc3QgZW1wdHkgaW5zdGFuY2VzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsIGxpc3RfaW5zdGFuY2VzX3VybCwgTlVMTCwgIlwiaW5zdGFuY2VzXCI6W10iLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY29uc3QgY2hhciogdXNlcjEgPSAie1wibmFtZVwiOlwiSm9obiBEb2VcIixcImFnZVwiOjMwLFwiZW1haWxcIjpcImpvaG5AdGVzdC5jb21cIn0iOwogICAgY2hhciBpbnNlcnRfdXJsWzI1Nl07CiAgICBzbnByaW50ZihpbnNlcnRfdXJsLCBzaXplb2YoaW5zZXJ0X3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9pbnN0YW5jZXMiLCB1bmlxdWVfZGIpOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L2luc3RhbmNlcyAtIEluc2VydCBmaXJzdCB1c2VyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCBpbnNlcnRfdXJsLCB1c2VyMSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY29uc3QgY2hhciogdXNlcjIgPSAie1wibmFtZVwiOlwiSmFuZSBTbWl0aFwiLFwiYWdlXCI6MjUsXCJlbWFpbFwiOlwiamFuZUB0ZXN0LmNvbVwifSI7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L2luc3RhbmNlcyAtIEluc2VydCBzZWNvbmQgdXNlciIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgaW5zZXJ0X3VybCwgdXNlcjIsICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkdFVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zL3tjb2xsfS9pbnN0YW5jZXMgLSBMaXN0IHVzZXJzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsIGxpc3RfaW5zdGFuY2VzX3VybCwgTlVMTCwgIkpvaG4gRG9lIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGNoYXIgcXVlcnlfdXJsWzUxMl07CiAgICBzbnByaW50ZihxdWVyeV91cmwsIHNpemVvZihxdWVyeV91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzP3F1ZXJ5PWFnZTozMCIsIHVuaXF1ZV9kYik7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS8uLi4vaW5zdGFuY2VzP3F1ZXJ5PWFnZTozMCAtIFF1ZXJ5IGJ5IGFnZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBxdWVyeV91cmwsIE5VTEwsICJKb2huIERvZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBjaGFyKiBpZCA9IGdldF9sYXN0X2luc2VydGVkX2lkKHVuaXF1ZV9kYiwgInVzZXJzIik7CiAgICBpZiAoaWQpIHsKICAgICAgICBjaGFyIHVwZGF0ZV91cmxbMjU2XTsKICAgICAgICBzbnByaW50Zih1cGRhdGVfdXJsLCBzaXplb2YodXBkYXRlX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9pbnN0YW5jZXMvJXMiLCB1bmlxdWVfZGIsIGlkKTsKICAgICAgICBjb25zdCBjaGFyKiB1cGRhdGVfZGF0YSA9ICJ7XCJhZ2VcIjozNSxcImVtYWlsXCI6XCJqb2huLnVwZGF0ZWRAdGVzdC5jb21cIn0iOwogICAgICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBVVCAvYXBpLy4uLi9pbnN0YW5jZXMve2lkfSAtIFVwZGF0ZSB1c2VyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJQVVQiLCB1cGRhdGVfdXJsLCB1cGRhdGVfZGF0YSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICB9CiAgICAgICAgdG90YWwrKzsKICAgICAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgICAgIAogICAgICAgIGNoYXIgZGVsZXRlX3VybFsyNTZdOwogICAgICAgIHNucHJpbnRmKGRlbGV0ZV91cmwsIHNpemVvZihkZWxldGVfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcy8lcyIsIHVuaXF1ZV9kYiwgaWQpOwogICAgICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkRFTEVURSAvYXBpLy4uLi9pbnN0YW5jZXMve2lkfSAtIERlbGV0ZSB1c2VyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJERUxFVEUiLCBkZWxldGVfdXJsLCBOVUxMLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgICAgIHBhc3NlZCsrOwogICAgICAgIH0KICAgICAgICB0b3RhbCsrOwogICAgICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICB9CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgSW5zdGFuY2UgQVBJIHRlc3RzOiAlZC8lZCBwYXNzZWQgKGF2ZzogJWxsZCBtcylcbiIgUkVTRVQsIAogICAgICAgICAgIHBhc3NlZCwgdG90YWwsIHRvdGFsX3RpbWUgLyAodG90YWwgPiAwID8gdG90YWwgOiAxKSk7CiAgICAKICAgIHJldHVybiBwYXNzZWQ7Cn0KCmludCBydW5faHR0cF9jb21tYW5kX3Rlc3RzKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSAiSFRUUCBBUEkgQ09NTUFORCBURVNUUyIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIGxvbmcgbG9uZyB0b3RhbF90aW1lID0gMDsKICAgIGxvbmcgbG9uZyBkdXJhdGlvbjsKICAgIAogICAgY29uc3QgY2hhciogY29tbWFuZCA9ICJ7XCJjb21tYW5kXCI6XCJsaXN0XCIsXCJhcmd1bWVudHNcIjpbXX0iOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiUE9TVCAvYXBpL2V4ZWN1dGUgLSBFeGVjdXRlIGxpc3QgY29tbWFuZCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgIi9hcGkvZXhlY3V0ZSIsIGNvbW1hbmQsICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgQ29tbWFuZCBBUEkgdGVzdHM6ICVkLyVkIHBhc3NlZCAoYXZnOiAlbGxkIG1zKVxuIiBSRVNFVCwgCiAgICAgICAgICAgcGFzc2VkLCB0b3RhbCwgdG90YWxfdGltZSAvIHRvdGFsKTsKICAgIAogICAgcmV0dXJuIHBhc3NlZDsKfQoKaW50IHJ1bl9odHRwX2Vycm9yX3Rlc3RzKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSAiSFRUUCBBUEkgRVJST1IgSEFORExJTkcgVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMgLSBJbnZhbGlkIGRhdGFiYXNlIG5hbWUiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsICJ7XCJuYW1lXCI6XCJpbnZhbGlkL25hbWVcIn0iLCAiXCJzdWNjZXNzXCI6ZmFsc2UiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvZGF0YWJhc2VzL25vbmV4aXN0ZW50L2NvbGxlY3Rpb25zIC0gTm9uLWV4aXN0ZW50IGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsICIvYXBpL2RhdGFiYXNlcy9ub25leGlzdGVudC9jb2xsZWN0aW9ucyIsIE5VTEwsICJcInN1Y2Nlc3NcIjpmYWxzZSIsIDEsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMvdGVzdGRiL2NvbGxlY3Rpb25zL25vbmV4aXN0ZW50L2luc3RhbmNlcyAtIE5vbi1leGlzdGVudCBjb2xsZWN0aW9uIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsICIvYXBpL2RhdGFiYXNlcy90ZXN0ZGIvY29sbGVjdGlvbnMvbm9uZXhpc3RlbnQvaW5zdGFuY2VzIiwgTlVMTCwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMgLSBJbnZhbGlkIEpTT04iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsICJpbnZhbGlkIGpzb24iLCAiXCJzdWNjZXNzXCI6ZmFsc2UiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBFcnJvciBoYW5kbGluZyB0ZXN0czogJWQvJWQgcGFzc2VkIChhdmc6ICVsbGQgbXMpXG4iIFJFU0VULCAKICAgICAgICAgICBwYXNzZWQsIHRvdGFsLCB0b3RhbF90aW1lIC8gKHRvdGFsID4gMCA/IHRvdGFsIDogMSkpOwogICAgCiAgICByZXR1cm4gcGFzc2VkOwp9Cg==`;
        const fileContent = Buffer.from(base64Content, 'base64');
        
        fs.writeFileSync(outputFile, fileContent);
        const stats = fs.statSync(outputFile);
        
        console.log(` Successfully extracted: ${outputFile}`);
        console.log(`   Size: ${stats.size} bytes`);
        
        // Verify it's a C file
        const firstLines = fs.readFileSync(outputFile, 'utf8', 0, 200);
        if (firstLines.includes('#include') || /^\s*int\s+main/.test(firstLines)) {
            console.log(`   Verified: Valid C source code`);
        }
        
        console.log(`\n Next steps:`);
        console.log(`   Compile: gcc ${outputFile} -o program`);
        console.log(`   Execute: ./program`);
        
    } catch (error) {
        console.error(` Extraction failed: ${error.message}`);
        process.exit(1);
    }
}

// Run extraction
extractCFile().catch(console.error);
