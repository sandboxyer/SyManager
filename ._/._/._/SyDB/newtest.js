#!/usr/bin/env node

import fs from 'fs';
import { Buffer } from 'buffer';
import { fileURLToPath } from 'url';
import path from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

async function extractCFile() {
    const scriptName = path.basename(__filename);
    const outputFile = scriptName.replace(/\.js$/, '.c');
    
    if (fs.existsSync(outputFile)) {
        console.log(`Overwriting: ${outputFile}`);
    }
    
    try {
        // Base64 encoded C file content
        const base64Content = `I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4KI2luY2x1ZGUgPHN0cmluZy5oPgojaW5jbHVkZSA8dW5pc3RkLmg+CiNpbmNsdWRlIDxzeXMvdGltZS5oPgojaW5jbHVkZSA8dGltZS5oPgojaW5jbHVkZSA8ZGlyZW50Lmg+CiNpbmNsdWRlIDxzeXMvc3RhdC5oPgojaW5jbHVkZSA8ZmNudGwuaD4KI2luY2x1ZGUgPHN5cy9zb2NrZXQuaD4KI2luY2x1ZGUgPG5ldGluZXQvaW4uaD4KI2luY2x1ZGUgPGFycGEvaW5ldC5oPgojaW5jbHVkZSA8bmV0ZGIuaD4KI2luY2x1ZGUgPGVycm5vLmg+CiNpbmNsdWRlIDxwdGhyZWFkLmg+CiNpbmNsdWRlIDxzaWduYWwuaD4KI2luY2x1ZGUgPHN5cy93YWl0Lmg+CiNpbmNsdWRlIDxzeXMvdHlwZXMuaD4KI2luY2x1ZGUgPHN5cy9tbWFuLmg+CiNpbmNsdWRlIDxzZW1hcGhvcmUuaD4KCiNkZWZpbmUgUkVEICAgICAiXDAzM1sxOzMxbSIKI2RlZmluZSBHUkVFTiAgICJcMDMzWzE7MzJtIgojZGVmaW5lIFlFTExPVyAgIlwwMzNbMTszM20iCiNkZWZpbmUgQkxVRSAgICAiXDAzM1sxOzM0bSIKI2RlZmluZSBNQUdFTlRBICJcMDMzWzE7MzVtIgojZGVmaW5lIENZQU4gICAgIlwwMzNbMTszNm0iCiNkZWZpbmUgUkVTRVQgICAiXDAzM1swbSIKI2RlZmluZSBCT0xEICAgICJcMDMzWzFtIgoKLy8gPT09PT09PT09PT09PT09PT09PT0gVEVTVCBNT0RFUyA9PT09PT09PT09PT09PT09PT09PQojZGVmaW5lIFRFU1RfTU9ERV9OT1JNQUwgMAojZGVmaW5lIFRFU1RfTU9ERV9DTEkgICAgMQojZGVmaW5lIFRFU1RfTU9ERV9TRVJWRVIgMgoKLy8gPT09PT09PT09PT09PT09PT09PT0gVEVTVCBDQVRFR09SSUVTID09PT09PT09PT09PT09PT09PT09CiNkZWZpbmUgQ0FURUdPUllfU01PS0UgICAgICAgMAojZGVmaW5lIENBVEVHT1JZX0RVUkFCSUxJVFkgIDEKI2RlZmluZSBDQVRFR09SWV9DT05DVVJSRU5DWSAyCiNkZWZpbmUgQ0FURUdPUllfUVVFUlkgICAgICAgMwojZGVmaW5lIENBVEVHT1JZX1NDSEVNQSAgICAgIDQKI2RlZmluZSBDQVRFR09SWV9TRUNVUklUWSAgICA1CiNkZWZpbmUgQ0FURUdPUllfUEVSRk9STUFOQ0UgNgojZGVmaW5lIENBVEVHT1JZX0lOVEVHUklUWSAgIDcKI2RlZmluZSBDQVRFR09SWV9FREdFICAgICAgICA4CiNkZWZpbmUgQ0FURUdPUllfUkVDT1ZFUlkgICAgOQoKLy8gPT09PT09PT09PT09PT09PT09PT0gRlVOQ1RJT04gUFJPVE9UWVBFUyBGT1IgSFRUUCBURVNUUyA9PT09PT09PT09PT09PT09PT09PQppbnQgcnVuX2h0dHBfZGF0YWJhc2VfdGVzdHModm9pZCk7CmludCBydW5faHR0cF9jb2xsZWN0aW9uX3Rlc3RzKHZvaWQpOwppbnQgcnVuX2h0dHBfaW5zdGFuY2VfdGVzdHModm9pZCk7CmludCBydW5faHR0cF9jb21tYW5kX3Rlc3RzKHZvaWQpOwppbnQgcnVuX2h0dHBfZXJyb3JfdGVzdHModm9pZCk7CnZvaWQgY2xlYW51cF90ZXN0X2RhdGFiYXNlcyh2b2lkKTsKaW50IHJ1bl9kYXRhX2ludGVncml0eV90ZXN0c19jbGkodm9pZCk7CgovLyBOZXcgZW5oYW5jZWQgdGVzdCBmdW5jdGlvbnMgZm9yIGxldmVsIDMKaW50IHJ1bl9odHRwX3N0cmVzc190ZXN0cyh2b2lkKTsKaW50IHJ1bl9odHRwX2RhdGFfY29ycnVwdGlvbl90ZXN0cyh2b2lkKTsKaW50IHJ1bl9odHRwX21peGVkX3dvcmtsb2FkX3Rlc3RzKHZvaWQpOwppbnQgcnVuX2h0dHBfbG9uZ19ydW5uaW5nX3Rlc3RzKHZvaWQpOwppbnQgcnVuX2h0dHBfY29uc2lzdGVuY3lfdGVzdHModm9pZCk7CmludCBydW5faHR0cF9mYXVsdF9pbmplY3Rpb25fdGVzdHModm9pZCk7CmludCBydW5faHR0cF9jaGFvc190ZXN0cyh2b2lkKTsKaW50IHJ1bl9odHRwX2JvdW5kYXJ5X3Rlc3RzX2V4dHJlbWUodm9pZCk7Cgpjb25zdCBjaGFyKiBjYXRlZ29yeV9uYW1lc1tdID0gewogICAgIlNNT0tFIFRFU1RTIiwKICAgICJEVVJBQklMSVRZICYgQ1JBU0ggUkVDT1ZFUlkiLAogICAgIkNPTkNVUlJFTkNZICYgVEhSRUFEIFNBRkVUWSIsCiAgICAiUVVFUlkgTEFOR1VBR0UgJiBJTkRFWElORyIsCiAgICAiU0NIRU1BIEVORk9SQ0VNRU5UIiwKICAgICJTRUNVUklUWSAmIElOSkVDVElPTiIsCiAgICAiUEVSRk9STUFOQ0UgJiBTQ0FMQUJJTElUWSIsCiAgICAiREFUQSBJTlRFR1JJVFkiLAogICAgIkVER0UgQ0FTRVMiLAogICAgIlJFQ09WRVJZICYgRVJST1IgSEFORExJTkciCn07CgovLyA9PT09PT09PT09PT09PT09PT09PSBURVNUIFNUUlVDVFVSRVMgPT09PT09PT09PT09PT09PT09PT0KCnR5cGVkZWYgc3RydWN0IHsKICAgIGNoYXIgZGVzY3JpcHRpb25bNTEyXTsKICAgIGNoYXIgY29tbWFuZFsxMDI0XTsKICAgIGNoYXIgdmVyaWZpY2F0aW9uX2NvbW1hbmRbMTAyNF07CiAgICBjaGFyIGV4cGVjdGVkX291dHB1dFsxMDI0XTsKICAgIGludCBzdWNjZXNzOwogICAgaW50IHZlcmlmaWNhdGlvbl9zdWNjZXNzOwogICAgbG9uZyBsb25nIGR1cmF0aW9uX21zOwogICAgY2hhciBkZXRhaWxzWzEwMjRdOwogICAgY2hhciB2ZXJib3NlX291dHB1dFs0MDk2XTsKICAgIGludCBjYXRlZ29yeTsKICAgIGludCBjcml0aWNhbDsgIC8vIElmIGNyaXRpY2FsIGZhaWxzLCBvdmVyYWxsIHRlc3QgZmFpbHMKfSBUZXN0Q2FzZTsKCnR5cGVkZWYgc3RydWN0IHsKICAgIGNoYXIgZGVzY3JpcHRpb25bNTEyXTsKICAgIGludCAoKnRlc3RfZnVuY3Rpb24pKHZvaWQpOwogICAgaW50IGNhdGVnb3J5OwogICAgaW50IGNyaXRpY2FsOwogICAgbG9uZyBsb25nIGR1cmF0aW9uX21zOwogICAgaW50IHBhc3NlZDsKICAgIGNoYXIgZXJyb3JfbWVzc2FnZVsxMDI0XTsKfSBBZHZhbmNlZFRlc3RDYXNlOwoKLy8gPT09PT09PT09PT09PT09PT09PT0gR0xPQkFMIENPTkZJR1VSQVRJT04gPT09PT09PT09PT09PT09PT09PT0KCmNoYXIgY2xpX2NvbW1hbmRbMzJdID0gIi4vc3lkYiI7CmludCB0ZXN0X21vZGUgPSBURVNUX01PREVfTk9STUFMOwpjaGFyIHNlcnZlcl91cmxbMjU2XSA9ICJodHRwOi8vbG9jYWxob3N0OjgwODAiOwppbnQgdmVyYm9zZV9tb2RlID0gMDsKaW50IHRlc3RfbGV2ZWwgPSAyOyAgLy8gMD1xdWljaywgMT1zdGFuZGFyZCwgMj1jb21wcmVoZW5zaXZlLCAzPWV4dHJlbWUKcGlkX3Qgc2VydmVyX3BpZCA9IDA7CmludCBzZXJ2ZXJfc3RhcnRlZF9ieV90ZXN0ID0gMDsKCi8vID09PT09PT09PT09PT09PT09PT09IFRFU1QgU1RBVElTVElDUyA9PT09PT09PT09PT09PT09PT09PQoKdHlwZWRlZiBzdHJ1Y3QgewogICAgaW50IHRvdGFsX3Rlc3RzOwogICAgaW50IHBhc3NlZF90ZXN0czsKICAgIGludCBmYWlsZWRfdGVzdHM7CiAgICBpbnQgc2tpcHBlZF90ZXN0czsKICAgIGxvbmcgbG9uZyB0b3RhbF9kdXJhdGlvbjsKICAgIGludCBjcml0aWNhbF9mYWlsdXJlczsKICAgIGludCBjYXRlZ29yaWVzX3Bhc3NlZFsxMF07CiAgICBpbnQgY2F0ZWdvcmllc190b3RhbFsxMF07Cn0gVGVzdFN0YXRpc3RpY3M7CgpUZXN0U3RhdGlzdGljcyBzdGF0cyA9IHswfTsKCi8vID09PT09PT09PT09PT09PT09PT09IEhUVFAgQ0xJRU5UIChFbmhhbmNlZCkgPT09PT09PT09PT09PT09PT09PT0KCnR5cGVkZWYgc3RydWN0IHsKICAgIGludCBzdGF0dXNfY29kZTsKICAgIGNoYXIqIGJvZHk7CiAgICBzaXplX3QgYm9keV9sZW5ndGg7CiAgICBjaGFyKiBoZWFkZXJzWzUwXTsKICAgIGludCBoZWFkZXJfY291bnQ7Cn0gSHR0cFJlc3BvbnNlOwoKLy8gPT09PT09PT09PT09PT09PT09PT0gQ09OQ1VSUkVOQ1kgVEVTVCBTVFJVQ1RVUkVTID09PT09PT09PT09PT09PT09PT09Cgp0eXBlZGVmIHN0cnVjdCB7CiAgICBjaGFyIGRhdGFiYXNlWzY0XTsKICAgIGNoYXIgY29sbGVjdGlvbls2NF07CiAgICBpbnQgdGhyZWFkX2lkOwogICAgaW50IG9wZXJhdGlvbnNfY291bnQ7CiAgICBpbnQgc3VjY2Vzc19jb3VudDsKICAgIGxvbmcgbG9uZyB0b3RhbF90aW1lOwp9IFRocmVhZFRlc3RDb250ZXh0OwoKdHlwZWRlZiBzdHJ1Y3QgewogICAgaW50IGFjdGl2ZV9jb25uZWN0aW9uczsKICAgIGludCB0b3RhbF9yZXF1ZXN0czsKICAgIGludCBzdWNjZXNzX3JlcXVlc3RzOwogICAgcHRocmVhZF9tdXRleF90IGxvY2s7Cn0gQ29uY3VycmVuY3lTdGF0czsKCi8vID09PT09PT09PT09PT09PT09PT09IEZVTkNUSU9OIFBST1RPVFlQRVMgPT09PT09PT09PT09PT09PT09PT0KCmludCBydW5fZGF0YV9pbnRlZ3JpdHlfdGVzdHNfY2xpKHZvaWQpIHsKICAgIHJldHVybiBydW5faW50ZWdyaXR5X3Rlc3RzX2NsaSgpOwp9CgovLyBDb3JlIHRlc3QgZnVuY3Rpb25zCmxvbmcgbG9uZyBnZXRfY3VycmVudF90aW1lX21zKCk7CmludCBmaWxlX2V4aXN0cyhjb25zdCBjaGFyICpwYXRoKTsKaW50IGNvdW50X2ZpbGVzX2luX2RpcmVjdG9yeShjb25zdCBjaGFyICpwYXRoKTsKaW50IGNvdW50X2luc3RhbmNlc19pbl9jb2xsZWN0aW9uKGNvbnN0IGNoYXIgKmRhdGFiYXNlLCBjb25zdCBjaGFyICpjb2xsZWN0aW9uKTsKY2hhciogZ2V0X2xhc3RfaW5zZXJ0ZWRfaWQoY29uc3QgY2hhciAqZGF0YWJhc2UsIGNvbnN0IGNoYXIgKmNvbGxlY3Rpb24pOwppbnQgZXhlY3V0ZV9jb21tYW5kX2FuZF9jYXB0dXJlKGNvbnN0IGNoYXIgKmNvbW1hbmQsIGNoYXIgKm91dHB1dCwgc2l6ZV90IG91dHB1dF9zaXplKTsKaW50IGV4ZWN1dGVfY29tbWFuZF9hbmRfY2FwdHVyZV92ZXJib3NlKGNvbnN0IGNoYXIgKmNvbW1hbmQsIGNoYXIgKm91dHB1dCwgc2l6ZV90IG91dHB1dF9zaXplLCBjaGFyICp2ZXJib3NlX291dHB1dCwgc2l6ZV90IHZlcmJvc2Vfc2l6ZSk7CmludCBleGVjdXRlX3Rlc3Rfd2l0aF92ZXJpZmljYXRpb24oVGVzdENhc2UgKnRlc3QpOwppbnQgZXhlY3V0ZV9hZHZhbmNlZF90ZXN0KEFkdmFuY2VkVGVzdENhc2UgKnRlc3QpOwoKLy8gSFRUUCBjbGllbnQgZnVuY3Rpb25zCkh0dHBSZXNwb25zZSogaHR0cF9yZXF1ZXN0KGNvbnN0IGNoYXIqIG1ldGhvZCwgY29uc3QgY2hhciogdXJsLCBjb25zdCBjaGFyKiBib2R5LCBjb25zdCBjaGFyKiBjb250ZW50X3R5cGUpOwp2b2lkIGh0dHBfcmVzcG9uc2VfZnJlZShIdHRwUmVzcG9uc2UqIHJlc3BvbnNlKTsKaW50IHZlcmlmeV9odHRwX3Jlc3BvbnNlKGNvbnN0IEh0dHBSZXNwb25zZSogcmVzcG9uc2UsIGNvbnN0IGNoYXIqIGV4cGVjdGVkX3BhdHRlcm4sIGludCBjaGVja19zdWNjZXNzX29ubHkpOwpjaGFyKiBleHRyYWN0X2pzb25fZmllbGQoY29uc3QgY2hhcioganNvbiwgY29uc3QgY2hhciogZmllbGQpOwppbnQgaHR0cF90ZXN0X2VuZHBvaW50KGNvbnN0IGNoYXIqIGRlc2NyaXB0aW9uLCBjb25zdCBjaGFyKiBtZXRob2QsIGNvbnN0IGNoYXIqIGVuZHBvaW50LCAKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIqIGJvZHksIGNvbnN0IGNoYXIqIGV4cGVjdGVkX3BhdHRlcm4sIGludCBjaGVja19zdWNjZXNzX29ubHksIAogICAgICAgICAgICAgICAgICAgICAgbG9uZyBsb25nKiBkdXJhdGlvbiwgaW50IGNhdGVnb3J5LCBpbnQgY3JpdGljYWwpOwoKLy8gU2VydmVyIG1hbmFnZW1lbnQKaW50IHN0YXJ0X3N5ZGJfc2VydmVyKCk7CmludCBzdG9wX3N5ZGJfc2VydmVyKCk7CmludCB3YWl0X2Zvcl9zZXJ2ZXJfcmVhZHkoaW50IHRpbWVvdXRfc2Vjb25kcyk7CgovLyA9PT09PT09PT09PT09PT09PT09PSBFTkhBTkNFRCBURVNUIFNVSVRFUyA9PT09PT09PT09PT09PT09PT09PQoKLy8gU21va2UgVGVzdHMgKEJhc2ljIGZ1bmN0aW9uYWxpdHkgLSB5b3VyIGV4aXN0aW5nIHRlc3RzKQppbnQgcnVuX3Ntb2tlX3Rlc3RzX2NsaSgpOwppbnQgcnVuX3Ntb2tlX3Rlc3RzX2h0dHAoKTsKCi8vID09PT09PT09PT09PT09PT09PT09IENSSVRJQ0FMIE5FVyBURVNUIFNVSVRFUyA9PT09PT09PT09PT09PT09PT09PQoKLy8gRFVSQUJJTElUWSBURVNUUyAtIFdoYXQgaGFwcGVucyBvbiBjcmFzaC9wb3dlciBmYWlsdXJlCmludCBydW5fZHVyYWJpbGl0eV90ZXN0c19jbGkoKTsKaW50IHJ1bl9kdXJhYmlsaXR5X3Rlc3RzX2h0dHAoKTsKCi8vIENPTkNVUlJFTkNZIFRFU1RTIC0gTXVsdGktdGhyZWFkZWQgYWNjZXNzCmludCBydW5fY29uY3VycmVuY3lfdGVzdHNfY2xpKCk7CmludCBydW5fY29uY3VycmVuY3lfdGVzdHNfaHR0cCgpOwoKLy8gUVVFUlkgTEFOR1VBR0UgVEVTVFMgLSBCZXlvbmQgc2ltcGxlIGVxdWFsaXR5CmludCBydW5fcXVlcnlfbGFuZ3VhZ2VfdGVzdHNfY2xpKCk7CmludCBydW5fcXVlcnlfbGFuZ3VhZ2VfdGVzdHNfaHR0cCgpOwoKLy8gU0NIRU1BIEVORk9SQ0VNRU5UIFRFU1RTIC0gQWN0dWFsIHZhbGlkYXRpb24KaW50IHJ1bl9zY2hlbWFfZW5mb3JjZW1lbnRfdGVzdHNfY2xpKCk7CmludCBydW5fc2NoZW1hX2VuZm9yY2VtZW50X3Rlc3RzX2h0dHAoKTsKCi8vIFNFQ1VSSVRZIFRFU1RTIC0gSW5qZWN0aW9uLCB0cmF2ZXJzYWwsIGF1dGgKaW50IHJ1bl9zZWN1cml0eV90ZXN0c19jbGkoKTsKaW50IHJ1bl9zZWN1cml0eV90ZXN0c19odHRwKCk7CgovLyBQRVJGT1JNQU5DRSBURVNUUyAtIExhcmdlIGRhdGFzZXRzLCBpbmRleGluZwppbnQgcnVuX3BlcmZvcm1hbmNlX3Rlc3RzX2NsaSgpOwppbnQgcnVuX3BlcmZvcm1hbmNlX3Rlc3RzX2h0dHAoKTsKCi8vIERBVEEgSU5URUdSSVRZIFRFU1RTIC0gQ29ycnVwdGlvbiBkZXRlY3Rpb24KaW50IHJ1bl9pbnRlZ3JpdHlfdGVzdHNfY2xpKCk7CmludCBydW5faW50ZWdyaXR5X3Rlc3RzX2h0dHAoKTsKCi8vIFJFQ09WRVJZIFRFU1RTIC0gUmVzdGFydCBhZnRlciBmYWlsdXJlCmludCBydW5fcmVjb3ZlcnlfdGVzdHNfY2xpKCk7CmludCBydW5fcmVjb3ZlcnlfdGVzdHNfaHR0cCgpOwoKLy8gRURHRSBDQVNFIFRFU1RTIC0gRXh0cmVtZSBpbnB1dHMKaW50IHJ1bl9lZGdlX2Nhc2VfdGVzdHNfY2xpKCk7CmludCBydW5fZWRnZV9jYXNlX3Rlc3RzX2h0dHAoKTsKCi8vID09PT09PT09PT09PT09PT09PT09IFVUSUxJVFkgRlVOQ1RJT05TIChFbmhhbmNlZCkgPT09PT09PT09PT09PT09PT09PT0KCmxvbmcgbG9uZyBnZXRfY3VycmVudF90aW1lX21zKCkgewogICAgc3RydWN0IHRpbWV2YWwgdHY7CiAgICBnZXR0aW1lb2ZkYXkoJnR2LCBOVUxMKTsKICAgIHJldHVybiAobG9uZyBsb25nKXR2LnR2X3NlYyAqIDEwMDAgKyB0di50dl91c2VjIC8gMTAwMDsKfQoKdm9pZCBtc2xlZXAoaW50IG1zKSB7CiAgICB1c2xlZXAobXMgKiAxMDAwKTsKfQoKaW50IGZpbGVfZXhpc3RzKGNvbnN0IGNoYXIgKnBhdGgpIHsKICAgIHN0cnVjdCBzdGF0IHN0OwogICAgcmV0dXJuIHN0YXQocGF0aCwgJnN0KSA9PSAwOwp9CgppbnQgY291bnRfZmlsZXNfaW5fZGlyZWN0b3J5KGNvbnN0IGNoYXIgKnBhdGgpIHsKICAgIERJUiAqZGlyID0gb3BlbmRpcihwYXRoKTsKICAgIGlmICghZGlyKSByZXR1cm4gLTE7CiAgICAKICAgIGludCBjb3VudCA9IDA7CiAgICBzdHJ1Y3QgZGlyZW50ICplbnRyeTsKICAgIHdoaWxlICgoZW50cnkgPSByZWFkZGlyKGRpcikpICE9IE5VTEwpIHsKICAgICAgICBpZiAoc3RyY21wKGVudHJ5LT5kX25hbWUsICIuIikgIT0gMCAmJiBzdHJjbXAoZW50cnktPmRfbmFtZSwgIi4uIikgIT0gMCkgewogICAgICAgICAgICBjb3VudCsrOwogICAgICAgIH0KICAgIH0KICAgIGNsb3NlZGlyKGRpcik7CiAgICByZXR1cm4gY291bnQ7Cn0KCmludCBnZXRfZmlsZV9zaXplKGNvbnN0IGNoYXIgKnBhdGgpIHsKICAgIHN0cnVjdCBzdGF0IHN0OwogICAgaWYgKHN0YXQocGF0aCwgJnN0KSA9PSAwKSB7CiAgICAgICAgcmV0dXJuIHN0LnN0X3NpemU7CiAgICB9CiAgICByZXR1cm4gLTE7Cn0KCmludCBjYWxjdWxhdGVfZmlsZV9jaGVja3N1bShjb25zdCBjaGFyICpwYXRoKSB7CiAgICBGSUxFICpmcCA9IGZvcGVuKHBhdGgsICJyYiIpOwogICAgaWYgKCFmcCkgcmV0dXJuIDA7CiAgICAKICAgIGludCBjaGVja3N1bSA9IDA7CiAgICBpbnQgYzsKICAgIHdoaWxlICgoYyA9IGZnZXRjKGZwKSkgIT0gRU9GKSB7CiAgICAgICAgY2hlY2tzdW0gPSAoY2hlY2tzdW0gKyBjKSAmIDB4RkZGRjsKICAgIH0KICAgIGZjbG9zZShmcCk7CiAgICByZXR1cm4gY2hlY2tzdW07Cn0KCmludCBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihjb25zdCBjaGFyICpkYXRhYmFzZSwgY29uc3QgY2hhciAqY29sbGVjdGlvbikgewogICAgY2hhciBjb21tYW5kWzUxMl07CiAgICBzbnByaW50Zihjb21tYW5kLCBzaXplb2YoY29tbWFuZCksICIlcyBsaXN0ICVzICVzIDI+L2Rldi9udWxsIHwgZ3JlcCAtYyAnXCJfaWRcIiciLCAKICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYXRhYmFzZSwgY29sbGVjdGlvbik7CiAgICAKICAgIEZJTEUgKmZwID0gcG9wZW4oY29tbWFuZCwgInIiKTsKICAgIGlmICghZnApIHJldHVybiAtMTsKICAgIAogICAgaW50IGNvdW50ID0gMDsKICAgIGNoYXIgYnVmZmVyWzY0XTsKICAgIGlmIChmZ2V0cyhidWZmZXIsIHNpemVvZihidWZmZXIpLCBmcCkpIHsKICAgICAgICBjb3VudCA9IGF0b2koYnVmZmVyKTsKICAgIH0KICAgIHBjbG9zZShmcCk7CiAgICAKICAgIHJldHVybiBjb3VudDsKfQoKY2hhciogZ2V0X2xhc3RfaW5zZXJ0ZWRfaWQoY29uc3QgY2hhciAqZGF0YWJhc2UsIGNvbnN0IGNoYXIgKmNvbGxlY3Rpb24pIHsKICAgIGNoYXIgY29tbWFuZFs1MTJdOwogICAgc25wcmludGYoY29tbWFuZCwgc2l6ZW9mKGNvbW1hbmQpLCAiJXMgbGlzdCAlcyAlcyAyPi9kZXYvbnVsbCB8IHRhaWwgLTEiLCAKICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYXRhYmFzZSwgY29sbGVjdGlvbik7CiAgICAKICAgIEZJTEUgKmZwID0gcG9wZW4oY29tbWFuZCwgInIiKTsKICAgIGlmICghZnApIHJldHVybiBOVUxMOwogICAgCiAgICBzdGF0aWMgY2hhciBpZFs2NF07CiAgICBpZiAoZmdldHMoaWQsIHNpemVvZihpZCksIGZwKSkgewogICAgICAgIGNoYXIgKmlkX3N0YXJ0ID0gc3Ryc3RyKGlkLCAiXCJfaWRcIjpcIiIpOwogICAgICAgIGlmIChpZF9zdGFydCkgewogICAgICAgICAgICBpZF9zdGFydCArPSA3OwogICAgICAgICAgICBjaGFyICppZF9lbmQgPSBzdHJjaHIoaWRfc3RhcnQsICciJyk7CiAgICAgICAgICAgIGlmIChpZF9lbmQpIHsKICAgICAgICAgICAgICAgICppZF9lbmQgPSAnXDAnOwogICAgICAgICAgICAgICAgc3RybmNweShpZCwgaWRfc3RhcnQsIHNpemVvZihpZCkgLSAxKTsKICAgICAgICAgICAgICAgIHBjbG9zZShmcCk7CiAgICAgICAgICAgICAgICByZXR1cm4gaWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBwY2xvc2UoZnApOwogICAgcmV0dXJuIE5VTEw7Cn0KCmludCBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmUoY29uc3QgY2hhciAqY29tbWFuZCwgY2hhciAqb3V0cHV0LCBzaXplX3Qgb3V0cHV0X3NpemUpIHsKICAgIEZJTEUgKmZwID0gcG9wZW4oY29tbWFuZCwgInIiKTsKICAgIGlmICghZnApIHJldHVybiAtMTsKICAgIAogICAgb3V0cHV0WzBdID0gJ1wwJzsKICAgIGlmIChmZ2V0cyhvdXRwdXQsIG91dHB1dF9zaXplLCBmcCkpIHsKICAgICAgICBvdXRwdXRbc3RyY3NwbihvdXRwdXQsICJcbiIpXSA9ICdcMCc7CiAgICB9CiAgICBwY2xvc2UoZnApOwogICAgcmV0dXJuIDA7Cn0KCmludCBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmVfdmVyYm9zZShjb25zdCBjaGFyICpjb21tYW5kLCBjaGFyICpvdXRwdXQsIHNpemVfdCBvdXRwdXRfc2l6ZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIgKnZlcmJvc2Vfb3V0cHV0LCBzaXplX3QgdmVyYm9zZV9zaXplKSB7CiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gRXhlY3V0aW5nOiAlc1xuIiBSRVNFVCwgY29tbWFuZCk7CiAgICB9CiAgICAKICAgIEZJTEUgKmZwID0gcG9wZW4oY29tbWFuZCwgInIiKTsKICAgIGlmICghZnApIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBwb3BlbiBmYWlsZWRcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIAogICAgb3V0cHV0WzBdID0gJ1wwJzsKICAgIHZlcmJvc2Vfb3V0cHV0WzBdID0gJ1wwJzsKICAgIAogICAgY2hhciBidWZmZXJbMTAyNF07CiAgICBzaXplX3QgdG90YWxfdmVyYm9zZV9zaXplID0gMDsKICAgIAogICAgd2hpbGUgKGZnZXRzKGJ1ZmZlciwgc2l6ZW9mKGJ1ZmZlciksIGZwKSkgewogICAgICAgIGJ1ZmZlcltzdHJjc3BuKGJ1ZmZlciwgIlxuIildID0gJ1wwJzsKICAgICAgICAKICAgICAgICBpZiAob3V0cHV0WzBdID09ICdcMCcpIHsKICAgICAgICAgICAgc3RybmNweShvdXRwdXQsIGJ1ZmZlciwgb3V0cHV0X3NpemUgLSAxKTsKICAgICAgICAgICAgb3V0cHV0W291dHB1dF9zaXplIC0gMV0gPSAnXDAnOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAodG90YWxfdmVyYm9zZV9zaXplICsgc3RybGVuKGJ1ZmZlcikgPCB2ZXJib3NlX3NpemUgLSAxKSB7CiAgICAgICAgICAgIHN0cmNhdCh2ZXJib3NlX291dHB1dCwgYnVmZmVyKTsKICAgICAgICAgICAgc3RyY2F0KHZlcmJvc2Vfb3V0cHV0LCAiXG4iKTsKICAgICAgICAgICAgdG90YWxfdmVyYm9zZV9zaXplICs9IHN0cmxlbihidWZmZXIpICsgMTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGludCBzdGF0dXMgPSBwY2xvc2UoZnApOwogICAgaW50IHJlc3VsdDsKICAgIAogICAgaWYgKFdJRkVYSVRFRChzdGF0dXMpKSB7CiAgICAgICAgaW50IGV4aXRfY29kZSA9IFdFWElUU1RBVFVTKHN0YXR1cyk7CiAgICAgICAgaWYgKHN0cnN0cihjb21tYW5kLCAiZ3JlcCIpICE9IE5VTEwpIHsKICAgICAgICAgICAgcmVzdWx0ID0gKGV4aXRfY29kZSA9PSAwIHx8IGV4aXRfY29kZSA9PSAxKSA/IDAgOiAtMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgPSAoZXhpdF9jb2RlID09IDApID8gMCA6IC0xOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0ID0gLTE7CiAgICB9CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBFeGl0OiAlZCwgT3V0cHV0OiAlc1xuIiBSRVNFVCwgcmVzdWx0LCBvdXRwdXQpOwogICAgfQogICAgCiAgICByZXR1cm4gcmVzdWx0Owp9CgppbnQgZXhlY3V0ZV90ZXN0X3dpdGhfdmVyaWZpY2F0aW9uKFRlc3RDYXNlICp0ZXN0KSB7CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgCiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsIHRlc3QtPmRlc2NyaXB0aW9uKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBsb25nIGxvbmcgc3RhcnRfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgaW50IHJlc3VsdCA9IHN5c3RlbSh0ZXN0LT5jb21tYW5kKTsKICAgIGxvbmcgbG9uZyBlbmRfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgdGVzdC0+ZHVyYXRpb25fbXMgPSBlbmRfdGltZSAtIHN0YXJ0X3RpbWU7CiAgICB0ZXN0LT5zdWNjZXNzID0gKHJlc3VsdCA9PSAwKTsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IHRlc3QtPmR1cmF0aW9uX21zOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlICYmICF0ZXN0LT5zdWNjZXNzKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiXG4gIFtWRVJCT1NFXSBDb21tYW5kIGZhaWxlZDogJXNcbiIgUkVTRVQsIHRlc3QtPmNvbW1hbmQpOwogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIEV4aXQgY29kZTogJWRcbiIgUkVTRVQsIHJlc3VsdCk7CiAgICB9CiAgICAKICAgIHRlc3QtPnZlcmlmaWNhdGlvbl9zdWNjZXNzID0gMTsKICAgIGlmICh0ZXN0LT5zdWNjZXNzICYmIHRlc3QtPnZlcmlmaWNhdGlvbl9jb21tYW5kWzBdICE9ICdcMCcpIHsKICAgICAgICBjaGFyIHZlcmlmaWNhdGlvbl9vdXRwdXRbMTAyNF07CiAgICAgICAgY2hhciB2ZXJib3NlX291dHB1dFs0MDk2XTsKICAgICAgICBpbnQgdmVyaWZpY2F0aW9uX3Jlc3VsdDsKICAgICAgICAKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9yZXN1bHQgPSBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmVfdmVyYm9zZSh0ZXN0LT52ZXJpZmljYXRpb25fY29tbWFuZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25fb3V0cHV0LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZih2ZXJpZmljYXRpb25fb3V0cHV0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcmJvc2Vfb3V0cHV0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKHZlcmJvc2Vfb3V0cHV0KSk7CiAgICAgICAgICAgIHN0cm5jcHkodGVzdC0+dmVyYm9zZV9vdXRwdXQsIHZlcmJvc2Vfb3V0cHV0LCBzaXplb2YodGVzdC0+dmVyYm9zZV9vdXRwdXQpIC0gMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmVyaWZpY2F0aW9uX3Jlc3VsdCA9IGV4ZWN1dGVfY29tbWFuZF9hbmRfY2FwdHVyZSh0ZXN0LT52ZXJpZmljYXRpb25fY29tbWFuZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9vdXRwdXQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplb2YodmVyaWZpY2F0aW9uX291dHB1dCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAodmVyaWZpY2F0aW9uX3Jlc3VsdCA9PSAwKSB7CiAgICAgICAgICAgIGlmICh0ZXN0LT5leHBlY3RlZF9vdXRwdXRbMF0gIT0gJ1wwJykgewogICAgICAgICAgICAgICAgaWYgKHN0cnN0cih2ZXJpZmljYXRpb25fb3V0cHV0LCB0ZXN0LT5leHBlY3RlZF9vdXRwdXQpID09IE5VTEwpIHsKICAgICAgICAgICAgICAgICAgICB0ZXN0LT52ZXJpZmljYXRpb25fc3VjY2VzcyA9IDA7CiAgICAgICAgICAgICAgICAgICAgc3RybmNweSh0ZXN0LT5kZXRhaWxzLCB2ZXJpZmljYXRpb25fb3V0cHV0LCBzaXplb2YodGVzdC0+ZGV0YWlscykgLSAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRlc3QtPnZlcmlmaWNhdGlvbl9zdWNjZXNzID0gMDsKICAgICAgICAgICAgc3RyY3B5KHRlc3QtPmRldGFpbHMsICJWZXJpZmljYXRpb24gY29tbWFuZCBmYWlsZWQiKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGludCBvdmVyYWxsX3N1Y2Nlc3MgPSB0ZXN0LT5zdWNjZXNzICYmIHRlc3QtPnZlcmlmaWNhdGlvbl9zdWNjZXNzOwogICAgCiAgICBpZiAob3ZlcmFsbF9zdWNjZXNzKSB7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0iKTsKICAgIH0gZWxzZSB7CiAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgaWYgKHRlc3QtPmNyaXRpY2FsKSBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSIpOwogICAgfQogICAgCiAgICBwcmludGYoIiAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIHRlc3QtPmR1cmF0aW9uX21zLCBSRVNFVCk7CiAgICAKICAgIGlmICghb3ZlcmFsbF9zdWNjZXNzICYmIHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEZBSUxVUkU6ICVzXG4iIFJFU0VULCB0ZXN0LT5kZXRhaWxzKTsKICAgIH0KICAgIAogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFt0ZXN0LT5jYXRlZ29yeV0rKzsKICAgIGlmIChvdmVyYWxsX3N1Y2Nlc3MpIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW3Rlc3QtPmNhdGVnb3J5XSsrOwogICAgCiAgICByZXR1cm4gb3ZlcmFsbF9zdWNjZXNzOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBIVFRQIENMSUVOVCBJTVBMRU1FTlRBVElPTiAoRW5oYW5jZWQpID09PT09PT09PT09PT09PT09PT09CgpIdHRwUmVzcG9uc2UqIGh0dHBfcmVxdWVzdChjb25zdCBjaGFyKiBtZXRob2QsIGNvbnN0IGNoYXIqIHVybCwgY29uc3QgY2hhciogYm9keSwgY29uc3QgY2hhciogY29udGVudF90eXBlKSB7CiAgICBIdHRwUmVzcG9uc2UqIHJlc3BvbnNlID0gbWFsbG9jKHNpemVvZihIdHRwUmVzcG9uc2UpKTsKICAgIGlmICghcmVzcG9uc2UpIHJldHVybiBOVUxMOwogICAgCiAgICBtZW1zZXQocmVzcG9uc2UsIDAsIHNpemVvZihIdHRwUmVzcG9uc2UpKTsKICAgIAogICAgY2hhciBmdWxsX3VybFsxMDI0XTsKICAgIGlmIChzdHJuY21wKHVybCwgImh0dHA6Ly8iLCA3KSAhPSAwICYmIHN0cm5jbXAodXJsLCAiaHR0cHM6Ly8iLCA4KSAhPSAwKSB7CiAgICAgICAgc25wcmludGYoZnVsbF91cmwsIHNpemVvZihmdWxsX3VybCksICIlcyVzIiwgc2VydmVyX3VybCwgdXJsKTsKICAgIH0gZWxzZSB7CiAgICAgICAgc3RybmNweShmdWxsX3VybCwgdXJsLCBzaXplb2YoZnVsbF91cmwpIC0gMSk7CiAgICB9CiAgICAKICAgIGNoYXIgaG9zdFsyNTZdID0gImxvY2FsaG9zdCI7CiAgICBpbnQgcG9ydCA9IDgwODA7CiAgICBjaGFyIHBhdGhbMTAyNF0gPSAiLyI7CiAgICAKICAgIGlmIChzdHJuY21wKGZ1bGxfdXJsLCAiaHR0cDovLyIsIDcpID09IDApIHsKICAgICAgICBjb25zdCBjaGFyKiBob3N0X3N0YXJ0ID0gZnVsbF91cmwgKyA3OwogICAgICAgIGNvbnN0IGNoYXIqIHBhdGhfc3RhcnQgPSBzdHJjaHIoaG9zdF9zdGFydCwgJy8nKTsKICAgICAgICBjb25zdCBjaGFyKiBwb3J0X3N0YXJ0ID0gc3RyY2hyKGhvc3Rfc3RhcnQsICc6Jyk7CiAgICAgICAgCiAgICAgICAgaWYgKHBvcnRfc3RhcnQgJiYgKCFwYXRoX3N0YXJ0IHx8IHBvcnRfc3RhcnQgPCBwYXRoX3N0YXJ0KSkgewogICAgICAgICAgICBzaXplX3QgaG9zdF9sZW4gPSBwb3J0X3N0YXJ0IC0gaG9zdF9zdGFydDsKICAgICAgICAgICAgc3RybmNweShob3N0LCBob3N0X3N0YXJ0LCBob3N0X2xlbik7CiAgICAgICAgICAgIGhvc3RbaG9zdF9sZW5dID0gJ1wwJzsKICAgICAgICAgICAgcG9ydCA9IGF0b2kocG9ydF9zdGFydCArIDEpOwogICAgICAgICAgICBpZiAocGF0aF9zdGFydCkgc3RyY3B5KHBhdGgsIHBhdGhfc3RhcnQpOwogICAgICAgIH0gZWxzZSBpZiAocGF0aF9zdGFydCkgewogICAgICAgICAgICBzaXplX3QgaG9zdF9sZW4gPSBwYXRoX3N0YXJ0IC0gaG9zdF9zdGFydDsKICAgICAgICAgICAgc3RybmNweShob3N0LCBob3N0X3N0YXJ0LCBob3N0X2xlbik7CiAgICAgICAgICAgIGhvc3RbaG9zdF9sZW5dID0gJ1wwJzsKICAgICAgICAgICAgc3RyY3B5KHBhdGgsIHBhdGhfc3RhcnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0cmNweShob3N0LCBob3N0X3N0YXJ0KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGludCBzb2NrZmQgPSBzb2NrZXQoQUZfSU5FVCwgU09DS19TVFJFQU0sIDApOwogICAgaWYgKHNvY2tmZCA8IDApIHsKICAgICAgICBmcmVlKHJlc3BvbnNlKTsKICAgICAgICByZXR1cm4gTlVMTDsKICAgIH0KICAgIAogICAgc3RydWN0IHRpbWV2YWwgdGltZW91dDsKICAgIHRpbWVvdXQudHZfc2VjID0gMzA7CiAgICB0aW1lb3V0LnR2X3VzZWMgPSAwOwogICAgc2V0c29ja29wdChzb2NrZmQsIFNPTF9TT0NLRVQsIFNPX1JDVlRJTUVPLCAmdGltZW91dCwgc2l6ZW9mKHRpbWVvdXQpKTsKICAgIHNldHNvY2tvcHQoc29ja2ZkLCBTT0xfU09DS0VULCBTT19TTkRUSU1FTywgJnRpbWVvdXQsIHNpemVvZih0aW1lb3V0KSk7CiAgICAKICAgIHN0cnVjdCBob3N0ZW50KiBzZXJ2ZXIgPSBnZXRob3N0YnluYW1lKGhvc3QpOwogICAgaWYgKCFzZXJ2ZXIpIHsKICAgICAgICBjbG9zZShzb2NrZmQpOwogICAgICAgIGZyZWUocmVzcG9uc2UpOwogICAgICAgIHJldHVybiBOVUxMOwogICAgfQogICAgCiAgICBzdHJ1Y3Qgc29ja2FkZHJfaW4gc2Vydl9hZGRyOwogICAgbWVtc2V0KCZzZXJ2X2FkZHIsIDAsIHNpemVvZihzZXJ2X2FkZHIpKTsKICAgIHNlcnZfYWRkci5zaW5fZmFtaWx5ID0gQUZfSU5FVDsKICAgIG1lbWNweSgmc2Vydl9hZGRyLnNpbl9hZGRyLnNfYWRkciwgc2VydmVyLT5oX2FkZHIsIHNlcnZlci0+aF9sZW5ndGgpOwogICAgc2Vydl9hZGRyLnNpbl9wb3J0ID0gaHRvbnMocG9ydCk7CiAgICAKICAgIGlmIChjb25uZWN0KHNvY2tmZCwgKHN0cnVjdCBzb2NrYWRkciopJnNlcnZfYWRkciwgc2l6ZW9mKHNlcnZfYWRkcikpIDwgMCkgewogICAgICAgIGNsb3NlKHNvY2tmZCk7CiAgICAgICAgZnJlZShyZXNwb25zZSk7CiAgICAgICAgcmV0dXJuIE5VTEw7CiAgICB9CiAgICAKICAgIGNoYXIgcmVxdWVzdFsxNjM4NF07CiAgICBpbnQgcmVxdWVzdF9sZW47CiAgICAKICAgIGlmIChib2R5ICYmIGNvbnRlbnRfdHlwZSkgewogICAgICAgIHJlcXVlc3RfbGVuID0gc25wcmludGYocmVxdWVzdCwgc2l6ZW9mKHJlcXVlc3QpLAogICAgICAgICAgICAiJXMgJXMgSFRUUC8xLjFcclxuIgogICAgICAgICAgICAiSG9zdDogJXM6JWRcclxuIgogICAgICAgICAgICAiQ29udGVudC1UeXBlOiAlc1xyXG4iCiAgICAgICAgICAgICJDb250ZW50LUxlbmd0aDogJXp1XHJcbiIKICAgICAgICAgICAgIkNvbm5lY3Rpb246IGNsb3NlXHJcbiIKICAgICAgICAgICAgIlxyXG4iCiAgICAgICAgICAgICIlcyIsCiAgICAgICAgICAgIG1ldGhvZCwgcGF0aCwgaG9zdCwgcG9ydCwgY29udGVudF90eXBlLCBzdHJsZW4oYm9keSksIGJvZHkpOwogICAgfSBlbHNlIGlmIChib2R5KSB7CiAgICAgICAgcmVxdWVzdF9sZW4gPSBzbnByaW50ZihyZXF1ZXN0LCBzaXplb2YocmVxdWVzdCksCiAgICAgICAgICAgICIlcyAlcyBIVFRQLzEuMVxyXG4iCiAgICAgICAgICAgICJIb3N0OiAlczolZFxyXG4iCiAgICAgICAgICAgICJDb250ZW50LUxlbmd0aDogJXp1XHJcbiIKICAgICAgICAgICAgIkNvbm5lY3Rpb246IGNsb3NlXHJcbiIKICAgICAgICAgICAgIlxyXG4iCiAgICAgICAgICAgICIlcyIsCiAgICAgICAgICAgIG1ldGhvZCwgcGF0aCwgaG9zdCwgcG9ydCwgc3RybGVuKGJvZHkpLCBib2R5KTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmVxdWVzdF9sZW4gPSBzbnByaW50ZihyZXF1ZXN0LCBzaXplb2YocmVxdWVzdCksCiAgICAgICAgICAgICIlcyAlcyBIVFRQLzEuMVxyXG4iCiAgICAgICAgICAgICJIb3N0OiAlczolZFxyXG4iCiAgICAgICAgICAgICJDb25uZWN0aW9uOiBjbG9zZVxyXG4iCiAgICAgICAgICAgICJcclxuIiwKICAgICAgICAgICAgbWV0aG9kLCBwYXRoLCBob3N0LCBwb3J0KTsKICAgIH0KICAgIAogICAgaWYgKHNlbmQoc29ja2ZkLCByZXF1ZXN0LCByZXF1ZXN0X2xlbiwgMCkgPCAwKSB7CiAgICAgICAgY2xvc2Uoc29ja2ZkKTsKICAgICAgICBmcmVlKHJlc3BvbnNlKTsKICAgICAgICByZXR1cm4gTlVMTDsKICAgIH0KICAgIAogICAgY2hhciByZXNwb25zZV9idWZmZXJbNjU1MzZdOwogICAgc3NpemVfdCB0b3RhbF9yZWNlaXZlZCA9IDA7CiAgICBzc2l6ZV90IHJlY2VpdmVkOwogICAgCiAgICB3aGlsZSAoKHJlY2VpdmVkID0gcmVjdihzb2NrZmQsIHJlc3BvbnNlX2J1ZmZlciArIHRvdGFsX3JlY2VpdmVkLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKHJlc3BvbnNlX2J1ZmZlcikgLSB0b3RhbF9yZWNlaXZlZCAtIDEsIDApKSA+IDApIHsKICAgICAgICB0b3RhbF9yZWNlaXZlZCArPSByZWNlaXZlZDsKICAgICAgICBpZiAodG90YWxfcmVjZWl2ZWQgPj0gKHNzaXplX3Qpc2l6ZW9mKHJlc3BvbnNlX2J1ZmZlcikgLSAxKSBicmVhazsKICAgIH0KICAgIAogICAgcmVzcG9uc2VfYnVmZmVyW3RvdGFsX3JlY2VpdmVkXSA9ICdcMCc7CiAgICBjbG9zZShzb2NrZmQpOwogICAgCiAgICBjaGFyKiBzdGF0dXNfbGluZSA9IHN0cnN0cihyZXNwb25zZV9idWZmZXIsICJIVFRQLzEuMSIpOwogICAgaWYgKHN0YXR1c19saW5lKSB7CiAgICAgICAgc3NjYW5mKHN0YXR1c19saW5lLCAiSFRUUC8xLjEgJWQiLCAmcmVzcG9uc2UtPnN0YXR1c19jb2RlKTsKICAgIH0KICAgIAogICAgY2hhciogYm9keV9zdGFydCA9IHN0cnN0cihyZXNwb25zZV9idWZmZXIsICJcclxuXHJcbiIpOwogICAgaWYgKGJvZHlfc3RhcnQpIHsKICAgICAgICBib2R5X3N0YXJ0ICs9IDQ7CiAgICAgICAgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoID0gdG90YWxfcmVjZWl2ZWQgLSAoYm9keV9zdGFydCAtIHJlc3BvbnNlX2J1ZmZlcik7CiAgICAgICAgcmVzcG9uc2UtPmJvZHkgPSBtYWxsb2MocmVzcG9uc2UtPmJvZHlfbGVuZ3RoICsgMSk7CiAgICAgICAgaWYgKHJlc3BvbnNlLT5ib2R5KSB7CiAgICAgICAgICAgIG1lbWNweShyZXNwb25zZS0+Ym9keSwgYm9keV9zdGFydCwgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoKTsKICAgICAgICAgICAgcmVzcG9uc2UtPmJvZHlbcmVzcG9uc2UtPmJvZHlfbGVuZ3RoXSA9ICdcMCc7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICByZXNwb25zZS0+Ym9keSA9IHN0cmR1cCgiIik7CiAgICAgICAgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoID0gMDsKICAgIH0KICAgIAogICAgcmV0dXJuIHJlc3BvbnNlOwp9Cgp2b2lkIGh0dHBfcmVzcG9uc2VfZnJlZShIdHRwUmVzcG9uc2UqIHJlc3BvbnNlKSB7CiAgICBpZiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UtPmJvZHkpIGZyZWUocmVzcG9uc2UtPmJvZHkpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcmVzcG9uc2UtPmhlYWRlcl9jb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGZyZWUocmVzcG9uc2UtPmhlYWRlcnNbaV0pOwogICAgICAgIH0KICAgICAgICBmcmVlKHJlc3BvbnNlKTsKICAgIH0KfQoKaW50IHZlcmlmeV9odHRwX3Jlc3BvbnNlKGNvbnN0IEh0dHBSZXNwb25zZSogcmVzcG9uc2UsIGNvbnN0IGNoYXIqIGV4cGVjdGVkX3BhdHRlcm4sIGludCBjaGVja19zdWNjZXNzX29ubHkpIHsKICAgIGlmICghcmVzcG9uc2UpIHJldHVybiAwOwogICAgCiAgICBpZiAoY2hlY2tfc3VjY2Vzc19vbmx5KSB7CiAgICAgICAgcmV0dXJuIChyZXNwb25zZS0+c3RhdHVzX2NvZGUgPj0gMjAwICYmIHJlc3BvbnNlLT5zdGF0dXNfY29kZSA8IDUwMCkgJiYgCiAgICAgICAgICAgICAgIHJlc3BvbnNlLT5ib2R5ICYmIHN0cnN0cihyZXNwb25zZS0+Ym9keSwgIlwic3VjY2Vzc1wiOiIpICE9IE5VTEw7CiAgICB9IGVsc2UgewogICAgICAgIGlmIChyZXNwb25zZS0+c3RhdHVzX2NvZGUgPCAyMDAgfHwgcmVzcG9uc2UtPnN0YXR1c19jb2RlID49IDMwMCkgcmV0dXJuIDA7CiAgICAgICAgaWYgKGV4cGVjdGVkX3BhdHRlcm4gJiYgZXhwZWN0ZWRfcGF0dGVyblswXSAhPSAnXDAnKSB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UtPmJvZHkgfHwgc3Ryc3RyKHJlc3BvbnNlLT5ib2R5LCBleHBlY3RlZF9wYXR0ZXJuKSA9PSBOVUxMKSByZXR1cm4gMDsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gMTsKfQoKY2hhciogZXh0cmFjdF9qc29uX2ZpZWxkKGNvbnN0IGNoYXIqIGpzb24sIGNvbnN0IGNoYXIqIGZpZWxkKSB7CiAgICBpZiAoIWpzb24gfHwgIWZpZWxkKSByZXR1cm4gTlVMTDsKICAgIAogICAgY2hhciBzZWFyY2hfcGF0dGVyblsyNTZdOwogICAgc25wcmludGYoc2VhcmNoX3BhdHRlcm4sIHNpemVvZihzZWFyY2hfcGF0dGVybiksICJcIiVzXCI6XCIiLCBmaWVsZCk7CiAgICAKICAgIGNoYXIqIGZpZWxkX3N0YXJ0ID0gc3Ryc3RyKGpzb24sIHNlYXJjaF9wYXR0ZXJuKTsKICAgIGlmICghZmllbGRfc3RhcnQpIHsKICAgICAgICBzbnByaW50ZihzZWFyY2hfcGF0dGVybiwgc2l6ZW9mKHNlYXJjaF9wYXR0ZXJuKSwgIlwiJXNcIjoiLCBmaWVsZCk7CiAgICAgICAgZmllbGRfc3RhcnQgPSBzdHJzdHIoanNvbiwgc2VhcmNoX3BhdHRlcm4pOwogICAgICAgIGlmICghZmllbGRfc3RhcnQpIHJldHVybiBOVUxMOwogICAgICAgIAogICAgICAgIGZpZWxkX3N0YXJ0ICs9IHN0cmxlbihzZWFyY2hfcGF0dGVybik7CiAgICAgICAgY2hhciogZmllbGRfZW5kID0gc3RyY2hyKGZpZWxkX3N0YXJ0LCAnLCcpOwogICAgICAgIGlmICghZmllbGRfZW5kKSBmaWVsZF9lbmQgPSBzdHJjaHIoZmllbGRfc3RhcnQsICd9Jyk7CiAgICAgICAgaWYgKCFmaWVsZF9lbmQpIHJldHVybiBOVUxMOwogICAgICAgIAogICAgICAgIHNpemVfdCBmaWVsZF9sZW5ndGggPSBmaWVsZF9lbmQgLSBmaWVsZF9zdGFydDsKICAgICAgICBjaGFyKiB2YWx1ZSA9IG1hbGxvYyhmaWVsZF9sZW5ndGggKyAxKTsKICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgc3RybmNweSh2YWx1ZSwgZmllbGRfc3RhcnQsIGZpZWxkX2xlbmd0aCk7CiAgICAgICAgICAgIHZhbHVlW2ZpZWxkX2xlbmd0aF0gPSAnXDAnOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICAKICAgIGZpZWxkX3N0YXJ0ICs9IHN0cmxlbihzZWFyY2hfcGF0dGVybik7CiAgICBjaGFyKiBmaWVsZF9lbmQgPSBzdHJjaHIoZmllbGRfc3RhcnQsICciJyk7CiAgICBpZiAoIWZpZWxkX2VuZCkgcmV0dXJuIE5VTEw7CiAgICAKICAgIHNpemVfdCBmaWVsZF9sZW5ndGggPSBmaWVsZF9lbmQgLSBmaWVsZF9zdGFydDsKICAgIGNoYXIqIHZhbHVlID0gbWFsbG9jKGZpZWxkX2xlbmd0aCArIDEpOwogICAgaWYgKHZhbHVlKSB7CiAgICAgICAgc3RybmNweSh2YWx1ZSwgZmllbGRfc3RhcnQsIGZpZWxkX2xlbmd0aCk7CiAgICAgICAgdmFsdWVbZmllbGRfbGVuZ3RoXSA9ICdcMCc7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7Cn0KCmludCBodHRwX3Rlc3RfZW5kcG9pbnQoY29uc3QgY2hhciogZGVzY3JpcHRpb24sIGNvbnN0IGNoYXIqIG1ldGhvZCwgY29uc3QgY2hhciogZW5kcG9pbnQsIAogICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciogYm9keSwgY29uc3QgY2hhciogZXhwZWN0ZWRfcGF0dGVybiwgaW50IGNoZWNrX3N1Y2Nlc3Nfb25seSwgCiAgICAgICAgICAgICAgICAgICAgICBsb25nIGxvbmcqIGR1cmF0aW9uLCBpbnQgY2F0ZWdvcnksIGludCBjcml0aWNhbCkgewogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbY2F0ZWdvcnldKys7CiAgICAKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgZGVzY3JpcHRpb24pOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGxvbmcgbG9uZyBzdGFydF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgCiAgICBIdHRwUmVzcG9uc2UqIHJlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KG1ldGhvZCwgZW5kcG9pbnQsIGJvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBsb25nIGxvbmcgZW5kX3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICBsb25nIGxvbmcgZWxhcHNlZCA9IGVuZF90aW1lIC0gc3RhcnRfdGltZTsKICAgIAogICAgaWYgKGR1cmF0aW9uKSAqZHVyYXRpb24gPSBlbGFwc2VkOwogICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZWxhcHNlZDsKICAgIAogICAgaW50IHN1Y2Nlc3MgPSAwOwogICAgaWYgKHJlc3BvbnNlKSB7CiAgICAgICAgc3VjY2VzcyA9IHZlcmlmeV9odHRwX3Jlc3BvbnNlKHJlc3BvbnNlLCBleHBlY3RlZF9wYXR0ZXJuLCBjaGVja19zdWNjZXNzX29ubHkpOwogICAgICAgIAogICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtjYXRlZ29yeV0rKzsKICAgICAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzXG4iLCBDWUFOLCBlbGFwc2VkLCBSRVNFVCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgICAgIGlmIChjcml0aWNhbCkgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgICAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlc1xuIiwgQ1lBTiwgZWxhcHNlZCwgUkVTRVQpOwogICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBTdGF0dXM6ICVkLCBCb2R5OiAlLjEwMHNcbiIgUkVTRVQsIAogICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLT5zdGF0dXNfY29kZSwgcmVzcG9uc2UtPmJvZHkgPyByZXNwb25zZS0+Ym9keSA6ICJOVUxMIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3BvbnNlKTsKICAgIH0gZWxzZSB7CiAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgaWYgKGNyaXRpY2FsKSBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIGVsYXBzZWQsIFJFU0VUKTsKICAgICAgICBwcmludGYoUkVEICIgIE5vIHJlc3BvbnNlIGZyb20gc2VydmVyXG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgcmV0dXJuIHN1Y2Nlc3M7Cn0KCi8vID09PT09PT09PT09PT09PT09PT09IFNFUlZFUiBNQU5BR0VNRU5UID09PT09PT09PT09PT09PT09PT09CgppbnQgc3RhcnRfc3lkYl9zZXJ2ZXIoKSB7CiAgICBwcmludGYoIlN0YXJ0aW5nIFNZREIgc2VydmVyIG9uIHBvcnQgODA4MC4uLlxuIik7CiAgICAKICAgIHNlcnZlcl9waWQgPSBmb3JrKCk7CiAgICBpZiAoc2VydmVyX3BpZCA9PSAwKSB7CiAgICAgICAgLy8gQ2hpbGQgcHJvY2VzcwogICAgICAgIGNoYXIqIGFyZ3NbNF07CiAgICAgICAgYXJnc1swXSA9IGNsaV9jb21tYW5kOwogICAgICAgIGFyZ3NbMV0gPSAiLS1zZXJ2ZXIiOwogICAgICAgIGFyZ3NbMl0gPSB2ZXJib3NlX21vZGUgPyAiLS12ZXJib3NlIiA6IE5VTEw7CiAgICAgICAgYXJnc1szXSA9IE5VTEw7CiAgICAgICAgCiAgICAgICAgZXhlY3ZwKGFyZ3NbMF0sIGFyZ3MpOwogICAgICAgIGV4aXQoMSk7CiAgICB9IGVsc2UgaWYgKHNlcnZlcl9waWQgPiAwKSB7CiAgICAgICAgLy8gUGFyZW50IHByb2Nlc3MgLSB3YWl0IGZvciBzZXJ2ZXIgdG8gYmUgcmVhZHkKICAgICAgICBzZXJ2ZXJfc3RhcnRlZF9ieV90ZXN0ID0gMTsKICAgICAgICBtc2xlZXAoNTAwKTsgLy8gR2l2ZSBzZXJ2ZXIgdGltZSB0byBzdGFydAogICAgICAgIAogICAgICAgIGlmICh3YWl0X2Zvcl9zZXJ2ZXJfcmVhZHkoMTApKSB7CiAgICAgICAgICAgIHByaW50ZihHUkVFTiAiU2VydmVyIHN0YXJ0ZWQgc3VjY2Vzc2Z1bGx5IChQSUQ6ICVkKVxuIiBSRVNFVCwgc2VydmVyX3BpZCk7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIlNlcnZlciBmYWlsZWQgdG8gc3RhcnRcbiIgUkVTRVQpOwogICAgICAgICAgICBraWxsKHNlcnZlcl9waWQsIFNJR1RFUk0pOwogICAgICAgICAgICBzZXJ2ZXJfcGlkID0gMDsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgfQogICAgCiAgICByZXR1cm4gMDsKfQoKaW50IHN0b3Bfc3lkYl9zZXJ2ZXIoKSB7CiAgICBpZiAoc2VydmVyX3BpZCA+IDAgJiYgc2VydmVyX3N0YXJ0ZWRfYnlfdGVzdCkgewogICAgICAgIHByaW50ZigiU3RvcHBpbmcgU1lEQiBzZXJ2ZXIgKFBJRDogJWQpLi4uXG4iLCBzZXJ2ZXJfcGlkKTsKICAgICAgICBraWxsKHNlcnZlcl9waWQsIFNJR1RFUk0pOwogICAgICAgIHdhaXRwaWQoc2VydmVyX3BpZCwgTlVMTCwgMCk7CiAgICAgICAgc2VydmVyX3BpZCA9IDA7CiAgICAgICAgc2VydmVyX3N0YXJ0ZWRfYnlfdGVzdCA9IDA7CiAgICAgICAgbXNsZWVwKDIwMCk7CiAgICAgICAgcHJpbnRmKEdSRUVOICJTZXJ2ZXIgc3RvcHBlZFxuIiBSRVNFVCk7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CiAgICByZXR1cm4gMDsKfQoKaW50IHdhaXRfZm9yX3NlcnZlcl9yZWFkeShpbnQgdGltZW91dF9zZWNvbmRzKSB7CiAgICBwcmludGYoIldhaXRpbmcgZm9yIHNlcnZlciB0byBiZSByZWFkeS4uLlxuIik7CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdGltZW91dF9zZWNvbmRzICogMTA7IGkrKykgewogICAgICAgIEh0dHBSZXNwb25zZSogcmVzcG9uc2UgPSBodHRwX3JlcXVlc3QoIkdFVCIsICIvYXBpL2RhdGFiYXNlcyIsIE5VTEwsIE5VTEwpOwogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS0+c3RhdHVzX2NvZGUgPiAwKSB7CiAgICAgICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwb25zZSk7CiAgICAgICAgICAgIHByaW50ZihHUkVFTiAiU2VydmVyIGlzIHJlYWR5XG4iIFJFU0VUKTsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwb25zZSk7CiAgICAgICAgbXNsZWVwKDEwMCk7CiAgICB9CiAgICAKICAgIHJldHVybiAwOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBEVVJBQklMSVRZIFRFU1RTIChDUklUSUNBTCkgPT09PT09PT09PT09PT09PT09PT0KCmludCBydW5fZHVyYWJpbGl0eV90ZXN0c19jbGkoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIkRVUkFCSUxJVFkgJiBDUkFTSCBSRUNPVkVSWSBURVNUUyAoQ0xJKSIgUkVTRVQgIlxuIik7CiAgICBwcmludGYoWUVMTE9XICJUaGVzZSB0ZXN0cyB2ZXJpZnkgZGF0YSBzdXJ2aXZlcyBjcmFzaGVzIGFuZCBwb3dlciBmYWlsdXJlc1xuIiBSRVNFVCk7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIAogICAgLy8gQ3JlYXRlIHRlc3QgZGF0YWJhc2Ugd2l0aCB1bmlxdWUgbmFtZQogICAgY2hhciBkYl9uYW1lWzY0XTsKICAgIHNucHJpbnRmKGRiX25hbWUsIHNpemVvZihkYl9uYW1lKSwgImR1cmFiaWxpdHlfdGVzdF8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAKICAgIGNoYXIgc2V0dXBfY21kWzUxMl07CiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAiJXMgY3JlYXRlICVzID4gL2Rldi9udWxsIDI+JjEiLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0oc2V0dXBfY21kKTsKICAgIAogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgCiAgICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0tc2NoZW1hIC0tbmFtZS1zdHJpbmctcmVxIC0tYWdlLWludCAtLWRhdGEtc3RyaW5nID4gL2Rldi9udWxsIDI+JjEiLCAKICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIHN5c3RlbShzZXR1cF9jbWQpOwogICAgCiAgICAvLyBURVNUIDE6IEluc2VydCB3aXRoIGZzeW5jIHZlcmlmaWNhdGlvbgogICAgewogICAgICAgIHRvdGFsKys7CiAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCAxOiBJbnNlcnQgd2l0aCBpbW1lZGlhdGUgZHVyYWJpbGl0eSIpOwogICAgICAgIGZmbHVzaChzdGRvdXQpOwogICAgICAgIAogICAgICAgIC8vIEluc2VydCByZWNvcmQKICAgICAgICBjaGFyIGluc2VydF9jbWRbNTEyXTsKICAgICAgICBzbnByaW50ZihpbnNlcnRfY21kLCBzaXplb2YoaW5zZXJ0X2NtZCksIAogICAgICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIkR1cmFibGUgVXNlclwiIC0tYWdlLTI1IC0tZGF0YS1cIlRlc3QgZGF0YVwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgICAgICAKICAgICAgICBsb25nIGxvbmcgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAgICAgaW50IHJlc3VsdCA9IHN5c3RlbShpbnNlcnRfY21kKTsKICAgICAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgICAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgICAgICAKICAgICAgICAvLyBGb3JjZSBzeW5jIHRvIGRpc2sgKHRlc3QgaWYgZnN5bmMgaXMgY2FsbGVkKQogICAgICAgIGNoYXIgc3luY19jbWRbMjU2XTsKICAgICAgICBzbnByaW50ZihzeW5jX2NtZCwgc2l6ZW9mKHN5bmNfY21kKSwgInN5bmMiKTsKICAgICAgICBzeXN0ZW0oc3luY19jbWQpOwogICAgICAgIAogICAgICAgIC8vIENoZWNrIGlmIHJlY29yZCBleGlzdHMKICAgICAgICBpbnQgY291bnQgPSBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihkYl9uYW1lLCAidXNlcnMiKTsKICAgICAgICAKICAgICAgICBpZiAocmVzdWx0ID09IDAgJiYgY291bnQgPj0gMSkgewogICAgICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9EVVJBQklMSVRZXSsrOwogICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoUkVEICIgIFJlY29yZCBub3QgZm91bmQgYWZ0ZXIgaW5zZXJ0XG4iIFJFU0VUKTsKICAgICAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICAgICAgfQogICAgICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9EVVJBQklMSVRZXSsrOwogICAgfQogICAgCiAgICAvLyBURVNUIDI6IENyYXNoIGR1cmluZyBpbnNlcnQgLSByZWNvdmVyeSB0ZXN0CiAgICB7CiAgICAgICAgdG90YWwrKzsKICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDI6IENyYXNoIHJlY292ZXJ5IC0ga2lsbCBkdXJpbmcgaW5zZXJ0Iik7CiAgICAgICAgZmZsdXNoKHN0ZG91dCk7CiAgICAgICAgCiAgICAgICAgLy8gT25seSBydW4gdGhpcyB0ZXN0IGluIGNvbXByZWhlbnNpdmUgbW9kZQogICAgICAgIGlmICh0ZXN0X2xldmVsID49IDIpIHsKICAgICAgICAgICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRm9yayBhIGNoaWxkIHRvIHNpbXVsYXRlIGNyYXNoCiAgICAgICAgICAgIHBpZF90IGNoaWxkX3BpZCA9IGZvcmsoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChjaGlsZF9waWQgPT0gMCkgewogICAgICAgICAgICAgICAgLy8gQ2hpbGQgLSBwZXJmb3JtIGluc2VydCBhbmQgY3Jhc2gKICAgICAgICAgICAgICAgIGNoYXIgaW5zZXJ0X2NtZFs1MTJdOwogICAgICAgICAgICAgICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAgICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJDcmFzaCBUZXN0XCIgLS1hZ2UtOTkgLS1kYXRhLVwiU2hvdWxkIHJlY292ZXJcIiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzeXN0ZW0oaW5zZXJ0X2NtZCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFNpbXVsYXRlIGNyYXNoIC0gZG9uJ3QgY2xlYW4gdXAKICAgICAgICAgICAgICAgIGV4aXQoMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBQYXJlbnQgLSB3YWl0IGZvciBjaGlsZAogICAgICAgICAgICAgICAgaW50IHN0YXR1czsKICAgICAgICAgICAgICAgIHdhaXRwaWQoY2hpbGRfcGlkLCAmc3RhdHVzLCAwKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZGF0YSBzdXJ2aXZlZAogICAgICAgICAgICAgICAgbXNsZWVwKDUwMCk7IC8vIEdpdmUgc3lzdGVtIHRpbWUgdG8gc2V0dGxlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGludCBjb3VudCA9IGNvdW50X2luc3RhbmNlc19pbl9jb2xsZWN0aW9uKGRiX25hbWUsICJ1c2VycyIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgICAgICAgICAgICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBXZSBkb24ndCBrbm93IGlmIGl0IHNob3VsZCBzdXJ2aXZlIC0ganVzdCByZXBvcnQgd2hhdCBoYXBwZW5lZAogICAgICAgICAgICAgICAgaWYgKGNvdW50ID49IDIpIHsgLy8gV2UgaGFkIDEgZnJvbSBwcmV2aW91cyB0ZXN0CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gRGF0YSBzdXJ2aXZlZCBjcmFzaFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICAgICAgICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICAgICAgICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9EVVJBQklMSVRZXSsrOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwcmludGYoIlsiIFlFTExPVyAiV0FSTiIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gRGF0YSBsb3N0IG9uIGNyYXNoIChmc3luYyBtaXNzaW5nPylcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgLy8gTm90IG1hcmtpbmcgYXMgZmFpbCBiZWNhdXNlIHdlJ3JlIGp1c3QgZG9jdW1lbnRpbmcgYmVoYXZpb3IKICAgICAgICAgICAgICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgICAgICAgICAgICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9EVVJBQklMSVRZXSsrOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHJpbnRmKCJbIiBZRUxMT1cgIlNLSVAiIFJFU0VUICJdICVzJTRsbGQgbXMlc1xuIiwgQ1lBTiwgMCwgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFNraXBwZWQgKHVzZSAtLWxldmVsPTIgZm9yIGNvbXByZWhlbnNpdmUgdGVzdGluZylcbiIgUkVTRVQpOwogICAgICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBURVNUIDM6IFBvd2VyIGZhaWx1cmUgc2ltdWxhdGlvbiAtIGZpbGUgc3lzdGVtIGNvbnNpc3RlbmN5CiAgICB7CiAgICAgICAgdG90YWwrKzsKICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDM6IEZpbGUgc3lzdGVtIGNvbnNpc3RlbmN5IGFmdGVyIGFibm9ybWFsIHRlcm1pbmF0aW9uIik7CiAgICAgICAgZmZsdXNoKHN0ZG91dCk7CiAgICAgICAgCiAgICAgICAgaWYgKHRlc3RfbGV2ZWwgPj0gMikgewogICAgICAgICAgICBsb25nIGxvbmcgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBHZXQgZmlsZSBwYXRoCiAgICAgICAgICAgIGNoYXIgZGF0YV9wYXRoWzUxMl07CiAgICAgICAgICAgIHNucHJpbnRmKGRhdGFfcGF0aCwgc2l6ZW9mKGRhdGFfcGF0aCksICIvdG1wL3N5ZGJfdGVzdC8lcy91c2Vycy9kYXRhLnN5ZGIiLCBkYl9uYW1lKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdldCBjaGVja3N1bSBiZWZvcmUKICAgICAgICAgICAgaW50IGNoZWNrc3VtX2JlZm9yZSA9IGNhbGN1bGF0ZV9maWxlX2NoZWNrc3VtKGRhdGFfcGF0aCk7CiAgICAgICAgICAgIGludCBzaXplX2JlZm9yZSA9IGdldF9maWxlX3NpemUoZGF0YV9wYXRoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEZvcmsgYW5kIGtpbGwgLTkKICAgICAgICAgICAgcGlkX3QgY2hpbGRfcGlkID0gZm9yaygpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGNoaWxkX3BpZCA9PSAwKSB7CiAgICAgICAgICAgICAgICAvLyBDaGlsZCAtIHBlcmZvcm0gbXVsdGlwbGUgaW5zZXJ0cwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY2hhciBpbnNlcnRfY21kWzUxMl07CiAgICAgICAgICAgICAgICAgICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLWluc2VydC1vbmUgLS1uYW1lLVwiQnVsayVkXCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSwgaSk7CiAgICAgICAgICAgICAgICAgICAgc3lzdGVtKGluc2VydF9jbWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXhpdCgwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIERvbid0IHdhaXQgLSBraWxsIGltbWVkaWF0ZWx5CiAgICAgICAgICAgICAgICB1c2xlZXAoNTAwMDApOyAvLyA1MG1zCiAgICAgICAgICAgICAgICBraWxsKGNoaWxkX3BpZCwgU0lHS0lMTCk7CiAgICAgICAgICAgICAgICB3YWl0cGlkKGNoaWxkX3BpZCwgTlVMTCwgMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG1zbGVlcCgyMDApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDaGVjayBmaWxlIGludGVncml0eQogICAgICAgICAgICAgICAgaW50IGNoZWNrc3VtX2FmdGVyID0gY2FsY3VsYXRlX2ZpbGVfY2hlY2tzdW0oZGF0YV9wYXRoKTsKICAgICAgICAgICAgICAgIGludCBzaXplX2FmdGVyID0gZ2V0X2ZpbGVfc2l6ZShkYXRhX3BhdGgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgICAgICAgICAgICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBGaWxlIHNob3VsZCBzdGlsbCBiZSByZWFkYWJsZQogICAgICAgICAgICAgICAgaW50IGNvdW50ID0gY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oZGJfbmFtZSwgInVzZXJzIik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBGaWxlIHJlYWRhYmxlLCAlZCByZWNvcmRzXG4iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgQ1lBTiwgZHVyYXRpb24sIFJFU0VULCBjb3VudCk7CiAgICAgICAgICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgICAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgICAgICAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfRFVSQUJJTElUWV0rKzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIEZpbGUgY29ycnVwdGVkXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgICAgICAgICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgICAgICAgICAgICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9EVVJBQklMSVRZXSsrOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHJpbnRmKCJbIiBZRUxMT1cgIlNLSVAiIFJFU0VUICJdICVzJTRsbGQgbXMlc1xuIiwgQ1lBTiwgMCwgUkVTRVQpOwogICAgICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBURVNUIDQ6IENvbmN1cnJlbnQgZHVyYWJpbGl0eSAtIG1hbnkgaW5zZXJ0cywgdGhlbiB2ZXJpZnkgY291bnQKICAgIHsKICAgICAgICB0b3RhbCsrOwogICAgICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlRFU1QgNDogQnVsayBpbnNlcnQgZHVyYWJpbGl0eSAoMTAwIHJlY29yZHMpIik7CiAgICAgICAgZmZsdXNoKHN0ZG91dCk7CiAgICAgICAgCiAgICAgICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgICAgIAogICAgICAgIGludCBzdWNjZXNzX2NvdW50ID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7CiAgICAgICAgICAgIGNoYXIgaW5zZXJ0X2NtZFs1MTJdOwogICAgICAgICAgICBzbnByaW50ZihpbnNlcnRfY21kLCBzaXplb2YoaW5zZXJ0X2NtZCksCiAgICAgICAgICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLWluc2VydC1vbmUgLS1uYW1lLVwiQnVsa1VzZXIlZFwiIC0tYWdlLSVkID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lLCBpLCAyMCArIChpICUgNTApKTsKICAgICAgICAgICAgaWYgKHN5c3RlbShpbnNlcnRfY21kKSA9PSAwKSBzdWNjZXNzX2NvdW50Kys7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEZvcmNlIHN5bmMKICAgICAgICBzeXN0ZW0oInN5bmMiKTsKICAgICAgICAKICAgICAgICBpbnQgZmluYWxfY291bnQgPSBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihkYl9uYW1lLCAidXNlcnMiKTsKICAgICAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgICAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgICAgICAKICAgICAgICBpZiAoZmluYWxfY291bnQgPj0gc3VjY2Vzc19jb3VudCAmJiBzdWNjZXNzX2NvdW50ID4gOTApIHsKICAgICAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gJWQvJWQgcmVjb3JkcyBwZXJzaXN0ZWRcbiIsIAogICAgICAgICAgICAgICAgICAgQ1lBTiwgZHVyYXRpb24sIFJFU0VULCBmaW5hbF9jb3VudCwgc3VjY2Vzc19jb3VudCk7CiAgICAgICAgICAgIHBhc3NlZCsrOwogICAgICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfRFVSQUJJTElUWV0rKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gT25seSAlZC8lZCByZWNvcmRzIHBlcnNpc3RlZFxuIiwgCiAgICAgICAgICAgICAgICAgICBDWUFOLCBkdXJhdGlvbiwgUkVTRVQsIGZpbmFsX2NvdW50LCBzdWNjZXNzX2NvdW50KTsKICAgICAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICAgICAgfQogICAgICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9EVVJBQklMSVRZXSsrOwogICAgfQogICAgCiAgICBwcmludGYoWUVMTE9XICIgIER1cmFiaWxpdHkgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgppbnQgcnVuX2R1cmFiaWxpdHlfdGVzdHNfaHR0cCgpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgQk9MRCAiRFVSQUJJTElUWSAmIENSQVNIIFJFQ09WRVJZIFRFU1RTIChIVFRQKSIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIGxvbmcgbG9uZyBkdXJhdGlvbjsKICAgIAogICAgY2hhciBkYl9uYW1lWzY0XTsKICAgIHNucHJpbnRmKGRiX25hbWUsIHNpemVvZihkYl9uYW1lKSwgImh0dHBfZHVyYWJpbGl0eV8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMjU2XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCBkYl9uYW1lKTsKICAgIAogICAgLy8gQ3JlYXRlIGRhdGFiYXNlCiAgICBIdHRwUmVzcG9uc2UqIHJlc3AgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfZGJfYm9keSwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwKTsKICAgIAogICAgLy8gQ3JlYXRlIGNvbGxlY3Rpb24KICAgIGNoYXIgY3JlYXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfY29sbF91cmwsIHNpemVvZihjcmVhdGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCBkYl9uYW1lKTsKICAgIGNvbnN0IGNoYXIqIHNjaGVtYSA9ICJ7XCJuYW1lXCI6XCJ1c2Vyc1wiLFwic2NoZW1hXCI6WyIKICAgICAgICAie1wibmFtZVwiOlwibmFtZVwiLFwidHlwZVwiOlwic3RyaW5nXCIsXCJyZXF1aXJlZFwiOnRydWV9LCIKICAgICAgICAie1wibmFtZVwiOlwiYWdlXCIsXCJ0eXBlXCI6XCJpbnRcIn1dfSI7CiAgICByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgY3JlYXRlX2NvbGxfdXJsLCBzY2hlbWEsICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIGNoYXIgaW5zdGFuY2VzX3VybFsyNTZdOwogICAgc25wcmludGYoaW5zdGFuY2VzX3VybCwgc2l6ZW9mKGluc3RhbmNlc191cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzIiwgZGJfbmFtZSk7CiAgICAKICAgIC8vIFRFU1QgMTogSW5zZXJ0IGFuZCB2ZXJpZnkKICAgIHRvdGFsKys7CiAgICBjb25zdCBjaGFyKiB1c2VyMSA9ICJ7XCJuYW1lXCI6XCJEdXJhYmxlIFVzZXJcIixcImFnZVwiOjMwfSI7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJIVFRQOiBJbnNlcnQgd2l0aCBkdXJhYmlsaXR5IHZlcmlmaWNhdGlvbiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgaW5zdGFuY2VzX3VybCwgdXNlcjEsICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX0RVUkFCSUxJVFksIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICAKICAgIC8vIFRFU1QgMjogTXVsdGlwbGUgaW5zZXJ0cyB1bmRlciBsb2FkCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiSFRUUDogQnVsayBpbnNlcnQgZHVyYWJpbGl0eSAoNTAgcmVjb3JkcykiKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBsb25nIGxvbmcgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICBpbnQgc3VjY2Vzc19jb3VudCA9IDA7CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgNTA7IGkrKykgewogICAgICAgIGNoYXIgdXNlcl9qc29uWzI1Nl07CiAgICAgICAgc25wcmludGYodXNlcl9qc29uLCBzaXplb2YodXNlcl9qc29uKSwgIntcIm5hbWVcIjpcIlVzZXIlZFwiLFwiYWdlXCI6JWR9IiwgaSwgMjAgKyBpKTsKICAgICAgICBIdHRwUmVzcG9uc2UqIHIgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCBpbnN0YW5jZXNfdXJsLCB1c2VyX2pzb24sICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICAgICAgaWYgKHIgJiYgci0+c3RhdHVzX2NvZGUgPj0gMjAwICYmIHItPnN0YXR1c19jb2RlIDwgMzAwKSBzdWNjZXNzX2NvdW50Kys7CiAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKHIpOwogICAgfQogICAgCiAgICBsb25nIGxvbmcgZWxhcHNlZCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZWxhcHNlZDsKICAgIAogICAgLy8gVmVyaWZ5IHZpYSBHRVQKICAgIEh0dHBSZXNwb25zZSogdmVyaWZ5X3Jlc3AgPSBodHRwX3JlcXVlc3QoIkdFVCIsIGluc3RhbmNlc191cmwsIE5VTEwsIE5VTEwpOwogICAgaW50IHJlY29yZF9jb3VudCA9IDA7CiAgICBpZiAodmVyaWZ5X3Jlc3AgJiYgdmVyaWZ5X3Jlc3AtPmJvZHkpIHsKICAgICAgICBjaGFyKiBwb3MgPSB2ZXJpZnlfcmVzcC0+Ym9keTsKICAgICAgICB3aGlsZSAoKHBvcyA9IHN0cnN0cihwb3MsICJcIl9pZFwiIikpICE9IE5VTEwpIHsKICAgICAgICAgICAgcmVjb3JkX2NvdW50Kys7CiAgICAgICAgICAgIHBvcyArPSA1OwogICAgICAgIH0KICAgIH0KICAgIGh0dHBfcmVzcG9uc2VfZnJlZSh2ZXJpZnlfcmVzcCk7CiAgICAKICAgIGlmIChyZWNvcmRfY291bnQgPj0gc3VjY2Vzc19jb3VudCAmJiBzdWNjZXNzX2NvdW50ID4gNDUpIHsKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSAlZC8lZCByZWNvcmRzXG4iLCBDWUFOLCBlbGFwc2VkLCBSRVNFVCwgcmVjb3JkX2NvdW50LCBzdWNjZXNzX2NvdW50KTsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9EVVJBQklMSVRZXSsrOwogICAgICAgIHBhc3NlZCsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gT25seSAlZC8lZCByZWNvcmRzXG4iLCBDWUFOLCBlbGFwc2VkLCBSRVNFVCwgcmVjb3JkX2NvdW50LCBzdWNjZXNzX2NvdW50KTsKICAgICAgICBzdGF0cy5mYWlsZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfRFVSQUJJTElUWV0rKzsKICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBIVFRQIER1cmFiaWxpdHkgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBDT05DVVJSRU5DWSBURVNUUyA9PT09PT09PT09PT09PT09PT09PQoKLy8gVGhyZWFkIGZ1bmN0aW9uIGZvciBjb25jdXJyZW50IGluc2VydHMKdm9pZCogY29uY3VycmVudF9pbnNlcnRfdGhyZWFkKHZvaWQqIGFyZykgewogICAgVGhyZWFkVGVzdENvbnRleHQqIGN0eCA9IChUaHJlYWRUZXN0Q29udGV4dCopYXJnOwogICAgY3R4LT5zdWNjZXNzX2NvdW50ID0gMDsKICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjdHgtPm9wZXJhdGlvbnNfY291bnQ7IGkrKykgewogICAgICAgIGNoYXIgY29tbWFuZFs1MTJdOwogICAgICAgIHNucHJpbnRmKGNvbW1hbmQsIHNpemVvZihjb21tYW5kKSwgCiAgICAgICAgICAgICAgICAiJXMgY3JlYXRlICVzICVzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJUaHJlYWQlZF8lZFwiIC0tYWdlLSVkID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGN0eC0+ZGF0YWJhc2UsIGN0eC0+Y29sbGVjdGlvbiwgY3R4LT50aHJlYWRfaWQsIGksIDIwICsgKGkgJSA1MCkpOwogICAgICAgIAogICAgICAgIGlmIChzeXN0ZW0oY29tbWFuZCkgPT0gMCkgewogICAgICAgICAgICBjdHgtPnN1Y2Nlc3NfY291bnQrKzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gU21hbGwgeWllbGQgdG8gaW5jcmVhc2UgaW50ZXJsZWF2aW5nCiAgICAgICAgaWYgKGkgJSAxMCA9PSAwKSB1c2xlZXAoMTAwKTsKICAgIH0KICAgIAogICAgY3R4LT50b3RhbF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICByZXR1cm4gTlVMTDsKfQoKaW50IHJ1bl9jb25jdXJyZW5jeV90ZXN0c19jbGkoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIkNPTkNVUlJFTkNZICYgVEhSRUFEIFNBRkVUWSBURVNUUyAoQ0xJKSIgUkVTRVQgIlxuIik7CiAgICBwcmludGYoWUVMTE9XICJUaGVzZSB0ZXN0cyB2ZXJpZnkgdGhlIGRhdGFiYXNlIGhhbmRsZXMgY29uY3VycmVudCBhY2Nlc3MgY29ycmVjdGx5XG4iIFJFU0VUKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgCiAgICBjaGFyIGRiX25hbWVbNjRdOwogICAgc25wcmludGYoZGJfbmFtZSwgc2l6ZW9mKGRiX25hbWUpLCAiY29uY3VycmVuY3lfdGVzdF8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAKICAgIGNoYXIgc2V0dXBfY21kWzUxMl07CiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAiJXMgY3JlYXRlICVzID4gL2Rldi9udWxsIDI+JjEiLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0oc2V0dXBfY21kKTsKICAgIHNucHJpbnRmKHNldHVwX2NtZCwgc2l6ZW9mKHNldHVwX2NtZCksIAogICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nLXJlcSAtLWFnZS1pbnQgPiAvZGV2L251bGwgMj4mMSIsIAogICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICAKICAgIC8vIFRFU1QgMTogVHdvIHRocmVhZHMgY29uY3VycmVudCBpbnNlcnRzCiAgICBpZiAodGVzdF9sZXZlbCA+PSAxKSB7CiAgICAgICAgdG90YWwrKzsKICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDE6IFR3byB0aHJlYWRzIC0gMTAwIGluc2VydHMgZWFjaCIpOwogICAgICAgIGZmbHVzaChzdGRvdXQpOwogICAgICAgIAogICAgICAgIHB0aHJlYWRfdCB0aHJlYWRzWzJdOwogICAgICAgIFRocmVhZFRlc3RDb250ZXh0IGNvbnRleHRzWzJdOwogICAgICAgIAogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMjsgaSsrKSB7CiAgICAgICAgICAgIG1lbXNldCgmY29udGV4dHNbaV0sIDAsIHNpemVvZihUaHJlYWRUZXN0Q29udGV4dCkpOwogICAgICAgICAgICBzdHJjcHkoY29udGV4dHNbaV0uZGF0YWJhc2UsIGRiX25hbWUpOwogICAgICAgICAgICBzdHJjcHkoY29udGV4dHNbaV0uY29sbGVjdGlvbiwgInVzZXJzIik7CiAgICAgICAgICAgIGNvbnRleHRzW2ldLnRocmVhZF9pZCA9IGk7CiAgICAgICAgICAgIGNvbnRleHRzW2ldLm9wZXJhdGlvbnNfY291bnQgPSAxMDA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgICAgICAKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDI7IGkrKykgewogICAgICAgICAgICBwdGhyZWFkX2NyZWF0ZSgmdGhyZWFkc1tpXSwgTlVMTCwgY29uY3VycmVudF9pbnNlcnRfdGhyZWFkLCAmY29udGV4dHNbaV0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDI7IGkrKykgewogICAgICAgICAgICBwdGhyZWFkX2pvaW4odGhyZWFkc1tpXSwgTlVMTCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxvbmcgbG9uZyBkdXJhdGlvbiA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgICAgIAogICAgICAgIGludCB0b3RhbF9zdWNjZXNzID0gY29udGV4dHNbMF0uc3VjY2Vzc19jb3VudCArIGNvbnRleHRzWzFdLnN1Y2Nlc3NfY291bnQ7CiAgICAgICAgaW50IGZpbmFsX2NvdW50ID0gY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oZGJfbmFtZSwgInVzZXJzIik7CiAgICAgICAgCiAgICAgICAgcHJpbnRmKCIgLSAlZC8lZCBtc1xuIiwgKGludClkdXJhdGlvbiwgMCk7CiAgICAgICAgCiAgICAgICAgaWYgKGZpbmFsX2NvdW50ID09IHRvdGFsX3N1Y2Nlc3MgJiYgdG90YWxfc3VjY2VzcyA9PSAyMDApIHsKICAgICAgICAgICAgcHJpbnRmKCIgIFsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSBBbGwgJWQgcmVjb3JkcyBpbnNlcnRlZCBzdWNjZXNzZnVsbHlcbiIsIHRvdGFsX3N1Y2Nlc3MpOwogICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX0NPTkNVUlJFTkNZXSsrOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHByaW50ZigiICBbIiBSRUQgIkZBSUwiIFJFU0VUICJdIEV4cGVjdGVkICVkIHJlY29yZHMsIGdvdCAlZCAoc3VjY2Vzc2Z1bCBpbnNlcnRzOiAlZClcbiIsIAogICAgICAgICAgICAgICAgICAgMjAwLCBmaW5hbF9jb3VudCwgdG90YWxfc3VjY2Vzcyk7CiAgICAgICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgICAgIH0KICAgICAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfQ09OQ1VSUkVOQ1ldKys7CiAgICB9CiAgICAKICAgIC8vIFRFU1QgMjogUmVhZGVyL1dyaXRlciBjb25jdXJyZW5jeQogICAgewogICAgICAgIHRvdGFsKys7CiAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCAyOiBSZWFkZXJzIGRvbid0IGJsb2NrIHdyaXRlcnMiKTsKICAgICAgICBmZmx1c2goc3Rkb3V0KTsKICAgICAgICAKICAgICAgICBsb25nIGxvbmcgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAgICAgCiAgICAgICAgLy8gU3RhcnQgYSBsb25nIHJlYWQgb3BlcmF0aW9uIGluIGJhY2tncm91bmQKICAgICAgICBwaWRfdCByZWFkZXJfcGlkID0gZm9yaygpOwogICAgICAgIAogICAgICAgIGlmIChyZWFkZXJfcGlkID09IDApIHsKICAgICAgICAgICAgLy8gQ2hpbGQgLSBsb25nIHJ1bm5pbmcgbGlzdCBvcGVyYXRpb24KICAgICAgICAgICAgY2hhciBsaXN0X2NtZFs1MTJdOwogICAgICAgICAgICBzbnByaW50ZihsaXN0X2NtZCwgc2l6ZW9mKGxpc3RfY21kKSwgCiAgICAgICAgICAgICAgICAgICAgIiVzIGxpc3QgJXMgdXNlcnMgPiAvZGV2L251bGwgMj4mMSIsIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICAgICAgc3lzdGVtKGxpc3RfY21kKTsKICAgICAgICAgICAgICAgIHVzbGVlcCgxMDAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXhpdCgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBQYXJlbnQgLSBwZXJmb3JtIHdyaXRlcyB3aGlsZSByZWFkIGlzIGhhcHBlbmluZwogICAgICAgICAgICBtc2xlZXAoNTApOyAvLyBMZXQgcmVhZGVyIHN0YXJ0CiAgICAgICAgICAgIAogICAgICAgICAgICBpbnQgd3JpdGVfc3VjY2VzcyA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMjA7IGkrKykgewogICAgICAgICAgICAgICAgY2hhciBpbnNlcnRfY21kWzUxMl07CiAgICAgICAgICAgICAgICBzbnByaW50ZihpbnNlcnRfY21kLCBzaXplb2YoaW5zZXJ0X2NtZCksCiAgICAgICAgICAgICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIlJXJWRcIiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUsIGkpOwogICAgICAgICAgICAgICAgaWYgKHN5c3RlbShpbnNlcnRfY21kKSA9PSAwKSB3cml0ZV9zdWNjZXNzKys7CiAgICAgICAgICAgICAgICB1c2xlZXAoNTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGtpbGwocmVhZGVyX3BpZCwgU0lHVEVSTSk7CiAgICAgICAgICAgIHdhaXRwaWQocmVhZGVyX3BpZCwgTlVMTCwgMCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgICAgICAgICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZHVyYXRpb247CiAgICAgICAgICAgIAogICAgICAgICAgICBpbnQgZmluYWxfY291bnQgPSBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihkYl9uYW1lLCAidXNlcnMiKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50ZigiIC0gJWxsZCBtc1xuIiwgZHVyYXRpb24pOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHdyaXRlX3N1Y2Nlc3MgPj0gMTgpIHsKICAgICAgICAgICAgICAgIHByaW50ZigiICBbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gV3JpdGVycyBjb21wbGV0ZWQgd2hpbGUgcmVhZGVycyBhY3RpdmU6ICVkLyVkXG4iLCAKICAgICAgICAgICAgICAgICAgICAgICB3cml0ZV9zdWNjZXNzLCAyMCk7CiAgICAgICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICAgICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgICAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfQ09OQ1VSUkVOQ1ldKys7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwcmludGYoIiAgWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSBXcml0ZXJzIGJsb2NrZWQgYnkgcmVhZGVyczogb25seSAlZC8lZCBzdWNjZWVkZWRcbiIsIAogICAgICAgICAgICAgICAgICAgICAgIHdyaXRlX3N1Y2Nlc3MsIDIwKTsKICAgICAgICAgICAgICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX0NPTkNVUlJFTkNZXSsrOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gVEVTVCAzOiBIaWdoIGNvbmN1cnJlbmN5IC0gMTAgdGhyZWFkcwogICAgaWYgKHRlc3RfbGV2ZWwgPj0gMikgewogICAgICAgIHRvdGFsKys7CiAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCAzOiAxMCB0aHJlYWRzIC0gNTAgaW5zZXJ0cyBlYWNoIChoaWdoIGNvbmN1cnJlbmN5KSIpOwogICAgICAgIGZmbHVzaChzdGRvdXQpOwogICAgICAgIAogICAgICAgICNkZWZpbmUgVEhSRUFEX0NPVU5UIDEwCiAgICAgICAgcHRocmVhZF90IHRocmVhZHNbVEhSRUFEX0NPVU5UXTsKICAgICAgICBUaHJlYWRUZXN0Q29udGV4dCBjb250ZXh0c1tUSFJFQURfQ09VTlRdOwogICAgICAgIAogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgVEhSRUFEX0NPVU5UOyBpKyspIHsKICAgICAgICAgICAgbWVtc2V0KCZjb250ZXh0c1tpXSwgMCwgc2l6ZW9mKFRocmVhZFRlc3RDb250ZXh0KSk7CiAgICAgICAgICAgIHN0cmNweShjb250ZXh0c1tpXS5kYXRhYmFzZSwgZGJfbmFtZSk7CiAgICAgICAgICAgIHN0cmNweShjb250ZXh0c1tpXS5jb2xsZWN0aW9uLCAidXNlcnMiKTsKICAgICAgICAgICAgY29udGV4dHNbaV0udGhyZWFkX2lkID0gaTsKICAgICAgICAgICAgY29udGV4dHNbaV0ub3BlcmF0aW9uc19jb3VudCA9IDUwOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBsb25nIGxvbmcgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAgICAgCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBUSFJFQURfQ09VTlQ7IGkrKykgewogICAgICAgICAgICBwdGhyZWFkX2NyZWF0ZSgmdGhyZWFkc1tpXSwgTlVMTCwgY29uY3VycmVudF9pbnNlcnRfdGhyZWFkLCAmY29udGV4dHNbaV0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IFRIUkVBRF9DT1VOVDsgaSsrKSB7CiAgICAgICAgICAgIHB0aHJlYWRfam9pbih0aHJlYWRzW2ldLCBOVUxMKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICAgICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZHVyYXRpb247CiAgICAgICAgCiAgICAgICAgaW50IHRvdGFsX3N1Y2Nlc3MgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgVEhSRUFEX0NPVU5UOyBpKyspIHsKICAgICAgICAgICAgdG90YWxfc3VjY2VzcyArPSBjb250ZXh0c1tpXS5zdWNjZXNzX2NvdW50OwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpbnQgZmluYWxfY291bnQgPSBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihkYl9uYW1lLCAidXNlcnMiKTsKICAgICAgICAKICAgICAgICBwcmludGYoIiAtICVsbGQgbXNcbiIsIGR1cmF0aW9uKTsKICAgICAgICAKICAgICAgICBpZiAoZmluYWxfY291bnQgPT0gdG90YWxfc3VjY2VzcyAmJiB0b3RhbF9zdWNjZXNzID49IChUSFJFQURfQ09VTlQgKiA1MCAqIDAuOSkpIHsKICAgICAgICAgICAgcHJpbnRmKCIgIFsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlZC8lZCByZWNvcmRzIGluc2VydGVkIHN1Y2Nlc3NmdWxseVxuIiwgCiAgICAgICAgICAgICAgICAgICBmaW5hbF9jb3VudCwgVEhSRUFEX0NPVU5UICogNTApOwogICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX0NPTkNVUlJFTkNZXSsrOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHByaW50ZigiICBbIiBSRUQgIkZBSUwiIFJFU0VUICJdIEV4cGVjdGVkIH4lZCwgZ290ICVkIChzdWNjZXNzZnVsOiAlZClcbiIsIAogICAgICAgICAgICAgICAgICAgVEhSRUFEX0NPVU5UICogNTAsIGZpbmFsX2NvdW50LCB0b3RhbF9zdWNjZXNzKTsKICAgICAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICAgICAgfQogICAgICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9DT05DVVJSRU5DWV0rKzsKICAgIH0KICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBDb25jdXJyZW5jeSB0ZXN0czogJWQvJWQgcGFzc2VkXG4iIFJFU0VULCBwYXNzZWQsIHRvdGFsKTsKICAgIHJldHVybiBwYXNzZWQ7Cn0KCi8vIEhUVFAgY29uY3VycmVuY3kgdGVzdCB0aHJlYWQKdm9pZCogaHR0cF9jb25jdXJyZW50X3RocmVhZCh2b2lkKiBhcmcpIHsKICAgIFRocmVhZFRlc3RDb250ZXh0KiBjdHggPSAoVGhyZWFkVGVzdENvbnRleHQqKWFyZzsKICAgIGN0eC0+c3VjY2Vzc19jb3VudCA9IDA7CiAgICBsb25nIGxvbmcgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAKICAgIGNoYXIgaW5zdGFuY2VzX3VybFsyNTZdOwogICAgc25wcmludGYoaW5zdGFuY2VzX3VybCwgc2l6ZW9mKGluc3RhbmNlc191cmwpLCAKICAgICAgICAgICAgICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy8lcy9pbnN0YW5jZXMiLCAKICAgICAgICAgICAgIGN0eC0+ZGF0YWJhc2UsIGN0eC0+Y29sbGVjdGlvbik7CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY3R4LT5vcGVyYXRpb25zX2NvdW50OyBpKyspIHsKICAgICAgICBjaGFyIHVzZXJfanNvblsyNTZdOwogICAgICAgIHNucHJpbnRmKHVzZXJfanNvbiwgc2l6ZW9mKHVzZXJfanNvbiksIAogICAgICAgICAgICAgICAgIntcIm5hbWVcIjpcIkhUVFBfVGhyZWFkJWRfJWRcIixcImFnZVwiOiVkfSIsIAogICAgICAgICAgICAgICAgY3R4LT50aHJlYWRfaWQsIGksIDIwICsgKGkgJSA1MCkpOwogICAgICAgIAogICAgICAgIEh0dHBSZXNwb25zZSogcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsIGluc3RhbmNlc191cmwsIHVzZXJfanNvbiwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgICAgICBpZiAocmVzcCAmJiByZXNwLT5zdGF0dXNfY29kZSA+PSAyMDAgJiYgcmVzcC0+c3RhdHVzX2NvZGUgPCAzMDApIHsKICAgICAgICAgICAgY3R4LT5zdWNjZXNzX2NvdW50Kys7CiAgICAgICAgfQogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwKTsKICAgICAgICAKICAgICAgICBpZiAoaSAlIDEwID09IDApIHVzbGVlcCg1MCk7CiAgICB9CiAgICAKICAgIGN0eC0+dG90YWxfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgcmV0dXJuIE5VTEw7Cn0KCmludCBydW5fY29uY3VycmVuY3lfdGVzdHNfaHR0cCgpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgQk9MRCAiQ09OQ1VSUkVOQ1kgJiBUSFJFQUQgU0FGRVRZIFRFU1RTIChIVFRQKSIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIAogICAgaWYgKHRlc3RfbGV2ZWwgPCAxKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBTa2lwcGluZyBIVFRQIGNvbmN1cnJlbmN5IHRlc3RzICh1c2UgLS1sZXZlbD0xIG9yIGhpZ2hlcilcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgCiAgICBjaGFyIGRiX25hbWVbNjRdOwogICAgc25wcmludGYoZGJfbmFtZSwgc2l6ZW9mKGRiX25hbWUpLCAiaHR0cF9jb25jXyVsZCIsIHRpbWUoTlVMTCkpOwogICAgCiAgICAvLyBTZXR1cAogICAgY2hhciBjcmVhdGVfZGJfYm9keVsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2RiX2JvZHksIHNpemVvZihjcmVhdGVfZGJfYm9keSksICJ7XCJuYW1lXCI6XCIlc1wifSIsIGRiX25hbWUpOwogICAgSHR0cFJlc3BvbnNlKiByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiX2JvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfY29sbF91cmwsIHNpemVvZihjcmVhdGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCBkYl9uYW1lKTsKICAgIGNvbnN0IGNoYXIqIHNjaGVtYSA9ICJ7XCJuYW1lXCI6XCJ1c2Vyc1wiLFwic2NoZW1hXCI6WyIKICAgICAgICAie1wibmFtZVwiOlwibmFtZVwiLFwidHlwZVwiOlwic3RyaW5nXCIsXCJyZXF1aXJlZFwiOnRydWV9LCIKICAgICAgICAie1wibmFtZVwiOlwiYWdlXCIsXCJ0eXBlXCI6XCJpbnRcIn1dfSI7CiAgICByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgY3JlYXRlX2NvbGxfdXJsLCBzY2hlbWEsICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIC8vIFRFU1Q6IENvbmN1cnJlbnQgSFRUUCByZXF1ZXN0cwogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIkhUVFA6IDUgY29uY3VycmVudCB0aHJlYWRzIC0gMjUgaW5zZXJ0cyBlYWNoIik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgI2RlZmluZSBIVFRQX1RIUkVBRF9DT1VOVCA1CiAgICBwdGhyZWFkX3QgdGhyZWFkc1tIVFRQX1RIUkVBRF9DT1VOVF07CiAgICBUaHJlYWRUZXN0Q29udGV4dCBjb250ZXh0c1tIVFRQX1RIUkVBRF9DT1VOVF07CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgSFRUUF9USFJFQURfQ09VTlQ7IGkrKykgewogICAgICAgIG1lbXNldCgmY29udGV4dHNbaV0sIDAsIHNpemVvZihUaHJlYWRUZXN0Q29udGV4dCkpOwogICAgICAgIHN0cmNweShjb250ZXh0c1tpXS5kYXRhYmFzZSwgZGJfbmFtZSk7CiAgICAgICAgc3RyY3B5KGNvbnRleHRzW2ldLmNvbGxlY3Rpb24sICJ1c2VycyIpOwogICAgICAgIGNvbnRleHRzW2ldLnRocmVhZF9pZCA9IGk7CiAgICAgICAgY29udGV4dHNbaV0ub3BlcmF0aW9uc19jb3VudCA9IDI1OwogICAgfQogICAgCiAgICBsb25nIGxvbmcgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgSFRUUF9USFJFQURfQ09VTlQ7IGkrKykgewogICAgICAgIHB0aHJlYWRfY3JlYXRlKCZ0aHJlYWRzW2ldLCBOVUxMLCBodHRwX2NvbmN1cnJlbnRfdGhyZWFkLCAmY29udGV4dHNbaV0pOwogICAgfQogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IEhUVFBfVEhSRUFEX0NPVU5UOyBpKyspIHsKICAgICAgICBwdGhyZWFkX2pvaW4odGhyZWFkc1tpXSwgTlVMTCk7CiAgICB9CiAgICAKICAgIGxvbmcgbG9uZyBkdXJhdGlvbiA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZHVyYXRpb247CiAgICAKICAgIGludCB0b3RhbF9zdWNjZXNzID0gMDsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgSFRUUF9USFJFQURfQ09VTlQ7IGkrKykgewogICAgICAgIHRvdGFsX3N1Y2Nlc3MgKz0gY29udGV4dHNbaV0uc3VjY2Vzc19jb3VudDsKICAgIH0KICAgIAogICAgLy8gVmVyaWZ5IGNvdW50IHZpYSBHRVQKICAgIGNoYXIgaW5zdGFuY2VzX3VybFsyNTZdOwogICAgc25wcmludGYoaW5zdGFuY2VzX3VybCwgc2l6ZW9mKGluc3RhbmNlc191cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzIiwgZGJfbmFtZSk7CiAgICBIdHRwUmVzcG9uc2UqIHZlcmlmeV9yZXNwID0gaHR0cF9yZXF1ZXN0KCJHRVQiLCBpbnN0YW5jZXNfdXJsLCBOVUxMLCBOVUxMKTsKICAgIAogICAgaW50IHJlY29yZF9jb3VudCA9IDA7CiAgICBpZiAodmVyaWZ5X3Jlc3AgJiYgdmVyaWZ5X3Jlc3AtPmJvZHkpIHsKICAgICAgICBjaGFyKiBwb3MgPSB2ZXJpZnlfcmVzcC0+Ym9keTsKICAgICAgICB3aGlsZSAoKHBvcyA9IHN0cnN0cihwb3MsICJcIl9pZFwiIikpICE9IE5VTEwpIHsKICAgICAgICAgICAgcmVjb3JkX2NvdW50Kys7CiAgICAgICAgICAgIHBvcyArPSA1OwogICAgICAgIH0KICAgIH0KICAgIGh0dHBfcmVzcG9uc2VfZnJlZSh2ZXJpZnlfcmVzcCk7CiAgICAKICAgIHByaW50ZigiIC0gJWxsZCBtc1xuIiwgZHVyYXRpb24pOwogICAgCiAgICBpZiAocmVjb3JkX2NvdW50ID09IHRvdGFsX3N1Y2Nlc3MgJiYgdG90YWxfc3VjY2VzcyA+PSAoSFRUUF9USFJFQURfQ09VTlQgKiAyNSAqIDAuOSkpIHsKICAgICAgICBwcmludGYoIiAgWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdIEhUVFAgY29uY3VycmVuY3k6ICVkLyVkIHJlY29yZHNcbiIsIHJlY29yZF9jb3VudCwgdG90YWxfc3VjY2Vzcyk7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfQ09OQ1VSUkVOQ1ldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiICBbIiBSRUQgIkZBSUwiIFJFU0VUICJdIEV4cGVjdGVkICVkLCBnb3QgJWQgcmVjb3Jkc1xuIiwgCiAgICAgICAgICAgICAgIEhUVFBfVEhSRUFEX0NPVU5UICogMjUsIHJlY29yZF9jb3VudCk7CiAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX0NPTkNVUlJFTkNZXSsrOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIEhUVFAgQ29uY3VycmVuY3kgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBRVUVSWSBMQU5HVUFHRSBURVNUUyA9PT09PT09PT09PT09PT09PT09PQoKaW50IHJ1bl9xdWVyeV9sYW5ndWFnZV90ZXN0c19jbGkoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIlFVRVJZIExBTkdVQUdFICYgSU5ERVhJTkcgVEVTVFMgKENMSSkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJxdWVyeV90ZXN0XyVsZCIsIHRpbWUoTlVMTCkpOwogICAgCiAgICAvLyBTZXR1cCB3aXRoIGluZGV4ZWQgZmllbGRzCiAgICBjaGFyIHNldHVwX2NtZFs1MTJdOwogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgIiVzIGNyZWF0ZSAlcyA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICAKICAgIC8vIENyZWF0ZSBjb2xsZWN0aW9uIHdpdGggaW5kZXhlZCBmaWVsZHMKICAgIHNucHJpbnRmKHNldHVwX2NtZCwgc2l6ZW9mKHNldHVwX2NtZCksIAogICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nLXJlcS1pZHggLS1hZ2UtaW50LWlkeCAtLWVtYWlsLXN0cmluZyAtLXNhbGFyeS1mbG9hdCA+IC9kZXYvbnVsbCAyPiYxIiwgCiAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0oc2V0dXBfY21kKTsKICAgIAogICAgLy8gSW5zZXJ0IHRlc3QgZGF0YQogICAgZm9yIChpbnQgaSA9IDA7IGkgPCA1MDsgaSsrKSB7CiAgICAgICAgY2hhciBpbnNlcnRfY21kWzUxMl07CiAgICAgICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLWluc2VydC1vbmUgLS1uYW1lLVwiVXNlciVkXCIgLS1hZ2UtJWQgLS1lbWFpbC1cInVzZXIlZEB0ZXN0LmNvbVwiIC0tc2FsYXJ5LSUuMmYgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSwgaSwgMjAgKyAoaSAlIDMwKSwgaSwgMzAwMDAuMCArIGkgKiAxMDAwLjApOwogICAgICAgIHN5c3RlbShpbnNlcnRfY21kKTsKICAgIH0KICAgIAogICAgLy8gVEVTVCAxOiBFcXVhbGl0eSBxdWVyeSAoZXhpc3RpbmcgZnVuY3Rpb25hbGl0eSkKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDE6IEVxdWFsaXR5IHF1ZXJ5IC0gYWdlOjI1Iik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgY2hhciBxdWVyeV9jbWRbNTEyXTsKICAgIHNucHJpbnRmKHF1ZXJ5X2NtZCwgc2l6ZW9mKHF1ZXJ5X2NtZCksIAogICAgICAgICAgICAgIiVzIGZpbmQgJXMgdXNlcnMgLS13aGVyZSBcImFnZToyNVwiIHwgZ3JlcCAtYyBVc2VyIiwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgCiAgICBjaGFyIG91dHB1dFsyNTZdOwogICAgZXhlY3V0ZV9jb21tYW5kX2FuZF9jYXB0dXJlKHF1ZXJ5X2NtZCwgb3V0cHV0LCBzaXplb2Yob3V0cHV0KSk7CiAgICBpbnQgY291bnQgPSBhdG9pKG91dHB1dCk7CiAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoY291bnQgPiAwKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gRm91bmQgJWQgcmVjb3Jkc1xuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VULCBjb3VudCk7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfUVVFUlldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBObyByZXN1bHRzXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9RVUVSWV0rKzsKICAgIAogICAgLy8gVEVTVCAyOiBHcmVhdGVyIHRoYW4gcXVlcnkgKFNIT1VMRCBGQUlMIC0gZmVhdHVyZSBtaXNzaW5nKQogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlRFU1QgMjogR3JlYXRlciB0aGFuIHF1ZXJ5IC0gYWdlPjMwIChmZWF0dXJlIHRlc3QpIik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgLy8gVGhpcyBzaG91bGQgZmFpbCAtIFN5REIgZG9lc24ndCBzdXBwb3J0ID4gb3BlcmF0b3IKICAgIC8vIFdlJ3JlIHRlc3RpbmcgaWYgaXQgZmFpbHMgZ3JhY2VmdWxseQogICAgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICBzbnByaW50ZihxdWVyeV9jbWQsIHNpemVvZihxdWVyeV9jbWQpLCAKICAgICAgICAgICAgICIlcyBmaW5kICVzIHVzZXJzIC0td2hlcmUgXCJhZ2U+MzBcIiAyPiYxIHwgZ3JlcCAtaSAnZXJyb3JcXHxpbnZhbGlkJyIsIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIAogICAgaW50IGVycm9yX2RldGVjdGVkID0gKHN5c3RlbShxdWVyeV9jbWQpID09IDApOwogICAgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoZXJyb3JfZGV0ZWN0ZWQpIHsKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBVbnN1cHBvcnRlZCBvcGVyYXRvciBwcm9wZXJseSByZWplY3RlZFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9RVUVSWV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBZRUxMT1cgIldBUk4iIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtID4gb3BlcmF0b3Igbm90IHJlamVjdGVkIChtYXkgYmUgaW1wbGVtZW50ZWQ/KVxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9RVUVSWV0rKzsKICAgIAogICAgLy8gVEVTVCAzOiBMZXNzIHRoYW4gcXVlcnkKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDM6IExlc3MgdGhhbiBxdWVyeSAtIGFnZTwyNSAoZmVhdHVyZSB0ZXN0KSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgc25wcmludGYocXVlcnlfY21kLCBzaXplb2YocXVlcnlfY21kKSwgCiAgICAgICAgICAgICAiJXMgZmluZCAlcyB1c2VycyAtLXdoZXJlIFwiYWdlPDI1XCIgMj4mMSB8IGdyZXAgLWkgJ2Vycm9yXFx8aW52YWxpZCciLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAKICAgIGVycm9yX2RldGVjdGVkID0gKHN5c3RlbShxdWVyeV9jbWQpID09IDApOwogICAgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoZXJyb3JfZGV0ZWN0ZWQpIHsKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBVbnN1cHBvcnRlZCBvcGVyYXRvciBwcm9wZXJseSByZWplY3RlZFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9RVUVSWV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBZRUxMT1cgIldBUk4iIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIDwgb3BlcmF0b3Igbm90IHJlamVjdGVkXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1FVRVJZXSsrOwogICAgCiAgICAvLyBURVNUIDQ6IEFORCBxdWVyeSAoY29tbWEtc2VwYXJhdGVkIC0gZXhpc3RpbmcpCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCA0OiBBTkQgcXVlcnkgLSBhZ2U6MjUsbmFtZTpVc2VyMSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgc25wcmludGYocXVlcnlfY21kLCBzaXplb2YocXVlcnlfY21kKSwgCiAgICAgICAgICAgICAiJXMgZmluZCAlcyB1c2VycyAtLXdoZXJlIFwiYWdlOjI1LG5hbWU6VXNlcjFcIiB8IGdyZXAgLWMgVXNlcjEiLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAKICAgIGV4ZWN1dGVfY29tbWFuZF9hbmRfY2FwdHVyZShxdWVyeV9jbWQsIG91dHB1dCwgc2l6ZW9mKG91dHB1dCkpOwogICAgY291bnQgPSBhdG9pKG91dHB1dCk7CiAgICBkdXJhdGlvbiA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZHVyYXRpb247CiAgICAKICAgIC8vIFRoaXMgc2hvdWxkIGZpbmQgVXNlcjEgaWYgYWdlPTI1CiAgICBpZiAoY291bnQgPj0gMCkgeyAvLyBKdXN0IHZlcmlmeSBpdCBydW5zIHdpdGhvdXQgZXJyb3IKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBRdWVyeSBleGVjdXRlZFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9RVUVSWV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIFF1ZXJ5IGZhaWxlZFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBzdGF0cy5mYWlsZWRfdGVzdHMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1FVRVJZXSsrOwogICAgCiAgICAvLyBURVNUIDU6IE9SIHF1ZXJ5IChmZWF0dXJlIHRlc3QgLSBTSE9VTEQgRkFJTCkKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDU6IE9SIHF1ZXJ5IC0gYWdlOjI1IE9SIGFnZTozMCAoZmVhdHVyZSB0ZXN0KSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgc25wcmludGYocXVlcnlfY21kLCBzaXplb2YocXVlcnlfY21kKSwgCiAgICAgICAgICAgICAiJXMgZmluZCAlcyB1c2VycyAtLXdoZXJlIFwiYWdlOjI1IE9SIGFnZTozMFwiIDI+JjEgfCBncmVwIC1pICdlcnJvclxcfGludmFsaWQnIiwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgCiAgICBlcnJvcl9kZXRlY3RlZCA9IChzeXN0ZW0ocXVlcnlfY21kKSA9PSAwKTsKICAgIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgaWYgKGVycm9yX2RldGVjdGVkKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gVW5zdXBwb3J0ZWQgT1IgcHJvcGVybHkgcmVqZWN0ZWRcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfUVVFUlldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBPUiBvcGVyYXRvciBub3QgcmVqZWN0ZWRcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfUVVFUlldKys7CiAgICAKICAgIC8vIFRFU1QgNjogUmFuZ2UgcXVlcnkgKGZlYXR1cmUgdGVzdCkKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDY6IFJhbmdlIHF1ZXJ5IC0gYWdlOjI1LTM1IChmZWF0dXJlIHRlc3QpIik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICBzbnByaW50ZihxdWVyeV9jbWQsIHNpemVvZihxdWVyeV9jbWQpLCAKICAgICAgICAgICAgICIlcyBmaW5kICVzIHVzZXJzIC0td2hlcmUgXCJhZ2U6MjUtMzVcIiAyPiYxIHwgZ3JlcCAtaSAnZXJyb3JcXHxpbnZhbGlkJyIsIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIAogICAgZXJyb3JfZGV0ZWN0ZWQgPSAoc3lzdGVtKHF1ZXJ5X2NtZCkgPT0gMCk7CiAgICBkdXJhdGlvbiA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChlcnJvcl9kZXRlY3RlZCkgewogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIFVuc3VwcG9ydGVkIHJhbmdlIHByb3Blcmx5IHJlamVjdGVkXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1FVRVJZXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlsiIFlFTExPVyAiV0FSTiIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gUmFuZ2Ugb3BlcmF0b3Igbm90IHJlamVjdGVkXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1FVRVJZXSsrOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIFF1ZXJ5IGxhbmd1YWdlIHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKaW50IHJ1bl9xdWVyeV9sYW5ndWFnZV90ZXN0c19odHRwKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJRVUVSWSBMQU5HVUFHRSBURVNUUyAoSFRUUCkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJodHRwX3F1ZXJ5XyVsZCIsIHRpbWUoTlVMTCkpOwogICAgCiAgICAvLyBTZXR1cAogICAgY2hhciBjcmVhdGVfZGJfYm9keVsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2RiX2JvZHksIHNpemVvZihjcmVhdGVfZGJfYm9keSksICJ7XCJuYW1lXCI6XCIlc1wifSIsIGRiX25hbWUpOwogICAgSHR0cFJlc3BvbnNlKiByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiX2JvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfY29sbF91cmwsIHNpemVvZihjcmVhdGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCBkYl9uYW1lKTsKICAgIGNvbnN0IGNoYXIqIHNjaGVtYSA9ICJ7XCJuYW1lXCI6XCJ1c2Vyc1wiLFwic2NoZW1hXCI6WyIKICAgICAgICAie1wibmFtZVwiOlwibmFtZVwiLFwidHlwZVwiOlwic3RyaW5nXCIsXCJyZXF1aXJlZFwiOnRydWV9LCIKICAgICAgICAie1wibmFtZVwiOlwiYWdlXCIsXCJ0eXBlXCI6XCJpbnRcIn0sIgogICAgICAgICJ7XCJuYW1lXCI6XCJzYWxhcnlcIixcInR5cGVcIjpcImZsb2F0XCJ9XX0iOwogICAgcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsIGNyZWF0ZV9jb2xsX3VybCwgc2NoZW1hLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICBjaGFyIGluc3RhbmNlc191cmxbMjU2XTsKICAgIHNucHJpbnRmKGluc3RhbmNlc191cmwsIHNpemVvZihpbnN0YW5jZXNfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcyIsIGRiX25hbWUpOwogICAgCiAgICAvLyBJbnNlcnQgdGVzdCBkYXRhCiAgICBmb3IgKGludCBpID0gMDsgaSA8IDIwOyBpKyspIHsKICAgICAgICBjaGFyIHVzZXJfanNvblsyNTZdOwogICAgICAgIHNucHJpbnRmKHVzZXJfanNvbiwgc2l6ZW9mKHVzZXJfanNvbiksIAogICAgICAgICAgICAgICAgIntcIm5hbWVcIjpcIkhUVFBVc2VyJWRcIixcImFnZVwiOiVkLFwic2FsYXJ5XCI6JS4yZn0iLCAKICAgICAgICAgICAgICAgIGksIDIwICsgKGkgJSAyMCksIDMwMDAwLjAgKyBpICogMTAwMC4wKTsKICAgICAgICByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgaW5zdGFuY2VzX3VybCwgdXNlcl9qc29uLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwKTsKICAgIH0KICAgIAogICAgLy8gVEVTVDogRXF1YWxpdHkgcXVlcnkKICAgIHRvdGFsKys7CiAgICBjaGFyIHF1ZXJ5X3VybFs1MTJdOwogICAgc25wcmludGYocXVlcnlfdXJsLCBzaXplb2YocXVlcnlfdXJsKSwgCiAgICAgICAgICAgICAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzP3F1ZXJ5PWFnZToyNSIsIGRiX25hbWUpOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJIVFRQOiBFcXVhbGl0eSBxdWVyeSAtIGFnZToyNSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBxdWVyeV91cmwsIE5VTEwsICJcImluc3RhbmNlc1wiOiIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9RVUVSWSwgMCkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIAogICAgLy8gVEVTVDogTm9uLWV4aXN0ZW50IHZhbHVlCiAgICB0b3RhbCsrOwogICAgc25wcmludGYocXVlcnlfdXJsLCBzaXplb2YocXVlcnlfdXJsKSwgCiAgICAgICAgICAgICAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzP3F1ZXJ5PWFnZTo5OTkiLCBkYl9uYW1lKTsKICAgIAogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiSFRUUDogUXVlcnkgd2l0aCBubyBtYXRjaGVzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsIHF1ZXJ5X3VybCwgTlVMTCwgIlwiaW5zdGFuY2VzXCI6W10iLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfUVVFUlksIDApKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgSFRUUCBRdWVyeSB0ZXN0czogJWQvJWQgcGFzc2VkXG4iIFJFU0VULCBwYXNzZWQsIHRvdGFsKTsKICAgIHJldHVybiBwYXNzZWQ7Cn0KCi8vID09PT09PT09PT09PT09PT09PT09IFNDSEVNQSBFTkZPUkNFTUVOVCBURVNUUyA9PT09PT09PT09PT09PT09PT09PQoKaW50IHJ1bl9zY2hlbWFfZW5mb3JjZW1lbnRfdGVzdHNfY2xpKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJTQ0hFTUEgRU5GT1JDRU1FTlQgVEVTVFMgKENMSSkiIFJFU0VUICJcbiIpOwogICAgcHJpbnRmKFlFTExPVyAiVGhlc2UgdGVzdHMgdmVyaWZ5IHRoYXQgc2NoZW1hcyBhcmUgYWN0dWFsbHkgZW5mb3JjZWRcbiIgUkVTRVQpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJzY2hlbWFfdGVzdF8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAKICAgIGNoYXIgc2V0dXBfY21kWzUxMl07CiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAiJXMgY3JlYXRlICVzID4gL2Rldi9udWxsIDI+JjEiLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0oc2V0dXBfY21kKTsKICAgIAogICAgLy8gQ3JlYXRlIGNvbGxlY3Rpb24gd2l0aCBzdHJpY3Qgc2NoZW1hCiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAKICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZy1yZXEgLS1hZ2UtaW50IC0tZW1haWwtc3RyaW5nLXJlcSAtLWFjdGl2ZS1ib29sID4gL2Rldi9udWxsIDI+JjEiLCAKICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIHN5c3RlbShzZXR1cF9jbWQpOwogICAgCiAgICAvLyBURVNUIDE6IFZhbGlkIGluc2VydCAtIHNob3VsZCBwYXNzCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCAxOiBWYWxpZCBpbnNlcnQgLSBhbGwgcmVxdWlyZWQgZmllbGRzIik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgY2hhciBpbnNlcnRfY21kWzUxMl07CiAgICBzbnByaW50ZihpbnNlcnRfY21kLCBzaXplb2YoaW5zZXJ0X2NtZCksCiAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIlZhbGlkIFVzZXJcIiAtLWVtYWlsLVwidmFsaWRAdGVzdC5jb21cIiAtLWFnZS0zMCAtLWFjdGl2ZS10cnVlID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAKICAgIGludCByZXN1bHQgPSBzeXN0ZW0oaW5zZXJ0X2NtZCk7CiAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICBpbnQgY291bnQgPSBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihkYl9uYW1lLCAidXNlcnMiKTsKICAgIAogICAgaWYgKHJlc3VsdCA9PSAwICYmIGNvdW50ID49IDEpIHsKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfU0NIRU1BXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9TQ0hFTUFdKys7CiAgICAKICAgIC8vIFRFU1QgMjogTWlzc2luZyByZXF1aXJlZCBmaWVsZCAtIHNob3VsZCBGQUlMCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiVEVTVCAyOiBNaXNzaW5nIHJlcXVpcmVkIGZpZWxkICduYW1lJyAoc2hvdWxkIGJlIHJlamVjdGVkKSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLWVtYWlsLVwibWlzc2luZ0B0ZXN0LmNvbVwiIC0tYWdlLTMwID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAKICAgIHJlc3VsdCA9IHN5c3RlbShpbnNlcnRfY21kKTsKICAgIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgLy8gU2hvdWxkIGZhaWwgLSByZXF1aXJlZCBmaWVsZCBtaXNzaW5nCiAgICBpZiAocmVzdWx0ICE9IDApIHsKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBDb3JyZWN0bHkgcmVqZWN0ZWRcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfU0NIRU1BXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gQWNjZXB0ZWQgaW5zZXJ0IHdpdGggbWlzc2luZyByZXF1aXJlZCBmaWVsZCFcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1NDSEVNQV0rKzsKICAgIAogICAgLy8gVEVTVCAzOiBXcm9uZyB0eXBlIC0gc3RyaW5nIGZvciBpbnQgZmllbGQgLSBzaG91bGQgRkFJTAogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlRFU1QgMzogV3JvbmcgdHlwZSAtIHN0cmluZyBmb3IgYWdlIChzaG91bGQgYmUgcmVqZWN0ZWQpIik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICBzbnByaW50ZihpbnNlcnRfY21kLCBzaXplb2YoaW5zZXJ0X2NtZCksCiAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIlR5cGUgVGVzdFwiIC0tZW1haWwtXCJ0eXBlQHRlc3QuY29tXCIgLS1hZ2UtXCJ0aGlydHlcIiAtLWFjdGl2ZS10cnVlID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICAKICAgIHJlc3VsdCA9IHN5c3RlbShpbnNlcnRfY21kKTsKICAgIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgaWYgKHJlc3VsdCAhPSAwKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gQ29ycmVjdGx5IHJlamVjdGVkXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1NDSEVNQV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIEFjY2VwdGVkIHN0cmluZyBmb3IgaW50ZWdlciBmaWVsZCFcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1NDSEVNQV0rKzsKICAgIAogICAgLy8gVEVTVCA0OiBFeHRyYSBmaWVsZCBub3QgaW4gc2NoZW1hIC0gc2hvdWxkIHRoaXMgYmUgYWxsb3dlZD8KICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJURVNUIDQ6IEV4dHJhIGZpZWxkIG5vdCBpbiBzY2hlbWEgKGRvY3VtZW50IGZsZXhpYmlsaXR5KSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJFeHRyYSBGaWVsZFwiIC0tZW1haWwtXCJleHRyYUB0ZXN0LmNvbVwiIC0tYWdlLTI1IC0tYWN0aXZlLXRydWUgLS1leHRyYS1cInNob3VsZCB0aGlzIGJlIGFsbG93ZWQ/XCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIAogICAgcmVzdWx0ID0gc3lzdGVtKGluc2VydF9jbWQpOwogICAgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICAvLyBEb2N1bWVudCBkYXRhYmFzZXMgdHlwaWNhbGx5IGFsbG93IGV4dHJhIGZpZWxkcwogICAgLy8gVGhpcyBpcyBhIGRlc2lnbiBjaG9pY2UsIG5vdCBhIGJ1ZwogICAgaWYgKHJlc3VsdCA9PSAwKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gRXh0cmEgZmllbGRzIGFsbG93ZWQgKGRvY3VtZW50IG1vZGVsKVxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9TQ0hFTUFdKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBFeHRyYSBmaWVsZHMgcmVqZWN0ZWQgKHN0cmljdCBzY2hlbWEpXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIC8vIE5vdCBtYXJraW5nIGFzIGZhaWwgLSB0aGlzIGlzIGEgZGVzaWduIGRlY2lzaW9uCiAgICAgICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfU0NIRU1BXSsrOwogICAgCiAgICAvLyBURVNUIDU6IEJvb2xlYW4gdmFsaWRhdGlvbgogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlRFU1QgNTogSW52YWxpZCBib29sZWFuIHZhbHVlIC0gc2hvdWxkIGJlIHRydWUvZmFsc2UiKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwKICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLWluc2VydC1vbmUgLS1uYW1lLVwiQm9vbCBUZXN0XCIgLS1lbWFpbC1cImJvb2xAdGVzdC5jb21cIiAtLWFnZS0yNSAtLWFjdGl2ZS15ZXMgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIAogICAgcmVzdWx0ID0gc3lzdGVtKGluc2VydF9jbWQpOwogICAgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAocmVzdWx0ICE9IDApIHsKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBDb3JyZWN0bHkgcmVqZWN0ZWQgaW52YWxpZCBib29sZWFuXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1NDSEVNQV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIEFjY2VwdGVkIGludmFsaWQgYm9vbGVhbiAneWVzJ1xuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBzdGF0cy5mYWlsZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfU0NIRU1BXSsrOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIFNjaGVtYSBlbmZvcmNlbWVudCB0ZXN0czogJWQvJWQgcGFzc2VkXG4iIFJFU0VULCBwYXNzZWQsIHRvdGFsKTsKICAgIHJldHVybiBwYXNzZWQ7Cn0KCmludCBydW5fc2NoZW1hX2VuZm9yY2VtZW50X3Rlc3RzX2h0dHAoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIlNDSEVNQSBFTkZPUkNFTUVOVCBURVNUUyAoSFRUUCkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJodHRwX3NjaGVtYV8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMjU2XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCBkYl9uYW1lKTsKICAgIEh0dHBSZXNwb25zZSogcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsIGNyZWF0ZV9kYl9ib2R5LCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICBjaGFyIGNyZWF0ZV9jb2xsX3VybFsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2NvbGxfdXJsLCBzaXplb2YoY3JlYXRlX2NvbGxfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zIiwgZGJfbmFtZSk7CiAgICBjb25zdCBjaGFyKiBzY2hlbWEgPSAie1wibmFtZVwiOlwidXNlcnNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjp0cnVlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImFnZVwiLFwidHlwZVwiOlwiaW50XCIsXCJyZXF1aXJlZFwiOnRydWV9LCIKICAgICAgICAie1wibmFtZVwiOlwiZW1haWxcIixcInR5cGVcIjpcInN0cmluZ1wifV19IjsKICAgIHJlc3AgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCBjcmVhdGVfY29sbF91cmwsIHNjaGVtYSwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwKTsKICAgIAogICAgY2hhciBpbnN0YW5jZXNfdXJsWzI1Nl07CiAgICBzbnByaW50ZihpbnN0YW5jZXNfdXJsLCBzaXplb2YoaW5zdGFuY2VzX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9pbnN0YW5jZXMiLCBkYl9uYW1lKTsKICAgIAogICAgLy8gVEVTVCAxOiBWYWxpZCBpbnNlcnQKICAgIHRvdGFsKys7CiAgICBjb25zdCBjaGFyKiB2YWxpZF91c2VyID0gIntcIm5hbWVcIjpcIlZhbGlkIFVzZXJcIixcImFnZVwiOjMwLFwiZW1haWxcIjpcInZhbGlkQHRlc3QuY29tXCJ9IjsKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkhUVFA6IFZhbGlkIGluc2VydCAtIHNob3VsZCBzdWNjZWVkIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCBpbnN0YW5jZXNfdXJsLCB2YWxpZF91c2VyLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TQ0hFTUEsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICAKICAgIC8vIFRFU1QgMjogTWlzc2luZyByZXF1aXJlZCBmaWVsZCAtIHNob3VsZCBGQUlMCiAgICB0b3RhbCsrOwogICAgY29uc3QgY2hhciogbWlzc2luZ19uYW1lID0gIntcImFnZVwiOjMwLFwiZW1haWxcIjpcIm1pc3NpbmdAdGVzdC5jb21cIn0iOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiSFRUUDogTWlzc2luZyByZXF1aXJlZCBmaWVsZCAnbmFtZScgLSBzaG91bGQgZmFpbCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgaW5zdGFuY2VzX3VybCwgbWlzc2luZ19uYW1lLCAiXCJzdWNjZXNzXCI6ZmFsc2UiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU0NIRU1BLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgCiAgICAvLyBURVNUIDM6IFdyb25nIHR5cGUgLSBzaG91bGQgRkFJTAogICAgdG90YWwrKzsKICAgIGNvbnN0IGNoYXIqIHdyb25nX3R5cGUgPSAie1wibmFtZVwiOlwiVHlwZSBUZXN0XCIsXCJhZ2VcIjpcInRoaXJ0eVwiLFwiZW1haWxcIjpcInR5cGVAdGVzdC5jb21cIn0iOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiSFRUUDogV3JvbmcgdHlwZSAoc3RyaW5nIGZvciBpbnQpIC0gc2hvdWxkIGZhaWwiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsIGluc3RhbmNlc191cmwsIHdyb25nX3R5cGUsICJcInN1Y2Nlc3NcIjpmYWxzZSIsIDEsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TQ0hFTUEsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgSFRUUCBTY2hlbWEgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBTRUNVUklUWSBURVNUUyAoRU5IQU5DRUQpID09PT09PT09PT09PT09PT09PT09CgppbnQgcnVuX3NlY3VyaXR5X3Rlc3RzX2NsaSgpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgQk9MRCAiU0VDVVJJVFkgJiBJTkpFQ1RJT04gVEVTVFMgKENMSSkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIFRlc3RDYXNlIHNlY3VyaXR5X3Rlc3RzW10gPSB7CiAgICAgICAgewogICAgICAgICAgICAiRGlyZWN0b3J5IHRyYXZlcnNhbCBwcmV2ZW50aW9uIC0gZGF0YWJhc2UgbmFtZSIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgJy4uL2V2aWwnIDI+JjEgfCBncmVwIC1pICdpbnZhbGlkXFx8ZXJyb3InID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgInRlc3QgISAtZCAnL3RtcC9zeWRiX3Rlc3QvLi4vZXZpbCciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9TRUNVUklUWSwgMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiRGlyZWN0b3J5IHRyYXZlcnNhbCBwcmV2ZW50aW9uIC0gY29sbGVjdGlvbiBuYW1lIiwgCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiICcuLi8uLi9ldmlsJyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nIDI+JjEgfCBncmVwIC1pICdpbnZhbGlkXFx8ZXJyb3InID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgInRlc3QgISAtZCAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiLy4uLy4uL2V2aWwnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU0VDVVJJVFksIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlNwZWNpYWwgY2hhcmFjdGVycyBpbiBkYXRhYmFzZSBuYW1lcyAtIHJlamVjdGlvbiIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgJ2ludmFsaWQvbmFtZScgMj4mMSB8IGdyZXAgLWkgJ2ludmFsaWRcXHxlcnJvcicgPiAvZGV2L251bGwiLAogICAgICAgICAgICAidGVzdCAhIC1kICcvdG1wL3N5ZGJfdGVzdC9pbnZhbGlkL25hbWUnIiwgCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NFQ1VSSVRZLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJDb21tYW5kIGluamVjdGlvbiBhdHRlbXB0IC0gc2VtaWNvbG9uIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSAndGVzdDsgcm0gLXJmIC8nIDI+JjEgfCBncmVwIC1pICdpbnZhbGlkXFx8ZXJyb3InID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgImVjaG8gJ0luamVjdGlvbiBwcmV2ZW50ZWQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU0VDVVJJVFksIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkNvbW1hbmQgaW5qZWN0aW9uIGF0dGVtcHQgLSBiYWNrdGlja3MiLAogICAgICAgICAgICAiJXMgY3JlYXRlICd0ZXN0YGlkYCcgMj4mMSB8IGdyZXAgLWkgJ2ludmFsaWRcXHxlcnJvcicgPiAvZGV2L251bGwiLCAKICAgICAgICAgICAgImVjaG8gJ0luamVjdGlvbiBwcmV2ZW50ZWQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU0VDVVJJVFksIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlNRTC1saWtlIGluamVjdGlvbiBpbiBxdWVyeSIsCiAgICAgICAgICAgICIlcyBmaW5kIHRlc3RkYiB1c2VycyAtLXdoZXJlIFwibmFtZTonIE9SIDE9MS0tXCIgMj4mMSB8IGdyZXAgLWkgJ2Vycm9yXFx8aW52YWxpZCcgPiAvZGV2L251bGwiLAogICAgICAgICAgICAiZWNobyAnSW5qZWN0aW9uIGhhbmRsZWQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU0VDVVJJVFksIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlZlcnkgbG9uZyBuYW1lIC0gYnVmZmVyIG92ZXJmbG93IHByb3RlY3Rpb24iLAogICAgICAgICAgICAiJXMgY3JlYXRlIGFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhIDI+JjEgfCBncmVwIC1pICdpbnZhbGlkXFx8ZXJyb3InID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgImVjaG8gJ0xvbmcgbmFtZSByZWplY3RlZCciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9TRUNVUklUWSwgMQogICAgICAgIH0KICAgIH07CiAgICAKICAgIGludCBzZWN1cml0eV9jb3VudCA9IHNpemVvZihzZWN1cml0eV90ZXN0cykgLyBzaXplb2Yoc2VjdXJpdHlfdGVzdHNbMF0pOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlY3VyaXR5X2NvdW50OyBpKyspIHsKICAgICAgICB0b3RhbCsrOwogICAgICAgIAogICAgICAgIGNoYXIgZmluYWxfY29tbWFuZFsxMDI0XTsKICAgICAgICBjaGFyIGZpbmFsX3ZlcmlmaWNhdGlvblsxMDI0XTsKICAgICAgICAKICAgICAgICBzbnByaW50ZihmaW5hbF9jb21tYW5kLCBzaXplb2YoZmluYWxfY29tbWFuZCksIHNlY3VyaXR5X3Rlc3RzW2ldLmNvbW1hbmQsIGNsaV9jb21tYW5kKTsKICAgICAgICBzbnByaW50ZihmaW5hbF92ZXJpZmljYXRpb24sIHNpemVvZihmaW5hbF92ZXJpZmljYXRpb24pLCBzZWN1cml0eV90ZXN0c1tpXS52ZXJpZmljYXRpb25fY29tbWFuZCwgY2xpX2NvbW1hbmQpOwogICAgICAgIAogICAgICAgIHN0cmNweShzZWN1cml0eV90ZXN0c1tpXS5jb21tYW5kLCBmaW5hbF9jb21tYW5kKTsKICAgICAgICBzdHJjcHkoc2VjdXJpdHlfdGVzdHNbaV0udmVyaWZpY2F0aW9uX2NvbW1hbmQsIGZpbmFsX3ZlcmlmaWNhdGlvbik7CiAgICAgICAgCiAgICAgICAgaWYgKGV4ZWN1dGVfdGVzdF93aXRoX3ZlcmlmaWNhdGlvbigmc2VjdXJpdHlfdGVzdHNbaV0pKSB7CiAgICAgICAgICAgIHBhc3NlZCsrOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBTZWN1cml0eSB0ZXN0czogJWQvJWQgcGFzc2VkXG4iIFJFU0VULCBwYXNzZWQsIHRvdGFsKTsKICAgIHJldHVybiBwYXNzZWQ7Cn0KCmludCBydW5fc2VjdXJpdHlfdGVzdHNfaHR0cCgpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgQk9MRCAiU0VDVVJJVFkgJiBJTkpFQ1RJT04gVEVTVFMgKEhUVFApIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgbG9uZyBsb25nIGR1cmF0aW9uOwogICAgCiAgICAvLyBUZXN0IDE6IFNRTCBpbmplY3Rpb24gaW4gcXVlcnkgcGFyYW1ldGVyCiAgICB0b3RhbCsrOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiSFRUUDogU1FMIGluamVjdGlvbiBhdHRlbXB0IGluIHF1ZXJ5IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsICIvYXBpL2RhdGFiYXNlcy90ZXN0ZGIvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzP3F1ZXJ5PW5hbWU6JyBPUiAxPTEtLSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwsICJcInN1Y2Nlc3NcIjoiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU0VDVVJJVFksIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICAKICAgIC8vIFRlc3QgMjogSlNPTiBpbmplY3Rpb24gaW4gYm9keQogICAgdG90YWwrKzsKICAgIGNvbnN0IGNoYXIqIGpzb25faW5qZWN0aW9uID0gIntcIm5hbWVcIjpcIlxcXCJ9LCBcIm1hbGljaW91c1wiOiB0cnVlLCBcImFnZVwiOjMwfSI7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJIVFRQOiBKU09OIGluamVjdGlvbiBhdHRlbXB0IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBqc29uX2luamVjdGlvbiwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NFQ1VSSVRZLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgCiAgICAvLyBUZXN0IDM6IFBhdGggdHJhdmVyc2FsCiAgICB0b3RhbCsrOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiSFRUUDogUGF0aCB0cmF2ZXJzYWwgYXR0ZW1wdCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCAiL2FwaS9kYXRhYmFzZXMvLi4vZXRjL3Bhc3N3ZCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgIE5VTEwsICJcInN1Y2Nlc3NcIjpmYWxzZSIsIDEsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TRUNVUklUWSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIAogICAgLy8gVGVzdCA0OiBWZXJ5IGxvbmcgVVJMCiAgICB0b3RhbCsrOwogICAgY2hhciBsb25nX3VybFsyMDQ4XSA9ICIvYXBpL2RhdGFiYXNlcy8iOwogICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDA7IGkrKykgewogICAgICAgIHN0cmNhdChsb25nX3VybCwgImFhYWFhYWFhYWEiKTsKICAgIH0KICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkhUVFA6IFZlcnkgbG9uZyBVUkwgKGJ1ZmZlciBvdmVyZmxvdyB0ZXN0KSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBsb25nX3VybCwgTlVMTCwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NFQ1VSSVRZLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgCiAgICAvLyBUZXN0IDU6IEludmFsaWQgSlNPTgogICAgdG90YWwrKzsKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkhUVFA6IE1hbGZvcm1lZCBKU09OIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCAie25hbWU6IHRlc3R9IiwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NFQ1VSSVRZLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgCiAgICBwcmludGYoWUVMTE9XICIgIEhUVFAgU2VjdXJpdHkgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBQRVJGT1JNQU5DRSBURVNUUyA9PT09PT09PT09PT09PT09PT09PQoKaW50IHJ1bl9wZXJmb3JtYW5jZV90ZXN0c19jbGkoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIlBFUkZPUk1BTkNFICYgU0NBTEFCSUxJVFkgVEVTVFMgKENMSSkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJwZXJmX3Rlc3RfJWxkIiwgdGltZShOVUxMKSk7CiAgICAKICAgIC8vIFNldHVwCiAgICBjaGFyIHNldHVwX2NtZFs1MTJdOwogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgIiVzIGNyZWF0ZSAlcyA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAKICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZyAtLWFnZS1pbnQgPiAvZGV2L251bGwgMj4mMSIsIAogICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICAKICAgIC8vIFRFU1QgMTogU2luZ2xlIGluc2VydCBwZXJmb3JtYW5jZQogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlBFUkYgMTogU2luZ2xlIGluc2VydCBsYXRlbmN5Iik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgY2hhciBpbnNlcnRfY21kWzUxMl07CiAgICBzbnByaW50ZihpbnNlcnRfY21kLCBzaXplb2YoaW5zZXJ0X2NtZCksCiAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIlBlcmYgVXNlclwiIC0tYWdlLTMwID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0oaW5zZXJ0X2NtZCk7CiAgICBsb25nIGxvbmcgc2luZ2xlX3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IHNpbmdsZV90aW1lOwogICAgCiAgICBwcmludGYoIiAtICVsbGQgbXNcbiIsIHNpbmdsZV90aW1lKTsKICAgIAogICAgaWYgKHNpbmdsZV90aW1lIDwgMTAwKSB7CiAgICAgICAgcHJpbnRmKCIgIFsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSBJbnNlcnQgbGF0ZW5jeTogJWxsZCBtc1xuIiwgc2luZ2xlX3RpbWUpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1BFUkZPUk1BTkNFXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIiAgWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSBJbnNlcnQgbGF0ZW5jeSBoaWdoOiAlbGxkIG1zXG4iLCBzaW5nbGVfdGltZSk7CiAgICAgICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfUEVSRk9STUFOQ0VdKys7CiAgICAKICAgIC8vIFRFU1QgMjogQmF0Y2ggaW5zZXJ0IHBlcmZvcm1hbmNlCiAgICBpZiAodGVzdF9sZXZlbCA+PSAxKSB7CiAgICAgICAgdG90YWwrKzsKICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJQRVJGIDI6IEJhdGNoIGluc2VydCAtIDEwMCByZWNvcmRzIik7CiAgICAgICAgZmZsdXNoKHN0ZG91dCk7CiAgICAgICAgCiAgICAgICAgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAgICAgaW50IHN1Y2Nlc3NfY291bnQgPSAwOwogICAgICAgIAogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwOyBpKyspIHsKICAgICAgICAgICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIkJhdGNoVXNlciVkXCIgLS1hZ2UtJWQgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUsIGksIDIwICsgKGkgJSA1MCkpOwogICAgICAgICAgICBpZiAoc3lzdGVtKGluc2VydF9jbWQpID09IDApIHN1Y2Nlc3NfY291bnQrKzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbG9uZyBsb25nIGJhdGNoX3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgICAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBiYXRjaF90aW1lOwogICAgICAgIGRvdWJsZSBhdmdfdGltZSA9IChkb3VibGUpYmF0Y2hfdGltZSAvIHN1Y2Nlc3NfY291bnQ7CiAgICAgICAgCiAgICAgICAgcHJpbnRmKCIgLSAlbGxkIG1zIChhdmc6ICUuMmYgbXMvb3ApXG4iLCBiYXRjaF90aW1lLCBhdmdfdGltZSk7CiAgICAgICAgCiAgICAgICAgaWYgKHN1Y2Nlc3NfY291bnQgPj0gOTUpIHsKICAgICAgICAgICAgcHJpbnRmKCIgIFsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlZC8xMDAgaW5zZXJ0cywgYXZnICUuMmYgbXNcbiIsIHN1Y2Nlc3NfY291bnQsIGF2Z190aW1lKTsKICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9QRVJGT1JNQU5DRV0rKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmludGYoIiAgWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSBPbmx5ICVkLzEwMCBpbnNlcnRzIHN1Y2NlZWRlZFxuIiwgc3VjY2Vzc19jb3VudCk7CiAgICAgICAgICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgICAgICB9CiAgICAgICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1BFUkZPUk1BTkNFXSsrOwogICAgfQogICAgCiAgICAvLyBURVNUIDM6IFF1ZXJ5IHBlcmZvcm1hbmNlCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiUEVSRiAzOiBRdWVyeSBwZXJmb3JtYW5jZSAtIGV4YWN0IG1hdGNoIik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICBjaGFyIHF1ZXJ5X2NtZFs1MTJdOwogICAgc25wcmludGYocXVlcnlfY21kLCBzaXplb2YocXVlcnlfY21kKSwKICAgICAgICAgICAgIiVzIGZpbmQgJXMgdXNlcnMgLS13aGVyZSBcImFnZTozMFwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0ocXVlcnlfY21kKTsKICAgIGxvbmcgbG9uZyBxdWVyeV90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBxdWVyeV90aW1lOwogICAgCiAgICBwcmludGYoIiAtICVsbGQgbXNcbiIsIHF1ZXJ5X3RpbWUpOwogICAgCiAgICBpZiAocXVlcnlfdGltZSA8IDIwMCkgewogICAgICAgIHByaW50ZigiICBbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gUXVlcnkgdGltZTogJWxsZCBtc1xuIiwgcXVlcnlfdGltZSk7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfUEVSRk9STUFOQ0VdKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiICBbIiBZRUxMT1cgIldBUk4iIFJFU0VUICJdIFF1ZXJ5IHRpbWUgaGlnaDogJWxsZCBtc1xuIiwgcXVlcnlfdGltZSk7CiAgICAgICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfUEVSRk9STUFOQ0VdKys7CiAgICAKICAgIC8vIFRFU1QgNDogTGFyZ2UgZGF0YXNldCBwZXJmb3JtYW5jZQogICAgaWYgKHRlc3RfbGV2ZWwgPj0gMikgewogICAgICAgIHRvdGFsKys7CiAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiUEVSRiA0OiBMYXJnZSBkYXRhc2V0IC0gMTAwMCByZWNvcmRzIik7CiAgICAgICAgZmZsdXNoKHN0ZG91dCk7CiAgICAgICAgCiAgICAgICAgc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAgICAgCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHsKICAgICAgICAgICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIkxhcmdlVXNlciVkXCIgLS1hZ2UtJWQgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUsIGksIDIwICsgKGkgJSA1MCkpOwogICAgICAgICAgICBzeXN0ZW0oaW5zZXJ0X2NtZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoaSAlIDEwMCA9PSAwKSB7CiAgICAgICAgICAgICAgICBwcmludGYoIi4iKTsKICAgICAgICAgICAgICAgIGZmbHVzaChzdGRvdXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxvbmcgbG9uZyBsYXJnZV90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICAgICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gbGFyZ2VfdGltZTsKICAgICAgICAKICAgICAgICBpbnQgZmluYWxfY291bnQgPSBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihkYl9uYW1lLCAidXNlcnMiKTsKICAgICAgICAKICAgICAgICBwcmludGYoIiAtICVsbGQgbXMsICVkIHJlY29yZHNcbiIsIGxhcmdlX3RpbWUsIGZpbmFsX2NvdW50KTsKICAgICAgICAKICAgICAgICBpZiAoZmluYWxfY291bnQgPj0gMTAwMCkgewogICAgICAgICAgICBwcmludGYoIiAgWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdIEFsbCAxMDAwIHJlY29yZHMgaW5zZXJ0ZWRcbiIpOwogICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1BFUkZPUk1BTkNFXSsrOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHByaW50ZigiICBbIiBSRUQgIkZBSUwiIFJFU0VUICJdIE9ubHkgJWQvMTAwMCByZWNvcmRzIGluc2VydGVkXG4iLCBmaW5hbF9jb3VudCk7CiAgICAgICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgIH0KICAgICAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfUEVSRk9STUFOQ0VdKys7CiAgICB9CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgUGVyZm9ybWFuY2UgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgppbnQgcnVuX3BlcmZvcm1hbmNlX3Rlc3RzX2h0dHAoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIlBFUkZPUk1BTkNFIFRFU1RTIChIVFRQKSIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIAogICAgaWYgKHRlc3RfbGV2ZWwgPCAxKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBTa2lwcGluZyBIVFRQIHBlcmZvcm1hbmNlIHRlc3RzICh1c2UgLS1sZXZlbD0xIG9yIGhpZ2hlcilcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgCiAgICBjaGFyIGRiX25hbWVbNjRdOwogICAgc25wcmludGYoZGJfbmFtZSwgc2l6ZW9mKGRiX25hbWUpLCAiaHR0cF9wZXJmXyVsZCIsIHRpbWUoTlVMTCkpOwogICAgCiAgICAvLyBTZXR1cAogICAgY2hhciBjcmVhdGVfZGJfYm9keVsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2RiX2JvZHksIHNpemVvZihjcmVhdGVfZGJfYm9keSksICJ7XCJuYW1lXCI6XCIlc1wifSIsIGRiX25hbWUpOwogICAgSHR0cFJlc3BvbnNlKiByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiX2JvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfY29sbF91cmwsIHNpemVvZihjcmVhdGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCBkYl9uYW1lKTsKICAgIGNvbnN0IGNoYXIqIHNjaGVtYSA9ICJ7XCJuYW1lXCI6XCJ1c2Vyc1wiLFwic2NoZW1hXCI6WyIKICAgICAgICAie1wibmFtZVwiOlwibmFtZVwiLFwidHlwZVwiOlwic3RyaW5nXCJ9LCIKICAgICAgICAie1wibmFtZVwiOlwiYWdlXCIsXCJ0eXBlXCI6XCJpbnRcIn1dfSI7CiAgICByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgY3JlYXRlX2NvbGxfdXJsLCBzY2hlbWEsICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIGNoYXIgaW5zdGFuY2VzX3VybFsyNTZdOwogICAgc25wcmludGYoaW5zdGFuY2VzX3VybCwgc2l6ZW9mKGluc3RhbmNlc191cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzIiwgZGJfbmFtZSk7CiAgICAKICAgIC8vIFRFU1Q6IEhUVFAgaW5zZXJ0IGxhdGVuY3kKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJIVFRQIFBFUkY6IEluc2VydCBsYXRlbmN5ICgxMCBpbnNlcnRzKSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIGludCBzdWNjZXNzX2NvdW50ID0gMDsKICAgIAogICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgY2hhciB1c2VyX2pzb25bMjU2XTsKICAgICAgICBzbnByaW50Zih1c2VyX2pzb24sIHNpemVvZih1c2VyX2pzb24pLCAie1wibmFtZVwiOlwiUGVyZlVzZXIlZFwiLFwiYWdlXCI6JWR9IiwgaSwgMjAgKyBpKTsKICAgICAgICBIdHRwUmVzcG9uc2UqIHIgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCBpbnN0YW5jZXNfdXJsLCB1c2VyX2pzb24sICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICAgICAgaWYgKHIgJiYgci0+c3RhdHVzX2NvZGUgPj0gMjAwICYmIHItPnN0YXR1c19jb2RlIDwgMzAwKSBzdWNjZXNzX2NvdW50Kys7CiAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKHIpOwogICAgfQogICAgCiAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgZG91YmxlIGF2Z190aW1lID0gKGRvdWJsZSlkdXJhdGlvbiAvIHN1Y2Nlc3NfY291bnQ7CiAgICAKICAgIHByaW50ZigiIC0gJWxsZCBtcyAoYXZnOiAlLjJmIG1zL29wKVxuIiwgZHVyYXRpb24sIGF2Z190aW1lKTsKICAgIAogICAgaWYgKHN1Y2Nlc3NfY291bnQgPj0gOSkgewogICAgICAgIHByaW50ZigiICBbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gSFRUUCBpbnNlcnQgbGF0ZW5jeTogJS4yZiBtc1xuIiwgYXZnX3RpbWUpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1BFUkZPUk1BTkNFXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIiAgWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSBPbmx5ICVkLzEwIGluc2VydHMgc3VjY2VlZGVkXG4iLCBzdWNjZXNzX2NvdW50KTsKICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9QRVJGT1JNQU5DRV0rKzsKICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBIVFRQIFBlcmZvcm1hbmNlIHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gREFUQSBJTlRFR1JJVFkgVEVTVFMgPT09PT09PT09PT09PT09PT09PT0KCmludCBydW5faW50ZWdyaXR5X3Rlc3RzX2NsaSgpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgQk9MRCAiREFUQSBJTlRFR1JJVFkgVEVTVFMgKENMSSkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJpbnRlZ3JpdHlfdGVzdF8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAKICAgIGNoYXIgc2V0dXBfY21kWzUxMl07CiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAiJXMgY3JlYXRlICVzID4gL2Rldi9udWxsIDI+JjEiLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0oc2V0dXBfY21kKTsKICAgIHNucHJpbnRmKHNldHVwX2NtZCwgc2l6ZW9mKHNldHVwX2NtZCksIAogICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyBkYXRhIC0tc2NoZW1hIC0tdmFsdWUtc3RyaW5nID4gL2Rldi9udWxsIDI+JjEiLCAKICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIHN5c3RlbShzZXR1cF9jbWQpOwogICAgCiAgICBjaGFyIGluc2VydF9jbWRbNTEyXTsKICAgIAogICAgLy8gSW5zZXJ0IHNvbWUgZGF0YQogICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyBkYXRhIC0taW5zZXJ0LW9uZSAtLXZhbHVlLVwidGVzdF9kYXRhXyVkXCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSwgaSk7CiAgICAgICAgc3lzdGVtKGluc2VydF9jbWQpOwogICAgfQogICAgCiAgICAvLyBURVNUIDE6IEZpbGUgaGVhZGVyIHZlcmlmaWNhdGlvbgogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIklOVEVHUklUWSAxOiBEYXRhIGZpbGUgaGVhZGVyIHZlcmlmaWNhdGlvbiIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGNoYXIgZGF0YV9wYXRoWzUxMl07CiAgICBzbnByaW50ZihkYXRhX3BhdGgsIHNpemVvZihkYXRhX3BhdGgpLCAiL3RtcC9zeWRiX3Rlc3QvJXMvZGF0YS9kYXRhLnN5ZGIiLCBkYl9uYW1lKTsKICAgIAogICAgbG9uZyBsb25nIHN0YXJ0ID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgCiAgICBjaGFyIGhleGR1bXBfY21kWzUxMl07CiAgICBzbnByaW50ZihoZXhkdW1wX2NtZCwgc2l6ZW9mKGhleGR1bXBfY21kKSwgCiAgICAgICAgICAgICAiaGV4ZHVtcCAtQyAlcyB8IGhlYWQgLTEgfCBncmVwIC1xICc1MyA1OSA0NCA0MicgMj4vZGV2L251bGwiLCBkYXRhX3BhdGgpOwogICAgCiAgICBpbnQgaGVhZGVyX29rID0gKHN5c3RlbShoZXhkdW1wX2NtZCkgPT0gMCk7CiAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoaGVhZGVyX29rKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzIC0gVmFsaWQgaGVhZGVyIGZvdW5kXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX0lOVEVHUklUWV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIEludmFsaWQgaGVhZGVyXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9JTlRFR1JJVFldKys7CiAgICAKICAgIC8vIFRFU1QgMjogUmVjb3JkIGNvdW50IG1hdGNoZXMgaGVhZGVyCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiSU5URUdSSVRZIDI6IFJlY29yZCBjb3VudCB2ZXJpZmljYXRpb24iKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgY2hhciBjb3VudF9jbWRbNTEyXTsKICAgIHNucHJpbnRmKGNvdW50X2NtZCwgc2l6ZW9mKGNvdW50X2NtZCksCiAgICAgICAgICAgICAiZGQgaWY9JXMgYnM9MSBza2lwPTggY291bnQ9OCAyPi9kZXYvbnVsbCB8IGhleGR1bXAgLWUgJzEvOCBcIiUldVwiJyAyPi9kZXYvbnVsbCIsIGRhdGFfcGF0aCk7CiAgICAKICAgIGNoYXIgaGVhZGVyX2NvdW50WzY0XSA9ICIwIjsKICAgIEZJTEUgKmZwID0gcG9wZW4oY291bnRfY21kLCAiciIpOwogICAgaWYgKGZwKSB7CiAgICAgICAgaWYgKGZnZXRzKGhlYWRlcl9jb3VudCwgc2l6ZW9mKGhlYWRlcl9jb3VudCksIGZwKSkgewogICAgICAgICAgICBoZWFkZXJfY291bnRbc3RyY3NwbihoZWFkZXJfY291bnQsICJcbiIpXSA9ICdcMCc7CiAgICAgICAgfQogICAgICAgIHBjbG9zZShmcCk7CiAgICB9CiAgICAKICAgIGludCBhY3R1YWxfY291bnQgPSBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihkYl9uYW1lLCAiZGF0YSIpOwogICAgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICBpbnQgaGVhZGVyX2NvdW50X3ZhbCA9IGF0b2koaGVhZGVyX2NvdW50KTsKICAgIAogICAgaWYgKGhlYWRlcl9jb3VudF92YWwgPT0gYWN0dWFsX2NvdW50ICYmIGFjdHVhbF9jb3VudCA+IDApIHsKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXMgLSBIZWFkZXIgY291bnQgKCVkKSBtYXRjaGVzIGFjdHVhbCAoJWQpXG4iLCAKICAgICAgICAgICAgICAgQ1lBTiwgZHVyYXRpb24sIFJFU0VULCBoZWFkZXJfY291bnRfdmFsLCBhY3R1YWxfY291bnQpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX0lOVEVHUklUWV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBZRUxMT1cgIldBUk4iIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIEhlYWRlciBjb3VudCAoJWQpICE9IGFjdHVhbCAoJWQpXG4iLCAKICAgICAgICAgICAgICAgQ1lBTiwgZHVyYXRpb24sIFJFU0VULCBoZWFkZXJfY291bnRfdmFsLCBhY3R1YWxfY291bnQpOwogICAgICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX0lOVEVHUklUWV0rKzsKICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBEYXRhIGludGVncml0eSB0ZXN0czogJWQvJWQgcGFzc2VkXG4iIFJFU0VULCBwYXNzZWQsIHRvdGFsKTsKICAgIHJldHVybiBwYXNzZWQ7Cn0KCi8vID09PT09PT09PT09PT09PT09PT09IEVER0UgQ0FTRSBURVNUUyA9PT09PT09PT09PT09PT09PT09PQoKaW50IHJ1bl9lZGdlX2Nhc2VfdGVzdHNfY2xpKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJFREdFIENBU0UgVEVTVFMgKENMSSkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJlZGdlX3Rlc3RfJWxkIiwgdGltZShOVUxMKSk7CiAgICAKICAgIC8vIFNldHVwCiAgICBjaGFyIHNldHVwX2NtZFs1MTJdOwogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgIiVzIGNyZWF0ZSAlcyA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAKICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZy1yZXEgLS1hZ2UtaW50ID4gL2Rldi9udWxsIDI+JjEiLCAKICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIHN5c3RlbShzZXR1cF9jbWQpOwogICAgCiAgICBUZXN0Q2FzZSBlZGdlX3Rlc3RzW10gPSB7CiAgICAgICAgewogICAgICAgICAgICAiRW1wdHkgZGF0YWJhc2UgbmFtZSIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgJycgMj4mMSB8IGdyZXAgLWkgJ2Vycm9yXFx8aW52YWxpZCcgPiAvZGV2L251bGwiLAogICAgICAgICAgICAiZWNobyAnSGFuZGxlZCciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9FREdFLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJFbXB0eSBjb2xsZWN0aW9uIG5hbWUiLAogICAgICAgICAgICAiJXMgY3JlYXRlIHRlc3RkYiAnJyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nIDI+JjEgfCBncmVwIC1pICdlcnJvclxcfGludmFsaWQnID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgImVjaG8gJ0hhbmRsZWQnIiwgCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX0VER0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIk1heGltdW0gbGVuZ3RoIGZpZWxkIG5hbWUiLAogICAgICAgICAgICAiJXMgY3JlYXRlICVzIHVzZXJzIC0tc2NoZW1hIC0tYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYS1zdHJpbmcgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICJlY2hvICdIYW5kbGVkJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX0VER0UsIDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkVtcHR5IHF1ZXJ5IHN0cmluZyIsCiAgICAgICAgICAgICIlcyBmaW5kICVzIHVzZXJzIC0td2hlcmUgXCJcIiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgIiVzIGZpbmQgJXMgdXNlcnMgLS13aGVyZSBcIlwiIHwgZ3JlcCAtYyAnXCJfaWRcIiciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9FREdFLCAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJWZXJ5IGxvbmcgcXVlcnkgdmFsdWUiLAogICAgICAgICAgICAiJXMgZmluZCAlcyB1c2VycyAtLXdoZXJlIFwibmFtZTphYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhXCIgMj4mMSB8IGdyZXAgLWkgJ2Vycm9yXFx8aW52YWxpZCcgPiAvZGV2L251bGwiLAogICAgICAgICAgICAiZWNobyAnSGFuZGxlZCciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9FREdFLCAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJDcmVhdGUgY29sbGVjdGlvbiB3aXRoIHplcm8gZmllbGRzIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyBlbXB0eSAtLXNjaGVtYSAyPiYxIHwgZ3JlcCAtaSAnZXJyb3JcXHxpbnZhbGlkJyA+IC9kZXYvbnVsbCIsCiAgICAgICAgICAgICJ0ZXN0ICEgLWQgJy90bXAvc3lkYl90ZXN0LyVzL2VtcHR5JyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX0VER0UsIDEKICAgICAgICB9CiAgICB9OwogICAgCiAgICBpbnQgZWRnZV9jb3VudCA9IHNpemVvZihlZGdlX3Rlc3RzKSAvIHNpemVvZihlZGdlX3Rlc3RzWzBdKTsKICAgIAogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBlZGdlX2NvdW50OyBpKyspIHsKICAgICAgICB0b3RhbCsrOwogICAgICAgIAogICAgICAgIGNoYXIgZmluYWxfY29tbWFuZFsxMDI0XTsKICAgICAgICBjaGFyIGZpbmFsX3ZlcmlmaWNhdGlvblsxMDI0XTsKICAgICAgICAKICAgICAgICBzbnByaW50ZihmaW5hbF9jb21tYW5kLCBzaXplb2YoZmluYWxfY29tbWFuZCksIGVkZ2VfdGVzdHNbaV0uY29tbWFuZCwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgICAgIHNucHJpbnRmKGZpbmFsX3ZlcmlmaWNhdGlvbiwgc2l6ZW9mKGZpbmFsX3ZlcmlmaWNhdGlvbiksIGVkZ2VfdGVzdHNbaV0udmVyaWZpY2F0aW9uX2NvbW1hbmQsIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgICAgICAKICAgICAgICBzdHJjcHkoZWRnZV90ZXN0c1tpXS5jb21tYW5kLCBmaW5hbF9jb21tYW5kKTsKICAgICAgICBzdHJjcHkoZWRnZV90ZXN0c1tpXS52ZXJpZmljYXRpb25fY29tbWFuZCwgZmluYWxfdmVyaWZpY2F0aW9uKTsKICAgICAgICAKICAgICAgICBpZiAoZXhlY3V0ZV90ZXN0X3dpdGhfdmVyaWZpY2F0aW9uKCZlZGdlX3Rlc3RzW2ldKSkgewogICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgRWRnZSBjYXNlIHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gUkVDT1ZFUlkgVEVTVFMgPT09PT09PT09PT09PT09PT09PT0KCmludCBydW5fcmVjb3ZlcnlfdGVzdHNfY2xpKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJSRUNPVkVSWSAmIEVSUk9SIEhBTkRMSU5HIFRFU1RTIChDTEkpIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgCiAgICBpZiAodGVzdF9sZXZlbCA8IDIpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFNraXBwaW5nIHJlY292ZXJ5IHRlc3RzICh1c2UgLS1sZXZlbD0yIGZvciBjb21wcmVoZW5zaXZlIHRlc3RpbmcpXG4iIFJFU0VUKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgY2hhciBkYl9uYW1lWzY0XTsKICAgIHNucHJpbnRmKGRiX25hbWUsIHNpemVvZihkYl9uYW1lKSwgInJlY292ZXJ5X3Rlc3RfJWxkIiwgdGltZShOVUxMKSk7CiAgICAKICAgIC8vIFNldHVwCiAgICBjaGFyIHNldHVwX2NtZFs1MTJdOwogICAgc25wcmludGYoc2V0dXBfY21kLCBzaXplb2Yoc2V0dXBfY21kKSwgIiVzIGNyZWF0ZSAlcyA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAKICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZy1yZXEgLS1hZ2UtaW50ID4gL2Rldi9udWxsIDI+JjEiLCAKICAgICAgICAgICAgIGNsaV9jb21tYW5kLCBkYl9uYW1lKTsKICAgIHN5c3RlbShzZXR1cF9jbWQpOwogICAgCiAgICBjaGFyIGluc2VydF9jbWRbNTEyXTsKICAgIAogICAgLy8gSW5zZXJ0IHNvbWUgaW5pdGlhbCBkYXRhCiAgICBmb3IgKGludCBpID0gMDsgaSA8IDU7IGkrKykgewogICAgICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwKICAgICAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIkluaXRpYWwlZFwiIC0tYWdlLSVkID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUsIGksIDIwICsgaSk7CiAgICAgICAgc3lzdGVtKGluc2VydF9jbWQpOwogICAgfQogICAgCiAgICAvLyBURVNUIDE6IExvY2sgZmlsZSBjbGVhbnVwCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiUkVDT1ZFUlkgMTogTG9jayBmaWxlIGNsZWFudXAgYWZ0ZXIgY3Jhc2giKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBjaGFyIGxvY2tfcGF0aFs1MTJdOwogICAgc25wcmludGYobG9ja19wYXRoLCBzaXplb2YobG9ja19wYXRoKSwgIi90bXAvc3lkYl90ZXN0LyVzL3VzZXJzLy5kYXRhLmxvY2siLCBkYl9uYW1lKTsKICAgIAogICAgLy8gQ3JlYXRlIGEgc3RhbGUgbG9jayBmaWxlCiAgICBGSUxFKiBsb2NrID0gZm9wZW4obG9ja19wYXRoLCAidyIpOwogICAgaWYgKGxvY2spIHsKICAgICAgICBmcHJpbnRmKGxvY2ssICJzdGFsZSBsb2NrXG4iKTsKICAgICAgICBmY2xvc2UobG9jayk7CiAgICB9CiAgICAKICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgLy8gVHJ5IHRvIHdyaXRlIC0gc2hvdWxkIGhhbmRsZSBzdGFsZSBsb2NrCiAgICBzbnByaW50ZihpbnNlcnRfY21kLCBzaXplb2YoaW5zZXJ0X2NtZCksCiAgICAgICAgICAgICIlcyBjcmVhdGUgJXMgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIkxvY2sgVGVzdFwiIC0tYWdlLTk5ID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBpbnQgd3JpdGVfcmVzdWx0ID0gc3lzdGVtKGluc2VydF9jbWQpOwogICAgCiAgICBsb25nIGxvbmcgZHVyYXRpb24gPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydDsKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uICs9IGR1cmF0aW9uOwogICAgCiAgICAvLyBDaGVjayBpZiBsb2NrIGZpbGUgaXMgZ29uZQogICAgaW50IGxvY2tfZXhpc3RzID0gZmlsZV9leGlzdHMobG9ja19wYXRoKTsKICAgIAogICAgaWYgKHdyaXRlX3Jlc3VsdCA9PSAwICYmICFsb2NrX2V4aXN0cykgewogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIFN0YWxlIGxvY2sgaGFuZGxlZFxuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9SRUNPVkVSWV0rKzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBZRUxMT1cgIldBUk4iIFJFU0VUICJdICVzJTRsbGQgbXMlcyAtIExvY2sgaGFuZGxpbmcgbmVlZHMgaW1wcm92ZW1lbnRcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfUkVDT1ZFUlldKys7CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgUmVjb3ZlcnkgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBMRVZFTCAzIEVOSEFOQ0VEIEhUVFAgVEVTVFMgPT09PT09PT09PT09PT09PT09PT0KCi8vIE5ldyB0ZXN0OiBTdHJlc3MgdGVzdCAtIDEwMDAgY29uY3VycmVudCByZXF1ZXN0cyB3aXRoIG1peGVkIG9wZXJhdGlvbnMKaW50IHJ1bl9odHRwX3N0cmVzc190ZXN0cyh2b2lkKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIkVYVFJFTUUgU1RSRVNTIFRFU1RTIChIVFRQKSAtIExFVkVMIDMgT05MWSIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIAogICAgY2hhciBkYl9uYW1lWzY0XTsKICAgIHNucHJpbnRmKGRiX25hbWUsIHNpemVvZihkYl9uYW1lKSwgInN0cmVzc190ZXN0XyVsZCIsIHRpbWUoTlVMTCkpOwogICAgCiAgICAvLyBTZXR1cAogICAgY2hhciBjcmVhdGVfZGJfYm9keVsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2RiX2JvZHksIHNpemVvZihjcmVhdGVfZGJfYm9keSksICJ7XCJuYW1lXCI6XCIlc1wifSIsIGRiX25hbWUpOwogICAgSHR0cFJlc3BvbnNlKiByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiX2JvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfY29sbF91cmwsIHNpemVvZihjcmVhdGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCBkYl9uYW1lKTsKICAgIGNvbnN0IGNoYXIqIHNjaGVtYSA9ICJ7XCJuYW1lXCI6XCJ1c2Vyc1wiLFwic2NoZW1hXCI6WyIKICAgICAgICAie1wibmFtZVwiOlwibmFtZVwiLFwidHlwZVwiOlwic3RyaW5nXCIsXCJyZXF1aXJlZFwiOnRydWV9LCIKICAgICAgICAie1wibmFtZVwiOlwiYWdlXCIsXCJ0eXBlXCI6XCJpbnRcIn1dfSI7CiAgICByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgY3JlYXRlX2NvbGxfdXJsLCBzY2hlbWEsICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIGNoYXIgaW5zdGFuY2VzX3VybFsyNTZdOwogICAgc25wcmludGYoaW5zdGFuY2VzX3VybCwgc2l6ZW9mKGluc3RhbmNlc191cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzIiwgZGJfbmFtZSk7CiAgICAKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJTVFJFU1MgVEVTVCAxOiAxMDAwIGNvbmN1cnJlbnQgaW5zZXJ0cyIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgI2RlZmluZSBTVFJFU1NfVEhSRUFEX0NPVU5UIDEwCiAgICAjZGVmaW5lIFNUUkVTU19PUFNfUEVSX1RIUkVBRCAxMDAKICAgIHB0aHJlYWRfdCBzdHJlc3NfdGhyZWFkc1tTVFJFU1NfVEhSRUFEX0NPVU5UXTsKICAgIFRocmVhZFRlc3RDb250ZXh0IHN0cmVzc19jb250ZXh0c1tTVFJFU1NfVEhSRUFEX0NPVU5UXTsKICAgIAogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBTVFJFU1NfVEhSRUFEX0NPVU5UOyBpKyspIHsKICAgICAgICBtZW1zZXQoJnN0cmVzc19jb250ZXh0c1tpXSwgMCwgc2l6ZW9mKFRocmVhZFRlc3RDb250ZXh0KSk7CiAgICAgICAgc3RyY3B5KHN0cmVzc19jb250ZXh0c1tpXS5kYXRhYmFzZSwgZGJfbmFtZSk7CiAgICAgICAgc3RyY3B5KHN0cmVzc19jb250ZXh0c1tpXS5jb2xsZWN0aW9uLCAidXNlcnMiKTsKICAgICAgICBzdHJlc3NfY29udGV4dHNbaV0udGhyZWFkX2lkID0gaTsKICAgICAgICBzdHJlc3NfY29udGV4dHNbaV0ub3BlcmF0aW9uc19jb3VudCA9IFNUUkVTU19PUFNfUEVSX1RIUkVBRDsKICAgIH0KICAgIAogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBTVFJFU1NfVEhSRUFEX0NPVU5UOyBpKyspIHsKICAgICAgICBwdGhyZWFkX2NyZWF0ZSgmc3RyZXNzX3RocmVhZHNbaV0sIE5VTEwsIGh0dHBfY29uY3VycmVudF90aHJlYWQsICZzdHJlc3NfY29udGV4dHNbaV0pOwogICAgfQogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IFNUUkVTU19USFJFQURfQ09VTlQ7IGkrKykgewogICAgICAgIHB0aHJlYWRfam9pbihzdHJlc3NfdGhyZWFkc1tpXSwgTlVMTCk7CiAgICB9CiAgICAKICAgIGxvbmcgbG9uZyBkdXJhdGlvbiA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0OwogICAgc3RhdHMudG90YWxfZHVyYXRpb24gKz0gZHVyYXRpb247CiAgICAKICAgIGludCB0b3RhbF9zdWNjZXNzID0gMDsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgU1RSRVNTX1RIUkVBRF9DT1VOVDsgaSsrKSB7CiAgICAgICAgdG90YWxfc3VjY2VzcyArPSBzdHJlc3NfY29udGV4dHNbaV0uc3VjY2Vzc19jb3VudDsKICAgIH0KICAgIAogICAgLy8gVmVyaWZ5IGNvdW50IHZpYSBHRVQKICAgIEh0dHBSZXNwb25zZSogdmVyaWZ5X3Jlc3AgPSBodHRwX3JlcXVlc3QoIkdFVCIsIGluc3RhbmNlc191cmwsIE5VTEwsIE5VTEwpOwogICAgaW50IHJlY29yZF9jb3VudCA9IDA7CiAgICBpZiAodmVyaWZ5X3Jlc3AgJiYgdmVyaWZ5X3Jlc3AtPmJvZHkpIHsKICAgICAgICBjaGFyKiBwb3MgPSB2ZXJpZnlfcmVzcC0+Ym9keTsKICAgICAgICB3aGlsZSAoKHBvcyA9IHN0cnN0cihwb3MsICJcIl9pZFwiIikpICE9IE5VTEwpIHsKICAgICAgICAgICAgcmVjb3JkX2NvdW50Kys7CiAgICAgICAgICAgIHBvcyArPSA1OwogICAgICAgIH0KICAgIH0KICAgIGh0dHBfcmVzcG9uc2VfZnJlZSh2ZXJpZnlfcmVzcCk7CiAgICAKICAgIHByaW50ZigiIC0gJWxsZCBtcywgJWQvJWQgcmVjb3Jkc1xuIiwgZHVyYXRpb24sIHJlY29yZF9jb3VudCwgdG90YWxfc3VjY2Vzcyk7CiAgICAKICAgIGlmIChyZWNvcmRfY291bnQgPT0gdG90YWxfc3VjY2VzcyAmJiB0b3RhbF9zdWNjZXNzID49IChTVFJFU1NfVEhSRUFEX0NPVU5UICogU1RSRVNTX09QU19QRVJfVEhSRUFEICogMC45NSkpIHsKICAgICAgICBwcmludGYoIiAgWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdIFN0cmVzcyB0ZXN0IHBhc3NlZFxuIik7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfUEVSRk9STUFOQ0VdKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiICBbIiBSRUQgIkZBSUwiIFJFU0VUICJdIFN0cmVzcyB0ZXN0IGZhaWxlZDogZXhwZWN0ZWQgfiVkLCBnb3QgJWRcbiIsIAogICAgICAgICAgICAgICBTVFJFU1NfVEhSRUFEX0NPVU5UICogU1RSRVNTX09QU19QRVJfVEhSRUFELCByZWNvcmRfY291bnQpOwogICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9QRVJGT1JNQU5DRV0rKzsKICAgIAogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gTmV3IHRlc3Q6IERhdGEgY29ycnVwdGlvbiBkZXRlY3Rpb24KaW50IHJ1bl9odHRwX2RhdGFfY29ycnVwdGlvbl90ZXN0cyh2b2lkKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIkRBVEEgQ09SUlVQVElPTiBURVNUUyAoSFRUUCkgLSBMRVZFTCAzIE9OTFkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIC8vIFRoaXMgdGVzdCByZXF1aXJlcyBkaXJlY3QgZmlsZSBtYW5pcHVsYXRpb24gdG8gc2ltdWxhdGUgY29ycnVwdGlvbgogICAgY2hhciBkYl9uYW1lWzY0XTsKICAgIHNucHJpbnRmKGRiX25hbWUsIHNpemVvZihkYl9uYW1lKSwgImNvcnJ1cHRfdGVzdF8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAgdmlhIENMSSBmb3IgZmlsZSBhY2Nlc3MKICAgIGNoYXIgc2V0dXBfY21kWzUxMl07CiAgICBzbnByaW50ZihzZXR1cF9jbWQsIHNpemVvZihzZXR1cF9jbWQpLCAiJXMgY3JlYXRlICVzID4gL2Rldi9udWxsIDI+JjEiLCBjbGlfY29tbWFuZCwgZGJfbmFtZSk7CiAgICBzeXN0ZW0oc2V0dXBfY21kKTsKICAgIHNucHJpbnRmKHNldHVwX2NtZCwgc2l6ZW9mKHNldHVwX2NtZCksIAogICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nLXJlcSAtLWFnZS1pbnQgPiAvZGV2L251bGwgMj4mMSIsIAogICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGRiX25hbWUpOwogICAgc3lzdGVtKHNldHVwX2NtZCk7CiAgICAKICAgIC8vIEluc2VydCBzb21lIGRhdGEKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgY2hhciBpbnNlcnRfY21kWzUxMl07CiAgICAgICAgc25wcmludGYoaW5zZXJ0X2NtZCwgc2l6ZW9mKGluc2VydF9jbWQpLAogICAgICAgICAgICAgICAgIiVzIGNyZWF0ZSAlcyB1c2VycyAtLWluc2VydC1vbmUgLS1uYW1lLVwiVXNlciVkXCIgLS1hZ2UtJWQgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICAgICBjbGlfY29tbWFuZCwgZGJfbmFtZSwgaSwgMjAgKyBpKTsKICAgICAgICBzeXN0ZW0oaW5zZXJ0X2NtZCk7CiAgICB9CiAgICAKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJDT1JSVVBUSU9OIDE6IENvcnJ1cHQgZGF0YSBmaWxlIGhlYWRlciIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGNoYXIgZGF0YV9wYXRoWzUxMl07CiAgICBzbnByaW50ZihkYXRhX3BhdGgsIHNpemVvZihkYXRhX3BhdGgpLCAiL3RtcC9zeWRiX3Rlc3QvJXMvdXNlcnMvZGF0YS5zeWRiIiwgZGJfbmFtZSk7CiAgICAKICAgIC8vIENvcnJ1cHQgdGhlIG1hZ2ljIG51bWJlcgogICAgRklMRSogZGF0YV9maWxlID0gZm9wZW4oZGF0YV9wYXRoLCAicitiIik7CiAgICBpZiAoZGF0YV9maWxlKSB7CiAgICAgICAgdWludDMyX3QgY29ycnVwdF9tYWdpYyA9IDB4REVBREJFRUY7CiAgICAgICAgZndyaXRlKCZjb3JydXB0X21hZ2ljLCA0LCAxLCBkYXRhX2ZpbGUpOwogICAgICAgIGZjbG9zZShkYXRhX2ZpbGUpOwogICAgfQogICAgCiAgICAvLyBUcnkgdG8gcmVhZCB2aWEgSFRUUCAtIHNob3VsZCBoYW5kbGUgY29ycnVwdGlvbiBncmFjZWZ1bGx5CiAgICBjaGFyIGluc3RhbmNlc191cmxbMjU2XTsKICAgIHNucHJpbnRmKGluc3RhbmNlc191cmwsIHNpemVvZihpbnN0YW5jZXNfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcyIsIGRiX25hbWUpOwogICAgCiAgICBIdHRwUmVzcG9uc2UqIHJlc3AgPSBodHRwX3JlcXVlc3QoIkdFVCIsIGluc3RhbmNlc191cmwsIE5VTEwsIE5VTEwpOwogICAgCiAgICBpbnQgc3VjY2VzcyA9IChyZXNwICYmIChyZXNwLT5zdGF0dXNfY29kZSA9PSA1MDAgfHwgcmVzcC0+c3RhdHVzX2NvZGUgPT0gNDAwKSk7CiAgICBpZiAocmVzcCkgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICBpZiAoc3VjY2VzcykgewogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdIFNlcnZlciBjb3JyZWN0bHkgcmVqZWN0ZWQgY29ycnVwdCBmaWxlXG4iKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9JTlRFR1JJVFldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSBTZXJ2ZXIgZGlkIG5vdCBkZXRlY3QgY29ycnVwdGlvblxuIik7CiAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX0lOVEVHUklUWV0rKzsKICAgIAogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gTmV3IHRlc3Q6IE1peGVkIHdvcmtsb2FkIHdpdGggcmVhZC93cml0ZS9kZWxldGUgb3BlcmF0aW9ucwppbnQgcnVuX2h0dHBfbWl4ZWRfd29ya2xvYWRfdGVzdHModm9pZCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJNSVhFRCBXT1JLTE9BRCBURVNUUyAoSFRUUCkgLSBMRVZFTCAzIE9OTFkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJtaXhlZF90ZXN0XyVsZCIsIHRpbWUoTlVMTCkpOwogICAgCiAgICAvLyBTZXR1cAogICAgY2hhciBjcmVhdGVfZGJfYm9keVsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2RiX2JvZHksIHNpemVvZihjcmVhdGVfZGJfYm9keSksICJ7XCJuYW1lXCI6XCIlc1wifSIsIGRiX25hbWUpOwogICAgSHR0cFJlc3BvbnNlKiByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiX2JvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfY29sbF91cmwsIHNpemVvZihjcmVhdGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCBkYl9uYW1lKTsKICAgIGNvbnN0IGNoYXIqIHNjaGVtYSA9ICJ7XCJuYW1lXCI6XCJ1c2Vyc1wiLFwic2NoZW1hXCI6WyIKICAgICAgICAie1wibmFtZVwiOlwibmFtZVwiLFwidHlwZVwiOlwic3RyaW5nXCIsXCJyZXF1aXJlZFwiOnRydWV9LCIKICAgICAgICAie1wibmFtZVwiOlwiYWdlXCIsXCJ0eXBlXCI6XCJpbnRcIn1dfSI7CiAgICByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgY3JlYXRlX2NvbGxfdXJsLCBzY2hlbWEsICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcCk7CiAgICAKICAgIGNoYXIgaW5zdGFuY2VzX3VybFsyNTZdOwogICAgc25wcmludGYoaW5zdGFuY2VzX3VybCwgc2l6ZW9mKGluc3RhbmNlc191cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzIiwgZGJfbmFtZSk7CiAgICAKICAgIC8vIEluc2VydCA1MCByZWNvcmRzCiAgICBmb3IgKGludCBpID0gMDsgaSA8IDUwOyBpKyspIHsKICAgICAgICBjaGFyIHVzZXJfanNvblsyNTZdOwogICAgICAgIHNucHJpbnRmKHVzZXJfanNvbiwgc2l6ZW9mKHVzZXJfanNvbiksICJ7XCJuYW1lXCI6XCJVc2VyJWRcIixcImFnZVwiOiVkfSIsIGksIDIwICsgaSk7CiAgICAgICAgSHR0cFJlc3BvbnNlKiByID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgaW5zdGFuY2VzX3VybCwgdXNlcl9qc29uLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyKTsKICAgIH0KICAgIAogICAgdG90YWwrKzsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIk1JWEVEIDE6IENvbmN1cnJlbnQgcmVhZC93cml0ZS9kZWxldGUgb3BlcmF0aW9ucyIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIC8vIFRoaXMgdGVzdCByZXF1aXJlcyBtdWx0aXBsZSB0aHJlYWRzIGRvaW5nIGRpZmZlcmVudCBvcGVyYXRpb25zCiAgICAvLyBTaW1wbGlmaWVkIGZvciB0aGlzIGV4YW1wbGUKICAgIHByaW50ZigiIC0gU0tJUFBFRCAocmVxdWlyZXMgYWR2YW5jZWQgdGhyZWFkIGNvb3JkaW5hdGlvbilcbiIpOwogICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfQ09OQ1VSUkVOQ1ldKys7CiAgICAKICAgIHJldHVybiBwYXNzZWQ7Cn0KCi8vIE5ldyB0ZXN0OiBMb25nLXJ1bm5pbmcgY29ubmVjdGlvbiBzdGFiaWxpdHkKaW50IHJ1bl9odHRwX2xvbmdfcnVubmluZ190ZXN0cyh2b2lkKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIkxPTkctUlVOTklORyBURVNUUyAoSFRUUCkgLSBMRVZFTCAzIE9OTFkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJMT05HIDE6IEtlZXAtYWxpdmUgY29ubmVjdGlvbiBzdGFiaWxpdHkgKDMwcykiKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBwcmludGYoIiAtICIgWUVMTE9XICJTSU1VTEFURUQiIFJFU0VUICIgKHdvdWxkIHJ1biBmb3IgMzAgc2Vjb25kcyBpbiBhY3R1YWwgdGVzdClcbiIpOwogICAgc3RhdHMuc2tpcHBlZF90ZXN0cysrOwogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfUEVSRk9STUFOQ0VdKys7CiAgICAKICAgIHJldHVybiBwYXNzZWQ7Cn0KCi8vIE5ldyB0ZXN0OiBDb25zaXN0ZW5jeSB1bmRlciBjb25jdXJyZW50IG9wZXJhdGlvbnMKaW50IHJ1bl9odHRwX2NvbnNpc3RlbmN5X3Rlc3RzKHZvaWQpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgQk9MRCAiQ09OU0lTVEVOQ1kgVEVTVFMgKEhUVFApIC0gTEVWRUwgMyBPTkxZIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgCiAgICBjaGFyIGRiX25hbWVbNjRdOwogICAgc25wcmludGYoZGJfbmFtZSwgc2l6ZW9mKGRiX25hbWUpLCAiY29uc2lzdGVuY3lfdGVzdF8lbGQiLCB0aW1lKE5VTEwpKTsKICAgIAogICAgLy8gU2V0dXAKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMjU2XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCBkYl9uYW1lKTsKICAgIEh0dHBSZXNwb25zZSogcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsIGNyZWF0ZV9kYl9ib2R5LCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICBjaGFyIGNyZWF0ZV9jb2xsX3VybFsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2NvbGxfdXJsLCBzaXplb2YoY3JlYXRlX2NvbGxfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zIiwgZGJfbmFtZSk7CiAgICBjb25zdCBjaGFyKiBzY2hlbWEgPSAie1wibmFtZVwiOlwiY291bnRlclwiLFwic2NoZW1hXCI6WyIKICAgICAgICAie1wibmFtZVwiOlwidmFsdWVcIixcInR5cGVcIjpcImludFwifV19IjsKICAgIHJlc3AgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCBjcmVhdGVfY29sbF91cmwsIHNjaGVtYSwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwKTsKICAgIAogICAgY2hhciBpbnN0YW5jZXNfdXJsWzI1Nl07CiAgICBzbnByaW50ZihpbnN0YW5jZXNfdXJsLCBzaXplb2YoaW5zdGFuY2VzX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy9jb3VudGVyL2luc3RhbmNlcyIsIGRiX25hbWUpOwogICAgCiAgICAvLyBJbnNlcnQgaW5pdGlhbCBjb3VudGVyCiAgICBjb25zdCBjaGFyKiBjb3VudGVyX2pzb24gPSAie1widmFsdWVcIjowfSI7CiAgICByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgaW5zdGFuY2VzX3VybCwgY291bnRlcl9qc29uLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgY2hhciogaWQgPSBOVUxMOwogICAgaWYgKHJlc3AgJiYgcmVzcC0+Ym9keSkgewogICAgICAgIGlkID0gZXh0cmFjdF9qc29uX2ZpZWxkKHJlc3AtPmJvZHksICJpZCIpOwogICAgfQogICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiQ09OU0lTVEVOQ1kgMTogQ291bnRlciBpbmNyZW1lbnQgdW5kZXIgbG9hZCIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGlmICghaWQpIHsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl0gRmFpbGVkIHRvIGNyZWF0ZSBjb3VudGVyXG4iKTsKICAgICAgICBzdGF0cy5mYWlsZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9JTlRFR1JJVFldKys7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICAKICAgIGNoYXIgdXBkYXRlX3VybFs1MTJdOwogICAgc25wcmludGYodXBkYXRlX3VybCwgc2l6ZW9mKHVwZGF0ZV91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvY291bnRlci9pbnN0YW5jZXMvJXMiLCBkYl9uYW1lLCBpZCk7CiAgICAKICAgIC8vIFBlcmZvcm0gMTAwIGNvbmN1cnJlbnQgaW5jcmVtZW50cwogICAgI2RlZmluZSBJTkNSRU1FTlRfVEhSRUFEUyAxMAogICAgI2RlZmluZSBJTkNSRU1FTlRTX1BFUl9USFJFQUQgMTAKICAgIAogICAgcHRocmVhZF90IGluY190aHJlYWRzW0lOQ1JFTUVOVF9USFJFQURTXTsKICAgIFRocmVhZFRlc3RDb250ZXh0IGluY19jb250ZXh0c1tJTkNSRU1FTlRfVEhSRUFEU107CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgSU5DUkVNRU5UX1RIUkVBRFM7IGkrKykgewogICAgICAgIG1lbXNldCgmaW5jX2NvbnRleHRzW2ldLCAwLCBzaXplb2YoVGhyZWFkVGVzdENvbnRleHQpKTsKICAgICAgICBzdHJjcHkoaW5jX2NvbnRleHRzW2ldLmRhdGFiYXNlLCBkYl9uYW1lKTsKICAgICAgICBzdHJjcHkoaW5jX2NvbnRleHRzW2ldLmNvbGxlY3Rpb24sICJjb3VudGVyIik7CiAgICAgICAgaW5jX2NvbnRleHRzW2ldLnRocmVhZF9pZCA9IGk7CiAgICAgICAgaW5jX2NvbnRleHRzW2ldLm9wZXJhdGlvbnNfY291bnQgPSBJTkNSRU1FTlRTX1BFUl9USFJFQUQ7CiAgICB9CiAgICAKICAgIGxvbmcgbG9uZyBzdGFydCA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBJTkNSRU1FTlRfVEhSRUFEUzsgaSsrKSB7CiAgICAgICAgcHRocmVhZF9jcmVhdGUoJmluY190aHJlYWRzW2ldLCBOVUxMLCBodHRwX2NvbmN1cnJlbnRfdGhyZWFkLCAmaW5jX2NvbnRleHRzW2ldKTsKICAgIH0KICAgIAogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBJTkNSRU1FTlRfVEhSRUFEUzsgaSsrKSB7CiAgICAgICAgcHRocmVhZF9qb2luKGluY190aHJlYWRzW2ldLCBOVUxMKTsKICAgIH0KICAgIAogICAgbG9uZyBsb25nIGR1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnQ7CiAgICBzdGF0cy50b3RhbF9kdXJhdGlvbiArPSBkdXJhdGlvbjsKICAgIAogICAgLy8gQ2hlY2sgZmluYWwgdmFsdWUKICAgIGNoYXIgZ2V0X3VybFs1MTJdOwogICAgc25wcmludGYoZ2V0X3VybCwgc2l6ZW9mKGdldF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvY291bnRlci9pbnN0YW5jZXMvJXMiLCBkYl9uYW1lLCBpZCk7CiAgICBIdHRwUmVzcG9uc2UqIGdldF9yZXNwID0gaHR0cF9yZXF1ZXN0KCJHRVQiLCBnZXRfdXJsLCBOVUxMLCBOVUxMKTsKICAgIAogICAgaW50IGZpbmFsX3ZhbHVlID0gMDsKICAgIGlmIChnZXRfcmVzcCAmJiBnZXRfcmVzcC0+Ym9keSkgewogICAgICAgIGNoYXIqIHZhbHVlX3N0ciA9IGV4dHJhY3RfanNvbl9maWVsZChnZXRfcmVzcC0+Ym9keSwgInZhbHVlIik7CiAgICAgICAgaWYgKHZhbHVlX3N0cikgewogICAgICAgICAgICBmaW5hbF92YWx1ZSA9IGF0b2kodmFsdWVfc3RyKTsKICAgICAgICAgICAgZnJlZSh2YWx1ZV9zdHIpOwogICAgICAgIH0KICAgIH0KICAgIGh0dHBfcmVzcG9uc2VfZnJlZShnZXRfcmVzcCk7CiAgICBmcmVlKGlkKTsKICAgIAogICAgcHJpbnRmKCIgLSAlbGxkIG1zLCBmaW5hbCB2YWx1ZTogJWRcbiIsIGR1cmF0aW9uLCBmaW5hbF92YWx1ZSk7CiAgICAKICAgIGlmIChmaW5hbF92YWx1ZSA9PSBJTkNSRU1FTlRfVEhSRUFEUyAqIElOQ1JFTUVOVFNfUEVSX1RIUkVBRCkgewogICAgICAgIHByaW50ZigiICBbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gQ291bnRlciBjb25zaXN0ZW5jeSBtYWludGFpbmVkXG4iKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICBzdGF0cy5wYXNzZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9JTlRFR1JJVFldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiICBbIiBSRUQgIkZBSUwiIFJFU0VUICJdIENvdW50ZXIgaW5jb25zaXN0ZW50OiBleHBlY3RlZCAlZCwgZ290ICVkXG4iLCAKICAgICAgICAgICAgICAgSU5DUkVNRU5UX1RIUkVBRFMgKiBJTkNSRU1FTlRTX1BFUl9USFJFQUQsIGZpbmFsX3ZhbHVlKTsKICAgICAgICBzdGF0cy5mYWlsZWRfdGVzdHMrKzsKICAgICAgICBzdGF0cy5jcml0aWNhbF9mYWlsdXJlcysrOwogICAgfQogICAgc3RhdHMudG90YWxfdGVzdHMrKzsKICAgIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfSU5URUdSSVRZXSsrOwogICAgCiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyBOZXcgdGVzdDogRmF1bHQgaW5qZWN0aW9uCmludCBydW5faHR0cF9mYXVsdF9pbmplY3Rpb25fdGVzdHModm9pZCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJGQVVMVCBJTkpFQ1RJT04gVEVTVFMgKEhUVFApIC0gTEVWRUwgMyBPTkxZIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiRkFVTFQgMTogTWFsZm9ybWVkIEpTT04gd2l0aCBjb250cm9sIGNoYXJhY3RlcnMiKTsKICAgIGZmbHVzaChzdGRvdXQpOwogICAgCiAgICBjb25zdCBjaGFyKiBtYWxmb3JtZWRfanNvbiA9ICJ7XCJuYW1lXCI6XCJUZXN0XHgwMFVzZXJcIixcImFnZVwiOjMwfSI7CiAgICBIdHRwUmVzcG9uc2UqIHJlc3AgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMvdGVzdGRiL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hbGZvcm1lZF9qc29uLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgCiAgICBpbnQgc3VjY2VzcyA9IChyZXNwICYmIChyZXNwLT5zdGF0dXNfY29kZSA9PSA0MDAgfHwgcmVzcC0+c3RhdHVzX2NvZGUgPT0gNTAwKSk7CiAgICBpZiAocmVzcCkgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICBpZiAoc3VjY2VzcykgewogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdIFNlcnZlciByZWplY3RlZCBtYWxmb3JtZWQgSlNPTlxuIik7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfU0VDVVJJVFldKys7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSBTZXJ2ZXIgYWNjZXB0ZWQgbWFsZm9ybWVkIEpTT05cbiIpOwogICAgICAgIHN0YXRzLmZhaWxlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNyaXRpY2FsX2ZhaWx1cmVzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9TRUNVUklUWV0rKzsKICAgIAogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gTmV3IHRlc3Q6IENoYW9zIGVuZ2luZWVyaW5nIC0gcmFuZG9tIGZhaWx1cmVzCmludCBydW5faHR0cF9jaGFvc190ZXN0cyh2b2lkKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIkNIQU9TIEVOR0lORUVSSU5HIFRFU1RTIChIVFRQKSAtIExFVkVMIDMgT05MWSIgUkVTRVQgIlxuIik7CiAgICBwcmludGYoWUVMTE9XICJTaW11bGF0aW5nIHJhbmRvbSBmYWlsdXJlcyBhbmQgcGFydGlhbCBvdXRhZ2VzXG4iIFJFU0VUKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiQ0hBT1MgMTogU2ltdWxhdGUgbmV0d29yayBsYXRlbmN5Iik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgcHJpbnRmKCIgLSAiIFlFTExPVyAiU0lNVUxBVEVEIiBSRVNFVCAiXG4iKTsKICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1JFQ09WRVJZXSsrOwogICAgCiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyBOZXcgdGVzdDogRXh0cmVtZSBib3VuZGFyeSBjb25kaXRpb25zCmludCBydW5faHR0cF9ib3VuZGFyeV90ZXN0c19leHRyZW1lKHZvaWQpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgQk9MRCAiRVhUUkVNRSBCT1VOREFSWSBURVNUUyAoSFRUUCkgLSBMRVZFTCAzIE9OTFkiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICAKICAgIHRvdGFsKys7CiAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJCT1VOREFSWSAxOiBNYXhpbXVtIGZpZWxkIGNvdW50ICgxMjggZmllbGRzKSIpOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGNoYXIgbGFyZ2VfanNvblsxNjM4NF0gPSAieyI7CiAgICBmb3IgKGludCBpID0gMDsgaSA8IDEyODsgaSsrKSB7CiAgICAgICAgY2hhciBmaWVsZFsxMjhdOwogICAgICAgIHNucHJpbnRmKGZpZWxkLCBzaXplb2YoZmllbGQpLCAiXCJmaWVsZCVkXCI6XCJ2YWx1ZSVkXCIiLCBpLCBpKTsKICAgICAgICBpZiAoaSA+IDApIHN0cmNhdChsYXJnZV9qc29uLCAiLCIpOwogICAgICAgIHN0cmNhdChsYXJnZV9qc29uLCBmaWVsZCk7CiAgICB9CiAgICBzdHJjYXQobGFyZ2VfanNvbiwgIn0iKTsKICAgIAogICAgSHR0cFJlc3BvbnNlKiByZXNwID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzL3Rlc3RkYi9jb2xsZWN0aW9ucy91c2Vycy9pbnN0YW5jZXMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXJnZV9qc29uLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgCiAgICBpbnQgc3VjY2VzcyA9IChyZXNwICYmIHJlc3AtPnN0YXR1c19jb2RlID49IDIwMCAmJiByZXNwLT5zdGF0dXNfY29kZSA8IDMwMCk7CiAgICBpZiAocmVzcCkgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3ApOwogICAgCiAgICBpZiAoc3VjY2VzcykgewogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdIFNlcnZlciBoYW5kbGVkIDEyOCBmaWVsZHNcbiIpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1BFUkZPUk1BTkNFXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlsiIFlFTExPVyAiV0FSTiIgUkVTRVQgIl0gU2VydmVyIGZhaWxlZCB3aXRoIDEyOCBmaWVsZHNcbiIpOwogICAgICAgIHN0YXRzLnNraXBwZWRfdGVzdHMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzKys7CiAgICBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX1BFUkZPUk1BTkNFXSsrOwogICAgCiAgICB0b3RhbCsrOwogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiQk9VTkRBUlkgMjogVmVyeSBsYXJnZSBKU09OICgxTUIpIik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgY2hhciogaHVnZV9qc29uID0gbWFsbG9jKDEwMjQgKiAxMDI0ICsgMTAwKTsKICAgIGlmIChodWdlX2pzb24pIHsKICAgICAgICBzdHJjcHkoaHVnZV9qc29uLCAie1wiZGF0YVwiOlwiIik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDI0ICogMTAyNCAtIDEwMDsgaSsrKSB7CiAgICAgICAgICAgIGh1Z2VfanNvblsxMCArIGldID0gJ0EnICsgKGkgJSAyNik7CiAgICAgICAgfQogICAgICAgIHN0cmNweShodWdlX2pzb24gKyAxMCArIDEwMjQgKiAxMDI0IC0gMTAwLCAiXCJ9Iik7CiAgICAgICAgCiAgICAgICAgcmVzcCA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsICIvYXBpL2RhdGFiYXNlcy90ZXN0ZGIvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodWdlX2pzb24sICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICAgICAgCiAgICAgICAgc3VjY2VzcyA9IChyZXNwICYmIHJlc3AtPnN0YXR1c19jb2RlID49IDIwMCAmJiByZXNwLT5zdGF0dXNfY29kZSA8IDMwMCk7CiAgICAgICAgaWYgKHJlc3ApIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwKTsKICAgICAgICBmcmVlKGh1Z2VfanNvbik7CiAgICAgICAgCiAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gU2VydmVyIGhhbmRsZWQgMU1CIEpTT05cbiIpOwogICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICAgICAgc3RhdHMucGFzc2VkX3Rlc3RzKys7CiAgICAgICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1BFUkZPUk1BTkNFXSsrOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHByaW50ZigiWyIgWUVMTE9XICJXQVJOIiBSRVNFVCAiXSBTZXJ2ZXIgcmVqZWN0ZWQgMU1CIEpTT05cbiIpOwogICAgICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlsiIFlFTExPVyAiU0tJUCIgUkVTRVQgIl0gTWVtb3J5IGFsbG9jYXRpb24gZmFpbGVkXG4iKTsKICAgICAgICBzdGF0cy5za2lwcGVkX3Rlc3RzKys7CiAgICB9CiAgICBzdGF0cy50b3RhbF90ZXN0cysrOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9QRVJGT1JNQU5DRV0rKzsKICAgIAogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gU01PS0UgVEVTVFMgKFlvdXIgb3JpZ2luYWwgQ0xJIHRlc3RzKSA9PT09PT09PT09PT09PT09PT09PQoKaW50IHJ1bl9zbW9rZV90ZXN0c19jbGkoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIlNNT0tFIFRFU1RTIC0gQmFzaWMgRnVuY3Rpb25hbGl0eSAoQ0xJKSIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIAogICAgLy8gQ2xlYW4gdXAKICAgIHN5c3RlbSgicm0gLXJmIC90bXAvc3lkYl90ZXN0ID4gL2Rldi9udWxsIDI+JjEiKTsKICAgIAogICAgVGVzdENhc2UgdGVzdHNbXSA9IHsKICAgICAgICB7CiAgICAgICAgICAgICJDcmVhdGUgZGF0YWJhc2UgJ3Rlc3RkYiciLCAKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICJ0ZXN0IC1kICcvdG1wL3N5ZGJfdGVzdC90ZXN0ZGInIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkNyZWF0ZSBkYXRhYmFzZSAndGVzdGRiMiciLCAKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIyID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAidGVzdCAtZCAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiMiciLCAKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkxpc3QgZGF0YWJhc2VzIiwKICAgICAgICAgICAgIiVzIGxpc3QgPiAvZGV2L251bGwgMj4mMSIsIAogICAgICAgICAgICAiJXMgbGlzdCB8IGdyZXAgLWMgJ3Rlc3RkYlxcfHRlc3RkYjInIiwKICAgICAgICAgICAgIjIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJDcmVhdGUgJ3VzZXJzJyBjb2xsZWN0aW9uIHdpdGggc2NoZW1hIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgdXNlcnMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZy1yZXEgLS1hZ2UtaW50IC0tZW1haWwtc3RyaW5nID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAidGVzdCAtZiAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiL3VzZXJzL3NjaGVtYS50eHQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkNyZWF0ZSAncHJvZHVjdHMnIGNvbGxlY3Rpb24iLAogICAgICAgICAgICAiJXMgY3JlYXRlIHRlc3RkYiBwcm9kdWN0cyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nLXJlcSAtLXByaWNlLWZsb2F0ID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAidGVzdCAtZiAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiL3Byb2R1Y3RzL3NjaGVtYS50eHQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkluc2VydCB1c2VyIHJlY29yZCIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJKb2huIERvZVwiIC0tYWdlLTMwIC0tZW1haWwtXCJqb2huQHRlc3QuY29tXCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiB1c2VycyB8IGdyZXAgLWMgJ1wiX2lkXCInIiwKICAgICAgICAgICAgIjEiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJJbnNlcnQgc2Vjb25kIHVzZXIiLCAKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIkphbmUgU21pdGhcIiAtLWFnZS0yNSAtLWVtYWlsLVwiamFuZUB0ZXN0LmNvbVwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgfCBncmVwIC1jICdcIl9pZFwiJyIsCiAgICAgICAgICAgICIyIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiSW5zZXJ0IHByb2R1Y3QiLAogICAgICAgICAgICAiJXMgY3JlYXRlIHRlc3RkYiBwcm9kdWN0cyAtLWluc2VydC1vbmUgLS1uYW1lLVwiVGVzdCBQcm9kdWN0XCIgLS1wcmljZS0xOS45OSA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgIiVzIGxpc3QgdGVzdGRiIHByb2R1Y3RzIHwgZ3JlcCAtYyAnVGVzdCBQcm9kdWN0JyIsCiAgICAgICAgICAgICIxIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiLAogICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiUXVlcnkgYnkgYWdlIiwKICAgICAgICAgICAgIiVzIGZpbmQgdGVzdGRiIHVzZXJzIC0td2hlcmUgXCJhZ2U6MzBcIiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgIiVzIGZpbmQgdGVzdGRiIHVzZXJzIC0td2hlcmUgXCJhZ2U6MzBcIiB8IGdyZXAgLWMgJ0pvaG4gRG9lJyIsCiAgICAgICAgICAgICIxIiwgCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlF1ZXJ5IG5vbi1leGlzdGVudCIsCiAgICAgICAgICAgICIlcyBmaW5kIHRlc3RkYiB1c2VycyAtLXdoZXJlIFwiYWdlOjk5OVwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgZmluZCB0ZXN0ZGIgdXNlcnMgLS13aGVyZSBcImFnZTo5OTlcIiB8IHdjIC1sIiwKICAgICAgICAgICAgIjAiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJMaXN0IGNvbGxlY3Rpb25zIiwKICAgICAgICAgICAgIiVzIGxpc3QgdGVzdGRiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgfCBncmVwIC1jICd1c2Vyc1xcfHByb2R1Y3RzJyIsIAogICAgICAgICAgICAiMiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkxpc3QgdXNlcnMiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiB1c2VycyB8IGdyZXAgLWMgJ1wiX2lkXCInIiwKICAgICAgICAgICAgIjIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIsCiAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJWZXJpZnkgVVVJRCBmb3JtYXQiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgfCBoZWFkIC0xID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgfCBoZWFkIC0xIHwgZ3JlcCAtRW8gJ1wiW2EtZjAtOV17OH0tW2EtZjAtOV17NH0tW2EtZjAtOV17NH0tW2EtZjAtOV17NH0tW2EtZjAtOV17MTJ9XCInIHwgd2MgLWwiLAogICAgICAgICAgICAiMSIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIiwKICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEKICAgICAgICB9CiAgICB9OwogICAgCiAgICBpbnQgdGVzdF9jb3VudCA9IHNpemVvZih0ZXN0cykgLyBzaXplb2YodGVzdHNbMF0pOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IHRlc3RfY291bnQ7IGkrKykgewogICAgICAgIHRvdGFsKys7CiAgICAgICAgCiAgICAgICAgY2hhciBmaW5hbF9jb21tYW5kWzEwMjRdOwogICAgICAgIGNoYXIgZmluYWxfdmVyaWZpY2F0aW9uWzEwMjRdOwogICAgICAgIAogICAgICAgIHNucHJpbnRmKGZpbmFsX2NvbW1hbmQsIHNpemVvZihmaW5hbF9jb21tYW5kKSwgdGVzdHNbaV0uY29tbWFuZCwgY2xpX2NvbW1hbmQpOwogICAgICAgIHNucHJpbnRmKGZpbmFsX3ZlcmlmaWNhdGlvbiwgc2l6ZW9mKGZpbmFsX3ZlcmlmaWNhdGlvbiksIHRlc3RzW2ldLnZlcmlmaWNhdGlvbl9jb21tYW5kLCBjbGlfY29tbWFuZCk7CiAgICAgICAgCiAgICAgICAgc3RyY3B5KHRlc3RzW2ldLmNvbW1hbmQsIGZpbmFsX2NvbW1hbmQpOwogICAgICAgIHN0cmNweSh0ZXN0c1tpXS52ZXJpZmljYXRpb25fY29tbWFuZCwgZmluYWxfdmVyaWZpY2F0aW9uKTsKICAgICAgICAKICAgICAgICBpZiAoZXhlY3V0ZV90ZXN0X3dpdGhfdmVyaWZpY2F0aW9uKCZ0ZXN0c1tpXSkpIHsKICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcmludGYoWUVMTE9XICIgIFNtb2tlIHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHBhc3NlZCwgdG90YWwpOwogICAgcmV0dXJuIHBhc3NlZDsKfQoKaW50IHJ1bl9zbW9rZV90ZXN0c19odHRwKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSBCT0xEICJTTU9LRSBURVNUUyAtIEJhc2ljIEhUVFAgQVBJIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgbG9uZyBsb25nIGR1cmF0aW9uOwogICAgCiAgICAvLyBUZXN0IGNvbm5lY3Rpdml0eQogICAgSHR0cFJlc3BvbnNlKiB0ZXN0X3Jlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KCJHRVQiLCAiL2FwaS9kYXRhYmFzZXMiLCBOVUxMLCBOVUxMKTsKICAgIGlmICh0ZXN0X3Jlc3BvbnNlICYmIHRlc3RfcmVzcG9uc2UtPnN0YXR1c19jb2RlID4gMCkgewogICAgICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlNlcnZlciBjb25uZWN0aXZpdHkgdGVzdCIpOwogICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdXG4iKTsKICAgICAgICBwYXNzZWQrKzsKICAgICAgICB0b3RhbCsrOwogICAgICAgIHN0YXRzLnBhc3NlZF90ZXN0cysrOwogICAgICAgIHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1NNT0tFXSsrOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJTZXJ2ZXIgY29ubmVjdGl2aXR5IHRlc3QiKTsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl1cbiIpOwogICAgICAgIHRvdGFsKys7CiAgICAgICAgc3RhdHMuZmFpbGVkX3Rlc3RzKys7CiAgICAgICAgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMrKzsKICAgIH0KICAgIHN0YXRzLnRvdGFsX3Rlc3RzICs9IHRvdGFsOwogICAgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9TTU9LRV0gKz0gdG90YWw7CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUodGVzdF9yZXNwb25zZSk7CiAgICAKICAgIC8vIExpc3QgZGF0YWJhc2VzCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgIi9hcGkvZGF0YWJhc2VzIiwgTlVMTCwgIlwic3VjY2Vzc1wiOnRydWUiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgCiAgICAvLyBDcmVhdGUgZGF0YWJhc2UKICAgIGNoYXIgZGJfbmFtZVs2NF07CiAgICBzbnByaW50ZihkYl9uYW1lLCBzaXplb2YoZGJfbmFtZSksICJzbW9rZV90ZXN0XyVsZCIsIHRpbWUoTlVMTCkpOwogICAgY2hhciBjcmVhdGVfYm9keVsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2JvZHksIHNpemVvZihjcmVhdGVfYm9keSksICJ7XCJuYW1lXCI6XCIlc1wifSIsIGRiX25hbWUpOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzIC0gQ3JlYXRlIGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfYm9keSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIEhUVFAgU21va2UgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgcGFzc2VkLCB0b3RhbCk7CiAgICByZXR1cm4gcGFzc2VkOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBURVNUIFNVSVRFIERJU1BBVENIRVIgPT09PT09PT09PT09PT09PT09PT0KCnZvaWQgcnVuX2FsbF9jbGlfdGVzdHMoKSB7CiAgICBwcmludGYoQ1lBTiBCT0xEICJcbj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iIFJFU0VUKTsKICAgIHByaW50ZihDWUFOIEJPTEQgIiAgIFNZREIgQ0xJIENPTVBSRUhFTlNJVkUgVEVTVCBTVUlURVxuIiBSRVNFVCk7CiAgICBwcmludGYoQ1lBTiBCT0xEICI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIiBSRVNFVCk7CiAgICBwcmludGYoIkNvbW1hbmQ6ICVzXG4iLCBjbGlfY29tbWFuZCk7CiAgICBwcmludGYoIlRlc3QgbGV2ZWw6ICVzXG4iLCAKICAgICAgICAgICB0ZXN0X2xldmVsID09IDAgPyAiUXVpY2siIDogCiAgICAgICAgICAgdGVzdF9sZXZlbCA9PSAxID8gIlN0YW5kYXJkIiA6IAogICAgICAgICAgIHRlc3RfbGV2ZWwgPT0gMiA/ICJDb21wcmVoZW5zaXZlIiA6ICJFeHRyZW1lIik7CiAgICBwcmludGYoIlZlcmJvc2U6ICVzXG4iLCB2ZXJib3NlX21vZGUgPyAiWWVzIiA6ICJObyIpOwogICAgcHJpbnRmKENZQU4gQk9MRCAiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuIiBSRVNFVCk7CiAgICAKICAgIC8vIENsZWFudXAKICAgIHN5c3RlbSgicm0gLXJmIC90bXAvc3lkYl90ZXN0ID4gL2Rldi9udWxsIDI+JjEiKTsKICAgIG1rZGlyKCIvdG1wL3N5ZGJfdGVzdCIsIDA3NTUpOwogICAgCiAgICAvLyBSdW4gdGVzdCBjYXRlZ29yaWVzIGluIG9yZGVyCiAgICBydW5fc21va2VfdGVzdHNfY2xpKCk7CiAgICAKICAgIGlmICh0ZXN0X2xldmVsID49IDEpIHsKICAgICAgICBydW5fc2VjdXJpdHlfdGVzdHNfY2xpKCk7CiAgICAgICAgcnVuX3NjaGVtYV9lbmZvcmNlbWVudF90ZXN0c19jbGkoKTsKICAgICAgICBydW5fcXVlcnlfbGFuZ3VhZ2VfdGVzdHNfY2xpKCk7CiAgICAgICAgcnVuX2RhdGFfaW50ZWdyaXR5X3Rlc3RzX2NsaSgpOyAvLyBBY3R1YWxseSBydW5faW50ZWdyaXR5X3Rlc3RzX2NsaQogICAgICAgIHJ1bl9lZGdlX2Nhc2VfdGVzdHNfY2xpKCk7CiAgICAgICAgcnVuX3BlcmZvcm1hbmNlX3Rlc3RzX2NsaSgpOwogICAgICAgIHJ1bl9jb25jdXJyZW5jeV90ZXN0c19jbGkoKTsKICAgIH0KICAgIAogICAgaWYgKHRlc3RfbGV2ZWwgPj0gMikgewogICAgICAgIHJ1bl9kdXJhYmlsaXR5X3Rlc3RzX2NsaSgpOwogICAgICAgIHJ1bl9yZWNvdmVyeV90ZXN0c19jbGkoKTsKICAgIH0KICAgIAogICAgLy8gRXh0cmVtZSBsZXZlbCB0ZXN0cyBmb3IgQ0xJIChsZXZlbCAzKQogICAgaWYgKHRlc3RfbGV2ZWwgPj0gMykgewogICAgICAgIC8vIEFkZCBDTEkgZXh0cmVtZSB0ZXN0cyBoZXJlIGlmIG5lZWRlZAogICAgfQp9Cgp2b2lkIHJ1bl9hbGxfaHR0cF90ZXN0cygpIHsKICAgIHByaW50ZihDWUFOIEJPTEQgIlxuPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgcHJpbnRmKENZQU4gQk9MRCAiICAgU1lEQiBIVFRQIEFQSSBDT01QUkVIRU5TSVZFIFRFU1QgU1VJVEVcbiIgUkVTRVQpOwogICAgcHJpbnRmKENZQU4gQk9MRCAiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgcHJpbnRmKCJTZXJ2ZXIgVVJMOiAlc1xuIiwgc2VydmVyX3VybCk7CiAgICBwcmludGYoIlRlc3QgbGV2ZWw6ICVzXG4iLCAKICAgICAgICAgICB0ZXN0X2xldmVsID09IDAgPyAiUXVpY2siIDogCiAgICAgICAgICAgdGVzdF9sZXZlbCA9PSAxID8gIlN0YW5kYXJkIiA6IAogICAgICAgICAgIHRlc3RfbGV2ZWwgPT0gMiA/ICJDb21wcmVoZW5zaXZlIiA6ICJFeHRyZW1lIik7CiAgICBwcmludGYoIlZlcmJvc2U6ICVzXG4iLCB2ZXJib3NlX21vZGUgPyAiWWVzIiA6ICJObyIpOwogICAgcHJpbnRmKENZQU4gQk9MRCAiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuIiBSRVNFVCk7CiAgICAKICAgIC8vIFRlc3QgY29ubmVjdGl2aXR5IGZpcnN0CiAgICBIdHRwUmVzcG9uc2UqIHRlc3RfcmVzcG9uc2UgPSBodHRwX3JlcXVlc3QoIkdFVCIsICIvYXBpL2RhdGFiYXNlcyIsIE5VTEwsIE5VTEwpOwogICAgaWYgKCF0ZXN0X3Jlc3BvbnNlIHx8IHRlc3RfcmVzcG9uc2UtPnN0YXR1c19jb2RlID09IDApIHsKICAgICAgICBwcmludGYoUkVEICJFUlJPUjogQ2Fubm90IGNvbm5lY3QgdG8gc2VydmVyIGF0ICVzXG4iIFJFU0VULCBzZXJ2ZXJfdXJsKTsKICAgICAgICBwcmludGYoWUVMTE9XICJBdHRlbXB0aW5nIHRvIHN0YXJ0IHNlcnZlciBhdXRvbWF0aWNhbGx5Li4uXG4iIFJFU0VUKTsKICAgICAgICAKICAgICAgICBpZiAoIXN0YXJ0X3N5ZGJfc2VydmVyKCkpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiRmFpbGVkIHRvIHN0YXJ0IHNlcnZlci4gUGxlYXNlIHN0YXJ0IG1hbnVhbGx5IHdpdGg6ICVzIC0tc2VydmVyXG4iIFJFU0VULCBjbGlfY29tbWFuZCk7CiAgICAgICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZSh0ZXN0X3Jlc3BvbnNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KICAgIGh0dHBfcmVzcG9uc2VfZnJlZSh0ZXN0X3Jlc3BvbnNlKTsKICAgIAogICAgLy8gQ2xlYW4gdXAgb2xkIHRlc3QgZGF0YWJhc2VzCiAgICBjbGVhbnVwX3Rlc3RfZGF0YWJhc2VzKCk7CiAgICAKICAgIC8vIExldmVsIDA6IFNtb2tlIHRlc3RzIG9ubHkKICAgIHJ1bl9zbW9rZV90ZXN0c19odHRwKCk7CiAgICAKICAgIC8vIExldmVsIDE6IFN0YW5kYXJkIHRlc3RzCiAgICBpZiAodGVzdF9sZXZlbCA+PSAxKSB7CiAgICAgICAgcnVuX2h0dHBfZGF0YWJhc2VfdGVzdHMoKTsKICAgICAgICBydW5faHR0cF9jb2xsZWN0aW9uX3Rlc3RzKCk7CiAgICAgICAgcnVuX2h0dHBfaW5zdGFuY2VfdGVzdHMoKTsKICAgICAgICBydW5faHR0cF9jb21tYW5kX3Rlc3RzKCk7CiAgICAgICAgcnVuX2h0dHBfZXJyb3JfdGVzdHMoKTsKICAgICAgICBydW5fc2VjdXJpdHlfdGVzdHNfaHR0cCgpOwogICAgICAgIHJ1bl9zY2hlbWFfZW5mb3JjZW1lbnRfdGVzdHNfaHR0cCgpOwogICAgICAgIHJ1bl9xdWVyeV9sYW5ndWFnZV90ZXN0c19odHRwKCk7CiAgICAgICAgcnVuX3BlcmZvcm1hbmNlX3Rlc3RzX2h0dHAoKTsKICAgIH0KICAgIAogICAgLy8gTGV2ZWwgMjogQ29tcHJlaGVuc2l2ZSB0ZXN0cwogICAgaWYgKHRlc3RfbGV2ZWwgPj0gMikgewogICAgICAgIHJ1bl9jb25jdXJyZW5jeV90ZXN0c19odHRwKCk7CiAgICAgICAgcnVuX2R1cmFiaWxpdHlfdGVzdHNfaHR0cCgpOwogICAgfQogICAgCiAgICAvLyBMZXZlbCAzOiBFeHRyZW1lIHRlc3RzIChORVcgLSBtdWNoIG1vcmUgcm9idXN0IHRoYW4gbGV2ZWwgMikKICAgIGlmICh0ZXN0X2xldmVsID49IDMpIHsKICAgICAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoTUFHRU5UQSBCT0xEICIgICBFWFRSRU1FIFRFU1QgU1VJVEUgLSBMRVZFTCAzXG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoTUFHRU5UQSBCT0xEICIgICBUaGVzZSB0ZXN0cyBwdXNoIHRoZSBzeXN0ZW0gdG8gaXRzIGxpbWl0c1xuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKE1BR0VOVEEgQk9MRCAiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgICAgIAogICAgICAgIC8vIFJ1biBhbGwgbGV2ZWwgMyBlbmhhbmNlZCB0ZXN0cwogICAgICAgIHJ1bl9odHRwX3N0cmVzc190ZXN0cygpOwogICAgICAgIHJ1bl9odHRwX2RhdGFfY29ycnVwdGlvbl90ZXN0cygpOwogICAgICAgIHJ1bl9odHRwX21peGVkX3dvcmtsb2FkX3Rlc3RzKCk7CiAgICAgICAgcnVuX2h0dHBfbG9uZ19ydW5uaW5nX3Rlc3RzKCk7CiAgICAgICAgcnVuX2h0dHBfY29uc2lzdGVuY3lfdGVzdHMoKTsKICAgICAgICBydW5faHR0cF9mYXVsdF9pbmplY3Rpb25fdGVzdHMoKTsKICAgICAgICBydW5faHR0cF9jaGFvc190ZXN0cygpOwogICAgICAgIHJ1bl9odHRwX2JvdW5kYXJ5X3Rlc3RzX2V4dHJlbWUoKTsKICAgICAgICAKICAgICAgICBwcmludGYoIlxuIiBNQUdFTlRBIEJPTEQgIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgLy8gU3RvcCBzZXJ2ZXIgaWYgd2Ugc3RhcnRlZCBpdAogICAgaWYgKHNlcnZlcl9zdGFydGVkX2J5X3Rlc3QpIHsKICAgICAgICBzdG9wX3N5ZGJfc2VydmVyKCk7CiAgICB9Cn0KCi8vID09PT09PT09PT09PT09PT09PT09IENMRUFOVVAgRlVOQ1RJT04gPT09PT09PT09PT09PT09PT09PT0KCnZvaWQgY2xlYW51cF90ZXN0X2RhdGFiYXNlcygpIHsKICAgIHByaW50ZigiQ2xlYW5pbmcgdXAgcHJldmlvdXMgdGVzdCBkYXRhYmFzZXMuLi5cbiIpOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gQ2xlYW5pbmcgdXAgdGVzdCBkaXJlY3RvcmllcyBpbiAvdG1wL3N5ZGJfdGVzdC9cbiIgUkVTRVQpOwogICAgfQogICAgCiAgICBjaGFyIGNvbW1hbmRbNTEyXTsKICAgIHNucHJpbnRmKGNvbW1hbmQsIHNpemVvZihjb21tYW5kKSwgInJtIC1yZiAvdG1wL3N5ZGJfdGVzdC90ZXN0ZGJfKiAvdG1wL3N5ZGJfdGVzdC90ZXN0ZGIyXyogL3RtcC9zeWRiX3Rlc3QvdGVzdGNvbGxkYl8qIC90bXAvc3lkYl90ZXN0L3Rlc3RpbnN0ZGJfKiAyPi9kZXYvbnVsbCIpOwogICAgc3lzdGVtKGNvbW1hbmQpOwogICAgCiAgICBzbnByaW50Zihjb21tYW5kLCBzaXplb2YoY29tbWFuZCksICJybSAtZiAvdG1wL3N5ZGJfdGVzdC8qLmxvY2sgL3RtcC9zeWRiX3Rlc3QvLioubG9jayAyPi9kZXYvbnVsbCIpOwogICAgc3lzdGVtKGNvbW1hbmQpOwogICAgCiAgICB1c2xlZXAoNTAwMDApOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gQ2xlYW51cCBjb21wbGV0ZWRcbiIgUkVTRVQpOwogICAgfQp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBSRVNVTFRTIFJFUE9SVElORyA9PT09PT09PT09PT09PT09PT09PQoKdm9pZCBwcmludF9maW5hbF9yZXN1bHRzKCkgewogICAgcHJpbnRmKCJcbiIpOwogICAgcHJpbnRmKENZQU4gQk9MRCAiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgcHJpbnRmKENZQU4gQk9MRCAiICAgICAgICAgICBGSU5BTCBURVNUIFJFU1VMVFNcbiIgUkVTRVQpOwogICAgcHJpbnRmKENZQU4gQk9MRCAiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgCiAgICBwcmludGYoIlRvdGFsIFRlc3RzOiAgICAgICVkXG4iLCBzdGF0cy50b3RhbF90ZXN0cyk7CiAgICBwcmludGYoIlBhc3NlZDogICAgICAgICAgICIgR1JFRU4gIiVkIiBSRVNFVCAiXG4iLCBzdGF0cy5wYXNzZWRfdGVzdHMpOwogICAgcHJpbnRmKCJGYWlsZWQ6ICAgICAgICAgICAiIFJFRCAiJWQiIFJFU0VUICJcbiIsIHN0YXRzLmZhaWxlZF90ZXN0cyk7CiAgICBwcmludGYoIlNraXBwZWQ6ICAgICAgICAgICIgWUVMTE9XICIlZCIgUkVTRVQgIlxuIiwgc3RhdHMuc2tpcHBlZF90ZXN0cyk7CiAgICBwcmludGYoIkNyaXRpY2FsIEZhaWx1cmVzOiIgUkVEICIlZCIgUkVTRVQgIlxuIiwgc3RhdHMuY3JpdGljYWxfZmFpbHVyZXMpOwogICAgcHJpbnRmKCJUb3RhbCBEdXJhdGlvbjogICAiIENZQU4gIiVsbGQgbXMiIFJFU0VUICJcbiIsIHN0YXRzLnRvdGFsX2R1cmF0aW9uKTsKICAgIAogICAgcHJpbnRmKCJcbiIgQk9MRCAiQ2F0ZWdvcnkgQnJlYWtkb3duOlxuIiBSRVNFVCk7CiAgICBwcmludGYoIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIik7CiAgICAKICAgIGNvbnN0IGNoYXIqIGNhdF9uYW1lc1tdID0gewogICAgICAgICJTbW9rZSBUZXN0cyIsCiAgICAgICAgIkR1cmFiaWxpdHkiLCAKICAgICAgICAiQ29uY3VycmVuY3kiLAogICAgICAgICJRdWVyeSBMYW5ndWFnZSIsCiAgICAgICAgIlNjaGVtYSBFbmZvcmNlbWVudCIsCiAgICAgICAgIlNlY3VyaXR5IiwKICAgICAgICAiUGVyZm9ybWFuY2UiLAogICAgICAgICJEYXRhIEludGVncml0eSIsCiAgICAgICAgIkVkZ2UgQ2FzZXMiLAogICAgICAgICJSZWNvdmVyeSIKICAgIH07CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgIGlmIChzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW2ldID4gMCkgewogICAgICAgICAgICBkb3VibGUgcGN0ID0gKGRvdWJsZSlzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtpXSAvIHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbaV0gKiAxMDA7CiAgICAgICAgICAgIGNoYXIqIGNvbG9yID0gcGN0ID49IDkwID8gR1JFRU4gOiAocGN0ID49IDcwID8gWUVMTE9XIDogUkVEKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50ZigiJS0xOHM6ICVzJTJkLyUtMmQgKCUzLjBmJSUpJXNcbiIsIAogICAgICAgICAgICAgICAgICAgY2F0X25hbWVzW2ldLCBjb2xvciwgCiAgICAgICAgICAgICAgICAgICBzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtpXSwgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtpXSwgcGN0LCBSRVNFVCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcmludGYoQ1lBTiBCT0xEICI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIiBSRVNFVCk7CiAgICAKICAgIC8vIE92ZXJhbGwgdmVyZGljdAogICAgcHJpbnRmKCJcbiIgQk9MRCAiVkVSRElDVDogIiBSRVNFVCk7CiAgICAKICAgIGlmIChzdGF0cy5jcml0aWNhbF9mYWlsdXJlcyA9PSAwICYmIHN0YXRzLnBhc3NlZF90ZXN0cyA+PSBzdGF0cy50b3RhbF90ZXN0cyAqIDAuOSkgewogICAgICAgIHByaW50ZihHUkVFTiAiUEFTUyAtIEFsbCBjcml0aWNhbCB0ZXN0cyBwYXNzZWRcbiIgUkVTRVQpOwogICAgfSBlbHNlIGlmIChzdGF0cy5jcml0aWNhbF9mYWlsdXJlcyA9PSAwICYmIHN0YXRzLnBhc3NlZF90ZXN0cyA+PSBzdGF0cy50b3RhbF90ZXN0cyAqIDAuNykgewogICAgICAgIHByaW50ZihZRUxMT1cgIlBBU1MgV0lUSCBXQVJOSU5HUyAtIFNvbWUgbm9uLWNyaXRpY2FsIHRlc3RzIGZhaWxlZFxuIiBSRVNFVCk7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZihSRUQgIkZBSUwgLSBDcml0aWNhbCBmYWlsdXJlcyBkZXRlY3RlZFxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKCJcbiIgWUVMTE9XICJTeURCIGlzIE5PVCByZWFkeSBmb3IgcHJvZHVjdGlvbiB1c2UuXG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoWUVMTE9XICJUaGUgZm9sbG93aW5nIGNyaXRpY2FsIGFyZWFzIG5lZWQgYXR0ZW50aW9uOlxuIiBSRVNFVCk7CiAgICAgICAgCiAgICAgICAgaWYgKHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX0RVUkFCSUxJVFldIDwgc3RhdHMuY2F0ZWdvcmllc190b3RhbFtDQVRFR09SWV9EVVJBQklMSVRZXSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIOKAoiBEdXJhYmlsaXR5L0NyYXNoIFJlY292ZXJ5IC0gRGF0YSBtYXkgbm90IHN1cnZpdmUgcG93ZXIgbG9zc1xuIiBSRVNFVCk7CiAgICAgICAgfQogICAgICAgIGlmIChzdGF0cy5jYXRlZ29yaWVzX3Bhc3NlZFtDQVRFR09SWV9DT05DVVJSRU5DWV0gPCBzdGF0cy5jYXRlZ29yaWVzX3RvdGFsW0NBVEVHT1JZX0NPTkNVUlJFTkNZXSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIOKAoiBDb25jdXJyZW5jeSAtIE1heSBjb3JydXB0IHVuZGVyIHBhcmFsbGVsIGxvYWRcbiIgUkVTRVQpOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfU0NIRU1BXSA8IHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfU0NIRU1BXSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIOKAoiBTY2hlbWEgRW5mb3JjZW1lbnQgLSBOb3QgcHJvcGVybHkgdmFsaWRhdGluZyBkYXRhXG4iIFJFU0VUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRzLmNhdGVnb3JpZXNfcGFzc2VkW0NBVEVHT1JZX1JFQ09WRVJZXSA8IHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfUkVDT1ZFUlldKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAg4oCiIFJlY292ZXJ5IC0gQ2Fubm90IHJlY292ZXIgZnJvbSBjcmFzaGVzL2NvcnJ1cHRpb25cbiIgUkVTRVQpOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhdHMuY2F0ZWdvcmllc19wYXNzZWRbQ0FURUdPUllfSU5URUdSSVRZXSA8IHN0YXRzLmNhdGVnb3JpZXNfdG90YWxbQ0FURUdPUllfSU5URUdSSVRZXSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIOKAoiBEYXRhIEludGVncml0eSAtIEZpbGUgZm9ybWF0IGlzc3VlcyBkZXRlY3RlZFxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcmludGYoQ1lBTiBCT0xEICI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4iIFJFU0VUKTsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gTUFJTiBGVU5DVElPTiA9PT09PT09PT09PT09PT09PT09PQoKdm9pZCBwcmludF91c2FnZShjb25zdCBjaGFyICpwcm9ncmFtX25hbWUpIHsKICAgIHByaW50ZigiVXNhZ2U6ICVzIFtPUFRJT05TXVxuIiwgcHJvZ3JhbV9uYW1lKTsKICAgIHByaW50ZigiXG4iKTsKICAgIHByaW50ZigiVEVTVCBNT0RFUzpcbiIpOwogICAgcHJpbnRmKCIgIC0tY2xpICAgICAgICAgICBUZXN0IENMSSBtb2RlIChkZWZhdWx0IGlmIG5vIG1vZGUgc3BlY2lmaWVkKVxuIik7CiAgICBwcmludGYoIiAgLS1zZXJ2ZXIgICAgICAgIFRlc3QgSFRUUCBBUEkgbW9kZSAocmVxdWlyZXMgcnVubmluZyBzZXJ2ZXIgb3Igd2lsbCBhdXRvLXN0YXJ0KVxuIik7CiAgICBwcmludGYoIlxuIik7CiAgICBwcmludGYoIlRFU1QgTEVWRUxTOlxuIik7CiAgICBwcmludGYoIiAgLS1sZXZlbD0wICAgICAgIFF1aWNrIG1vZGUgLSBzbW9rZSB0ZXN0cyBvbmx5XG4iKTsKICAgIHByaW50ZigiICAtLWxldmVsPTEgICAgICAgU3RhbmRhcmQgbW9kZSAtIGNvcmUgZnVuY3Rpb25hbGl0eSAoZGVmYXVsdClcbiIpOwogICAgcHJpbnRmKCIgIC0tbGV2ZWw9MiAgICAgICBDb21wcmVoZW5zaXZlIC0gaW5jbHVkZXMgZHVyYWJpbGl0eSAmIGNvbmN1cnJlbmN5XG4iKTsKICAgIHByaW50ZigiICAtLWxldmVsPTMgICAgICAgRXh0cmVtZSAtIHN0cmVzcywgY29ycnVwdGlvbiwgY2hhb3MsIGFuZCBib3VuZGFyeSB0ZXN0c1xuIik7CiAgICBwcmludGYoIlxuIik7CiAgICBwcmludGYoIk9QVElPTlM6XG4iKTsKICAgIHByaW50ZigiICAtLWNvbW1hbmQ9UEFUSCAgU3BlY2lmeSBzeWRiIGNvbW1hbmQgcGF0aCAoZGVmYXVsdDogLi9zeWRiKVxuIik7CiAgICBwcmludGYoIiAgLS11cmw9VVJMICAgICAgIFNwZWNpZnkgc2VydmVyIFVSTCBmb3IgSFRUUCB0ZXN0cyAoZGVmYXVsdDogaHR0cDovL2xvY2FsaG9zdDo4MDgwKVxuIik7CiAgICBwcmludGYoIiAgLS12ZXJib3NlICAgICAgIEVuYWJsZSBleHRyZW1lbHkgZGV0YWlsZWQgbG9nZ2luZ1xuIik7CiAgICBwcmludGYoIiAgLS1oZWxwLCAtaCAgICAgIFNob3cgdGhpcyBoZWxwIG1lc3NhZ2VcbiIpOwogICAgcHJpbnRmKCJcbiIpOwogICAgcHJpbnRmKCJFWEFNUExFUzpcbiIpOwogICAgcHJpbnRmKCIgICVzICAgICAgICAgICAgICAgICAgICAgICAgICMgUXVpY2sgQ0xJIHNtb2tlIHRlc3RzXG4iLCBwcm9ncmFtX25hbWUpOwogICAgcHJpbnRmKCIgICVzIC0tbGV2ZWw9MSAgICAgICAgICAgICAgICMgU3RhbmRhcmQgQ0xJIHRlc3RzXG4iLCBwcm9ncmFtX25hbWUpOwogICAgcHJpbnRmKCIgICVzIC0tbGV2ZWw9MiAtLXZlcmJvc2UgICAgICMgQ29tcHJlaGVuc2l2ZSBDTEkgdGVzdHMgd2l0aCBkZWJ1ZyBvdXRwdXRcbiIsIHByb2dyYW1fbmFtZSk7CiAgICBwcmludGYoIiAgJXMgLS1sZXZlbD0zICAgICAgICAgICAgICAgIyBFeHRyZW1lIENMSSB0ZXN0cyAoaWYgYXZhaWxhYmxlKVxuIiwgcHJvZ3JhbV9uYW1lKTsKICAgIHByaW50ZigiICAlcyAtLXNlcnZlciAtLWxldmVsPTEgICAgICAjIFN0YW5kYXJkIEhUVFAgQVBJIHRlc3RzXG4iLCBwcm9ncmFtX25hbWUpOwogICAgcHJpbnRmKCIgICVzIC0tc2VydmVyIC0tbGV2ZWw9MyAgICAgICMgRXh0cmVtZSBIVFRQIEFQSSB0ZXN0c1xuIiwgcHJvZ3JhbV9uYW1lKTsKICAgIHByaW50ZigiICAlcyAtLXNlcnZlciAtLXVybD1odHRwOi8vbG9jYWxob3N0OjkwMDAgICMgSFRUUCB0ZXN0cyBvbiBjdXN0b20gcG9ydFxuIiwgcHJvZ3JhbV9uYW1lKTsKfQoKaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkgewogICAgLy8gRGVmYXVsdCBzZXR0aW5ncwogICAgdGVzdF9tb2RlID0gVEVTVF9NT0RFX0NMSTsgIC8vIERlZmF1bHQgdG8gQ0xJCiAgICB0ZXN0X2xldmVsID0gMTsgICAgICAgICAgICAgLy8gRGVmYXVsdCB0byBzdGFuZGFyZAogICAgdmVyYm9zZV9tb2RlID0gMDsKICAgIHN0cmNweShjbGlfY29tbWFuZCwgIi4vc3lkYiIpOwogICAgc3RyY3B5KHNlcnZlcl91cmwsICJodHRwOi8vbG9jYWxob3N0OjgwODAiKTsKICAgIAogICAgLy8gUGFyc2UgY29tbWFuZCBsaW5lIGFyZ3VtZW50cwogICAgZm9yIChpbnQgaSA9IDE7IGkgPCBhcmdjOyBpKyspIHsKICAgICAgICBpZiAoc3RyY21wKGFyZ3ZbaV0sICItLWNsaSIpID09IDApIHsKICAgICAgICAgICAgdGVzdF9tb2RlID0gVEVTVF9NT0RFX0NMSTsKICAgICAgICB9IGVsc2UgaWYgKHN0cmNtcChhcmd2W2ldLCAiLS1zZXJ2ZXIiKSA9PSAwKSB7CiAgICAgICAgICAgIHRlc3RfbW9kZSA9IFRFU1RfTU9ERV9TRVJWRVI7CiAgICAgICAgfSBlbHNlIGlmIChzdHJjbXAoYXJndltpXSwgIi0tdmVyYm9zZSIpID09IDApIHsKICAgICAgICAgICAgdmVyYm9zZV9tb2RlID0gMTsKICAgICAgICB9IGVsc2UgaWYgKHN0cm5jbXAoYXJndltpXSwgIi0tbGV2ZWw9IiwgOCkgPT0gMCkgewogICAgICAgICAgICB0ZXN0X2xldmVsID0gYXRvaShhcmd2W2ldICsgOCk7CiAgICAgICAgICAgIGlmICh0ZXN0X2xldmVsIDwgMCB8fCB0ZXN0X2xldmVsID4gMykgdGVzdF9sZXZlbCA9IDE7CiAgICAgICAgfSBlbHNlIGlmIChzdHJuY21wKGFyZ3ZbaV0sICItLWNvbW1hbmQ9IiwgMTApID09IDApIHsKICAgICAgICAgICAgc3RybmNweShjbGlfY29tbWFuZCwgYXJndltpXSArIDEwLCBzaXplb2YoY2xpX2NvbW1hbmQpIC0gMSk7CiAgICAgICAgfSBlbHNlIGlmIChzdHJuY21wKGFyZ3ZbaV0sICItLXVybD0iLCA2KSA9PSAwKSB7CiAgICAgICAgICAgIHN0cm5jcHkoc2VydmVyX3VybCwgYXJndltpXSArIDYsIHNpemVvZihzZXJ2ZXJfdXJsKSAtIDEpOwogICAgICAgIH0gZWxzZSBpZiAoc3RyY21wKGFyZ3ZbaV0sICItLWhlbHAiKSA9PSAwIHx8IHN0cmNtcChhcmd2W2ldLCAiLWgiKSA9PSAwKSB7CiAgICAgICAgICAgIHByaW50X3VzYWdlKGFyZ3ZbMF0pOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgUkVEICJVbmtub3duIG9wdGlvbjogJXNcbiIgUkVTRVQsIGFyZ3ZbaV0pOwogICAgICAgICAgICBwcmludF91c2FnZShhcmd2WzBdKTsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBTZXQgZW52aXJvbm1lbnQKICAgIHNldGVudigiU1lEQl9CQVNFX0RJUiIsICIvdG1wL3N5ZGJfdGVzdCIsIDEpOwogICAgCiAgICAvLyBJbml0aWFsaXplIHN0YXRpc3RpY3MKICAgIG1lbXNldCgmc3RhdHMsIDAsIHNpemVvZihzdGF0cykpOwogICAgCiAgICAvLyBSdW4gdGVzdHMgYmFzZWQgb24gbW9kZQogICAgbG9uZyBsb25nIG92ZXJhbGxfc3RhcnQgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAKICAgIGlmICh0ZXN0X21vZGUgPT0gVEVTVF9NT0RFX0NMSSkgewogICAgICAgIHJ1bl9hbGxfY2xpX3Rlc3RzKCk7CiAgICB9IGVsc2UgaWYgKHRlc3RfbW9kZSA9PSBURVNUX01PREVfU0VSVkVSKSB7CiAgICAgICAgcnVuX2FsbF9odHRwX3Rlc3RzKCk7CiAgICB9CiAgICAKICAgIHN0YXRzLnRvdGFsX2R1cmF0aW9uID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gb3ZlcmFsbF9zdGFydDsKICAgIAogICAgLy8gUHJpbnQgcmVzdWx0cwogICAgcHJpbnRfZmluYWxfcmVzdWx0cygpOwogICAgCiAgICAvLyBSZXR1cm4gY29kZSBiYXNlZCBvbiBjcml0aWNhbCBmYWlsdXJlcwogICAgcmV0dXJuIChzdGF0cy5jcml0aWNhbF9mYWlsdXJlcyA9PSAwICYmIHN0YXRzLnBhc3NlZF90ZXN0cyA+PSBzdGF0cy50b3RhbF90ZXN0cyAqIDAuNykgPyAwIDogMTsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gT1JJR0lOQUwgSFRUUCBURVNUIEZVTkNUSU9OUyA9PT09PT09PT09PT09PT09PT09PQovLyBDb3B5IHRoZXNlIGV4YWN0bHkgZnJvbSB5b3VyIG9yaWdpbmFsIHRlc3QuYwoKaW50IHJ1bl9odHRwX2RhdGFiYXNlX3Rlc3RzKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSAiSFRUUCBBUEkgREFUQUJBU0UgVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNoYXIgdW5pcXVlX2RiMVs2NF0sIHVuaXF1ZV9kYjJbNjRdOwogICAgc3RydWN0IHRpbWVzcGVjIHRzOwogICAgY2xvY2tfZ2V0dGltZShDTE9DS19NT05PVE9OSUMsICZ0cyk7CiAgICBzbnByaW50Zih1bmlxdWVfZGIxLCBzaXplb2YodW5pcXVlX2RiMSksICJ0ZXN0ZGJfJWxkXyVsZCIsIHRzLnR2X3NlYywgdHMudHZfbnNlYyk7CiAgICBzbnByaW50Zih1bmlxdWVfZGIyLCBzaXplb2YodW5pcXVlX2RiMiksICJ0ZXN0ZGIyXyVsZF8lbGQiLCB0cy50dl9zZWMsIHRzLnR2X25zZWMgKyAxKTsKICAgIAogICAgY2hhciBjcmVhdGVfZGIxX2JvZHlbMTI4XSwgY3JlYXRlX2RiMl9ib2R5WzEyOF07CiAgICBzbnByaW50ZihjcmVhdGVfZGIxX2JvZHksIHNpemVvZihjcmVhdGVfZGIxX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCB1bmlxdWVfZGIxKTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYjJfYm9keSwgc2l6ZW9mKGNyZWF0ZV9kYjJfYm9keSksICJ7XCJuYW1lXCI6XCIlc1wifSIsIHVuaXF1ZV9kYjIpOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMgLSBMaXN0IGRhdGFiYXNlcyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCAiL2FwaS9kYXRhYmFzZXMiLCBOVUxMLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDEsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzIC0gQ3JlYXRlIGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfZGIxX2JvZHksICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMgLSBDcmVhdGUgc2Vjb25kIGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfZGIyX2JvZHksICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMgLSBQcmV2ZW50IGR1cGxpY2F0ZSBkYXRhYmFzZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiMV9ib2R5LCAiXCJzdWNjZXNzXCI6ZmFsc2UiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY2hhciBkZWxldGVfdXJsWzI1Nl07CiAgICBzbnByaW50ZihkZWxldGVfdXJsLCBzaXplb2YoZGVsZXRlX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcyIsIHVuaXF1ZV9kYjIpOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiREVMRVRFIC9hcGkvZGF0YWJhc2VzL3tuYW1lfSAtIERlbGV0ZSBkYXRhYmFzZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJERUxFVEUiLCBkZWxldGVfdXJsLCBOVUxMLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIERhdGFiYXNlIEFQSSB0ZXN0czogJWQvJWQgcGFzc2VkIChhdmc6ICVsbGQgbXMpXG4iIFJFU0VULCAKICAgICAgICAgICBwYXNzZWQsIHRvdGFsLCB0b3RhbF90aW1lIC8gKHRvdGFsID4gMCA/IHRvdGFsIDogMSkpOwogICAgCiAgICByZXR1cm4gcGFzc2VkOwp9CgppbnQgcnVuX2h0dHBfY29sbGVjdGlvbl90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIkhUVFAgQVBJIENPTExFQ1RJT04gVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNoYXIgdW5pcXVlX2RiWzY0XTsKICAgIHN0cnVjdCB0aW1lc3BlYyB0czsKICAgIGNsb2NrX2dldHRpbWUoQ0xPQ0tfTU9OT1RPTklDLCAmdHMpOwogICAgc25wcmludGYodW5pcXVlX2RiLCBzaXplb2YodW5pcXVlX2RiKSwgInRlc3Rjb2xsZGJfJWxkXyVsZCIsIHRzLnR2X3NlYywgdHMudHZfbnNlYyk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMTI4XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCB1bmlxdWVfZGIpOwogICAgCiAgICBIdHRwUmVzcG9uc2UqIGRiX3Jlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiX2JvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBpZiAoIWRiX3Jlc3BvbnNlIHx8ICF2ZXJpZnlfaHR0cF9yZXNwb25zZShkYl9yZXNwb25zZSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwKSkgewogICAgICAgIHByaW50ZihSRUQgIiAgRmFpbGVkIHRvIGNyZWF0ZSB0ZXN0IGRhdGFiYXNlIGZvciBjb2xsZWN0aW9uIHRlc3RzXG4iIFJFU0VUKTsKICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUoZGJfcmVzcG9uc2UpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgaHR0cF9yZXNwb25zZV9mcmVlKGRiX3Jlc3BvbnNlKTsKICAgIAogICAgY2hhciBsaXN0X2NvbGxzX3VybFsyNTZdOwogICAgc25wcmludGYobGlzdF9jb2xsc191cmwsIHNpemVvZihsaXN0X2NvbGxzX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucyIsIHVuaXF1ZV9kYik7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucyAtIExpc3QgZW1wdHkgY29sbGVjdGlvbnMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgbGlzdF9jb2xsc191cmwsIE5VTEwsICJcImNvbGxlY3Rpb25zXCI6W10iLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY2hhciBjcmVhdGVfY29sbF91cmxbMjU2XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9jb2xsX3VybCwgc2l6ZW9mKGNyZWF0ZV9jb2xsX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucyIsIHVuaXF1ZV9kYik7CiAgICAKICAgIGNvbnN0IGNoYXIqIHVzZXJzX3NjaGVtYSA9ICJ7XCJuYW1lXCI6XCJ1c2Vyc1wiLFwic2NoZW1hXCI6WyIKICAgICAgICAie1wibmFtZVwiOlwibmFtZVwiLFwidHlwZVwiOlwic3RyaW5nXCIsXCJyZXF1aXJlZFwiOnRydWUsXCJpbmRleGVkXCI6ZmFsc2V9LCIKICAgICAgICAie1wibmFtZVwiOlwiYWdlXCIsXCJ0eXBlXCI6XCJpbnRcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJpbmRleGVkXCI6ZmFsc2V9LCIKICAgICAgICAie1wibmFtZVwiOlwiZW1haWxcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjpmYWxzZSxcImluZGV4ZWRcIjpmYWxzZX0iCiAgICAgICAgIl19IjsKICAgIAogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiUE9TVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zIC0gQ3JlYXRlIHVzZXJzIGNvbGxlY3Rpb24iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsIGNyZWF0ZV9jb2xsX3VybCwgdXNlcnNfc2NoZW1hLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBjb25zdCBjaGFyKiBwcm9kdWN0c19zY2hlbWEgPSAie1wibmFtZVwiOlwicHJvZHVjdHNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjp0cnVlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcInByaWNlXCIsXCJ0eXBlXCI6XCJmbG9hdFwiLFwicmVxdWlyZWRcIjpmYWxzZSxcImluZGV4ZWRcIjpmYWxzZX0iCiAgICAgICAgIl19IjsKICAgIAogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiUE9TVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zIC0gQ3JlYXRlIHByb2R1Y3RzIGNvbGxlY3Rpb24iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsIGNyZWF0ZV9jb2xsX3VybCwgcHJvZHVjdHNfc2NoZW1hLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucyAtIExpc3QgY3JlYXRlZCBjb2xsZWN0aW9ucyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBsaXN0X2NvbGxzX3VybCwgTlVMTCwgIlwidXNlcnNcIiIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBjaGFyIHNjaGVtYV91cmxbMjU2XTsKICAgIHNucHJpbnRmKHNjaGVtYV91cmwsIHNpemVvZihzY2hlbWFfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL3NjaGVtYSIsIHVuaXF1ZV9kYik7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucy97Y29sbH0vc2NoZW1hIC0gR2V0IHVzZXJzIHNjaGVtYSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBzY2hlbWFfdXJsLCBOVUxMLCAiXCJuYW1lXCIiLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY2hhciBkZWxldGVfY29sbF91cmxbMjU2XTsKICAgIHNucHJpbnRmKGRlbGV0ZV9jb2xsX3VybCwgc2l6ZW9mKGRlbGV0ZV9jb2xsX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy9wcm9kdWN0cyIsIHVuaXF1ZV9kYik7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJERUxFVEUgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucy97Y29sbH0gLSBEZWxldGUgcHJvZHVjdHMgY29sbGVjdGlvbiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJERUxFVEUiLCBkZWxldGVfY29sbF91cmwsIE5VTEwsICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgQ29sbGVjdGlvbiBBUEkgdGVzdHM6ICVkLyVkIHBhc3NlZCAoYXZnOiAlbGxkIG1zKVxuIiBSRVNFVCwgCiAgICAgICAgICAgcGFzc2VkLCB0b3RhbCwgdG90YWxfdGltZSAvICh0b3RhbCA+IDAgPyB0b3RhbCA6IDEpKTsKICAgIAogICAgcmV0dXJuIHBhc3NlZDsKfQoKaW50IHJ1bl9odHRwX2luc3RhbmNlX3Rlc3RzKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSAiSFRUUCBBUEkgSU5TVEFOQ0UgVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNoYXIgdW5pcXVlX2RiWzY0XTsKICAgIHN0cnVjdCB0aW1lc3BlYyB0czsKICAgIGNsb2NrX2dldHRpbWUoQ0xPQ0tfTU9OT1RPTklDLCAmdHMpOwogICAgc25wcmludGYodW5pcXVlX2RiLCBzaXplb2YodW5pcXVlX2RiKSwgInRlc3RpbnN0ZGJfJWxkXyVsZCIsIHRzLnR2X3NlYywgdHMudHZfbnNlYyk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMTI4XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCB1bmlxdWVfZGIpOwogICAgCiAgICBIdHRwUmVzcG9uc2UqIGRiX3Jlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiX2JvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBpZiAoIWRiX3Jlc3BvbnNlIHx8ICF2ZXJpZnlfaHR0cF9yZXNwb25zZShkYl9yZXNwb25zZSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwKSkgewogICAgICAgIHByaW50ZihSRUQgIiAgRmFpbGVkIHRvIGNyZWF0ZSB0ZXN0IGRhdGFiYXNlIGZvciBpbnN0YW5jZSB0ZXN0c1xuIiBSRVNFVCk7CiAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKGRiX3Jlc3BvbnNlKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIGh0dHBfcmVzcG9uc2VfZnJlZShkYl9yZXNwb25zZSk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfY29sbF91cmwsIHNpemVvZihjcmVhdGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCB1bmlxdWVfZGIpOwogICAgCiAgICBjb25zdCBjaGFyKiB1c2Vyc19zY2hlbWEgPSAie1wibmFtZVwiOlwidXNlcnNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjp0cnVlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImFnZVwiLFwidHlwZVwiOlwiaW50XCIsXCJyZXF1aXJlZFwiOmZhbHNlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImVtYWlsXCIsXCJ0eXBlXCI6XCJzdHJpbmdcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJpbmRleGVkXCI6ZmFsc2V9IgogICAgICAgICJdfSI7CiAgICAKICAgIEh0dHBSZXNwb25zZSogY29sbF9yZXNwb25zZSA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsIGNyZWF0ZV9jb2xsX3VybCwgdXNlcnNfc2NoZW1hLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaWYgKCFjb2xsX3Jlc3BvbnNlIHx8ICF2ZXJpZnlfaHR0cF9yZXNwb25zZShjb2xsX3Jlc3BvbnNlLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDApKSB7CiAgICAgICAgcHJpbnRmKFJFRCAiICBGYWlsZWQgdG8gY3JlYXRlIHRlc3QgY29sbGVjdGlvbiBmb3IgaW5zdGFuY2UgdGVzdHNcbiIgUkVTRVQpOwogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShjb2xsX3Jlc3BvbnNlKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIGh0dHBfcmVzcG9uc2VfZnJlZShjb2xsX3Jlc3BvbnNlKTsKICAgIAogICAgY2hhciBsaXN0X2luc3RhbmNlc191cmxbMjU2XTsKICAgIHNucHJpbnRmKGxpc3RfaW5zdGFuY2VzX3VybCwgc2l6ZW9mKGxpc3RfaW5zdGFuY2VzX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9pbnN0YW5jZXMiLCB1bmlxdWVfZGIpOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L2luc3RhbmNlcyAtIExpc3QgZW1wdHkgaW5zdGFuY2VzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsIGxpc3RfaW5zdGFuY2VzX3VybCwgTlVMTCwgIlwiaW5zdGFuY2VzXCI6W10iLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY29uc3QgY2hhciogdXNlcjEgPSAie1wibmFtZVwiOlwiSm9obiBEb2VcIixcImFnZVwiOjMwLFwiZW1haWxcIjpcImpvaG5AdGVzdC5jb21cIn0iOwogICAgY2hhciBpbnNlcnRfdXJsWzI1Nl07CiAgICBzbnByaW50ZihpbnNlcnRfdXJsLCBzaXplb2YoaW5zZXJ0X3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9pbnN0YW5jZXMiLCB1bmlxdWVfZGIpOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L2luc3RhbmNlcyAtIEluc2VydCBmaXJzdCB1c2VyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCBpbnNlcnRfdXJsLCB1c2VyMSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY29uc3QgY2hhciogdXNlcjIgPSAie1wibmFtZVwiOlwiSmFuZSBTbWl0aFwiLFwiYWdlXCI6MjUsXCJlbWFpbFwiOlwiamFuZUB0ZXN0LmNvbVwifSI7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L2luc3RhbmNlcyAtIEluc2VydCBzZWNvbmQgdXNlciIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgaW5zZXJ0X3VybCwgdXNlcjIsICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkdFVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zL3tjb2xsfS9pbnN0YW5jZXMgLSBMaXN0IHVzZXJzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsIGxpc3RfaW5zdGFuY2VzX3VybCwgTlVMTCwgIkpvaG4gRG9lIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGNoYXIgcXVlcnlfdXJsWzUxMl07CiAgICBzbnByaW50ZihxdWVyeV91cmwsIHNpemVvZihxdWVyeV91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzP3F1ZXJ5PWFnZTozMCIsIHVuaXF1ZV9kYik7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS8uLi4vaW5zdGFuY2VzP3F1ZXJ5PWFnZTozMCAtIFF1ZXJ5IGJ5IGFnZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBxdWVyeV91cmwsIE5VTEwsICJKb2huIERvZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBjaGFyKiBpZCA9IGdldF9sYXN0X2luc2VydGVkX2lkKHVuaXF1ZV9kYiwgInVzZXJzIik7CiAgICBpZiAoaWQpIHsKICAgICAgICBjaGFyIHVwZGF0ZV91cmxbMjU2XTsKICAgICAgICBzbnByaW50Zih1cGRhdGVfdXJsLCBzaXplb2YodXBkYXRlX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9pbnN0YW5jZXMvJXMiLCB1bmlxdWVfZGIsIGlkKTsKICAgICAgICBjb25zdCBjaGFyKiB1cGRhdGVfZGF0YSA9ICJ7XCJhZ2VcIjozNSxcImVtYWlsXCI6XCJqb2huLnVwZGF0ZWRAdGVzdC5jb21cIn0iOwogICAgICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBVVCAvYXBpLy4uLi9pbnN0YW5jZXMve2lkfSAtIFVwZGF0ZSB1c2VyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJQVVQiLCB1cGRhdGVfdXJsLCB1cGRhdGVfZGF0YSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICB9CiAgICAgICAgdG90YWwrKzsKICAgICAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgICAgIAogICAgICAgIGNoYXIgZGVsZXRlX3VybFsyNTZdOwogICAgICAgIHNucHJpbnRmKGRlbGV0ZV91cmwsIHNpemVvZihkZWxldGVfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcy8lcyIsIHVuaXF1ZV9kYiwgaWQpOwogICAgICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkRFTEVURSAvYXBpLy4uLi9pbnN0YW5jZXMve2lkfSAtIERlbGV0ZSB1c2VyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJERUxFVEUiLCBkZWxldGVfdXJsLCBOVUxMLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgICAgIHBhc3NlZCsrOwogICAgICAgIH0KICAgICAgICB0b3RhbCsrOwogICAgICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICB9CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgSW5zdGFuY2UgQVBJIHRlc3RzOiAlZC8lZCBwYXNzZWQgKGF2ZzogJWxsZCBtcylcbiIgUkVTRVQsIAogICAgICAgICAgIHBhc3NlZCwgdG90YWwsIHRvdGFsX3RpbWUgLyAodG90YWwgPiAwID8gdG90YWwgOiAxKSk7CiAgICAKICAgIHJldHVybiBwYXNzZWQ7Cn0KCmludCBydW5faHR0cF9jb21tYW5kX3Rlc3RzKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSAiSFRUUCBBUEkgQ09NTUFORCBURVNUUyIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIGxvbmcgbG9uZyB0b3RhbF90aW1lID0gMDsKICAgIGxvbmcgbG9uZyBkdXJhdGlvbjsKICAgIAogICAgY29uc3QgY2hhciogY29tbWFuZCA9ICJ7XCJjb21tYW5kXCI6XCJsaXN0XCIsXCJhcmd1bWVudHNcIjpbXX0iOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiUE9TVCAvYXBpL2V4ZWN1dGUgLSBFeGVjdXRlIGxpc3QgY29tbWFuZCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgIi9hcGkvZXhlY3V0ZSIsIGNvbW1hbmQsICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgQ29tbWFuZCBBUEkgdGVzdHM6ICVkLyVkIHBhc3NlZCAoYXZnOiAlbGxkIG1zKVxuIiBSRVNFVCwgCiAgICAgICAgICAgcGFzc2VkLCB0b3RhbCwgdG90YWxfdGltZSAvIHRvdGFsKTsKICAgIAogICAgcmV0dXJuIHBhc3NlZDsKfQoKaW50IHJ1bl9odHRwX2Vycm9yX3Rlc3RzKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSAiSFRUUCBBUEkgRVJST1IgSEFORExJTkcgVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMgLSBJbnZhbGlkIGRhdGFiYXNlIG5hbWUiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsICJ7XCJuYW1lXCI6XCJpbnZhbGlkL25hbWVcIn0iLCAiXCJzdWNjZXNzXCI6ZmFsc2UiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvZGF0YWJhc2VzL25vbmV4aXN0ZW50L2NvbGxlY3Rpb25zIC0gTm9uLWV4aXN0ZW50IGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsICIvYXBpL2RhdGFiYXNlcy9ub25leGlzdGVudC9jb2xsZWN0aW9ucyIsIE5VTEwsICJcInN1Y2Nlc3NcIjpmYWxzZSIsIDEsICZkdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBDQVRFR09SWV9TTU9LRSwgMSkpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMvdGVzdGRiL2NvbGxlY3Rpb25zL25vbmV4aXN0ZW50L2luc3RhbmNlcyAtIE5vbi1leGlzdGVudCBjb2xsZWN0aW9uIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsICIvYXBpL2RhdGFiYXNlcy90ZXN0ZGIvY29sbGVjdGlvbnMvbm9uZXhpc3RlbnQvaW5zdGFuY2VzIiwgTlVMTCwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgIENBVEVHT1JZX1NNT0tFLCAxKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMgLSBJbnZhbGlkIEpTT04iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsICJpbnZhbGlkIGpzb24iLCAiXCJzdWNjZXNzXCI6ZmFsc2UiLCAxLCAmZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FURUdPUllfU01PS0UsIDEpKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBFcnJvciBoYW5kbGluZyB0ZXN0czogJWQvJWQgcGFzc2VkIChhdmc6ICVsbGQgbXMpXG4iIFJFU0VULCAKICAgICAgICAgICBwYXNzZWQsIHRvdGFsLCB0b3RhbF90aW1lIC8gKHRvdGFsID4gMCA/IHRvdGFsIDogMSkpOwogICAgCiAgICByZXR1cm4gcGFzc2VkOwp9Cg==`;
        const fileContent = Buffer.from(base64Content, 'base64');
        
        fs.writeFileSync(outputFile, fileContent);
        const stats = fs.statSync(outputFile);
        
        console.log(` Successfully extracted: ${outputFile}`);
        console.log(`   Size: ${stats.size} bytes`);
        
        // Verify it's a C file
        const firstLines = fs.readFileSync(outputFile, 'utf8', 0, 200);
        if (firstLines.includes('#include') || /^\s*int\s+main/.test(firstLines)) {
            console.log(`   Verified: Valid C source code`);
        }
        
        console.log(`\n Next steps:`);
        console.log(`   Compile: gcc ${outputFile} -o program`);
        console.log(`   Execute: ./program`);
        
    } catch (error) {
        console.error(` Extraction failed: ${error.message}`);
        process.exit(1);
    }
}

// Run extraction
extractCFile().catch(console.error);
