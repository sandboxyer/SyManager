#!/usr/bin/env node

import fs from 'fs';
import { Buffer } from 'buffer';
import { fileURLToPath } from 'url';
import path from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

async function extractCFile() {
    const scriptName = path.basename(__filename);
    const outputFile = scriptName.replace(/\.js$/, '.c');
    
    if (fs.existsSync(outputFile)) {
        console.log(`Overwriting: ${outputFile}`);
    }
    
    try {
        // Base64 encoded C file content
        const base64Content = `I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4KI2luY2x1ZGUgPHN0cmluZy5oPgojaW5jbHVkZSA8dW5pc3RkLmg+CiNpbmNsdWRlIDxzeXMvdGltZS5oPgojaW5jbHVkZSA8dGltZS5oPgojaW5jbHVkZSA8ZGlyZW50Lmg+CiNpbmNsdWRlIDxzeXMvc3RhdC5oPgojaW5jbHVkZSA8ZmNudGwuaD4KI2luY2x1ZGUgPHN5cy9zb2NrZXQuaD4KI2luY2x1ZGUgPG5ldGluZXQvaW4uaD4KI2luY2x1ZGUgPGFycGEvaW5ldC5oPgojaW5jbHVkZSA8bmV0ZGIuaD4KI2luY2x1ZGUgPGVycm5vLmg+CiNpbmNsdWRlIDxjdHlwZS5oPgoKI2RlZmluZSBSRUQgICAgICJcMDMzWzE7MzFtIgojZGVmaW5lIEdSRUVOICAgIlwwMzNbMTszMm0iCiNkZWZpbmUgWUVMTE9XICAiXDAzM1sxOzMzbSIKI2RlZmluZSBCTFVFICAgICJcMDMzWzE7MzRtIgojZGVmaW5lIE1BR0VOVEEgIlwwMzNbMTszNW0iCiNkZWZpbmUgQ1lBTiAgICAiXDAzM1sxOzM2bSIKI2RlZmluZSBXSElURSAgICJcMDMzWzE7MzdtIgojZGVmaW5lIEdSQVkgICAgIlwwMzNbMTs5MG0iCiNkZWZpbmUgUkVTRVQgICAiXDAzM1swbSIKCnR5cGVkZWYgc3RydWN0IHsKICAgIGNoYXIgZGVzY3JpcHRpb25bNTEyXTsKICAgIGNoYXIgY29tbWFuZFsxMDI0XTsKICAgIGNoYXIgdmVyaWZpY2F0aW9uX2NvbW1hbmRbMTAyNF07CiAgICBjaGFyIGV4cGVjdGVkX291dHB1dFsxMDI0XTsKICAgIGludCBzdWNjZXNzOwogICAgaW50IHZlcmlmaWNhdGlvbl9zdWNjZXNzOwogICAgbG9uZyBsb25nIGR1cmF0aW9uX21zOwogICAgY2hhciBkZXRhaWxzWzEwMjRdOwogICAgY2hhciB2ZXJib3NlX291dHB1dFs0MDk2XTsKfSBUZXN0Q2FzZTsKCmNoYXIgY2xpX2NvbW1hbmRbMzJdID0gIi4vc3lkYiI7CmludCB0ZXN0X21vZGUgPSAwOwpjaGFyIHNlcnZlcl91cmxbMjU2XSA9ICJodHRwOi8vbG9jYWxob3N0OjgwODAiOwppbnQgdmVyYm9zZV9tb2RlID0gMDsKCnR5cGVkZWYgc3RydWN0IHsKICAgIGludCBzdGF0dXNfY29kZTsKICAgIGNoYXIqIGJvZHk7CiAgICBzaXplX3QgYm9keV9sZW5ndGg7Cn0gSHR0cFJlc3BvbnNlOwoKSHR0cFJlc3BvbnNlKiBodHRwX3JlcXVlc3QoY29uc3QgY2hhciogbWV0aG9kLCBjb25zdCBjaGFyKiB1cmwsIGNvbnN0IGNoYXIqIGJvZHksIGNvbnN0IGNoYXIqIGNvbnRlbnRfdHlwZSk7CnZvaWQgaHR0cF9yZXNwb25zZV9mcmVlKEh0dHBSZXNwb25zZSogcmVzcG9uc2UpOwppbnQgaHR0cF90ZXN0X2VuZHBvaW50KGNvbnN0IGNoYXIqIGRlc2NyaXB0aW9uLCBjb25zdCBjaGFyKiBtZXRob2QsIGNvbnN0IGNoYXIqIGVuZHBvaW50LCAKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIqIGJvZHksIGNvbnN0IGNoYXIqIGV4cGVjdGVkX3BhdHRlcm4sIGludCBjaGVja19zdWNjZXNzX29ubHksIGxvbmcgbG9uZyogZHVyYXRpb24pOwppbnQgdmVyaWZ5X2h0dHBfcmVzcG9uc2UoY29uc3QgSHR0cFJlc3BvbnNlKiByZXNwb25zZSwgY29uc3QgY2hhciogZXhwZWN0ZWRfcGF0dGVybiwgaW50IGNoZWNrX3N1Y2Nlc3Nfb25seSk7CmNoYXIqIGV4dHJhY3RfanNvbl9maWVsZChjb25zdCBjaGFyKiBqc29uLCBjb25zdCBjaGFyKiBmaWVsZCk7Cgpsb25nIGxvbmcgZ2V0X2N1cnJlbnRfdGltZV9tcygpOwppbnQgZmlsZV9leGlzdHMoY29uc3QgY2hhciAqcGF0aCk7CmludCBjb3VudF9maWxlc19pbl9kaXJlY3RvcnkoY29uc3QgY2hhciAqcGF0aCk7CmludCBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihjb25zdCBjaGFyICpkYXRhYmFzZSwgY29uc3QgY2hhciAqY29sbGVjdGlvbik7CmNoYXIqIGdldF9sYXN0X2luc2VydGVkX2lkKGNvbnN0IGNoYXIgKmRhdGFiYXNlLCBjb25zdCBjaGFyICpjb2xsZWN0aW9uKTsKaW50IGV4ZWN1dGVfY29tbWFuZF9hbmRfY2FwdHVyZShjb25zdCBjaGFyICpjb21tYW5kLCBjaGFyICpvdXRwdXQsIHNpemVfdCBvdXRwdXRfc2l6ZSk7CmludCBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmVfdmVyYm9zZShjb25zdCBjaGFyICpjb21tYW5kLCBjaGFyICpvdXRwdXQsIHNpemVfdCBvdXRwdXRfc2l6ZSwgY2hhciAqdmVyYm9zZV9vdXRwdXQsIHNpemVfdCB2ZXJib3NlX3NpemUpOwppbnQgdmVyaWZ5X2RhdGFiYXNlX3N0cnVjdHVyZShjb25zdCBjaGFyICpkYXRhYmFzZSk7CmludCB2ZXJpZnlfY29sbGVjdGlvbl9zdHJ1Y3R1cmUoY29uc3QgY2hhciAqZGF0YWJhc2UsIGNvbnN0IGNoYXIgKmNvbGxlY3Rpb24pOwppbnQgdmVyaWZ5X3NjaGVtYV9jb250ZW50KGNvbnN0IGNoYXIgKmRhdGFiYXNlLCBjb25zdCBjaGFyICpjb2xsZWN0aW9uLCBjb25zdCBjaGFyICpleHBlY3RlZF9maWVsZHMpOwppbnQgZXhlY3V0ZV90ZXN0X3dpdGhfdmVyaWZpY2F0aW9uKFRlc3RDYXNlICp0ZXN0KTsKdm9pZCBydW5fc2VjdXJpdHlfdGVzdHMoKTsKdm9pZCBydW5fZGF0YV9pbnRlZ3JpdHlfdGVzdHMoKTsKdm9pZCBydW5fcGVyZm9ybWFuY2VfdGVzdCgpOwp2b2lkIHJ1bl9lZGdlX2Nhc2VfdGVzdHMoKTsKdm9pZCBydW5fY29tcHJlaGVuc2l2ZV92ZXJpZmljYXRpb24oKTsKCmxvbmcgbG9uZyBnZXRfY3VycmVudF90aW1lX21zKCkgewogICAgc3RydWN0IHRpbWV2YWwgdHY7CiAgICBnZXR0aW1lb2ZkYXkoJnR2LCBOVUxMKTsKICAgIHJldHVybiAobG9uZyBsb25nKXR2LnR2X3NlYyAqIDEwMDAgKyB0di50dl91c2VjIC8gMTAwMDsKfQoKaW50IGZpbGVfZXhpc3RzKGNvbnN0IGNoYXIgKnBhdGgpIHsKICAgIHN0cnVjdCBzdGF0IHN0OwogICAgcmV0dXJuIHN0YXQocGF0aCwgJnN0KSA9PSAwOwp9CgppbnQgY291bnRfZmlsZXNfaW5fZGlyZWN0b3J5KGNvbnN0IGNoYXIgKnBhdGgpIHsKICAgIERJUiAqZGlyID0gb3BlbmRpcihwYXRoKTsKICAgIGlmICghZGlyKSByZXR1cm4gLTE7CiAgICAKICAgIGludCBjb3VudCA9IDA7CiAgICBzdHJ1Y3QgZGlyZW50ICplbnRyeTsKICAgIHdoaWxlICgoZW50cnkgPSByZWFkZGlyKGRpcikpICE9IE5VTEwpIHsKICAgICAgICBpZiAoc3RyY21wKGVudHJ5LT5kX25hbWUsICIuIikgIT0gMCAmJiBzdHJjbXAoZW50cnktPmRfbmFtZSwgIi4uIikgIT0gMCkgewogICAgICAgICAgICBjb3VudCsrOwogICAgICAgIH0KICAgIH0KICAgIGNsb3NlZGlyKGRpcik7CiAgICByZXR1cm4gY291bnQ7Cn0KCmludCBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbihjb25zdCBjaGFyICpkYXRhYmFzZSwgY29uc3QgY2hhciAqY29sbGVjdGlvbikgewogICAgY2hhciBjb21tYW5kWzUxMl07CiAgICBzbnByaW50Zihjb21tYW5kLCBzaXplb2YoY29tbWFuZCksICIlcyBsaXN0ICVzICVzIDI+L2Rldi9udWxsIHwgd2MgLWwiLCBjbGlfY29tbWFuZCwgZGF0YWJhc2UsIGNvbGxlY3Rpb24pOwogICAgCiAgICBGSUxFICpmcCA9IHBvcGVuKGNvbW1hbmQsICJyIik7CiAgICBpZiAoIWZwKSByZXR1cm4gLTE7CiAgICAKICAgIGludCBjb3VudCA9IDA7CiAgICBjaGFyIGJ1ZmZlcls2NF07CiAgICBpZiAoZmdldHMoYnVmZmVyLCBzaXplb2YoYnVmZmVyKSwgZnApKSB7CiAgICAgICAgY291bnQgPSBhdG9pKGJ1ZmZlcik7CiAgICB9CiAgICBwY2xvc2UoZnApOwogICAgCiAgICByZXR1cm4gY291bnQ7Cn0KCmNoYXIqIGdldF9sYXN0X2luc2VydGVkX2lkKGNvbnN0IGNoYXIgKmRhdGFiYXNlLCBjb25zdCBjaGFyICpjb2xsZWN0aW9uKSB7CiAgICBjaGFyIGNvbW1hbmRbNTEyXTsKICAgIHNucHJpbnRmKGNvbW1hbmQsIHNpemVvZihjb21tYW5kKSwgIiVzIGxpc3QgJXMgJXMgMj4vZGV2L251bGwgfCB0YWlsIC0xIiwgY2xpX2NvbW1hbmQsIGRhdGFiYXNlLCBjb2xsZWN0aW9uKTsKICAgIAogICAgRklMRSAqZnAgPSBwb3Blbihjb21tYW5kLCAiciIpOwogICAgaWYgKCFmcCkgcmV0dXJuIE5VTEw7CiAgICAKICAgIHN0YXRpYyBjaGFyIGlkWzY0XTsKICAgIGlmIChmZ2V0cyhpZCwgc2l6ZW9mKGlkKSwgZnApKSB7CiAgICAgICAgY2hhciAqaWRfc3RhcnQgPSBzdHJzdHIoaWQsICJcIl9pZFwiOlwiIik7CiAgICAgICAgaWYgKGlkX3N0YXJ0KSB7CiAgICAgICAgICAgIGlkX3N0YXJ0ICs9IDc7CiAgICAgICAgICAgIGNoYXIgKmlkX2VuZCA9IHN0cmNocihpZF9zdGFydCwgJyInKTsKICAgICAgICAgICAgaWYgKGlkX2VuZCkgewogICAgICAgICAgICAgICAgKmlkX2VuZCA9ICdcMCc7CiAgICAgICAgICAgICAgICBzdHJuY3B5KGlkLCBpZF9zdGFydCwgc2l6ZW9mKGlkKSAtIDEpOwogICAgICAgICAgICAgICAgcGNsb3NlKGZwKTsKICAgICAgICAgICAgICAgIHJldHVybiBpZDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHBjbG9zZShmcCk7CiAgICByZXR1cm4gTlVMTDsKfQoKaW50IGV4ZWN1dGVfY29tbWFuZF9hbmRfY2FwdHVyZShjb25zdCBjaGFyICpjb21tYW5kLCBjaGFyICpvdXRwdXQsIHNpemVfdCBvdXRwdXRfc2l6ZSkgewogICAgRklMRSAqZnAgPSBwb3Blbihjb21tYW5kLCAiciIpOwogICAgaWYgKCFmcCkgcmV0dXJuIC0xOwogICAgCiAgICBvdXRwdXRbMF0gPSAnXDAnOwogICAgaWYgKGZnZXRzKG91dHB1dCwgb3V0cHV0X3NpemUsIGZwKSkgewogICAgICAgIG91dHB1dFtzdHJjc3BuKG91dHB1dCwgIlxuIildID0gJ1wwJzsKICAgIH0KICAgIHBjbG9zZShmcCk7CiAgICByZXR1cm4gMDsKfQoKaW50IGV4ZWN1dGVfY29tbWFuZF9hbmRfY2FwdHVyZV92ZXJib3NlKGNvbnN0IGNoYXIgKmNvbW1hbmQsIGNoYXIgKm91dHB1dCwgc2l6ZV90IG91dHB1dF9zaXplLCBjaGFyICp2ZXJib3NlX291dHB1dCwgc2l6ZV90IHZlcmJvc2Vfc2l6ZSkgewogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIlxuICBbVkVSQk9TRV0gRVhFQ1VUSU9OIERFVEFJTFNcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIENvbW1hbmQgdG8gZXhlY3V0ZTpcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgJXNcbiIgUkVTRVQsIGNvbW1hbmQpOwogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIENvbW1hbmQgc3RydWN0dXJlIGFuYWx5c2lzOlxuIiBSRVNFVCk7CiAgICAgICAgCiAgICAgICAgaWYgKHN0cnN0cihjb21tYW5kLCAiZ3JlcCIpKSB7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgQ29udGFpbnMgZ3JlcCBjb21tYW5kIC0gZXhpdCBjb2RlcyAwLzEgYXJlIG5vcm1hbFxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgICAgIGlmIChzdHJzdHIoY29tbWFuZCwgInwiKSkgewogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIENvbnRhaW5zIHBpcGUocykgLSBjb21wb3VuZCBjb21tYW5kXG4iIFJFU0VUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cnN0cihjb21tYW5kLCAiMj4mMSIpKSB7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgU1RERVJSIHJlZGlyZWN0ZWQgdG8gU1RET1VUXG4iIFJFU0VUKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIEZJTEUgKmZwID0gcG9wZW4oY29tbWFuZCwgInIiKTsKICAgIGlmICghZnApIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIENSSVRJQ0FMIEVSUk9SOiBwb3BlbigpIGZhaWxlZFxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFBvc3NpYmxlIGNhdXNlczpcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIC0gU2hlbGwgbm90IGF2YWlsYWJsZVxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgLSBNZW1vcnkgZXhoYXVzdGVkXG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICAtIFRvbyBtYW55IG9wZW4gZmlsZSBkZXNjcmlwdG9yc1xuIiBSRVNFVCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIAogICAgb3V0cHV0WzBdID0gJ1wwJzsKICAgIHZlcmJvc2Vfb3V0cHV0WzBdID0gJ1wwJzsKICAgIAogICAgY2hhciBidWZmZXJbMTAyNF07CiAgICBzaXplX3QgdG90YWxfdmVyYm9zZV9zaXplID0gMDsKICAgIGludCBsaW5lX2NvdW50ID0gMDsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIENvbW1hbmQgb3V0cHV0IHN0cmVhbTpcbiIgUkVTRVQpOwogICAgfQogICAgCiAgICB3aGlsZSAoZmdldHMoYnVmZmVyLCBzaXplb2YoYnVmZmVyKSwgZnApKSB7CiAgICAgICAgYnVmZmVyW3N0cmNzcG4oYnVmZmVyLCAiXG4iKV0gPSAnXDAnOwogICAgICAgIGxpbmVfY291bnQrKzsKICAgICAgICAKICAgICAgICBpZiAob3V0cHV0WzBdID09ICdcMCcpIHsKICAgICAgICAgICAgc3RybmNweShvdXRwdXQsIGJ1ZmZlciwgb3V0cHV0X3NpemUgLSAxKTsKICAgICAgICAgICAgb3V0cHV0W291dHB1dF9zaXplIC0gMV0gPSAnXDAnOwogICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIExpbmUgJWQgKGZpcnN0IGxpbmUgY2FwdHVyZWQgYXMgb3V0cHV0KTogJXNcbiIgUkVTRVQsIGxpbmVfY291bnQsIGJ1ZmZlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIExpbmUgJWQ6ICVzXG4iIFJFU0VULCBsaW5lX2NvdW50LCBidWZmZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICh0b3RhbF92ZXJib3NlX3NpemUgKyBzdHJsZW4oYnVmZmVyKSA8IHZlcmJvc2Vfc2l6ZSAtIDEpIHsKICAgICAgICAgICAgc3RyY2F0KHZlcmJvc2Vfb3V0cHV0LCBidWZmZXIpOwogICAgICAgICAgICBzdHJjYXQodmVyYm9zZV9vdXRwdXQsICJcbiIpOwogICAgICAgICAgICB0b3RhbF92ZXJib3NlX3NpemUgKz0gc3RybGVuKGJ1ZmZlcikgKyAxOwogICAgICAgIH0KICAgIH0KICAgIAogICAgaW50IHN0YXR1cyA9IHBjbG9zZShmcCk7CiAgICAKICAgIGludCByZXN1bHQ7CiAgICBpZiAoV0lGRVhJVEVEKHN0YXR1cykpIHsKICAgICAgICBpbnQgZXhpdF9jb2RlID0gV0VYSVRTVEFUVVMoc3RhdHVzKTsKICAgICAgICBpZiAoc3Ryc3RyKGNvbW1hbmQsICJncmVwIikgIT0gTlVMTCkgewogICAgICAgICAgICByZXN1bHQgPSAoZXhpdF9jb2RlID09IDAgfHwgZXhpdF9jb2RlID09IDEpID8gMCA6IC0xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdCA9IChleGl0X2NvZGUgPT0gMCkgPyAwIDogLTE7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gQ29tbWFuZCBleGl0ZWQgbm9ybWFsbHlcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEV4aXQgY29kZTogJWRcbiIgUkVTRVQsIGV4aXRfY29kZSk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUHJvY2VzcyBpbnRlcnByZXRhdGlvbjogJXNcbiIgUkVTRVQsIChyZXN1bHQgPT0gMCkgPyAiU1VDQ0VTUyIgOiAiRkFJTFVSRSIpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHN0cnN0cihjb21tYW5kLCAiZ3JlcCIpKSB7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEdyZXAtc3BlY2lmaWMgaW50ZXJwcmV0YXRpb246XG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgICBFeGl0IGNvZGUgJWQgPSBwYXR0ZXJuICVzXG4iIFJFU0VULCAKICAgICAgICAgICAgICAgICAgICAgICBleGl0X2NvZGUsIAogICAgICAgICAgICAgICAgICAgICAgIGV4aXRfY29kZSA9PSAwID8gIkZPVU5EIiA6IGV4aXRfY29kZSA9PSAxID8gIk5PVCBGT1VORCAobm9ybWFsKSIgOiAiRVJST1IiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoV0lGU0lHTkFMRUQoc3RhdHVzKSkgewogICAgICAgIHJlc3VsdCA9IC0xOwogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgaW50IHNpZyA9IFdURVJNU0lHKHN0YXR1cyk7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIENvbW1hbmQgdGVybWluYXRlZCBieSBzaWduYWxcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFNpZ25hbCBudW1iZXI6ICVkXG4iIFJFU0VULCBzaWcpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFNpZ25hbCBuYW1lOiAlc1xuIiBSRVNFVCwgc3Ryc2lnbmFsKHNpZykpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoV0lGU1RPUFBFRChzdGF0dXMpKSB7CiAgICAgICAgcmVzdWx0ID0gLTE7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBDb21tYW5kIHN0b3BwZWQgYnkgc2lnbmFsXG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBTdG9wIHNpZ25hbDogJWRcbiIgUkVTRVQsIFdTVE9QU0lHKHN0YXR1cykpOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0ID0gLTE7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBDb21tYW5kIGRpZCBub3QgZXhpdCBub3JtYWxseVxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUmF3IHN0YXR1czogJWRcbiIgUkVTRVQsIHN0YXR1cyk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gRXhlY3V0aW9uIHN1bW1hcnk6XG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIFRvdGFsIGxpbmVzIG91dHB1dDogJWRcbiIgUkVTRVQsIGxpbmVfY291bnQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgRmlyc3QgbGluZSBjYXB0dXJlZDogXCIlc1wiXG4iIFJFU0VULCBvdXRwdXRbMF0gIT0gJ1wwJyA/IG91dHB1dCA6ICIoZW1wdHkpIik7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBUb3RhbCB2ZXJib3NlIG91dHB1dCBsZW5ndGg6ICV6dSBieXRlc1xuIiBSRVNFVCwgdG90YWxfdmVyYm9zZV9zaXplKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIEZpbmFsIHJlc3VsdCBjb2RlOiAlZCAoJXMpXG4iIFJFU0VULCByZXN1bHQsIHJlc3VsdCA9PSAwID8gIlNVQ0NFU1MiIDogIkZBSUxVUkUiKTsKICAgIH0KICAgIAogICAgcmV0dXJuIHJlc3VsdDsKfQoKaW50IHZlcmlmeV9kYXRhYmFzZV9zdHJ1Y3R1cmUoY29uc3QgY2hhciAqZGF0YWJhc2UpIHsKICAgIGNoYXIgcGF0aFs1MTJdOwogICAgc25wcmludGYocGF0aCwgc2l6ZW9mKHBhdGgpLCAiL3RtcC9zeWRiX3Rlc3QvJXMiLCBkYXRhYmFzZSk7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICJcbiAgW1ZFUkJPU0VdIERBVEFCQVNFIFNUUlVDVFVSRSBWRVJJRklDQVRJT05cbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgRGF0YWJhc2U6ICVzXG4iIFJFU0VULCBkYXRhYmFzZSk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBFeHBlY3RlZCBwYXRoOiAlc1xuIiBSRVNFVCwgcGF0aCk7CiAgICB9CiAgICAKICAgIGlmICghZmlsZV9leGlzdHMocGF0aCkpIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEZBSUxVUkUgQU5BTFlTSVM6XG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICAgIERhdGFiYXNlIGRpcmVjdG9yeSBkb2Vzbid0IGV4aXN0XG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDaGVja2VkIHBhdGg6ICVzXG4iIFJFU0VULCBwYXRoKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBGdWxsIGRpcmVjdG9yeSBjb250ZW50cyBvZiAvdG1wL3N5ZGJfdGVzdC86XG4iIFJFU0VUKTsKICAgICAgICAgICAgc3lzdGVtKCJscyAtbGEgL3RtcC9zeWRiX3Rlc3QvIDI+L2Rldi9udWxsIHwgd2hpbGUgcmVhZCBsaW5lOyBkbyBlY2hvIFwiICAgICAgJGxpbmVcIjsgZG9uZSIpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEN1cnJlbnQgd29ya2luZyBkaXJlY3Rvcnk6ICIgUkVTRVQpOwogICAgICAgICAgICBzeXN0ZW0oInB3ZCIpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEVudmlyb25tZW50IHZhcmlhYmxlIFNZREJfQkFTRV9ESVI6ICVzXG4iIFJFU0VULCBnZXRlbnYoIlNZREJfQkFTRV9ESVIiKSk7CiAgICAgICAgfQogICAgICAgIHByaW50ZihSRUQgIiAg4pyXIERhdGFiYXNlIGRpcmVjdG9yeSBkb2Vzbid0IGV4aXN0XG4iIFJFU0VUKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgc3RydWN0IHN0YXQgc3Q7CiAgICBpZiAoc3RhdChwYXRoLCAmc3QpICE9IDApIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEZBSUxVUkUgQU5BTFlTSVM6XG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICAgIHN0YXQoKSBjYWxsIGZhaWxlZFxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUGF0aDogJXNcbiIgUkVTRVQsIHBhdGgpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIGVycm5vOiAlZCAoJXMpXG4iIFJFU0VULCBlcnJubywgc3RyZXJyb3IoZXJybm8pKTsKICAgICAgICB9CiAgICAgICAgcHJpbnRmKFJFRCAiICDinJcgQ2Fubm90IGFjY2VzcyBkYXRhYmFzZSBkaXJlY3RvcnlcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgCiAgICBpZiAoIVNfSVNESVIoc3Quc3RfbW9kZSkpIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEZBSUxVUkUgQU5BTFlTSVM6XG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICAgIFBhdGggZXhpc3RzIGJ1dCBpcyBub3QgYSBkaXJlY3RvcnlcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFBhdGg6ICVzXG4iIFJFU0VULCBwYXRoKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBGaWxlIHR5cGU6ICIpOwogICAgICAgICAgICBpZiAoU19JU1JFRyhzdC5zdF9tb2RlKSkgcHJpbnRmKCJSZWd1bGFyIGZpbGVcbiIgUkVTRVQpOwogICAgICAgICAgICBlbHNlIGlmIChTX0lTTE5LKHN0LnN0X21vZGUpKSBwcmludGYoIlN5bWJvbGljIGxpbmtcbiIgUkVTRVQpOwogICAgICAgICAgICBlbHNlIHByaW50ZigiT3RoZXIgKG1vZGU6ICVvKVxuIiBSRVNFVCwgc3Quc3RfbW9kZSAmIFNfSUZNVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUGVybWlzc2lvbnM6ICVvXG4iIFJFU0VULCBzdC5zdF9tb2RlICYgMDc3Nyk7CiAgICAgICAgfQogICAgICAgIHByaW50ZihSRUQgIiAg4pyXIERhdGFiYXNlIHBhdGggaXMgbm90IGEgZGlyZWN0b3J5XG4iIFJFU0VUKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihHUkVFTiAiICBbVkVSQk9TRV0gU1VDQ0VTUyBBTkFMWVNJUzpcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkVFTiAiICAgIERhdGFiYXNlIGRpcmVjdG9yeSBleGlzdHMgYW5kIGlzIHZhbGlkXG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIFBhdGg6ICVzXG4iIFJFU0VULCBwYXRoKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIFBlcm1pc3Npb25zOiAlb1xuIiBSRVNFVCwgc3Quc3RfbW9kZSAmIDA3NzcpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgU2l6ZTogJWxkIGJ5dGVzXG4iIFJFU0VULCBzdC5zdF9zaXplKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIExhc3QgbW9kaWZpZWQ6ICVzIiwgY3RpbWUoJnN0LnN0X210aW1lKSk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDb250ZW50cyBvZiBkYXRhYmFzZSBkaXJlY3Rvcnk6XG4iIFJFU0VUKTsKICAgICAgICBjaGFyIGxzX2NtZFs1MTJdOwogICAgICAgIHNucHJpbnRmKGxzX2NtZCwgc2l6ZW9mKGxzX2NtZCksICJscyAtbGEgXCIlc1wiIDI+L2Rldi9udWxsIiwgcGF0aCk7CiAgICAgICAgc3lzdGVtKGxzX2NtZCk7CiAgICB9CiAgICBwcmludGYoR1JFRU4gIiAg4pyTIERhdGFiYXNlIGRpcmVjdG9yeSBleGlzdHMgYW5kIGlzIHZhbGlkXG4iIFJFU0VUKTsKICAgIHJldHVybiAxOwp9CgppbnQgdmVyaWZ5X2NvbGxlY3Rpb25fc3RydWN0dXJlKGNvbnN0IGNoYXIgKmRhdGFiYXNlLCBjb25zdCBjaGFyICpjb2xsZWN0aW9uKSB7CiAgICBjaGFyIHBhdGhbNTEyXTsKICAgIHNucHJpbnRmKHBhdGgsIHNpemVvZihwYXRoKSwgIi90bXAvc3lkYl90ZXN0LyVzLyVzIiwgZGF0YWJhc2UsIGNvbGxlY3Rpb24pOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiXG4gIFtWRVJCT1NFXSBDT0xMRUNUSU9OIFNUUlVDVFVSRSBWRVJJRklDQVRJT05cbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgRGF0YWJhc2U6ICVzXG4iIFJFU0VULCBkYXRhYmFzZSk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDb2xsZWN0aW9uOiAlc1xuIiBSRVNFVCwgY29sbGVjdGlvbik7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBFeHBlY3RlZCBwYXRoOiAlc1xuIiBSRVNFVCwgcGF0aCk7CiAgICB9CiAgICAKICAgIGlmICghZmlsZV9leGlzdHMocGF0aCkpIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEZBSUxVUkUgQU5BTFlTSVM6XG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICAgIENvbGxlY3Rpb24gZGlyZWN0b3J5IGRvZXNuJ3QgZXhpc3RcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIENoZWNrZWQgcGF0aDogJXNcbiIgUkVTRVQsIHBhdGgpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFBhcmVudCBkaXJlY3RvcnkgY29udGVudHM6XG4iIFJFU0VUKTsKICAgICAgICAgICAgY2hhciBwYXJlbnRfcGF0aFs1MTJdOwogICAgICAgICAgICBzbnByaW50ZihwYXJlbnRfcGF0aCwgc2l6ZW9mKHBhcmVudF9wYXRoKSwgIi90bXAvc3lkYl90ZXN0LyVzIiwgZGF0YWJhc2UpOwogICAgICAgICAgICBjaGFyIGxzX2NtZFs1MTJdOwogICAgICAgICAgICBzbnByaW50Zihsc19jbWQsIHNpemVvZihsc19jbWQpLCAibHMgLWxhIFwiJXNcIiAyPi9kZXYvbnVsbCIsIHBhcmVudF9wYXRoKTsKICAgICAgICAgICAgc3lzdGVtKGxzX2NtZCk7CiAgICAgICAgfQogICAgICAgIHByaW50ZihSRUQgIiAg4pyXIENvbGxlY3Rpb24gZGlyZWN0b3J5IGRvZXNuJ3QgZXhpc3RcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgCiAgICBjaGFyIHNjaGVtYV9wYXRoWzUxMl07CiAgICBzbnByaW50ZihzY2hlbWFfcGF0aCwgc2l6ZW9mKHNjaGVtYV9wYXRoKSwgIiVzL3NjaGVtYS50eHQiLCBwYXRoKTsKICAgIGlmICghZmlsZV9leGlzdHMoc2NoZW1hX3BhdGgpKSB7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBGQUlMVVJFIEFOQUxZU0lTOlxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgICBTY2hlbWEgZmlsZSBkb2Vzbid0IGV4aXN0XG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBFeHBlY3RlZCBzY2hlbWEgcGF0aDogJXNcbiIgUkVTRVQsIHNjaGVtYV9wYXRoKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDb2xsZWN0aW9uIGRpcmVjdG9yeSBjb250ZW50czpcbiIgUkVTRVQpOwogICAgICAgICAgICBjaGFyIGxzX2NtZFs1MTJdOwogICAgICAgICAgICBzbnByaW50Zihsc19jbWQsIHNpemVvZihsc19jbWQpLCAibHMgLWxhIFwiJXNcIiAyPi9kZXYvbnVsbCIsIHBhdGgpOwogICAgICAgICAgICBzeXN0ZW0obHNfY21kKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBMb29raW5nIGZvciBmaWxlcyBtYXRjaGluZyAnKnNjaGVtYSonOlxuIiBSRVNFVCk7CiAgICAgICAgICAgIHNucHJpbnRmKGxzX2NtZCwgc2l6ZW9mKGxzX2NtZCksICJscyAtbGEgXCIlc1wiIDI+L2Rldi9udWxsIHwgZ3JlcCAtaSBzY2hlbWEiLCBwYXRoKTsKICAgICAgICAgICAgc3lzdGVtKGxzX2NtZCk7CiAgICAgICAgfQogICAgICAgIHByaW50ZihSRUQgIiAg4pyXIFNjaGVtYSBmaWxlIGRvZXNuJ3QgZXhpc3RcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgCiAgICBjaGFyIGRhdGFfcGF0aFs1MTJdOwogICAgc25wcmludGYoZGF0YV9wYXRoLCBzaXplb2YoZGF0YV9wYXRoKSwgIiVzL2RhdGEuc3lkYiIsIHBhdGgpOwogICAgaWYgKCFmaWxlX2V4aXN0cyhkYXRhX3BhdGgpKSB7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBGQUlMVVJFIEFOQUxZU0lTOlxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgICBEYXRhIGZpbGUgZG9lc24ndCBleGlzdFxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgRXhwZWN0ZWQgZGF0YSBwYXRoOiAlc1xuIiBSRVNFVCwgZGF0YV9wYXRoKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDb2xsZWN0aW9uIGRpcmVjdG9yeSBjb250ZW50czpcbiIgUkVTRVQpOwogICAgICAgICAgICBjaGFyIGxzX2NtZFs1MTJdOwogICAgICAgICAgICBzbnByaW50Zihsc19jbWQsIHNpemVvZihsc19jbWQpLCAibHMgLWxhIFwiJXNcIiAyPi9kZXYvbnVsbCIsIHBhdGgpOwogICAgICAgICAgICBzeXN0ZW0obHNfY21kKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBMb29raW5nIGZvciBmaWxlcyBtYXRjaGluZyAnKmRhdGEqJzpcbiIgUkVTRVQpOwogICAgICAgICAgICBzbnByaW50Zihsc19jbWQsIHNpemVvZihsc19jbWQpLCAibHMgLWxhIFwiJXNcIiAyPi9kZXYvbnVsbCB8IGdyZXAgLWkgZGF0YSIsIHBhdGgpOwogICAgICAgICAgICBzeXN0ZW0obHNfY21kKTsKICAgICAgICB9CiAgICAgICAgcHJpbnRmKFJFRCAiICDinJcgRGF0YSBmaWxlIGRvZXNuJ3QgZXhpc3RcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBTVUNDRVNTIEFOQUxZU0lTOlxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKEdSRUVOICIgICAgQ29sbGVjdGlvbiBzdHJ1Y3R1cmUgaXMgdmFsaWRcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgQ29sbGVjdGlvbiBwYXRoOiAlc1xuIiBSRVNFVCwgcGF0aCk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBTY2hlbWEgZmlsZTogJXNcbiIgUkVTRVQsIHNjaGVtYV9wYXRoKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIERhdGEgZmlsZTogJXNcbiIgUkVTRVQsIGRhdGFfcGF0aCk7CiAgICAgICAgCiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBTY2hlbWEgZmlsZSBjb250ZW50IChmaXJzdCAyMCBsaW5lcyk6XG4iIFJFU0VUKTsKICAgICAgICBjaGFyIGNhdF9jbWRbNTEyXTsKICAgICAgICBzbnByaW50ZihjYXRfY21kLCBzaXplb2YoY2F0X2NtZCksICJoZWFkIC0yMCBcIiVzXCIgMj4vZGV2L251bGwiLCBzY2hlbWFfcGF0aCk7CiAgICAgICAgc3lzdGVtKGNhdF9jbWQpOwogICAgICAgIAogICAgICAgIHN0cnVjdCBzdGF0IGRhdGFfc3RhdDsKICAgICAgICBpZiAoc3RhdChkYXRhX3BhdGgsICZkYXRhX3N0YXQpID09IDApIHsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBEYXRhIGZpbGUgc2l6ZTogJWxkIGJ5dGVzXG4iIFJFU0VULCBkYXRhX3N0YXQuc3Rfc2l6ZSk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgRGF0YSBmaWxlIGxhc3QgbW9kaWZpZWQ6ICVzIiwgY3RpbWUoJmRhdGFfc3RhdC5zdF9tdGltZSkpOwogICAgICAgIH0KICAgIH0KICAgIHByaW50ZihHUkVFTiAiICDinJMgQ29sbGVjdGlvbiBzdHJ1Y3R1cmUgaXMgdmFsaWRcbiIgUkVTRVQpOwogICAgcmV0dXJuIDE7Cn0KCmludCB2ZXJpZnlfc2NoZW1hX2NvbnRlbnQoY29uc3QgY2hhciAqZGF0YWJhc2UsIGNvbnN0IGNoYXIgKmNvbGxlY3Rpb24sIGNvbnN0IGNoYXIgKmV4cGVjdGVkX2ZpZWxkcykgewogICAgY2hhciBjb21tYW5kWzUxMl07CiAgICBzbnByaW50Zihjb21tYW5kLCBzaXplb2YoY29tbWFuZCksICIlcyBzY2hlbWEgJXMgJXMiLCBjbGlfY29tbWFuZCwgZGF0YWJhc2UsIGNvbGxlY3Rpb24pOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiXG4gIFtWRVJCT1NFXSBTQ0hFTUEgQ09OVEVOVCBWRVJJRklDQVRJT05cbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgRGF0YWJhc2U6ICVzXG4iIFJFU0VULCBkYXRhYmFzZSk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDb2xsZWN0aW9uOiAlc1xuIiBSRVNFVCwgY29sbGVjdGlvbik7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDb21tYW5kIHRvIGV4ZWN1dGU6ICVzXG4iIFJFU0VULCBjb21tYW5kKTsKICAgICAgICBpZiAoZXhwZWN0ZWRfZmllbGRzICYmIGV4cGVjdGVkX2ZpZWxkc1swXSkgewogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEV4cGVjdGVkIGZpZWxkcyB0byBmaW5kOiAlc1xuIiBSRVNFVCwgZXhwZWN0ZWRfZmllbGRzKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGNoYXIgb3V0cHV0WzEwMjRdOwogICAgY2hhciB2ZXJib3NlX291dHB1dFs0MDk2XTsKICAgIGludCByZXN1bHQ7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICByZXN1bHQgPSBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmVfdmVyYm9zZShjb21tYW5kLCBvdXRwdXQsIHNpemVvZihvdXRwdXQpLCB2ZXJib3NlX291dHB1dCwgc2l6ZW9mKHZlcmJvc2Vfb3V0cHV0KSk7CiAgICB9IGVsc2UgewogICAgICAgIHJlc3VsdCA9IGV4ZWN1dGVfY29tbWFuZF9hbmRfY2FwdHVyZShjb21tYW5kLCBvdXRwdXQsIHNpemVvZihvdXRwdXQpKTsKICAgIH0KICAgIAogICAgaWYgKHJlc3VsdCAhPSAwKSB7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBGQUlMVVJFIEFOQUxZU0lTOlxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgICBDb21tYW5kIGV4ZWN1dGlvbiBmYWlsZWRcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIENvbW1hbmQ6ICVzXG4iIFJFU0VULCBjb21tYW5kKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBSZXR1cm4gY29kZTogJWRcbiIgUkVTRVQsIHJlc3VsdCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUmF3IG91dHB1dDogJXNcbiIgUkVTRVQsIG91dHB1dCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUG9zc2libGUgaXNzdWVzOlxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgICAtIERhdGFiYXNlIGRvZXNuJ3QgZXhpc3RcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgLSBDb2xsZWN0aW9uIGRvZXNuJ3QgZXhpc3RcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgLSBTY2hlbWEgY29tbWFuZCBzeW50YXggZXJyb3JcbiIgUkVTRVQpOwogICAgICAgIH0KICAgICAgICBwcmludGYoUkVEICIgIOKclyBDb3VsZCBub3QgcmVhZCBzY2hlbWFcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gU0NIRU1BIE9VVFBVVCBBTkFMWVNJUzpcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgUmF3IG91dHB1dDogXCIlc1wiXG4iIFJFU0VULCBvdXRwdXQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgT3V0cHV0IGxlbmd0aDogJXp1IGNoYXJhY3RlcnNcbiIgUkVTRVQsIHN0cmxlbihvdXRwdXQpKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIExvb2tpbmcgZm9yICdGaWVsZCcgaW4gb3V0cHV0OiAlc1xuIiBSRVNFVCwgCiAgICAgICAgICAgICAgIHN0cnN0cihvdXRwdXQsICJGaWVsZCIpID8gIkZPVU5EIiA6ICJOT1QgRk9VTkQiKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIExvb2tpbmcgZm9yICdUeXBlJyBpbiBvdXRwdXQ6ICVzXG4iIFJFU0VULCAKICAgICAgICAgICAgICAgc3Ryc3RyKG91dHB1dCwgIlR5cGUiKSA/ICJGT1VORCIgOiAiTk9UIEZPVU5EIik7CiAgICB9CiAgICAKICAgIGlmIChzdHJzdHIob3V0cHV0LCAiRmllbGQiKSA9PSBOVUxMIHx8IHN0cnN0cihvdXRwdXQsICJUeXBlIikgPT0gTlVMTCkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gRkFJTFVSRSBBTkFMWVNJUzpcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoUkVEICIgICAgU2NoZW1hIG91dHB1dCBmb3JtYXQgaW5jb3JyZWN0XG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBFeHBlY3RlZCB0byBmaW5kIGJvdGggJ0ZpZWxkJyBhbmQgJ1R5cGUnIGluIG91dHB1dFxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgQWN0dWFsIG91dHB1dCByZWNlaXZlZDpcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoV0hJVEUgIiAgICAtLS0gQkVHSU4gT1VUUFVUIC0tLVxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZigiJXNcbiIsIG91dHB1dCk7CiAgICAgICAgICAgIHByaW50ZihXSElURSAiICAgIC0tLSBFTkQgT1VUUFVUIC0tLVxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgQ2hhcmFjdGVyLWJ5LWNoYXJhY3RlciBhbmFseXNpczpcbiIgUkVTRVQpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IChpbnQpc3RybGVuKG91dHB1dCkgJiYgaSA8IDEwMDsgaSsrKSB7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgWyUzZF0gMHglMDJ4ICclYydcbiIgUkVTRVQsIGksICh1bnNpZ25lZCBjaGFyKW91dHB1dFtpXSwgCiAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W2ldID49IDMyICYmIG91dHB1dFtpXSA8PSAxMjYgPyBvdXRwdXRbaV0gOiAnLicpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHByaW50ZihSRUQgIiAg4pyXIFNjaGVtYSBvdXRwdXQgZm9ybWF0IGluY29ycmVjdFxuIiBSRVNFVCk7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdIFNVQ0NFU1MgQU5BTFlTSVM6XG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoR1JFRU4gIiAgICBTY2hlbWEgY29udGVudCBpcyB2YWxpZFxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBGdWxsIHNjaGVtYSBvdXRwdXQ6XG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoV0hJVEUgIiAgICAtLS0gQkVHSU4gU0NIRU1BIC0tLVxuIiBSRVNFVCk7CiAgICAgICAgaWYgKHZlcmJvc2Vfb3V0cHV0WzBdICE9ICdcMCcpIHsKICAgICAgICAgICAgcHJpbnRmKCIlcyIsIHZlcmJvc2Vfb3V0cHV0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmludGYoIiVzXG4iLCBvdXRwdXQpOwogICAgICAgIH0KICAgICAgICBwcmludGYoV0hJVEUgIiAgICAtLS0gRU5EIFNDSEVNQSAtLS1cbiIgUkVTRVQpOwogICAgICAgIAogICAgICAgIGlmIChleHBlY3RlZF9maWVsZHMgJiYgZXhwZWN0ZWRfZmllbGRzWzBdKSB7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgU2VhcmNoaW5nIGZvciBleHBlY3RlZCBmaWVsZHM6XG4iIFJFU0VUKTsKICAgICAgICAgICAgY2hhciAqdG9rZW47CiAgICAgICAgICAgIGNoYXIgZmllbGRzX2NvcHlbMTAyNF07CiAgICAgICAgICAgIHN0cm5jcHkoZmllbGRzX2NvcHksIGV4cGVjdGVkX2ZpZWxkcywgc2l6ZW9mKGZpZWxkc19jb3B5KSk7CiAgICAgICAgICAgIHRva2VuID0gc3RydG9rKGZpZWxkc19jb3B5LCAiLCIpOwogICAgICAgICAgICB3aGlsZSAodG9rZW4gIT0gTlVMTCkgewogICAgICAgICAgICAgICAgY2hhciAqZm91bmQgPSBzdHJzdHIob3V0cHV0LCB0b2tlbik7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgRmllbGQgJyVzJzogJXNcbiIgUkVTRVQsIHRva2VuLCAKICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA/ICJGT1VORCIgOiAiTk9UIEZPVU5EIik7CiAgICAgICAgICAgICAgICB0b2tlbiA9IHN0cnRvayhOVUxMLCAiLCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcHJpbnRmKEdSRUVOICIgIOKckyBTY2hlbWEgY29udGVudCBpcyB2YWxpZFxuIiBSRVNFVCk7CiAgICByZXR1cm4gMTsKfQoKaW50IGV4ZWN1dGVfdGVzdF93aXRoX3ZlcmlmaWNhdGlvbihUZXN0Q2FzZSAqdGVzdCkgewogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCB0ZXN0LT5kZXNjcmlwdGlvbik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgbG9uZyBsb25nIHN0YXJ0X3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICJcbiAgW1ZFUkJPU0VdID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFRFU1QgRVhFQ1VUSU9OIERFVEFJTFNcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgVGVzdCBEZXNjcmlwdGlvbjogJXNcbiIgUkVTRVQsIHRlc3QtPmRlc2NyaXB0aW9uKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIE1haW4gQ29tbWFuZDogJXNcbiIgUkVTRVQsIHRlc3QtPmNvbW1hbmQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgVmVyaWZpY2F0aW9uIENvbW1hbmQ6ICVzXG4iIFJFU0VULCAKICAgICAgICAgICAgICAgdGVzdC0+dmVyaWZpY2F0aW9uX2NvbW1hbmRbMF0gPyB0ZXN0LT52ZXJpZmljYXRpb25fY29tbWFuZCA6ICIobm9uZSkiKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIEV4cGVjdGVkIE91dHB1dCBQYXR0ZXJuOiBcIiVzXCJcbiIgUkVTRVQsIAogICAgICAgICAgICAgICB0ZXN0LT5leHBlY3RlZF9vdXRwdXRbMF0gPyB0ZXN0LT5leHBlY3RlZF9vdXRwdXQgOiAiKGFueSkiKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIFN0YXJ0IFRpbWU6ICVsbGQgbXNcbiIgUkVTRVQsIHN0YXJ0X3RpbWUpOwogICAgfQogICAgCiAgICBpbnQgcmVzdWx0ID0gc3lzdGVtKHRlc3QtPmNvbW1hbmQpOwogICAgbG9uZyBsb25nIGVuZF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgCiAgICB0ZXN0LT5kdXJhdGlvbl9tcyA9IGVuZF90aW1lIC0gc3RhcnRfdGltZTsKICAgIHRlc3QtPnN1Y2Nlc3MgPSAocmVzdWx0ID09IDApOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiXG4gIFtWRVJCT1NFXSBNQUlOIENPTU1BTkQgRVhFQ1VUSU9OIFJFU1VMVFNcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgQ29tbWFuZDogJXNcbiIgUkVTRVQsIHRlc3QtPmNvbW1hbmQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgUmF3IGV4aXQgY29kZTogJWRcbiIgUkVTRVQsIHJlc3VsdCk7CiAgICAgICAgCiAgICAgICAgaWYgKFdJRkVYSVRFRChyZXN1bHQpKSB7CiAgICAgICAgICAgIGludCBleGl0X3N0YXR1cyA9IFdFWElUU1RBVFVTKHJlc3VsdCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgTm9ybWFsIGV4aXQgd2l0aCBzdGF0dXM6ICVkXG4iIFJFU0VULCBleGl0X3N0YXR1cyk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgSW50ZXJwcmV0YXRpb246ICVzXG4iIFJFU0VULCBleGl0X3N0YXR1cyA9PSAwID8gIlNVQ0NFU1MiIDogIkZBSUxVUkUiKTsKICAgICAgICB9IGVsc2UgaWYgKFdJRlNJR05BTEVEKHJlc3VsdCkpIHsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBUZXJtaW5hdGVkIGJ5IHNpZ25hbDogJWRcbiIgUkVTRVQsIFdURVJNU0lHKHJlc3VsdCkpOwogICAgICAgIH0gZWxzZSBpZiAoV0lGU1RPUFBFRChyZXN1bHQpKSB7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgU3RvcHBlZCBieSBzaWduYWw6ICVkXG4iIFJFU0VULCBXU1RPUFNJRyhyZXN1bHQpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBFeGVjdXRpb24gdGltZTogJWxsZCBtc1xuIiBSRVNFVCwgdGVzdC0+ZHVyYXRpb25fbXMpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgVGVzdCBzdWNjZXNzIGZsYWc6ICVzXG4iIFJFU0VULCB0ZXN0LT5zdWNjZXNzID8gIlRSVUUiIDogIkZBTFNFIik7CiAgICB9CiAgICAKICAgIHRlc3QtPnZlcmlmaWNhdGlvbl9zdWNjZXNzID0gMTsKICAgIGlmICh0ZXN0LT5zdWNjZXNzICYmIHRlc3QtPnZlcmlmaWNhdGlvbl9jb21tYW5kWzBdICE9ICdcMCcpIHsKICAgICAgICBjaGFyIHZlcmlmaWNhdGlvbl9vdXRwdXRbMTAyNF07CiAgICAgICAgY2hhciB2ZXJib3NlX291dHB1dFs0MDk2XTsKICAgICAgICBpbnQgdmVyaWZpY2F0aW9uX3Jlc3VsdDsKICAgICAgICAKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihZRUxMT1cgIlxuICBbVkVSQk9TRV0gVkVSSUZJQ0FUSU9OIFBIQVNFXG4iIFJFU0VUKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICB2ZXJpZmljYXRpb25fcmVzdWx0ID0gZXhlY3V0ZV9jb21tYW5kX2FuZF9jYXB0dXJlX3ZlcmJvc2UodGVzdC0+dmVyaWZpY2F0aW9uX2NvbW1hbmQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyaWZpY2F0aW9uX291dHB1dCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplb2YodmVyaWZpY2F0aW9uX291dHB1dCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJib3NlX291dHB1dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZih2ZXJib3NlX291dHB1dCkpOwogICAgICAgICAgICBzdHJuY3B5KHRlc3QtPnZlcmJvc2Vfb3V0cHV0LCB2ZXJib3NlX291dHB1dCwgc2l6ZW9mKHRlc3QtPnZlcmJvc2Vfb3V0cHV0KSAtIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9yZXN1bHQgPSBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmUodGVzdC0+dmVyaWZpY2F0aW9uX2NvbW1hbmQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25fb3V0cHV0LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKHZlcmlmaWNhdGlvbl9vdXRwdXQpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHZlcmlmaWNhdGlvbl9yZXN1bHQgPT0gMCkgewogICAgICAgICAgICBpZiAodGVzdC0+ZXhwZWN0ZWRfb3V0cHV0WzBdICE9ICdcMCcpIHsKICAgICAgICAgICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBFWFBFQ1RFRCBPVVRQVVQgVkFMSURBVElPTlxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBFeHBlY3RlZCBwYXR0ZXJuOiBcIiVzXCJcbiIgUkVTRVQsIHRlc3QtPmV4cGVjdGVkX291dHB1dCk7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBBY3R1YWwgb3V0cHV0OiBcIiVzXCJcbiIgUkVTRVQsIHZlcmlmaWNhdGlvbl9vdXRwdXQpOwogICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUGF0dGVybiBzZWFyY2g6ICVzXG4iIFJFU0VULCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryc3RyKHZlcmlmaWNhdGlvbl9vdXRwdXQsIHRlc3QtPmV4cGVjdGVkX291dHB1dCkgPyAiRk9VTkQiIDogIk5PVCBGT1VORCIpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChzdHJzdHIodmVyaWZpY2F0aW9uX291dHB1dCwgdGVzdC0+ZXhwZWN0ZWRfb3V0cHV0KSA9PSBOVUxMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFBBVFRFUk4gTUFUQ0hJTkcgRkFJTFVSRSBBTkFMWVNJUzpcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEV4cGVjdGVkIHN0cmluZyBsZW5ndGg6ICV6dVxuIiBSRVNFVCwgc3RybGVuKHRlc3QtPmV4cGVjdGVkX291dHB1dCkpOwogICAgICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEFjdHVhbCBzdHJpbmcgbGVuZ3RoOiAlenVcbiIgUkVTRVQsIHN0cmxlbih2ZXJpZmljYXRpb25fb3V0cHV0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpbnQgbWF4X2xlbiA9IHN0cmxlbih0ZXN0LT5leHBlY3RlZF9vdXRwdXQpOwogICAgICAgICAgICAgICAgICAgICAgICBpbnQgYmVzdF9tYXRjaCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGludCBiZXN0X3Bvc2l0aW9uID0gLTE7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgdmVyaWZpY2F0aW9uX291dHB1dFtpXTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgbWF0Y2hfbGVuID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChtYXRjaF9sZW4gPCBtYXhfbGVuICYmIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9vdXRwdXRbaSArIG1hdGNoX2xlbl0gJiYgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyaWZpY2F0aW9uX291dHB1dFtpICsgbWF0Y2hfbGVuXSA9PSB0ZXN0LT5leHBlY3RlZF9vdXRwdXRbbWF0Y2hfbGVuXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoX2xlbisrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoX2xlbiA+IGJlc3RfbWF0Y2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZXN0X21hdGNoID0gbWF0Y2hfbGVuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlc3RfcG9zaXRpb24gPSBpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmVzdF9tYXRjaCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgQmVzdCBwYXJ0aWFsIG1hdGNoOiAlZCBjaGFyYWN0ZXJzIGF0IHBvc2l0aW9uICVkXG4iIFJFU0VULCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZXN0X21hdGNoLCBiZXN0X3Bvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUGFydGlhbCBtYXRjaCBjb250ZXh0OlxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgRXhwZWN0ZWQ6IFwiJXNcIlxuIiBSRVNFVCwgdGVzdC0+ZXhwZWN0ZWRfb3V0cHV0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgICBQYXJ0aWFsOiAgXCIlLipzXCJcbiIgUkVTRVQsIGJlc3RfbWF0Y2gsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZ2ZXJpZmljYXRpb25fb3V0cHV0W2Jlc3RfcG9zaXRpb25dKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgICBOZXh0IGV4cGVjdGVkIGNoYXI6ICclYycgKDB4JTAyeClcbiIgUkVTRVQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdC0+ZXhwZWN0ZWRfb3V0cHV0W2Jlc3RfbWF0Y2hdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlc3QtPmV4cGVjdGVkX291dHB1dFtiZXN0X21hdGNoXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgTmV4dCBhY3R1YWwgY2hhcjogICAnJWMnICgweCUwMngpXG4iIFJFU0VULAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9vdXRwdXRbYmVzdF9wb3NpdGlvbiArIGJlc3RfbWF0Y2hdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9vdXRwdXRbYmVzdF9wb3NpdGlvbiArIGJlc3RfbWF0Y2hdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgTm8gcGFydGlhbCBtYXRjaGVzIGZvdW5kXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmxlbih2ZXJpZmljYXRpb25fb3V0cHV0KSA9PSBzdHJsZW4odGVzdC0+ZXhwZWN0ZWRfb3V0cHV0KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDaGFyYWN0ZXItYnktY2hhcmFjdGVyIGNvbXBhcmlzb246XG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgc3RybGVuKHRlc3QtPmV4cGVjdGVkX291dHB1dCk7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2ZXJpZmljYXRpb25fb3V0cHV0W2ldICE9IHRlc3QtPmV4cGVjdGVkX291dHB1dFtpXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgUG9zaXRpb24gJXp1OiBleHBlY3RlZCAnJWMnICgweCUwMngpLCBnb3QgJyVjJyAoMHglMDJ4KSAlc1xuIiBSRVNFVCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXN0LT5leHBlY3RlZF9vdXRwdXRbaV0sICh1bnNpZ25lZCBjaGFyKXRlc3QtPmV4cGVjdGVkX291dHB1dFtpXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9vdXRwdXRbaV0sICh1bnNpZ25lZCBjaGFyKXZlcmlmaWNhdGlvbl9vdXRwdXRbaV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25fb3V0cHV0W2ldID09ICdcMCcgPyAiKFNUUklORyBFTkQpIiA6ICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChzdHJzdHIodmVyaWZpY2F0aW9uX291dHB1dCwgdGVzdC0+ZXhwZWN0ZWRfb3V0cHV0KSA9PSBOVUxMKSB7CiAgICAgICAgICAgICAgICAgICAgdGVzdC0+dmVyaWZpY2F0aW9uX3N1Y2Nlc3MgPSAwOwogICAgICAgICAgICAgICAgICAgIHN0cm5jcHkodGVzdC0+ZGV0YWlscywgdmVyaWZpY2F0aW9uX291dHB1dCwgc2l6ZW9mKHRlc3QtPmRldGFpbHMpIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBWRVJJRklDQVRJT04gRkFJTEVEIC0gUGF0dGVybiBub3QgZm91bmRcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdIFZFUklGSUNBVElPTiBTVUNDRVNTIC0gUGF0dGVybiBmb3VuZFxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkVFTiAiICBbVkVSQk9TRV0gVkVSSUZJQ0FUSU9OIFNVQ0NFU1MgLSBObyBleHBlY3RlZCBwYXR0ZXJuIHRvIG1hdGNoXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRlc3QtPnZlcmlmaWNhdGlvbl9zdWNjZXNzID0gMDsKICAgICAgICAgICAgc3RyY3B5KHRlc3QtPmRldGFpbHMsICJWZXJpZmljYXRpb24gY29tbWFuZCBmYWlsZWQiKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFZFUklGSUNBVElPTiBGQUlMRUQgLSBDb21tYW5kIGV4ZWN1dGlvbiBmYWlsZWRcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBWZXJpZmljYXRpb24gY29tbWFuZDogJXNcbiIgUkVTRVQsIHRlc3QtPnZlcmlmaWNhdGlvbl9jb21tYW5kKTsKICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgRXhpdCBjb2RlOiAlZFxuIiBSRVNFVCwgdmVyaWZpY2F0aW9uX3Jlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKCF0ZXN0LT5zdWNjZXNzICYmIHRlc3QtPnZlcmlmaWNhdGlvbl9jb21tYW5kWzBdICE9ICdcMCcpIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFZFUklGSUNBVElPTiBTS0lQUEVEIC0gTWFpbiBjb21tYW5kIGZhaWxlZFxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpbnQgb3ZlcmFsbF9zdWNjZXNzID0gdGVzdC0+c3VjY2VzcyAmJiB0ZXN0LT52ZXJpZmljYXRpb25fc3VjY2VzczsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIlxuICBbVkVSQk9TRV0gRklOQUwgVEVTVCBBU1NFU1NNRU5UXG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIE1haW4gY29tbWFuZCBzdWNjZXNzOiAlc1xuIiBSRVNFVCwgdGVzdC0+c3VjY2VzcyA/ICJZRVMiIDogIk5PIik7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBWZXJpZmljYXRpb24gc3VjY2VzczogJXNcbiIgUkVTRVQsIHRlc3QtPnZlcmlmaWNhdGlvbl9zdWNjZXNzID8gIllFUyIgOiAiTk8iKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIE92ZXJhbGwgc3VjY2VzczogJXNcbiIgUkVTRVQsIG92ZXJhbGxfc3VjY2VzcyA/ICJZRVMiIDogIk5PIik7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBUb3RhbCBkdXJhdGlvbjogJWxsZCBtc1xuIiBSRVNFVCwgdGVzdC0+ZHVyYXRpb25fbXMpOwogICAgfQogICAgCiAgICBpZiAob3ZlcmFsbF9zdWNjZXNzKSB7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0iKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdIik7CiAgICB9CiAgICAKICAgIHByaW50ZigiICVzJTRsbGQgbXMlc1xuIiwgQ1lBTiwgdGVzdC0+ZHVyYXRpb25fbXMsIFJFU0VUKTsKICAgIAogICAgaWYgKCF0ZXN0LT52ZXJpZmljYXRpb25fc3VjY2VzcykgewogICAgICAgIGlmICh0ZXN0LT5kZXRhaWxzWzBdICE9ICdcMCcpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBWZXJpZmljYXRpb24gZmFpbGVkOiAlc1xuIiBSRVNFVCwgdGVzdC0+ZGV0YWlscyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICh2ZXJib3NlX21vZGUgJiYgdGVzdC0+dmVyYm9zZV9vdXRwdXRbMF0gIT0gJ1wwJykgewogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBGVUxMIFZFUklGSUNBVElPTiBPVVRQVVQ6XG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKFdISVRFICIgIC0tLSBCRUdJTiBWRVJCT1NFIE9VVFBVVCAtLS1cbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoIiVzXG4iLCB0ZXN0LT52ZXJib3NlX291dHB1dCk7CiAgICAgICAgICAgIHByaW50ZihXSElURSAiICAtLS0gRU5EIFZFUkJPU0UgT1VUUFVUIC0tLVxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlICYmICFvdmVyYWxsX3N1Y2Nlc3MpIHsKICAgICAgICBwcmludGYoUkVEICJcbiAgW1ZFUkJPU0VdID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEZBSUxVUkUgUk9PVCBDQVVTRSBBTkFMWVNJU1xuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gVGVzdDogJXNcbiIgUkVTRVQsIHRlc3QtPmRlc2NyaXB0aW9uKTsKICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBNYWluIGNvbW1hbmQgc3VjY2VzczogJXNcbiIgUkVTRVQsIHRlc3QtPnN1Y2Nlc3MgPyAiWUVTIiA6ICJOTyIpOwogICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFZlcmlmaWNhdGlvbiBzdWNjZXNzOiAlc1xuIiBSRVNFVCwgdGVzdC0+dmVyaWZpY2F0aW9uX3N1Y2Nlc3MgPyAiWUVTIiA6ICJOTyIpOwogICAgICAgIAogICAgICAgIGlmICghdGVzdC0+c3VjY2VzcykgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBQUklNQVJZIEZBSUxVUkU6IE1haW4gY29tbWFuZCBleGVjdXRpb25cbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIENvbW1hbmQ6ICVzXG4iIFJFU0VULCB0ZXN0LT5jb21tYW5kKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBSYXcgZXhpdCBjb2RlOiAlZFxuIiBSRVNFVCwgcmVzdWx0KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFBPU1NJQkxFIFNPTFVUSU9OUzpcbiIgUkVTRVQpOwogICAgICAgICAgICBpZiAoc3Ryc3RyKHRlc3QtPmNvbW1hbmQsICJ0ZXN0ZGIiKSkgewogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICAtIENoZWNrIGlmIHRlc3RkYiBkYXRhYmFzZSBleGlzdHNcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICAtIFZlcmlmeSBkYXRhYmFzZSBwZXJtaXNzaW9uc1xuIiBSRVNFVCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0cnN0cih0ZXN0LT5jb21tYW5kLCAiZ3JlcCIpKSB7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIC0gQ2hlY2sgaWYgZ3JlcCBwYXR0ZXJuIG1hdGNoZXMgYWN0dWFsIG91dHB1dFxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIC0gVmVyaWZ5IGNhc2Ugc2Vuc2l0aXZpdHlcbiIgUkVTRVQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdHJzdHIodGVzdC0+Y29tbWFuZCwgInwiKSkgewogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICAtIENoZWNrIGVhY2ggY29tbWFuZCBpbiB0aGUgcGlwZWxpbmUgc2VwYXJhdGVseVxuIiBSRVNFVCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCF0ZXN0LT52ZXJpZmljYXRpb25fc3VjY2VzcykgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBQUklNQVJZIEZBSUxVUkU6IFZlcmlmaWNhdGlvbiBwaGFzZVxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgVmVyaWZpY2F0aW9uIGNvbW1hbmQ6ICVzXG4iIFJFU0VULCB0ZXN0LT52ZXJpZmljYXRpb25fY29tbWFuZCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgRXhwZWN0ZWQgcGF0dGVybjogXCIlc1wiXG4iIFJFU0VULCB0ZXN0LT5leHBlY3RlZF9vdXRwdXQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIERldGFpbHM6ICVzXG4iIFJFU0VULCB0ZXN0LT5kZXRhaWxzKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0ZXN0LT52ZXJib3NlX291dHB1dFswXSAhPSAnXDAnKSB7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEZ1bGwgb3V0cHV0IGNhcHR1cmVkICglenUgYnl0ZXMpXG4iIFJFU0VULCBzdHJsZW4odGVzdC0+dmVyYm9zZV9vdXRwdXQpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgcmV0dXJuIG92ZXJhbGxfc3VjY2VzczsKfQoKSHR0cFJlc3BvbnNlKiBodHRwX3JlcXVlc3QoY29uc3QgY2hhciogbWV0aG9kLCBjb25zdCBjaGFyKiB1cmwsIGNvbnN0IGNoYXIqIGJvZHksIGNvbnN0IGNoYXIqIGNvbnRlbnRfdHlwZSkgewogICAgSHR0cFJlc3BvbnNlKiByZXNwb25zZSA9IG1hbGxvYyhzaXplb2YoSHR0cFJlc3BvbnNlKSk7CiAgICBpZiAoIXJlc3BvbnNlKSByZXR1cm4gTlVMTDsKICAgIAogICAgcmVzcG9uc2UtPnN0YXR1c19jb2RlID0gMDsKICAgIHJlc3BvbnNlLT5ib2R5ID0gTlVMTDsKICAgIHJlc3BvbnNlLT5ib2R5X2xlbmd0aCA9IDA7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICJcbiAgW1ZFUkJPU0VdIEhUVFAgUkVRVUVTVCBJTklUSUFUSU9OXG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIE1ldGhvZDogJXNcbiIgUkVTRVQsIG1ldGhvZCk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBVUkw6ICVzXG4iIFJFU0VULCB1cmwpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgQm9keTogJXNcbiIgUkVTRVQsIGJvZHkgPyBib2R5IDogIihub25lKSIpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgQ29udGVudC1UeXBlOiAlc1xuIiBSRVNFVCwgY29udGVudF90eXBlID8gY29udGVudF90eXBlIDogIihub25lKSIpOwogICAgfQogICAgCiAgICBjaGFyIGhvc3RbMjU2XSA9ICJsb2NhbGhvc3QiOwogICAgaW50IHBvcnQgPSA4MDgwOwogICAgY2hhciBwYXRoWzEwMjRdID0gIi8iOwogICAgCiAgICBpZiAoc3RybmNtcCh1cmwsICJodHRwOi8vIiwgNykgPT0gMCkgewogICAgICAgIGNvbnN0IGNoYXIqIGhvc3Rfc3RhcnQgPSB1cmwgKyA3OwogICAgICAgIGNvbnN0IGNoYXIqIHBhdGhfc3RhcnQgPSBzdHJjaHIoaG9zdF9zdGFydCwgJy8nKTsKICAgICAgICBjb25zdCBjaGFyKiBwb3J0X3N0YXJ0ID0gc3RyY2hyKGhvc3Rfc3RhcnQsICc6Jyk7CiAgICAgICAgCiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBVUkwgUEFSU0lORyBBTkFMWVNJU1xuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgRnVsbCBVUkw6ICVzXG4iIFJFU0VULCB1cmwpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEhvc3Qgc3RhcnQgYXQ6ICVzXG4iIFJFU0VULCBob3N0X3N0YXJ0KTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBQYXRoIHN0YXJ0OiAlc1xuIiBSRVNFVCwgcGF0aF9zdGFydCA/IHBhdGhfc3RhcnQgOiAiTlVMTCIpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFBvcnQgc3RhcnQ6ICVzXG4iIFJFU0VULCBwb3J0X3N0YXJ0ID8gcG9ydF9zdGFydCA6ICJOVUxMIik7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChwb3J0X3N0YXJ0ICYmICghcGF0aF9zdGFydCB8fCBwb3J0X3N0YXJ0IDwgcGF0aF9zdGFydCkpIHsKICAgICAgICAgICAgc2l6ZV90IGhvc3RfbGVuID0gcG9ydF9zdGFydCAtIGhvc3Rfc3RhcnQ7CiAgICAgICAgICAgIHN0cm5jcHkoaG9zdCwgaG9zdF9zdGFydCwgaG9zdF9sZW4pOwogICAgICAgICAgICBob3N0W2hvc3RfbGVuXSA9ICdcMCc7CiAgICAgICAgICAgIHBvcnQgPSBhdG9pKHBvcnRfc3RhcnQgKyAxKTsKICAgICAgICAgICAgaWYgKHBhdGhfc3RhcnQpIHsKICAgICAgICAgICAgICAgIHN0cmNweShwYXRoLCBwYXRoX3N0YXJ0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDYXNlIDE6IFBvcnQgYmVmb3JlIHBhdGhcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBIb3N0OiAlcyAobGVuZ3RoOiAlenUpXG4iIFJFU0VULCBob3N0LCBob3N0X2xlbik7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFBvcnQ6ICVkXG4iIFJFU0VULCBwb3J0KTsKICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUGF0aDogJXNcbiIgUkVTRVQsIHBhdGgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChwYXRoX3N0YXJ0KSB7CiAgICAgICAgICAgIHNpemVfdCBob3N0X2xlbiA9IHBhdGhfc3RhcnQgLSBob3N0X3N0YXJ0OwogICAgICAgICAgICBzdHJuY3B5KGhvc3QsIGhvc3Rfc3RhcnQsIGhvc3RfbGVuKTsKICAgICAgICAgICAgaG9zdFtob3N0X2xlbl0gPSAnXDAnOwogICAgICAgICAgICBzdHJjcHkocGF0aCwgcGF0aF9zdGFydCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIENhc2UgMjogTm8gcG9ydCwgaGFzIHBhdGhcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBIb3N0OiAlcyAobGVuZ3RoOiAlenUpXG4iIFJFU0VULCBob3N0LCBob3N0X2xlbik7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFBhdGg6ICVzXG4iIFJFU0VULCBwYXRoKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0cmNweShob3N0LCBob3N0X3N0YXJ0KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgQ2FzZSAzOiBObyBwb3J0LCBubyBwYXRoXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgSG9zdDogJXNcbiIgUkVTRVQsIGhvc3QpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBzdHJjcHkocGF0aCwgdXJsKTsKICAgICAgICAKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgQ2FzZSA0OiBQYXRoIG9ubHkgKG5vIGh0dHA6Ly8pXG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBQYXRoOiAlc1xuIiBSRVNFVCwgcGF0aCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gUEFSU0VEIFVSTCBDT01QT05FTlRTXG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIEhvc3Q6ICVzXG4iIFJFU0VULCBob3N0KTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIFBvcnQ6ICVkXG4iIFJFU0VULCBwb3J0KTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIFBhdGg6ICVzXG4iIFJFU0VULCBwYXRoKTsKICAgIH0KICAgIAogICAgaW50IHNvY2tmZCA9IHNvY2tldChBRl9JTkVULCBTT0NLX1NUUkVBTSwgMCk7CiAgICBpZiAoc29ja2ZkIDwgMCkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gU09DS0VUIENSRUFUSU9OIEZBSUxFRFxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgRXJyb3I6ICVzIChlcnJubzogJWQpXG4iIFJFU0VULCBzdHJlcnJvcihlcnJubyksIGVycm5vKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBEb21haW46IEFGX0lORVRcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFR5cGU6IFNPQ0tfU1RSRUFNXG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBQcm90b2NvbDogMFxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgICAgIGZyZWUocmVzcG9uc2UpOwogICAgICAgIHJldHVybiBOVUxMOwogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBTb2NrZXQgY3JlYXRlZCBzdWNjZXNzZnVsbHlcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgU29ja2V0IEZEOiAlZFxuIiBSRVNFVCwgc29ja2ZkKTsKICAgIH0KICAgIAogICAgc3RydWN0IHRpbWV2YWwgdGltZW91dDsKICAgIHRpbWVvdXQudHZfc2VjID0gMTA7CiAgICB0aW1lb3V0LnR2X3VzZWMgPSAwOwogICAgc2V0c29ja29wdChzb2NrZmQsIFNPTF9TT0NLRVQsIFNPX1JDVlRJTUVPLCAmdGltZW91dCwgc2l6ZW9mKHRpbWVvdXQpKTsKICAgIHNldHNvY2tvcHQoc29ja2ZkLCBTT0xfU09DS0VULCBTT19TTkRUSU1FTywgJnRpbWVvdXQsIHNpemVvZih0aW1lb3V0KSk7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoR1JBWSAiICAgIFRpbWVvdXQgc2V0OiAlbGQgc2Vjb25kc1xuIiBSRVNFVCwgdGltZW91dC50dl9zZWMpOwogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gUkVTT0xWSU5HIEhPU1ROQU1FXG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIEhvc3RuYW1lIHRvIHJlc29sdmU6ICVzXG4iIFJFU0VULCBob3N0KTsKICAgIH0KICAgIAogICAgc3RydWN0IGhvc3RlbnQqIHNlcnZlciA9IGdldGhvc3RieW5hbWUoaG9zdCk7CiAgICBpZiAoIXNlcnZlcikgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gSE9TVE5BTUUgUkVTT0xVVElPTiBGQUlMRURcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEhvc3Q6ICVzXG4iIFJFU0VULCBob3N0KTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBoX2Vycm5vOiAlZFxuIiBSRVNFVCwgaF9lcnJubyk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUG9zc2libGUgY2F1c2VzOlxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgICAtIEROUyBzZXJ2ZXIgbm90IHJlYWNoYWJsZVxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgICAtIEhvc3RuYW1lIGRvZXNuJ3QgZXhpc3RcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgLSBOZXR3b3JrIGNvbmZpZ3VyYXRpb24gaXNzdWVcbiIgUkVTRVQpOwogICAgICAgIH0KICAgICAgICBjbG9zZShzb2NrZmQpOwogICAgICAgIGZyZWUocmVzcG9uc2UpOwogICAgICAgIHJldHVybiBOVUxMOwogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBIb3N0bmFtZSByZXNvbHZlZCBzdWNjZXNzZnVsbHlcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgT2ZmaWNpYWwgbmFtZTogJXNcbiIgUkVTRVQsIHNlcnZlci0+aF9uYW1lKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIEFkZHJlc3MgdHlwZTogJXNcbiIgUkVTRVQsIAogICAgICAgICAgICAgICBzZXJ2ZXItPmhfYWRkcnR5cGUgPT0gQUZfSU5FVCA/ICJBRl9JTkVUIChJUHY0KSIgOiAiT3RoZXIiKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIEFkZHJlc3MgbGVuZ3RoOiAlZCBieXRlc1xuIiBSRVNFVCwgc2VydmVyLT5oX2xlbmd0aCk7CiAgICAgICAgCiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBJUCBhZGRyZXNzZXM6XG4iIFJFU0VUKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgc2VydmVyLT5oX2FkZHJfbGlzdFtpXSAhPSBOVUxMOyBpKyspIHsKICAgICAgICAgICAgc3RydWN0IGluX2FkZHIgYWRkcjsKICAgICAgICAgICAgbWVtY3B5KCZhZGRyLCBzZXJ2ZXItPmhfYWRkcl9saXN0W2ldLCBzaXplb2YoYWRkcikpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgJWQ6ICVzXG4iIFJFU0VULCBpICsgMSwgaW5ldF9udG9hKGFkZHIpKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHN0cnVjdCBzb2NrYWRkcl9pbiBzZXJ2X2FkZHI7CiAgICBtZW1zZXQoJnNlcnZfYWRkciwgMCwgc2l6ZW9mKHNlcnZfYWRkcikpOwogICAgc2Vydl9hZGRyLnNpbl9mYW1pbHkgPSBBRl9JTkVUOwogICAgbWVtY3B5KCZzZXJ2X2FkZHIuc2luX2FkZHIuc19hZGRyLCBzZXJ2ZXItPmhfYWRkciwgc2VydmVyLT5oX2xlbmd0aCk7CiAgICBzZXJ2X2FkZHIuc2luX3BvcnQgPSBodG9ucyhwb3J0KTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIEFUVEVNUFRJTkcgQ09OTkVDVElPTlxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBTZXJ2ZXIgYWRkcmVzczogJXNcbiIgUkVTRVQsIGluZXRfbnRvYShzZXJ2X2FkZHIuc2luX2FkZHIpKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIFNlcnZlciBwb3J0OiAlZFxuIiBSRVNFVCwgbnRvaHMoc2Vydl9hZGRyLnNpbl9wb3J0KSk7CiAgICB9CiAgICAKICAgIGlmIChjb25uZWN0KHNvY2tmZCwgKHN0cnVjdCBzb2NrYWRkciopJnNlcnZfYWRkciwgc2l6ZW9mKHNlcnZfYWRkcikpIDwgMCkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gQ09OTkVDVElPTiBGQUlMRURcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEVycm9yOiAlcyAoZXJybm86ICVkKVxuIiBSRVNFVCwgc3RyZXJyb3IoZXJybm8pLCBlcnJubyk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgU2VydmVyOiAlczolZFxuIiBSRVNFVCwgaW5ldF9udG9hKHNlcnZfYWRkci5zaW5fYWRkciksIHBvcnQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFNvY2tldCBGRDogJWRcbiIgUkVTRVQsIHNvY2tmZCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUG9zc2libGUgY2F1c2VzOlxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgICAtIFNlcnZlciBub3QgcnVubmluZ1xuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgICAtIEZpcmV3YWxsIGJsb2NraW5nIGNvbm5lY3Rpb25cbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgLSBXcm9uZyBwb3J0IG51bWJlclxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgICAgIGNsb3NlKHNvY2tmZCk7CiAgICAgICAgZnJlZShyZXNwb25zZSk7CiAgICAgICAgcmV0dXJuIE5VTEw7CiAgICB9CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdIENvbm5lY3Rpb24gZXN0YWJsaXNoZWQgc3VjY2Vzc2Z1bGx5XG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIENvbm5lY3RlZCB0bzogJXM6JWRcbiIgUkVTRVQsIGluZXRfbnRvYShzZXJ2X2FkZHIuc2luX2FkZHIpLCBwb3J0KTsKICAgIH0KICAgIAogICAgY2hhciByZXF1ZXN0WzgxOTJdOwogICAgaW50IHJlcXVlc3RfbGVuOwogICAgCiAgICBpZiAoYm9keSAmJiBjb250ZW50X3R5cGUpIHsKICAgICAgICByZXF1ZXN0X2xlbiA9IHNucHJpbnRmKHJlcXVlc3QsIHNpemVvZihyZXF1ZXN0KSwKICAgICAgICAgICAgIiVzICVzIEhUVFAvMS4xXHJcbiIKICAgICAgICAgICAgIkhvc3Q6ICVzOiVkXHJcbiIKICAgICAgICAgICAgIkNvbnRlbnQtVHlwZTogJXNcclxuIgogICAgICAgICAgICAiQ29udGVudC1MZW5ndGg6ICV6dVxyXG4iCiAgICAgICAgICAgICJDb25uZWN0aW9uOiBjbG9zZVxyXG4iCiAgICAgICAgICAgICJcclxuIgogICAgICAgICAgICAiJXMiLAogICAgICAgICAgICBtZXRob2QsIHBhdGgsIGhvc3QsIHBvcnQsIGNvbnRlbnRfdHlwZSwgc3RybGVuKGJvZHkpLCBib2R5KTsKICAgIH0gZWxzZSBpZiAoYm9keSkgewogICAgICAgIHJlcXVlc3RfbGVuID0gc25wcmludGYocmVxdWVzdCwgc2l6ZW9mKHJlcXVlc3QpLAogICAgICAgICAgICAiJXMgJXMgSFRUUC8xLjFcclxuIgogICAgICAgICAgICAiSG9zdDogJXM6JWRcclxuIgogICAgICAgICAgICAiQ29udGVudC1MZW5ndGg6ICV6dVxyXG4iCiAgICAgICAgICAgICJDb25uZWN0aW9uOiBjbG9zZVxyXG4iCiAgICAgICAgICAgICJcclxuIgogICAgICAgICAgICAiJXMiLAogICAgICAgICAgICBtZXRob2QsIHBhdGgsIGhvc3QsIHBvcnQsIHN0cmxlbihib2R5KSwgYm9keSk7CiAgICB9IGVsc2UgewogICAgICAgIHJlcXVlc3RfbGVuID0gc25wcmludGYocmVxdWVzdCwgc2l6ZW9mKHJlcXVlc3QpLAogICAgICAgICAgICAiJXMgJXMgSFRUUC8xLjFcclxuIgogICAgICAgICAgICAiSG9zdDogJXM6JWRcclxuIgogICAgICAgICAgICAiQ29ubmVjdGlvbjogY2xvc2VcclxuIgogICAgICAgICAgICAiXHJcbiIsCiAgICAgICAgICAgIG1ldGhvZCwgcGF0aCwgaG9zdCwgcG9ydCk7CiAgICB9CiAgICAKICAgIGlmIChyZXF1ZXN0X2xlbiA+PSAoaW50KXNpemVvZihyZXF1ZXN0KSkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gSFRUUCBSRVFVRVNUIFRPTyBMQVJHRVxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUmVxdWVzdCBidWZmZXIgc2l6ZTogJXp1IGJ5dGVzXG4iIFJFU0VULCBzaXplb2YocmVxdWVzdCkpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIENhbGN1bGF0ZWQgcmVxdWVzdCBsZW5ndGg6ICVkIGJ5dGVzXG4iIFJFU0VULCByZXF1ZXN0X2xlbik7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgQm9keSBsZW5ndGg6ICV6dSBieXRlc1xuIiBSRVNFVCwgYm9keSA/IHN0cmxlbihib2R5KSA6IDApOwogICAgICAgIH0KICAgICAgICBjbG9zZShzb2NrZmQpOwogICAgICAgIGZyZWUocmVzcG9uc2UpOwogICAgICAgIHJldHVybiBOVUxMOwogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gSFRUUCBSRVFVRVNUIENPTlNUUlVDVEVEXG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIFRvdGFsIGxlbmd0aDogJWQgYnl0ZXNcbiIgUkVTRVQsIHJlcXVlc3RfbGVuKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIFJlcXVlc3QgcHJldmlldyAoZmlyc3QgNTAwIGJ5dGVzKTpcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihXSElURSAiICAgIC0tLSBCRUdJTiBSRVFVRVNUIC0tLVxuIiBSRVNFVCk7CiAgICAgICAgaW50IHByZXZpZXdfbGVuID0gcmVxdWVzdF9sZW4gPiA1MDAgPyA1MDAgOiByZXF1ZXN0X2xlbjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHByZXZpZXdfbGVuOyBpKyspIHsKICAgICAgICAgICAgcHV0Y2hhcihyZXF1ZXN0W2ldKTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlcXVlc3RfbGVuID4gNTAwKSB7CiAgICAgICAgICAgIHByaW50ZigiXG4gICAgLi4uIFslZCBtb3JlIGJ5dGVzXVxuIiwgcmVxdWVzdF9sZW4gLSA1MDApOwogICAgICAgIH0KICAgICAgICBwcmludGYoV0hJVEUgIiAgICAtLS0gRU5EIFJFUVVFU1QgLS0tXG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFNFTkRJTkcgSFRUUCBSRVFVRVNUXG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIFNvY2tldCBGRDogJWRcbiIgUkVTRVQsIHNvY2tmZCk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBSZXF1ZXN0IGxlbmd0aDogJWQgYnl0ZXNcbiIgUkVTRVQsIHJlcXVlc3RfbGVuKTsKICAgIH0KICAgIAogICAgc3NpemVfdCBzZW50X2J5dGVzID0gc2VuZChzb2NrZmQsIHJlcXVlc3QsIHJlcXVlc3RfbGVuLCAwKTsKICAgIGlmIChzZW50X2J5dGVzIDwgMCkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gU0VORCBGQUlMRURcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEVycm9yOiAlcyAoZXJybm86ICVkKVxuIiBSRVNFVCwgc3RyZXJyb3IoZXJybm8pLCBlcnJubyk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgQXR0ZW1wdGVkIHRvIHNlbmQ6ICVkIGJ5dGVzXG4iIFJFU0VULCByZXF1ZXN0X2xlbik7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgQWN0dWFsbHkgc2VudDogJXpkIGJ5dGVzXG4iIFJFU0VULCBzZW50X2J5dGVzKTsKICAgICAgICB9CiAgICAgICAgY2xvc2Uoc29ja2ZkKTsKICAgICAgICBmcmVlKHJlc3BvbnNlKTsKICAgICAgICByZXR1cm4gTlVMTDsKICAgIH0KICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihHUkVFTiAiICBbVkVSQk9TRV0gUmVxdWVzdCBzZW50IHN1Y2Nlc3NmdWxseVxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBCeXRlcyBzZW50OiAlemQvJWQgKCUuMWYlJSlcbiIgUkVTRVQsIAogICAgICAgICAgICAgICBzZW50X2J5dGVzLCByZXF1ZXN0X2xlbiwgKGZsb2F0KXNlbnRfYnl0ZXMvcmVxdWVzdF9sZW4qMTAwKTsKICAgIH0KICAgIAogICAgY2hhciByZXNwb25zZV9idWZmZXJbMTYzODRdOwogICAgc3NpemVfdCB0b3RhbF9yZWNlaXZlZCA9IDA7CiAgICBzc2l6ZV90IHJlY2VpdmVkOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gV0FJVElORyBGT1IgUkVTUE9OU0VcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgQnVmZmVyIHNpemU6ICV6dSBieXRlc1xuIiBSRVNFVCwgc2l6ZW9mKHJlc3BvbnNlX2J1ZmZlcikpOwogICAgfQogICAgCiAgICB3aGlsZSAoKHJlY2VpdmVkID0gcmVjdihzb2NrZmQsIHJlc3BvbnNlX2J1ZmZlciArIHRvdGFsX3JlY2VpdmVkLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKHJlc3BvbnNlX2J1ZmZlcikgLSB0b3RhbF9yZWNlaXZlZCAtIDEsIDApKSA+IDApIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlICYmIHRvdGFsX3JlY2VpdmVkID09IDApIHsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBGaXJzdCBjaHVuayByZWNlaXZlZDogJXpkIGJ5dGVzXG4iIFJFU0VULCByZWNlaXZlZCk7CiAgICAgICAgfQogICAgICAgIHRvdGFsX3JlY2VpdmVkICs9IHJlY2VpdmVkOwogICAgICAgIGlmICh0b3RhbF9yZWNlaXZlZCA+PSAoc3NpemVfdClzaXplb2YocmVzcG9uc2VfYnVmZmVyKSAtIDEpIHsKICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gUkVTUE9OU0UgQlVGRkVSIEZVTExcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBCdWZmZXIgY2FwYWNpdHkgcmVhY2hlZDogJXp1IGJ5dGVzXG4iIFJFU0VULCBzaXplb2YocmVzcG9uc2VfYnVmZmVyKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpZiAocmVjZWl2ZWQgPCAwKSB7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBSRUNFSVZFIEZBSUxFRFxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgRXJyb3I6ICVzIChlcnJubzogJWQpXG4iIFJFU0VULCBzdHJlcnJvcihlcnJubyksIGVycm5vKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBUb3RhbCByZWNlaXZlZCBiZWZvcmUgZXJyb3I6ICV6ZCBieXRlc1xuIiBSRVNFVCwgdG90YWxfcmVjZWl2ZWQpOwogICAgICAgIH0KICAgICAgICBjbG9zZShzb2NrZmQpOwogICAgICAgIGZyZWUocmVzcG9uc2UpOwogICAgICAgIHJldHVybiBOVUxMOwogICAgfQogICAgCiAgICByZXNwb25zZV9idWZmZXJbdG90YWxfcmVjZWl2ZWRdID0gJ1wwJzsKICAgIGNsb3NlKHNvY2tmZCk7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdIFJlc3BvbnNlIHJlY2VpdmVkIGNvbXBsZXRlbHlcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgVG90YWwgYnl0ZXMgcmVjZWl2ZWQ6ICV6ZFxuIiBSRVNFVCwgdG90YWxfcmVjZWl2ZWQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgUmVzcG9uc2UgcHJldmlldyAoZmlyc3QgNTAwIGJ5dGVzKTpcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihXSElURSAiICAgIC0tLSBCRUdJTiBSRVNQT05TRSBQUkVWSUVXIC0tLVxuIiBSRVNFVCk7CiAgICAgICAgaW50IHByZXZpZXdfbGVuID0gdG90YWxfcmVjZWl2ZWQgPiA1MDAgPyA1MDAgOiB0b3RhbF9yZWNlaXZlZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHByZXZpZXdfbGVuOyBpKyspIHsKICAgICAgICAgICAgcHV0Y2hhcihyZXNwb25zZV9idWZmZXJbaV0pOwogICAgICAgIH0KICAgICAgICBpZiAodG90YWxfcmVjZWl2ZWQgPiA1MDApIHsKICAgICAgICAgICAgcHJpbnRmKCJcbiAgICAuLi4gWyV6ZCBtb3JlIGJ5dGVzXVxuIiwgdG90YWxfcmVjZWl2ZWQgLSA1MDApOwogICAgICAgIH0KICAgICAgICBwcmludGYoV0hJVEUgIiAgICAtLS0gRU5EIFJFU1BPTlNFIFBSRVZJRVcgLS0tXG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgY2hhciogc3RhdHVzX2xpbmUgPSBzdHJzdHIocmVzcG9uc2VfYnVmZmVyLCAiSFRUUC8xLjEiKTsKICAgIGlmIChzdGF0dXNfbGluZSkgewogICAgICAgIHNzY2FuZihzdGF0dXNfbGluZSwgIkhUVFAvMS4xICVkIiwgJnJlc3BvbnNlLT5zdGF0dXNfY29kZSk7CiAgICAgICAgCiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBIVFRQIFNUQVRVUyBMSU5FIFBBUlNFRFxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgU3RhdHVzIGxpbmU6ICUuKnNcbiIgUkVTRVQsIAogICAgICAgICAgICAgICAgICAgKGludCkoc3RyY2hyKHN0YXR1c19saW5lLCAnXHInKSAtIHN0YXR1c19saW5lKSwgc3RhdHVzX2xpbmUpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFN0YXR1cyBjb2RlOiAlZFxuIiBSRVNFVCwgcmVzcG9uc2UtPnN0YXR1c19jb2RlKTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gTk8gSFRUUCBTVEFUVVMgTElORSBGT1VORFxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgTG9va2luZyBmb3IgJ0hUVFAvMS4xJyBpbiByZXNwb25zZVxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUmVzcG9uc2Ugc3RhcnQ6ICUuNTBzXG4iIFJFU0VULCByZXNwb25zZV9idWZmZXIpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgY2hhciogYm9keV9zdGFydCA9IHN0cnN0cihyZXNwb25zZV9idWZmZXIsICJcclxuXHJcbiIpOwogICAgaWYgKGJvZHlfc3RhcnQpIHsKICAgICAgICBib2R5X3N0YXJ0ICs9IDQ7CiAgICAgICAgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoID0gdG90YWxfcmVjZWl2ZWQgLSAoYm9keV9zdGFydCAtIHJlc3BvbnNlX2J1ZmZlcik7CiAgICAgICAgcmVzcG9uc2UtPmJvZHkgPSBtYWxsb2MocmVzcG9uc2UtPmJvZHlfbGVuZ3RoICsgMSk7CiAgICAgICAgaWYgKHJlc3BvbnNlLT5ib2R5KSB7CiAgICAgICAgICAgIG1lbWNweShyZXNwb25zZS0+Ym9keSwgYm9keV9zdGFydCwgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoKTsKICAgICAgICAgICAgcmVzcG9uc2UtPmJvZHlbcmVzcG9uc2UtPmJvZHlfbGVuZ3RoXSA9ICdcMCc7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdIFJFU1BPTlNFIEJPRFkgRVhUUkFDVEVEXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgQm9keSBzdGFydCBvZmZzZXQ6ICVsZCBieXRlc1xuIiBSRVNFVCwgYm9keV9zdGFydCAtIHJlc3BvbnNlX2J1ZmZlcik7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEJvZHkgbGVuZ3RoOiAlenUgYnl0ZXNcbiIgUkVTRVQsIHJlc3BvbnNlLT5ib2R5X2xlbmd0aCk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEJvZHkgcHJldmlldyAoZmlyc3QgMjAwIGJ5dGVzKTpcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKFdISVRFICIgICAgLS0tIEJFR0lOIEJPRFkgUFJFVklFVyAtLS1cbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgaW50IHByZXZpZXdfbGVuID0gcmVzcG9uc2UtPmJvZHlfbGVuZ3RoID4gMjAwID8gMjAwIDogcmVzcG9uc2UtPmJvZHlfbGVuZ3RoOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwcmV2aWV3X2xlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgcHV0Y2hhcihyZXNwb25zZS0+Ym9keVtpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UtPmJvZHlfbGVuZ3RoID4gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCJcbiAgICAuLi4gWyV6dSBtb3JlIGJ5dGVzXVxuIiwgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoIC0gMjAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHByaW50ZihXSElURSAiICAgIC0tLSBFTkQgQk9EWSBQUkVWSUVXIC0tLVxuIiBSRVNFVCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBNRU1PUlkgQUxMT0NBVElPTiBGQUlMRUQgRk9SIEJPRFlcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBSZXF1ZXN0ZWQgc2l6ZTogJXp1IGJ5dGVzXG4iIFJFU0VULCByZXNwb25zZS0+Ym9keV9sZW5ndGggKyAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgcmVzcG9uc2UtPmJvZHkgPSBzdHJkdXAoIiIpOwogICAgICAgIHJlc3BvbnNlLT5ib2R5X2xlbmd0aCA9IDA7CiAgICAgICAgCiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBOTyBCT0RZIEZPVU5EIElOIFJFU1BPTlNFXG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBMb29raW5nIGZvciAnXFxyXFxuXFxyXFxuJyBzZXBhcmF0b3JcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFJlc3BvbnNlIG1pZ2h0IGJlIGhlYWRlcnMtb25seVxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gSFRUUCBSRVFVRVNUIENPTVBMRVRFXG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIEZpbmFsIHN0YXR1czogJWRcbiIgUkVTRVQsIHJlc3BvbnNlLT5zdGF0dXNfY29kZSk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBCb2R5IHNpemU6ICV6dSBieXRlc1xuIiBSRVNFVCwgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIE1lbW9yeSBhbGxvY2F0ZWQgZm9yIHJlc3BvbnNlOiAlenUgYnl0ZXNcbiIgUkVTRVQsIAogICAgICAgICAgICAgICBzaXplb2YoSHR0cFJlc3BvbnNlKSArIChyZXNwb25zZS0+Ym9keSA/IHJlc3BvbnNlLT5ib2R5X2xlbmd0aCArIDEgOiAwKSk7CiAgICB9CiAgICAKICAgIHJldHVybiByZXNwb25zZTsKfQoKdm9pZCBodHRwX3Jlc3BvbnNlX2ZyZWUoSHR0cFJlc3BvbnNlKiByZXNwb25zZSkgewogICAgaWYgKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLT5ib2R5KSB7CiAgICAgICAgICAgIGZyZWUocmVzcG9uc2UtPmJvZHkpOwogICAgICAgIH0KICAgICAgICBmcmVlKHJlc3BvbnNlKTsKICAgIH0KfQoKaW50IHZlcmlmeV9odHRwX3Jlc3BvbnNlKGNvbnN0IEh0dHBSZXNwb25zZSogcmVzcG9uc2UsIGNvbnN0IGNoYXIqIGV4cGVjdGVkX3BhdHRlcm4sIGludCBjaGVja19zdWNjZXNzX29ubHkpIHsKICAgIGlmICghcmVzcG9uc2UpIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIlxuICBbVkVSQk9TRV0gSFRUUCBSRVNQT05TRSBWRVJJRklDQVRJT04gRkFJTEVEXG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gUmVzcG9uc2UgaXMgTlVMTFxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgRXhwZWN0ZWQgcGF0dGVybjogXCIlc1wiXG4iIFJFU0VULCBleHBlY3RlZF9wYXR0ZXJuID8gZXhwZWN0ZWRfcGF0dGVybiA6ICIobm9uZSkiKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDaGVjayBzdWNjZXNzIG9ubHk6ICVzXG4iIFJFU0VULCBjaGVja19zdWNjZXNzX29ubHkgPyAiWUVTIiA6ICJOTyIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIlxuICBbVkVSQk9TRV0gSFRUUCBSRVNQT05TRSBWRVJJRklDQVRJT05cbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgUmVzcG9uc2Ugc3RhdHVzIGNvZGU6ICVkXG4iIFJFU0VULCByZXNwb25zZS0+c3RhdHVzX2NvZGUpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgUmVzcG9uc2UgYm9keSBsZW5ndGg6ICV6dSBieXRlc1xuIiBSRVNFVCwgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIEV4cGVjdGVkIHBhdHRlcm46IFwiJXNcIlxuIiBSRVNFVCwgZXhwZWN0ZWRfcGF0dGVybiA/IGV4cGVjdGVkX3BhdHRlcm4gOiAiKG5vbmUpIik7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDaGVjayBzdWNjZXNzIG9ubHk6ICVzXG4iIFJFU0VULCBjaGVja19zdWNjZXNzX29ubHkgPyAiWUVTIiA6ICJOTyIpOwogICAgICAgIAogICAgICAgIGlmIChyZXNwb25zZS0+Ym9keSkgewogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEJvZHkgY29udGVudCAoZmlyc3QgMzAwIGNoYXJzKTpcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoV0hJVEUgIiAgICAtLS0gQkVHSU4gQk9EWSAtLS1cbiIgUkVTRVQpOwogICAgICAgICAgICBpbnQgbGVuID0gcmVzcG9uc2UtPmJvZHlfbGVuZ3RoID4gMzAwID8gMzAwIDogcmVzcG9uc2UtPmJvZHlfbGVuZ3RoOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBwdXRjaGFyKHJlc3BvbnNlLT5ib2R5W2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVzcG9uc2UtPmJvZHlfbGVuZ3RoID4gMzAwKSB7CiAgICAgICAgICAgICAgICBwcmludGYoIlxuICAgIC4uLiBbJXp1IG1vcmUgY2hhcnNdXG4iLCByZXNwb25zZS0+Ym9keV9sZW5ndGggLSAzMDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHByaW50ZihXSElURSAiICAgIC0tLSBFTkQgQk9EWSAtLS1cbiIgUkVTRVQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgaWYgKGNoZWNrX3N1Y2Nlc3Nfb25seSkgewogICAgICAgIGludCBoYXNfc3VjY2Vzc19maWVsZCA9IHJlc3BvbnNlLT5ib2R5ICYmIHN0cnN0cihyZXNwb25zZS0+Ym9keSwgIlwic3VjY2Vzc1wiOiIpICE9IE5VTEw7CiAgICAgICAgaW50IHZhbGlkX3N0YXR1cyA9IChyZXNwb25zZS0+c3RhdHVzX2NvZGUgPj0gMjAwICYmIHJlc3BvbnNlLT5zdGF0dXNfY29kZSA8IDUwMCk7CiAgICAgICAgaW50IHJlc3VsdCA9IHZhbGlkX3N0YXR1cyAmJiBoYXNfc3VjY2Vzc19maWVsZDsKICAgICAgICAKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFNVQ0NFU1MtT05MWSBDSEVDSyBBTkFMWVNJU1xuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgU3RhdHVzIGNvZGUgdmFsaWQgKDIwMC00OTkpOiAlcyAoJWQpXG4iIFJFU0VULCAKICAgICAgICAgICAgICAgICAgIHZhbGlkX3N0YXR1cyA/ICJZRVMiIDogIk5PIiwgcmVzcG9uc2UtPnN0YXR1c19jb2RlKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBIYXMgJ3N1Y2Nlc3MnIGZpZWxkIGluIEpTT046ICVzXG4iIFJFU0VULCAKICAgICAgICAgICAgICAgICAgIGhhc19zdWNjZXNzX2ZpZWxkID8gIllFUyIgOiAiTk8iKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDb21iaW5lZCByZXN1bHQ6ICVzXG4iIFJFU0VULCByZXN1bHQgPyAiUEFTUyIgOiAiRkFJTCIpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCF2YWxpZF9zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFNUQVRVUyBDT0RFIElTU1VFXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgRXhwZWN0ZWQ6IDIwMC00OTlcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBHb3Q6ICVkXG4iIFJFU0VULCByZXNwb25zZS0+c3RhdHVzX2NvZGUpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBTdGF0dXMgY29kZSBjYXRlZ29yaWVzOlxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgMjAwLTI5OTogU3VjY2Vzc1xuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgMzAwLTM5OTogUmVkaXJlY3Rpb25cbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICAgIDQwMC00OTk6IENsaWVudCBlcnJvclxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgNTAwLTU5OTogU2VydmVyIGVycm9yXG4iIFJFU0VUKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCFoYXNfc3VjY2Vzc19maWVsZCAmJiByZXNwb25zZS0+Ym9keSkgewogICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gTUlTU0lORyBTVUNDRVNTIEZJRUxEXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgTG9va2luZyBmb3IgJ1wic3VjY2Vzc1wiOicgaW4gYm9keVxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEJvZHkgY29udGVudCB0eXBlIGFuYWx5c2lzOlxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChzdHJzdHIocmVzcG9uc2UtPmJvZHksICJ7IikgJiYgc3Ryc3RyKHJlc3BvbnNlLT5ib2R5LCAifSIpKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBBcHBlYXJzIHRvIGJlIEpTT05cbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIqIGNvbW1vbl9maWVsZHNbXSA9IHsiXCJlcnJvclwiIiwgIlwibWVzc2FnZVwiIiwgIlwic3RhdHVzXCIiLCAiXCJyZXN1bHRcIiIsIE5VTEx9OwogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBjb21tb25fZmllbGRzW2ldOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cnN0cihyZXNwb25zZS0+Ym9keSwgY29tbW9uX2ZpZWxkc1tpXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgRm91bmQgc2ltaWxhciBmaWVsZDogJXNcbiIgUkVTRVQsIGNvbW1vbl9maWVsZHNbaV0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdHJzdHIocmVzcG9uc2UtPmJvZHksICI8aHRtbCIpIHx8IHN0cnN0cihyZXNwb25zZS0+Ym9keSwgIjwhRE9DVFlQRSIpKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBBcHBlYXJzIHRvIGJlIEhUTUxcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdHJzdHIocmVzcG9uc2UtPmJvZHksICJlcnJvciIpIHx8IHN0cnN0cihyZXNwb25zZS0+Ym9keSwgIkVycm9yIikpIHsKICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIENvbnRhaW5zICdlcnJvcicgdGV4dFxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBGVUxMIFJFU1BPTlNFIENIRUNLXG4iIFJFU0VUKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHJlc3BvbnNlLT5zdGF0dXNfY29kZSA8IDIwMCB8fCByZXNwb25zZS0+c3RhdHVzX2NvZGUgPj0gMzAwKSB7CiAgICAgICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFNUQVRVUyBDT0RFIENIRUNLIEZBSUxFRFxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEV4cGVjdGVkOiAyMDAtMjk5IChzdWNjZXNzKVxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEdvdDogJWRcbiIgUkVTRVQsIHJlc3BvbnNlLT5zdGF0dXNfY29kZSk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIFN0YXR1cyBjb2RlIG1lYW5pbmc6XG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgY2hhciogc3RhdHVzX21lYW5pbmdzW10gPSB7CiAgICAgICAgICAgICAgICAgICAgIjIwMCIsICJPSyIsCiAgICAgICAgICAgICAgICAgICAgIjIwMSIsICJDcmVhdGVkIiwKICAgICAgICAgICAgICAgICAgICAiMjA0IiwgIk5vIENvbnRlbnQiLAogICAgICAgICAgICAgICAgICAgICI0MDAiLCAiQmFkIFJlcXVlc3QiLAogICAgICAgICAgICAgICAgICAgICI0MDEiLCAiVW5hdXRob3JpemVkIiwKICAgICAgICAgICAgICAgICAgICAiNDAzIiwgIkZvcmJpZGRlbiIsCiAgICAgICAgICAgICAgICAgICAgIjQwNCIsICJOb3QgRm91bmQiLAogICAgICAgICAgICAgICAgICAgICI0MDUiLCAiTWV0aG9kIE5vdCBBbGxvd2VkIiwKICAgICAgICAgICAgICAgICAgICAiNDA5IiwgIkNvbmZsaWN0IiwKICAgICAgICAgICAgICAgICAgICAiNTAwIiwgIkludGVybmFsIFNlcnZlciBFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgIjUwMyIsICJTZXJ2aWNlIFVuYXZhaWxhYmxlIiwKICAgICAgICAgICAgICAgICAgICBOVUxMCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjaGFyIHN0YXR1c19zdHJbMTBdOwogICAgICAgICAgICAgICAgc25wcmludGYoc3RhdHVzX3N0ciwgc2l6ZW9mKHN0YXR1c19zdHIpLCAiJWQiLCByZXNwb25zZS0+c3RhdHVzX2NvZGUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgc3RhdHVzX21lYW5pbmdzW2ldICE9IE5VTEw7IGkgKz0gMikgewogICAgICAgICAgICAgICAgICAgIGlmIChzdHJjbXAoc3RhdHVzX3N0ciwgc3RhdHVzX21lYW5pbmdzW2ldKSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgICAlczogJXNcbiIgUkVTRVQsIHN0YXR1c19tZWFuaW5nc1tpXSwgc3RhdHVzX21lYW5pbmdzW2krMV0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBTdGF0dXMgY29kZSBjaGVjayBwYXNzZWQ6ICVkXG4iIFJFU0VULCByZXNwb25zZS0+c3RhdHVzX2NvZGUpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoZXhwZWN0ZWRfcGF0dGVybiAmJiBleHBlY3RlZF9wYXR0ZXJuWzBdICE9ICdcMCcpIHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZS0+Ym9keSkgewogICAgICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFBBVFRFUk4gQ0hFQ0sgRkFJTEVEXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEV4cGVjdGVkIHBhdHRlcm46IFwiJXNcIlxuIiBSRVNFVCwgZXhwZWN0ZWRfcGF0dGVybik7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBSZXNwb25zZSBib2R5IGlzIE5VTExcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNoYXIqIHBhdHRlcm5fZm91bmQgPSBzdHJzdHIocmVzcG9uc2UtPmJvZHksIGV4cGVjdGVkX3BhdHRlcm4pOwogICAgICAgICAgICBpZiAocGF0dGVybl9mb3VuZCA9PSBOVUxMKSB7CiAgICAgICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gUEFUVEVSTiBOT1QgRk9VTkQgSU4gUkVTUE9OU0UgQk9EWVxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBFeHBlY3RlZCBwYXR0ZXJuOiBcIiVzXCJcbiIgUkVTRVQsIGV4cGVjdGVkX3BhdHRlcm4pOwogICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUGF0dGVybiBsZW5ndGg6ICV6dSBjaGFyYWN0ZXJzXG4iIFJFU0VULCBzdHJsZW4oZXhwZWN0ZWRfcGF0dGVybikpOwogICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgQm9keSBsZW5ndGg6ICV6dSBjaGFyYWN0ZXJzXG4iIFJFU0VULCBzdHJsZW4ocmVzcG9uc2UtPmJvZHkpKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIENhc2UtaW5zZW5zaXRpdmUgc2VhcmNoOiAiIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICBjaGFyKiBsb3dlcl9ib2R5ID0gc3RyZHVwKHJlc3BvbnNlLT5ib2R5KTsKICAgICAgICAgICAgICAgICAgICBjaGFyKiBsb3dlcl9wYXR0ZXJuID0gc3RyZHVwKGV4cGVjdGVkX3BhdHRlcm4pOwogICAgICAgICAgICAgICAgICAgIGZvciAoc2l6ZV90IGkgPSAwOyBsb3dlcl9ib2R5W2ldOyBpKyspIGxvd2VyX2JvZHlbaV0gPSB0b2xvd2VyKGxvd2VyX2JvZHlbaV0pOwogICAgICAgICAgICAgICAgICAgIGZvciAoc2l6ZV90IGkgPSAwOyBsb3dlcl9wYXR0ZXJuW2ldOyBpKyspIGxvd2VyX3BhdHRlcm5baV0gPSB0b2xvd2VyKGxvd2VyX3BhdHRlcm5baV0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChzdHJzdHIobG93ZXJfYm9keSwgbG93ZXJfcGF0dGVybikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCJGT1VORCAoY2FzZSBkaWZmZXJlbmNlKVxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgT3JpZ2luYWwgY2FzZSBtaWdodCBiZSBkaWZmZXJlbnRcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZigiTk9UIEZPVU5EXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZnJlZShsb3dlcl9ib2R5KTsKICAgICAgICAgICAgICAgICAgICBmcmVlKGxvd2VyX3BhdHRlcm4pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgTG9va2luZyBmb3Igc2ltaWxhciBwYXR0ZXJuczpcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChzdHJzdHIoZXhwZWN0ZWRfcGF0dGVybiwgInN1Y2Nlc3MiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgICAgQ2hlY2tpbmcgJ1N1Y2Nlc3MnIChjYXBpdGFsIFMpOiAlc1xuIiBSRVNFVCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnN0cihyZXNwb25zZS0+Ym9keSwgIlN1Y2Nlc3MiKSA/ICJGT1VORCIgOiAiTk9UIEZPVU5EIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgICBDaGVja2luZyAnU1VDQ0VTUycgKGFsbCBjYXBzKTogJXNcbiIgUkVTRVQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJzdHIocmVzcG9uc2UtPmJvZHksICJTVUNDRVNTIikgPyAiRk9VTkQiIDogIk5PVCBGT1VORCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEJvZHkgY29udGVudCBhcm91bmQgZXhwZWN0ZWQgYXJlYTpcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIHByaW50ZihXSElURSAiICAgIC0tLSBCRUdJTiBDT05URVhUIC0tLVxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgaW50IHN0YXJ0ID0gMDsKICAgICAgICAgICAgICAgICAgICBpbnQgZW5kID0gc3RybGVuKHJlc3BvbnNlLT5ib2R5KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZW5kID4gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gZW5kLzIgLSAxMDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCA9IGVuZC8yICsgMTAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gc3RhcnQ7IGkgPCBlbmQgJiYgaSA8IChpbnQpc3RybGVuKHJlc3BvbnNlLT5ib2R5KTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1dGNoYXIocmVzcG9uc2UtPmJvZHlbaV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwcmludGYoV0hJVEUgIlxuICAgIC0tLSBFTkQgQ09OVEVYVCAtLS1cbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBQQVRURVJOIEZPVU5EIElOIFJFU1BPTlNFIEJPRFlcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUGF0dGVybjogXCIlc1wiXG4iIFJFU0VULCBleHBlY3RlZF9wYXR0ZXJuKTsKICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEZvdW5kIGF0IHBvc2l0aW9uOiAlbGRcbiIgUkVTRVQsIHBhdHRlcm5fZm91bmQgLSByZXNwb25zZS0+Ym9keSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDb250ZXh0IGFyb3VuZCBmb3VuZCBwYXR0ZXJuICg1MCBjaGFycyBiZWZvcmUvYWZ0ZXIpOlxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKFdISVRFICIgICAgLS0tIEJFR0lOIENPTlRFWFQgLS0tXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICBsb25nIHN0YXJ0ID0gcGF0dGVybl9mb3VuZCAtIHJlc3BvbnNlLT5ib2R5IC0gNTA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0IDwgMCkgc3RhcnQgPSAwOwogICAgICAgICAgICAgICAgICAgIGxvbmcgZW5kID0gcGF0dGVybl9mb3VuZCAtIHJlc3BvbnNlLT5ib2R5ICsgc3RybGVuKGV4cGVjdGVkX3BhdHRlcm4pICsgNTA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVuZCA+IChsb25nKXN0cmxlbihyZXNwb25zZS0+Ym9keSkpIGVuZCA9IHN0cmxlbihyZXNwb25zZS0+Ym9keSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZm9yIChsb25nIGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09IHBhdHRlcm5fZm91bmQgLSByZXNwb25zZS0+Ym9keSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSRUVOKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PSBwYXR0ZXJuX2ZvdW5kIC0gcmVzcG9uc2UtPmJvZHkgKyBzdHJsZW4oZXhwZWN0ZWRfcGF0dGVybikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcHV0Y2hhcihyZXNwb25zZS0+Ym9keVtpXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHByaW50ZihSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKFdISVRFICJcbiAgICAtLS0gRU5EIENPTlRFWFQgLS0tXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihHUkVFTiAiICBbVkVSQk9TRV0gTm8gcGF0dGVybiBzcGVjaWZpZWQgZm9yIHZlcmlmaWNhdGlvblxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBIVFRQIHJlc3BvbnNlIHZlcmlmaWNhdGlvbiBwYXNzZWRcbiIgUkVTRVQpOwogICAgfQogICAgCiAgICByZXR1cm4gMTsKfQoKY2hhciogZXh0cmFjdF9qc29uX2ZpZWxkKGNvbnN0IGNoYXIqIGpzb24sIGNvbnN0IGNoYXIqIGZpZWxkKSB7CiAgICBpZiAoIWpzb24gfHwgIWZpZWxkKSByZXR1cm4gTlVMTDsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIEVYVFJBQ1RJTkcgSlNPTiBGSUVMRFxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBGaWVsZCB0byBleHRyYWN0OiBcIiVzXCJcbiIgUkVTRVQsIGZpZWxkKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIEpTT04gbGVuZ3RoOiAlenUgY2hhcmFjdGVyc1xuIiBSRVNFVCwgc3RybGVuKGpzb24pKTsKICAgIH0KICAgIAogICAgY2hhciBzZWFyY2hfcGF0dGVyblsyNTZdOwogICAgc25wcmludGYoc2VhcmNoX3BhdHRlcm4sIHNpemVvZihzZWFyY2hfcGF0dGVybiksICJcIiVzXCI6XCIiLCBmaWVsZCk7CiAgICAKICAgIGNoYXIqIGZpZWxkX3N0YXJ0ID0gc3Ryc3RyKGpzb24sIHNlYXJjaF9wYXR0ZXJuKTsKICAgIGlmICghZmllbGRfc3RhcnQpIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgUGF0dGVybiAnXCIlc1wiOlwiJyBub3QgZm91bmQsIHRyeWluZyB3aXRob3V0IHF1b3Rlc1xuIiBSRVNFVCwgZmllbGQpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBzbnByaW50ZihzZWFyY2hfcGF0dGVybiwgc2l6ZW9mKHNlYXJjaF9wYXR0ZXJuKSwgIlwiJXNcIjoiLCBmaWVsZCk7CiAgICAgICAgZmllbGRfc3RhcnQgPSBzdHJzdHIoanNvbiwgc2VhcmNoX3BhdHRlcm4pOwogICAgICAgIGlmICghZmllbGRfc3RhcnQpIHsKICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gRklFTEQgTk9UIEZPVU5EIElOIEpTT05cbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBQYXR0ZXJuOiBcIiVzXCJcbiIgUkVTRVQsIHNlYXJjaF9wYXR0ZXJuKTsKICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgSlNPTiBwcmV2aWV3IChmaXJzdCAyMDAgY2hhcnMpOlxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICBpbnQgbGVuID0gc3RybGVuKGpzb24pID4gMjAwID8gMjAwIDogc3RybGVuKGpzb24pOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykgcHV0Y2hhcihqc29uW2ldKTsKICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oanNvbikgPiAyMDApIHByaW50ZigiXG4uLi4iKTsKICAgICAgICAgICAgICAgIHByaW50ZigiXG4iIFJFU0VUKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gTlVMTDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZmllbGRfc3RhcnQgKz0gc3RybGVuKHNlYXJjaF9wYXR0ZXJuKTsKICAgICAgICBjaGFyKiBmaWVsZF9lbmQgPSBzdHJjaHIoZmllbGRfc3RhcnQsICcsJyk7CiAgICAgICAgaWYgKCFmaWVsZF9lbmQpIGZpZWxkX2VuZCA9IHN0cmNocihmaWVsZF9zdGFydCwgJ30nKTsKICAgICAgICBpZiAoIWZpZWxkX2VuZCkgewogICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBDQU5OT1QgRklORCBGSUVMRCBFTkQgREVMSU1JVEVSXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgRmllbGQgc3RhcnQ6IFwiJS41MHNcIlxuIiBSRVNFVCwgZmllbGRfc3RhcnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBOVUxMOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBzaXplX3QgZmllbGRfbGVuZ3RoID0gZmllbGRfZW5kIC0gZmllbGRfc3RhcnQ7CiAgICAgICAgY2hhciogdmFsdWUgPSBtYWxsb2MoZmllbGRfbGVuZ3RoICsgMSk7CiAgICAgICAgaWYgKCF2YWx1ZSkgewogICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBNRU1PUlkgQUxMT0NBVElPTiBGQUlMRURcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBSZXF1ZXN0ZWQgc2l6ZTogJXp1IGJ5dGVzXG4iIFJFU0VULCBmaWVsZF9sZW5ndGggKyAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gTlVMTDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc3RybmNweSh2YWx1ZSwgZmllbGRfc3RhcnQsIGZpZWxkX2xlbmd0aCk7CiAgICAgICAgdmFsdWVbZmllbGRfbGVuZ3RoXSA9ICdcMCc7CiAgICAgICAgCiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdIEZJRUxEIEVYVFJBQ1RFRCAoVU5RVU9URUQpXG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBGaWVsZCB2YWx1ZTogXCIlc1wiXG4iIFJFU0VULCB2YWx1ZSk7CiAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgVmFsdWUgbGVuZ3RoOiAlenUgY2hhcmFjdGVyc1xuIiBSRVNFVCwgZmllbGRfbGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgCiAgICBmaWVsZF9zdGFydCArPSBzdHJsZW4oc2VhcmNoX3BhdHRlcm4pOwogICAgY2hhciogZmllbGRfZW5kID0gc3RyY2hyKGZpZWxkX3N0YXJ0LCAnIicpOwogICAgaWYgKCFmaWVsZF9lbmQpIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIENBTk5PVCBGSU5EIENMT1NJTkcgUVVPVEVcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIEZpZWxkIHN0YXJ0OiBcIiUuNTBzXCJcbiIgUkVTRVQsIGZpZWxkX3N0YXJ0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIE5VTEw7CiAgICB9CiAgICAKICAgIHNpemVfdCBmaWVsZF9sZW5ndGggPSBmaWVsZF9lbmQgLSBmaWVsZF9zdGFydDsKICAgIGNoYXIqIHZhbHVlID0gbWFsbG9jKGZpZWxkX2xlbmd0aCArIDEpOwogICAgaWYgKCF2YWx1ZSkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gTUVNT1JZIEFMTE9DQVRJT04gRkFJTEVEXG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBSZXF1ZXN0ZWQgc2l6ZTogJXp1IGJ5dGVzXG4iIFJFU0VULCBmaWVsZF9sZW5ndGggKyAxKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIE5VTEw7CiAgICB9CiAgICAKICAgIHN0cm5jcHkodmFsdWUsIGZpZWxkX3N0YXJ0LCBmaWVsZF9sZW5ndGgpOwogICAgdmFsdWVbZmllbGRfbGVuZ3RoXSA9ICdcMCc7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdIEZJRUxEIEVYVFJBQ1RFRCAoUVVPVEVEKVxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBGaWVsZCB2YWx1ZTogXCIlc1wiXG4iIFJFU0VULCB2YWx1ZSk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBWYWx1ZSBsZW5ndGg6ICV6dSBjaGFyYWN0ZXJzXG4iIFJFU0VULCBmaWVsZF9sZW5ndGgpOwogICAgICAgIHByaW50ZihHUkFZICIgICAgU2VhcmNoIHBhdHRlcm4gdXNlZDogXCIlc1wiXG4iIFJFU0VULCBzZWFyY2hfcGF0dGVybik7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBGb3VuZCBhdCBwb3NpdGlvbjogJWxkXG4iIFJFU0VULCBmaWVsZF9zdGFydCAtIGpzb24gLSBzdHJsZW4oc2VhcmNoX3BhdHRlcm4pKTsKICAgIH0KICAgIAogICAgcmV0dXJuIHZhbHVlOwp9CgppbnQgaHR0cF90ZXN0X2VuZHBvaW50KGNvbnN0IGNoYXIqIGRlc2NyaXB0aW9uLCBjb25zdCBjaGFyKiBtZXRob2QsIGNvbnN0IGNoYXIqIGVuZHBvaW50LCAKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIqIGJvZHksIGNvbnN0IGNoYXIqIGV4cGVjdGVkX3BhdHRlcm4sIGludCBjaGVja19zdWNjZXNzX29ubHksIGxvbmcgbG9uZyogZHVyYXRpb24pIHsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgZGVzY3JpcHRpb24pOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICJcbiAgW1ZFUkJPU0VdID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIEhUVFAgRU5EUE9JTlQgVEVTVCBTVEFSVFxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBEZXNjcmlwdGlvbjogJXNcbiIgUkVTRVQsIGRlc2NyaXB0aW9uKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIE1ldGhvZDogJXNcbiIgUkVTRVQsIG1ldGhvZCk7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBFbmRwb2ludDogJXNcbiIgUkVTRVQsIGVuZHBvaW50KTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIEJvZHk6ICVzXG4iIFJFU0VULCBib2R5ID8gYm9keSA6ICIobm9uZSkiKTsKICAgICAgICBwcmludGYoR1JBWSAiICAgIEV4cGVjdGVkIHBhdHRlcm46IFwiJXNcIlxuIiBSRVNFVCwgZXhwZWN0ZWRfcGF0dGVybiA/IGV4cGVjdGVkX3BhdHRlcm4gOiAiKG5vbmUpIik7CiAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBDaGVjayBzdWNjZXNzIG9ubHk6ICVzXG4iIFJFU0VULCBjaGVja19zdWNjZXNzX29ubHkgPyAiWUVTIiA6ICJOTyIpOwogICAgfQogICAgCiAgICBsb25nIGxvbmcgc3RhcnRfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgSHR0cFJlc3BvbnNlKiByZXNwb25zZSA9IGh0dHBfcmVxdWVzdChtZXRob2QsIGVuZHBvaW50LCBib2R5LCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgbG9uZyBsb25nIGVuZF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgCiAgICBpZiAoZHVyYXRpb24pIHsKICAgICAgICAqZHVyYXRpb24gPSBlbmRfdGltZSAtIHN0YXJ0X3RpbWU7CiAgICB9CiAgICAKICAgIGludCBzdWNjZXNzID0gMDsKICAgIGlmIChyZXNwb25zZSkgewogICAgICAgIHN1Y2Nlc3MgPSB2ZXJpZnlfaHR0cF9yZXNwb25zZShyZXNwb25zZSwgZXhwZWN0ZWRfcGF0dGVybiwgY2hlY2tfc3VjY2Vzc19vbmx5KTsKICAgICAgICAKICAgICAgICBpZiAoIXN1Y2Nlc3MpIHsKICAgICAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdICVzJTRsbGQgbXMlc1xuIiwgQ1lBTiwgZW5kX3RpbWUgLSBzdGFydF90aW1lLCBSRVNFVCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoUkVEICJcbiAgW1ZFUkJPU0VdID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gSFRUUCBURVNUIEZBSUxVUkUgQU5BTFlTSVNcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBUZXN0OiAlc1xuIiBSRVNFVCwgZGVzY3JpcHRpb24pOwogICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gRW5kcG9pbnQ6ICVzICVzXG4iIFJFU0VULCBtZXRob2QsIGVuZHBvaW50KTsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFN0YXR1cyBDb2RlOiAlZFxuIiBSRVNFVCwgcmVzcG9uc2UtPnN0YXR1c19jb2RlKTsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEV4cGVjdGVkIFBhdHRlcm46ICclcydcbiIgUkVTRVQsIGV4cGVjdGVkX3BhdHRlcm4gPyBleHBlY3RlZF9wYXR0ZXJuIDogIk5PTkUiKTsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIENoZWNrIFN1Y2Nlc3MgT25seTogJXNcbiIgUkVTRVQsIGNoZWNrX3N1Y2Nlc3Nfb25seSA/ICJZRVMiIDogIk5PIik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS0+Ym9keSkgewogICAgICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFJlc3BvbnNlIEJvZHkgKCV6dSBieXRlcyk6XG4iIFJFU0VULCByZXNwb25zZS0+Ym9keV9sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIHByaW50ZihXSElURSAiICAtLS0gQkVHSU4gUkVTUE9OU0UgQk9EWSAtLS1cbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIHByaW50ZigiJXNcbiIsIHJlc3BvbnNlLT5ib2R5KTsKICAgICAgICAgICAgICAgICAgICBwcmludGYoV0hJVEUgIiAgLS0tIEVORCBSRVNQT05TRSBCT0RZIC0tLVxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cnN0cihyZXNwb25zZS0+Ym9keSwgInsiKSAmJiBzdHJzdHIocmVzcG9uc2UtPmJvZHksICJ9IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gSlNPTiBTVFJVQ1RVUkUgQU5BTFlTSVM6XG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIqIGpzb25fZmllbGRzW10gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZXJyb3IiLCAibWVzc2FnZSIsICJkZXRhaWxzIiwgImNvZGUiLCAic3RhdHVzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3VjY2VzcyIsICJkYXRhIiwgInJlc3VsdCIsIE5VTEwKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBqc29uX2ZpZWxkc1tpXTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyKiB2YWx1ZSA9IGV4dHJhY3RfanNvbl9maWVsZChyZXNwb25zZS0+Ym9keSwganNvbl9maWVsZHNbaV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICBGaWVsZCAnJXMnOiAlc1xuIiBSRVNFVCwganNvbl9maWVsZHNbaV0sIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmVlKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gUmVzcG9uc2UgQm9keTogTlVMTFxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFJlc3BvbnNlIFRpbWU6ICVsbGQgbXNcbiIgUkVTRVQsIGVuZF90aW1lIC0gc3RhcnRfdGltZSk7CiAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gUE9TU0lCTEUgSVNTVUVTIEFORCBTT0xVVElPTlM6XG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLT5zdGF0dXNfY29kZSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICAtIFNlcnZlciBtaWdodCBub3QgYmUgcnVubmluZ1xuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICAtIE5ldHdvcmsgY29ubmVjdGl2aXR5IGlzc3VlXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIC0gRmlyZXdhbGwgYmxvY2tpbmcgY29ubmVjdGlvblxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLT5zdGF0dXNfY29kZSA9PSA0MDQpIHsKICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIC0gRW5kcG9pbnQgVVJMIG1pZ2h0IGJlIGluY29ycmVjdFxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICAtIFNlcnZlciByb3V0aW5nIG1pc2NvbmZpZ3VyZWRcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS0+c3RhdHVzX2NvZGUgPT0gNDA1KSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICAtIEhUVFAgbWV0aG9kIG5vdCBhbGxvd2VkIGZvciB0aGlzIGVuZHBvaW50XG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UtPnN0YXR1c19jb2RlID49IDUwMCkgewogICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgLSBTZXJ2ZXIgaW50ZXJuYWwgZXJyb3JcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgLSBDaGVjayBzZXJ2ZXIgbG9nc1xuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLT5zdGF0dXNfY29kZSA+PSA0MDApIHsKICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIC0gQ2xpZW50IGVycm9yIC0gY2hlY2sgcmVxdWVzdCBwYXJhbWV0ZXJzXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIC0gVmFsaWRhdGUgSlNPTiBmb3JtYXRcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgLSBDaGVjayByZXF1aXJlZCBmaWVsZHNcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoZXhwZWN0ZWRfcGF0dGVybiAmJiByZXNwb25zZS0+Ym9keSkgewogICAgICAgICAgICAgICAgICAgIGlmICghc3Ryc3RyKHJlc3BvbnNlLT5ib2R5LCBleHBlY3RlZF9wYXR0ZXJuKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIC0gUGF0dGVybiAnJXMnIG5vdCBmb3VuZCBpbiByZXNwb25zZVxuIiBSRVNFVCwgZXhwZWN0ZWRfcGF0dGVybik7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgLSBDaGVjayBmb3IgY2FzZSBzZW5zaXRpdml0eVxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkFZICIgICAgLSBWZXJpZnkgdGhlIGV4YWN0IGV4cGVjdGVkIG91dHB1dFxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLT5ib2R5KSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBTdGF0dXM6ICVkLCBSZXNwb25zZTogJXNcbiIgUkVTRVQsIHJlc3BvbnNlLT5zdGF0dXNfY29kZSwgcmVzcG9uc2UtPmJvZHkpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFN0YXR1czogJWQsIE5vIHJlc3BvbnNlIGJvZHlcbiIgUkVTRVQsIHJlc3BvbnNlLT5zdGF0dXNfY29kZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIGVuZF90aW1lIC0gc3RhcnRfdGltZSwgUkVTRVQpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgcHJpbnRmKEdSRUVOICJcbiAgW1ZFUkJPU0VdIEhUVFAgVEVTVCBTVUNDRVNTIERFVEFJTFNcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSAgIEVuZHBvaW50OiAlcyAlc1xuIiBSRVNFVCwgbWV0aG9kLCBlbmRwb2ludCk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdICAgU3RhdHVzIENvZGU6ICVkXG4iIFJFU0VULCByZXNwb25zZS0+c3RhdHVzX2NvZGUpOwogICAgICAgICAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSAgIFJlc3BvbnNlIFRpbWU6ICVsbGQgbXNcbiIgUkVTRVQsIGVuZF90aW1lIC0gc3RhcnRfdGltZSk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdICAgQm9keSBMZW5ndGg6ICV6dSBieXRlc1xuIiBSRVNFVCwgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLT5ib2R5ICYmIHJlc3BvbnNlLT5ib2R5X2xlbmd0aCA8IDUwMCkgewogICAgICAgICAgICAgICAgICAgIHByaW50ZihHUkVFTiAiICBbVkVSQk9TRV0gICBSZXNwb25zZSBCb2R5OlxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKCIlc1xuIiwgcmVzcG9uc2UtPmJvZHkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwb25zZSk7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIGVuZF90aW1lIC0gc3RhcnRfdGltZSwgUkVTRVQpOwogICAgICAgIHByaW50ZihSRUQgIiAgTm8gcmVzcG9uc2UgZnJvbSBzZXJ2ZXJcbiIgUkVTRVQpOwogICAgICAgIAogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiXG4gIFtWRVJCT1NFXSBIVFRQIFRFU1QgRkFJTFVSRSAtIE5PIFJFU1BPTlNFXG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gICBFbmRwb2ludDogJXMgJXNcbiIgUkVTRVQsIG1ldGhvZCwgZW5kcG9pbnQpOwogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSAgIFNlcnZlciBtYXkgYmUgZG93biBvciB1bnJlYWNoYWJsZVxuIiBSRVNFVCk7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdICAgUmVxdWVzdCB0aW1lOiAlbGxkIG1zXG4iIFJFU0VULCBlbmRfdGltZSAtIHN0YXJ0X3RpbWUpOwogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSAgIFBvc3NpYmxlIGNhdXNlczpcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIC0gU2VydmVyIG5vdCBzdGFydGVkXG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICAtIFdyb25nIHBvcnQgbnVtYmVyXG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKEdSQVkgIiAgICAtIEZpcmV3YWxsIGJsb2NraW5nIGNvbm5lY3Rpb25cbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIC0gTmV0d29yayBpc3N1ZXNcbiIgUkVTRVQpOwogICAgICAgICAgICBwcmludGYoR1JBWSAiICAgIC0gU2VydmVyIGNyYXNoZWRcbiIgUkVTRVQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIEhUVFAgRU5EUE9JTlQgVEVTVCBDT01QTEVURVxuIiBSRVNFVCk7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gUmVzdWx0OiAlc1xuIiBSRVNFVCwgc3VjY2VzcyA/ICJQQVNTIiA6ICJGQUlMIik7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gRHVyYXRpb246ICVsbGQgbXNcbiIgUkVTRVQsIGVuZF90aW1lIC0gc3RhcnRfdGltZSk7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIiBSRVNFVCk7CiAgICB9CiAgICAKICAgIHJldHVybiBzdWNjZXNzOwp9Cgp2b2lkIGNsZWFudXBfdGVzdF9kYXRhYmFzZXMoKSB7CiAgICBwcmludGYoIkNsZWFuaW5nIHVwIHByZXZpb3VzIHRlc3QgZGF0YWJhc2VzLi4uXG4iKTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIENsZWFuaW5nIHVwIHRlc3QgZGlyZWN0b3JpZXMgaW4gL3RtcC9zeWRiX3Rlc3QvXG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgY2hhciBjb21tYW5kWzUxMl07CiAgICBzbnByaW50Zihjb21tYW5kLCBzaXplb2YoY29tbWFuZCksICJybSAtcmYgL3RtcC9zeWRiX3Rlc3QvdGVzdGRiXyogL3RtcC9zeWRiX3Rlc3QvdGVzdGRiMl8qIC90bXAvc3lkYl90ZXN0L3Rlc3Rjb2xsZGJfKiAvdG1wL3N5ZGJfdGVzdC90ZXN0aW5zdGRiXyogMj4vZGV2L251bGwiKTsKICAgIHN5c3RlbShjb21tYW5kKTsKICAgIAogICAgc25wcmludGYoY29tbWFuZCwgc2l6ZW9mKGNvbW1hbmQpLCAicm0gLWYgL3RtcC9zeWRiX3Rlc3QvKi5sb2NrIC90bXAvc3lkYl90ZXN0Ly4qLmxvY2sgMj4vZGV2L251bGwiKTsKICAgIHN5c3RlbShjb21tYW5kKTsKICAgIAogICAgdXNsZWVwKDUwMDAwKTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIENsZWFudXAgY29tcGxldGVkXG4iIFJFU0VUKTsKICAgIH0KfQoKaW50IHJ1bl9odHRwX2RhdGFiYXNlX3Rlc3RzKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSAiSFRUUCBBUEkgREFUQUJBU0UgVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNoYXIgdW5pcXVlX2RiMVs2NF0sIHVuaXF1ZV9kYjJbNjRdOwogICAgc3RydWN0IHRpbWVzcGVjIHRzOwogICAgY2xvY2tfZ2V0dGltZShDTE9DS19NT05PVE9OSUMsICZ0cyk7CiAgICBzbnByaW50Zih1bmlxdWVfZGIxLCBzaXplb2YodW5pcXVlX2RiMSksICJ0ZXN0ZGJfJWxkXyVsZCIsIHRzLnR2X3NlYywgdHMudHZfbnNlYyk7CiAgICBzbnByaW50Zih1bmlxdWVfZGIyLCBzaXplb2YodW5pcXVlX2RiMiksICJ0ZXN0ZGIyXyVsZF8lbGQiLCB0cy50dl9zZWMsIHRzLnR2X25zZWMgKyAxKTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFVzaW5nIHVuaXF1ZSBkYXRhYmFzZSBuYW1lczogJXMsICVzXG4iIFJFU0VULCB1bmlxdWVfZGIxLCB1bmlxdWVfZGIyKTsKICAgIH0KICAgIAogICAgY2hhciBjcmVhdGVfZGIxX2JvZHlbMTI4XSwgY3JlYXRlX2RiMl9ib2R5WzEyOF07CiAgICBzbnByaW50ZihjcmVhdGVfZGIxX2JvZHksIHNpemVvZihjcmVhdGVfZGIxX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCB1bmlxdWVfZGIxKTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYjJfYm9keSwgc2l6ZW9mKGNyZWF0ZV9kYjJfYm9keSksICJ7XCJuYW1lXCI6XCIlc1wifSIsIHVuaXF1ZV9kYjIpOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMgLSBMaXN0IGRhdGFiYXNlcyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCAiL2FwaS9kYXRhYmFzZXMiLCBOVUxMLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDEsICZkdXJhdGlvbikpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzIC0gQ3JlYXRlIGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfZGIxX2JvZHksICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMgLSBDcmVhdGUgc2Vjb25kIGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfZGIyX2JvZHksICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMgLSBQcmV2ZW50IGR1cGxpY2F0ZSBkYXRhYmFzZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiMV9ib2R5LCAiXCJzdWNjZXNzXCI6ZmFsc2UiLCAxLCAmZHVyYXRpb24pKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY2hhciBkZWxldGVfdXJsWzI1Nl07CiAgICBzbnByaW50ZihkZWxldGVfdXJsLCBzaXplb2YoZGVsZXRlX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcyIsIHVuaXF1ZV9kYjIpOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiREVMRVRFIC9hcGkvZGF0YWJhc2VzL3tuYW1lfSAtIERlbGV0ZSBkYXRhYmFzZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJERUxFVEUiLCBkZWxldGVfdXJsLCBOVUxMLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbikpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIERhdGFiYXNlIEFQSSB0ZXN0czogJWQvJWQgcGFzc2VkIChhdmc6ICVsbGQgbXMpXG4iIFJFU0VULCAKICAgICAgICAgICBwYXNzZWQsIHRvdGFsLCB0b3RhbF90aW1lIC8gKHRvdGFsID4gMCA/IHRvdGFsIDogMSkpOwogICAgCiAgICByZXR1cm4gcGFzc2VkOwp9CgppbnQgcnVuX2h0dHBfY29sbGVjdGlvbl90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIkhUVFAgQVBJIENPTExFQ1RJT04gVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNoYXIgdW5pcXVlX2RiWzY0XTsKICAgIHN0cnVjdCB0aW1lc3BlYyB0czsKICAgIGNsb2NrX2dldHRpbWUoQ0xPQ0tfTU9OT1RPTklDLCAmdHMpOwogICAgc25wcmludGYodW5pcXVlX2RiLCBzaXplb2YodW5pcXVlX2RiKSwgInRlc3Rjb2xsZGJfJWxkXyVsZCIsIHRzLnR2X3NlYywgdHMudHZfbnNlYyk7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBVc2luZyB1bmlxdWUgZGF0YWJhc2UgbmFtZTogJXNcbiIgUkVTRVQsIHVuaXF1ZV9kYik7CiAgICB9CiAgICAKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMTI4XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCB1bmlxdWVfZGIpOwogICAgCiAgICBIdHRwUmVzcG9uc2UqIGRiX3Jlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgY3JlYXRlX2RiX2JvZHksICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBpZiAoIWRiX3Jlc3BvbnNlIHx8ICF2ZXJpZnlfaHR0cF9yZXNwb25zZShkYl9yZXNwb25zZSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwKSkgewogICAgICAgIHByaW50ZihSRUQgIiAgRmFpbGVkIHRvIGNyZWF0ZSB0ZXN0IGRhdGFiYXNlIGZvciBjb2xsZWN0aW9uIHRlc3RzXG4iIFJFU0VUKTsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIERhdGFiYXNlIGNyZWF0aW9uIGZhaWxlZFxuIiBSRVNFVCk7CiAgICAgICAgICAgIGlmIChkYl9yZXNwb25zZSkgewogICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gUmVzcG9uc2Ugc3RhdHVzOiAlZCwgYm9keTogJXNcbiIgUkVTRVQsIGRiX3Jlc3BvbnNlLT5zdGF0dXNfY29kZSwgZGJfcmVzcG9uc2UtPmJvZHkgPyBkYl9yZXNwb25zZS0+Ym9keSA6ICJOVUxMIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKGRiX3Jlc3BvbnNlKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIGh0dHBfcmVzcG9uc2VfZnJlZShkYl9yZXNwb25zZSk7CiAgICAKICAgIGNoYXIgbGlzdF9jb2xsc191cmxbMjU2XTsKICAgIHNucHJpbnRmKGxpc3RfY29sbHNfdXJsLCBzaXplb2YobGlzdF9jb2xsc191cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCB1bmlxdWVfZGIpOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMgLSBMaXN0IGVtcHR5IGNvbGxlY3Rpb25zIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsIGxpc3RfY29sbHNfdXJsLCBOVUxMLCAiXCJjb2xsZWN0aW9uc1wiOltdIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGNoYXIgY3JlYXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfY29sbF91cmwsIHNpemVvZihjcmVhdGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCB1bmlxdWVfZGIpOwogICAgCiAgICBjb25zdCBjaGFyKiB1c2Vyc19zY2hlbWEgPSAie1wibmFtZVwiOlwidXNlcnNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjp0cnVlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImFnZVwiLFwidHlwZVwiOlwiaW50XCIsXCJyZXF1aXJlZFwiOmZhbHNlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImVtYWlsXCIsXCJ0eXBlXCI6XCJzdHJpbmdcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJpbmRleGVkXCI6ZmFsc2V9IgogICAgICAgICJdfSI7CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucyAtIENyZWF0ZSB1c2VycyBjb2xsZWN0aW9uIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCBjcmVhdGVfY29sbF91cmwsIHVzZXJzX3NjaGVtYSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24pKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY29uc3QgY2hhciogcHJvZHVjdHNfc2NoZW1hID0gIntcIm5hbWVcIjpcInByb2R1Y3RzXCIsXCJzY2hlbWFcIjpbIgogICAgICAgICJ7XCJuYW1lXCI6XCJuYW1lXCIsXCJ0eXBlXCI6XCJzdHJpbmdcIixcInJlcXVpcmVkXCI6dHJ1ZSxcImluZGV4ZWRcIjpmYWxzZX0sIgogICAgICAgICJ7XCJuYW1lXCI6XCJwcmljZVwiLFwidHlwZVwiOlwiZmxvYXRcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJpbmRleGVkXCI6ZmFsc2V9IgogICAgICAgICJdfSI7CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucyAtIENyZWF0ZSBwcm9kdWN0cyBjb2xsZWN0aW9uIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCBjcmVhdGVfY29sbF91cmwsIHByb2R1Y3RzX3NjaGVtYSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24pKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMgLSBMaXN0IGNyZWF0ZWQgY29sbGVjdGlvbnMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgbGlzdF9jb2xsc191cmwsIE5VTEwsICJcInVzZXJzXCIiLCAwLCAmZHVyYXRpb24pKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgY2hhciBzY2hlbWFfdXJsWzI1Nl07CiAgICBzbnByaW50ZihzY2hlbWFfdXJsLCBzaXplb2Yoc2NoZW1hX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9zY2hlbWEiLCB1bmlxdWVfZGIpOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L3NjaGVtYSAtIEdldCB1c2VycyBzY2hlbWEiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgc2NoZW1hX3VybCwgTlVMTCwgIlwibmFtZVwiIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGNoYXIgZGVsZXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihkZWxldGVfY29sbF91cmwsIHNpemVvZihkZWxldGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvcHJvZHVjdHMiLCB1bmlxdWVfZGIpOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiREVMRVRFIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9IC0gRGVsZXRlIHByb2R1Y3RzIGNvbGxlY3Rpb24iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiREVMRVRFIiwgZGVsZXRlX2NvbGxfdXJsLCBOVUxMLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbikpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIENvbGxlY3Rpb24gQVBJIHRlc3RzOiAlZC8lZCBwYXNzZWQgKGF2ZzogJWxsZCBtcylcbiIgUkVTRVQsIAogICAgICAgICAgIHBhc3NlZCwgdG90YWwsIHRvdGFsX3RpbWUgLyAodG90YWwgPiAwID8gdG90YWwgOiAxKSk7CiAgICAKICAgIHJldHVybiBwYXNzZWQ7Cn0KCmludCBydW5faHR0cF9pbnN0YW5jZV90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIkhUVFAgQVBJIElOU1RBTkNFIFRFU1RTIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgbG9uZyBsb25nIHRvdGFsX3RpbWUgPSAwOwogICAgbG9uZyBsb25nIGR1cmF0aW9uOwogICAgCiAgICBjaGFyIHVuaXF1ZV9kYls2NF07CiAgICBzdHJ1Y3QgdGltZXNwZWMgdHM7CiAgICBjbG9ja19nZXR0aW1lKENMT0NLX01PTk9UT05JQywgJnRzKTsKICAgIHNucHJpbnRmKHVuaXF1ZV9kYiwgc2l6ZW9mKHVuaXF1ZV9kYiksICJ0ZXN0aW5zdGRiXyVsZF8lbGQiLCB0cy50dl9zZWMsIHRzLnR2X25zZWMpOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gVXNpbmcgdW5pcXVlIGRhdGFiYXNlIG5hbWU6ICVzXG4iIFJFU0VULCB1bmlxdWVfZGIpOwogICAgfQogICAgCiAgICBjaGFyIGNyZWF0ZV9kYl9ib2R5WzEyOF07CiAgICBzbnByaW50ZihjcmVhdGVfZGJfYm9keSwgc2l6ZW9mKGNyZWF0ZV9kYl9ib2R5KSwgIntcIm5hbWVcIjpcIiVzXCJ9IiwgdW5pcXVlX2RiKTsKICAgIAogICAgSHR0cFJlc3BvbnNlKiBkYl9yZXNwb25zZSA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsIGNyZWF0ZV9kYl9ib2R5LCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaWYgKCFkYl9yZXNwb25zZSB8fCAhdmVyaWZ5X2h0dHBfcmVzcG9uc2UoZGJfcmVzcG9uc2UsICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCkpIHsKICAgICAgICBwcmludGYoUkVEICIgIEZhaWxlZCB0byBjcmVhdGUgdGVzdCBkYXRhYmFzZSBmb3IgaW5zdGFuY2UgdGVzdHNcbiIgUkVTRVQpOwogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gRGF0YWJhc2UgY3JlYXRpb24gZmFpbGVkXG4iIFJFU0VUKTsKICAgICAgICB9CiAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKGRiX3Jlc3BvbnNlKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIGh0dHBfcmVzcG9uc2VfZnJlZShkYl9yZXNwb25zZSk7CiAgICAKICAgIGNoYXIgY3JlYXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfY29sbF91cmwsIHNpemVvZihjcmVhdGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCB1bmlxdWVfZGIpOwogICAgCiAgICBjb25zdCBjaGFyKiB1c2Vyc19zY2hlbWEgPSAie1wibmFtZVwiOlwidXNlcnNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjp0cnVlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImFnZVwiLFwidHlwZVwiOlwiaW50XCIsXCJyZXF1aXJlZFwiOmZhbHNlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImVtYWlsXCIsXCJ0eXBlXCI6XCJzdHJpbmdcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJpbmRleGVkXCI6ZmFsc2V9IgogICAgICAgICJdfSI7CiAgICAKICAgIEh0dHBSZXNwb25zZSogY29sbF9yZXNwb25zZSA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsIGNyZWF0ZV9jb2xsX3VybCwgdXNlcnNfc2NoZW1hLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgaWYgKCFjb2xsX3Jlc3BvbnNlIHx8ICF2ZXJpZnlfaHR0cF9yZXNwb25zZShjb2xsX3Jlc3BvbnNlLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDApKSB7CiAgICAgICAgcHJpbnRmKFJFRCAiICBGYWlsZWQgdG8gY3JlYXRlIHRlc3QgY29sbGVjdGlvbiBmb3IgaW5zdGFuY2UgdGVzdHNcbiIgUkVTRVQpOwogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gQ29sbGVjdGlvbiBjcmVhdGlvbiBmYWlsZWRcbiIgUkVTRVQpOwogICAgICAgIH0KICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUoY29sbF9yZXNwb25zZSk7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUoY29sbF9yZXNwb25zZSk7CiAgICAKICAgIGNoYXIgbGlzdF9pbnN0YW5jZXNfdXJsWzI1Nl07CiAgICBzbnByaW50ZihsaXN0X2luc3RhbmNlc191cmwsIHNpemVvZihsaXN0X2luc3RhbmNlc191cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzIiwgdW5pcXVlX2RiKTsKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkdFVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zL3tjb2xsfS9pbnN0YW5jZXMgLSBMaXN0IGVtcHR5IGluc3RhbmNlcyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBsaXN0X2luc3RhbmNlc191cmwsIE5VTEwsICJcImluc3RhbmNlc1wiOltdIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGNvbnN0IGNoYXIqIHVzZXIxID0gIntcIm5hbWVcIjpcIkpvaG4gRG9lXCIsXCJhZ2VcIjozMCxcImVtYWlsXCI6XCJqb2huQHRlc3QuY29tXCJ9IjsKICAgIGNoYXIgaW5zZXJ0X3VybFsyNTZdOwogICAgc25wcmludGYoaW5zZXJ0X3VybCwgc2l6ZW9mKGluc2VydF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzIiwgdW5pcXVlX2RiKTsKICAgIAogICAgSHR0cFJlc3BvbnNlKiBpbnNlcnRfcmVzcG9uc2UgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCBpbnNlcnRfdXJsLCB1c2VyMSwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIGlmIChpbnNlcnRfcmVzcG9uc2UgJiYgdmVyaWZ5X2h0dHBfcmVzcG9uc2UoaW5zZXJ0X3Jlc3BvbnNlLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDApKSB7CiAgICAgICAgY2hhciogaWQxID0gZXh0cmFjdF9qc29uX2ZpZWxkKGluc2VydF9yZXNwb25zZS0+Ym9keSwgImlkIik7CiAgICAgICAgaWYgKGlkMSkgewogICAgICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJQT1NUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L2luc3RhbmNlcyAtIEluc2VydCBmaXJzdCB1c2VyIik7CiAgICAgICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlc1xuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdIEluc2VydGVkIHVzZXIgd2l0aCBJRDogJXNcbiIgUkVTRVQsIGlkMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGNoYXIqIHVzZXIyID0gIntcIm5hbWVcIjpcIkphbmUgU21pdGhcIixcImFnZVwiOjI1LFwiZW1haWxcIjpcImphbmVAdGVzdC5jb21cIn0iOwogICAgICAgICAgICBIdHRwUmVzcG9uc2UqIGluc2VydF9yZXNwb25zZTIgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCBpbnNlcnRfdXJsLCB1c2VyMiwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgICAgICAgICAgaWYgKGluc2VydF9yZXNwb25zZTIgJiYgdmVyaWZ5X2h0dHBfcmVzcG9uc2UoaW5zZXJ0X3Jlc3BvbnNlMiwgIlwic3VjY2Vzc1wiOnRydWUiLCAwKSkgewogICAgICAgICAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiUE9TVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zL3tjb2xsfS9pbnN0YW5jZXMgLSBJbnNlcnQgc2Vjb25kIHVzZXIiKTsKICAgICAgICAgICAgICAgIHByaW50ZigiWyIgR1JFRU4gIlBBU1MiIFJFU0VUICJdICVzJTRsbGQgbXMlc1xuIiwgQ1lBTiwgZHVyYXRpb24sIFJFU0VUKTsKICAgICAgICAgICAgICAgIHBhc3NlZCsrOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucy97Y29sbH0vaW5zdGFuY2VzIC0gTGlzdCB1c2VycyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBsaXN0X2luc3RhbmNlc191cmwsIE5VTEwsICJKb2huIERvZSIsIDAsICZkdXJhdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRvdGFsKys7CiAgICAgICAgICAgICAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjaGFyIHF1ZXJ5X3VybFs1MTJdOwogICAgICAgICAgICAgICAgc25wcmludGYocXVlcnlfdXJsLCBzaXplb2YocXVlcnlfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcz9xdWVyeT1hZ2U6MzAiLCB1bmlxdWVfZGIpOwogICAgICAgICAgICAgICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvLi4uL2luc3RhbmNlcz9xdWVyeT1hZ2U6MzAgLSBRdWVyeSBieSBhZ2UiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgcXVlcnlfdXJsLCBOVUxMLCAiSm9obiBEb2UiLCAwLCAmZHVyYXRpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0b3RhbCsrOwogICAgICAgICAgICAgICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2hhciB1cGRhdGVfdXJsWzI1Nl07CiAgICAgICAgICAgICAgICBzbnByaW50Zih1cGRhdGVfdXJsLCBzaXplb2YodXBkYXRlX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9pbnN0YW5jZXMvJXMiLCB1bmlxdWVfZGIsIGlkMSk7CiAgICAgICAgICAgICAgICBjb25zdCBjaGFyKiB1cGRhdGVfZGF0YSA9ICJ7XCJhZ2VcIjozNSxcImVtYWlsXCI6XCJqb2huLnVwZGF0ZWRAdGVzdC5jb21cIn0iOwogICAgICAgICAgICAgICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiUFVUIC9hcGkvLi4uL2luc3RhbmNlcy97aWR9IC0gVXBkYXRlIHVzZXIiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUFVUIiwgdXBkYXRlX3VybCwgdXBkYXRlX2RhdGEsICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgICAgICAgICAgICAgIHBhc3NlZCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdG90YWwrKzsKICAgICAgICAgICAgICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNoYXIgZGVsZXRlX3VybFsyNTZdOwogICAgICAgICAgICAgICAgc25wcmludGYoZGVsZXRlX3VybCwgc2l6ZW9mKGRlbGV0ZV91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzLyVzIiwgdW5pcXVlX2RiLCBpZDEpOwogICAgICAgICAgICAgICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiREVMRVRFIC9hcGkvLi4uL2luc3RhbmNlcy97aWR9IC0gRGVsZXRlIHVzZXIiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiREVMRVRFIiwgZGVsZXRlX3VybCwgTlVMTCwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0b3RhbCsrOwogICAgICAgICAgICAgICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKGluc2VydF9yZXNwb25zZTIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiUE9TVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zL3tjb2xsfS9pbnN0YW5jZXMgLSBJbnNlcnQgc2Vjb25kIHVzZXIiKTsKICAgICAgICAgICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXVxuIik7CiAgICAgICAgICAgICAgICB0b3RhbCsrOwogICAgICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFNlY29uZCB1c2VyIGluc2VydGlvbiBmYWlsZWRcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBmcmVlKGlkMSk7CiAgICAgICAgfQogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShpbnNlcnRfcmVzcG9uc2UpOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJQT1NUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L2luc3RhbmNlcyAtIEluc2VydCBmaXJzdCB1c2VyIik7CiAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdXG4iKTsKICAgICAgICB0b3RhbCsrOwogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gRmlyc3QgdXNlciBpbnNlcnRpb24gZmFpbGVkXG4iIFJFU0VUKTsKICAgICAgICB9CiAgICB9CiAgICB0b3RhbCsrOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIEluc3RhbmNlIEFQSSB0ZXN0czogJWQvJWQgcGFzc2VkIChhdmc6ICVsbGQgbXMpXG4iIFJFU0VULCAKICAgICAgICAgICBwYXNzZWQsIHRvdGFsLCB0b3RhbF90aW1lIC8gKHRvdGFsID4gMCA/IHRvdGFsIDogMSkpOwogICAgCiAgICByZXR1cm4gcGFzc2VkOwp9CgppbnQgcnVuX2h0dHBfY29tbWFuZF90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIkhUVFAgQVBJIENPTU1BTkQgVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpbnQgcGFzc2VkID0gMDsKICAgIGludCB0b3RhbCA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IDA7CiAgICBsb25nIGxvbmcgZHVyYXRpb247CiAgICAKICAgIGNvbnN0IGNoYXIqIGNvbW1hbmQgPSAie1wiY29tbWFuZFwiOlwibGlzdFwiLFwiYXJndW1lbnRzXCI6W119IjsKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9leGVjdXRlIC0gRXhlY3V0ZSBsaXN0IGNvbW1hbmQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsICIvYXBpL2V4ZWN1dGUiLCBjb21tYW5kLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbikpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIENvbW1hbmQgQVBJIHRlc3RzOiAlZC8lZCBwYXNzZWQgKGF2ZzogJWxsZCBtcylcbiIgUkVTRVQsIAogICAgICAgICAgIHBhc3NlZCwgdG90YWwsIHRvdGFsX3RpbWUgLyB0b3RhbCk7CiAgICAKICAgIHJldHVybiBwYXNzZWQ7Cn0KCmludCBydW5faHR0cF9lcnJvcl90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIkhUVFAgQVBJIEVSUk9SIEhBTkRMSU5HIFRFU1RTIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgbG9uZyBsb25nIHRvdGFsX3RpbWUgPSAwOwogICAgbG9uZyBsb25nIGR1cmF0aW9uOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzIC0gSW52YWxpZCBkYXRhYmFzZSBuYW1lIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCAie1wibmFtZVwiOlwiaW52YWxpZC9uYW1lXCJ9IiwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkdFVCAvYXBpL2RhdGFiYXNlcy9ub25leGlzdGVudC9jb2xsZWN0aW9ucyAtIE5vbi1leGlzdGVudCBkYXRhYmFzZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCAiL2FwaS9kYXRhYmFzZXMvbm9uZXhpc3RlbnQvY29sbGVjdGlvbnMiLCBOVUxMLCAiXCJzdWNjZXNzXCI6ZmFsc2UiLCAxLCAmZHVyYXRpb24pKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvZGF0YWJhc2VzL3Rlc3RkYi9jb2xsZWN0aW9ucy9ub25leGlzdGVudC9pbnN0YW5jZXMgLSBOb24tZXhpc3RlbnQgY29sbGVjdGlvbiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCAiL2FwaS9kYXRhYmFzZXMvdGVzdGRiL2NvbGxlY3Rpb25zL25vbmV4aXN0ZW50L2luc3RhbmNlcyIsIE5VTEwsICJcInN1Y2Nlc3NcIjpmYWxzZSIsIDEsICZkdXJhdGlvbikpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzIC0gSW52YWxpZCBKU09OIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCAiaW52YWxpZCBqc29uIiwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIEh0dHBSZXNwb25zZSogcmVzcG9uc2UgPSBodHRwX3JlcXVlc3QoIlBBVENIIiwgIi9hcGkvZGF0YWJhc2VzL3Rlc3RkYiIsIE5VTEwsIE5VTEwpOwogICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLT5zdGF0dXNfY29kZSA9PSA0MDUpIHsKICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJQQVRDSCAvYXBpL2RhdGFiYXNlcy90ZXN0ZGIgLSBNZXRob2Qgbm90IGFsbG93ZWQiKTsKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXVxuIik7CiAgICAgICAgcGFzc2VkKys7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdIE1ldGhvZCBub3QgYWxsb3dlZCBoYW5kbGVkIGNvcnJlY3RseVxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJQQVRDSCAvYXBpL2RhdGFiYXNlcy90ZXN0ZGIgLSBNZXRob2Qgbm90IGFsbG93ZWQiKTsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl1cbiIpOwogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gRXhwZWN0ZWQgNDA1IE1ldGhvZCBOb3QgQWxsb3dlZCwgZ290OiAlZFxuIiBSRVNFVCwgcmVzcG9uc2UgPyByZXNwb25zZS0+c3RhdHVzX2NvZGUgOiAwKTsKICAgICAgICB9CiAgICB9CiAgICB0b3RhbCsrOwogICAgaHR0cF9yZXNwb25zZV9mcmVlKHJlc3BvbnNlKTsKICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBFcnJvciBoYW5kbGluZyB0ZXN0czogJWQvJWQgcGFzc2VkIChhdmc6ICVsbGQgbXMpXG4iIFJFU0VULCAKICAgICAgICAgICBwYXNzZWQsIHRvdGFsLCB0b3RhbF90aW1lIC8gKHRvdGFsID4gMCA/IHRvdGFsIDogMSkpOwogICAgCiAgICByZXR1cm4gcGFzc2VkOwp9Cgp2b2lkIHJ1bl9zZWN1cml0eV90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIlNFQ1VSSVRZIFRFU1RTIC0gUGF0aCB2YWxpZGF0aW9uIGFuZCBpbmplY3Rpb24gcHJldmVudGlvbiIgUkVTRVQgIlxuIik7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBTdGFydGluZyBzZWN1cml0eSB0ZXN0cyB3aXRoIHZlcmJvc2UgbG9nZ2luZ1xuIiBSRVNFVCk7CiAgICB9CiAgICAKICAgIFRlc3RDYXNlIHNlY3VyaXR5X3Rlc3RzW10gPSB7CiAgICAgICAgewogICAgICAgICAgICAiUHJldmVudCBkaXJlY3RvcnkgdHJhdmVyc2FsIGluIGRhdGFiYXNlIG5hbWVzIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSAnLi4vZXZpbCcgMj4mMSB8IGdyZXAgLWkgJ2ludmFsaWRcXHxlcnJvcicgPiAvZGV2L251bGwiLAogICAgICAgICAgICAidGVzdCAhIC1kICcvdG1wL3N5ZGJfdGVzdC8uLi9ldmlsJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlByZXZlbnQgZGlyZWN0b3J5IHRyYXZlcnNhbCBpbiBjb2xsZWN0aW9uIG5hbWVzIiwgCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiICcuLi8uLi9ldmlsJyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nIDI+JjEgfCBncmVwIC1pICdpbnZhbGlkXFx8ZXJyb3InID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgInRlc3QgISAtZCAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiLy4uLy4uL2V2aWwnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiUmVqZWN0IGludmFsaWQgZGF0YWJhc2UgbmFtZXMgd2l0aCBzcGVjaWFsIGNoYXJzIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSAnaW52YWxpZC9uYW1lJyAyPiYxIHwgZ3JlcCAtaSAnaW52YWxpZFxcfGVycm9yJyA+IC9kZXYvbnVsbCIsCiAgICAgICAgICAgICJ0ZXN0ICEgLWQgJy90bXAvc3lkYl90ZXN0L2ludmFsaWQvbmFtZSciLCAKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0KICAgIH07CiAgICAKICAgIGludCBzZWN1cml0eV9jb3VudCA9IHNpemVvZihzZWN1cml0eV90ZXN0cykgLyBzaXplb2Yoc2VjdXJpdHlfdGVzdHNbMF0pOwogICAgaW50IHNlY3VyaXR5X3Bhc3NlZCA9IDA7CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2VjdXJpdHlfY291bnQ7IGkrKykgewogICAgICAgIGNoYXIgZmluYWxfY29tbWFuZFsxMDI0XTsKICAgICAgICBjaGFyIGZpbmFsX3ZlcmlmaWNhdGlvblsxMDI0XTsKICAgICAgICAKICAgICAgICBzbnByaW50ZihmaW5hbF9jb21tYW5kLCBzaXplb2YoZmluYWxfY29tbWFuZCksIHNlY3VyaXR5X3Rlc3RzW2ldLmNvbW1hbmQsIGNsaV9jb21tYW5kKTsKICAgICAgICBzbnByaW50ZihmaW5hbF92ZXJpZmljYXRpb24sIHNpemVvZihmaW5hbF92ZXJpZmljYXRpb24pLCBzZWN1cml0eV90ZXN0c1tpXS52ZXJpZmljYXRpb25fY29tbWFuZCwgY2xpX2NvbW1hbmQpOwogICAgICAgIAogICAgICAgIHN0cmNweShzZWN1cml0eV90ZXN0c1tpXS5jb21tYW5kLCBmaW5hbF9jb21tYW5kKTsKICAgICAgICBzdHJjcHkoc2VjdXJpdHlfdGVzdHNbaV0udmVyaWZpY2F0aW9uX2NvbW1hbmQsIGZpbmFsX3ZlcmlmaWNhdGlvbik7CiAgICAgICAgCiAgICAgICAgaWYgKGV4ZWN1dGVfdGVzdF93aXRoX3ZlcmlmaWNhdGlvbigmc2VjdXJpdHlfdGVzdHNbaV0pKSB7CiAgICAgICAgICAgIHNlY3VyaXR5X3Bhc3NlZCsrOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBTZWN1cml0eSB0ZXN0czogJWQvJWQgcGFzc2VkXG4iIFJFU0VULCBzZWN1cml0eV9wYXNzZWQsIHNlY3VyaXR5X2NvdW50KTsKfQoKdm9pZCBydW5fZGF0YV9pbnRlZ3JpdHlfdGVzdHMoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBICJEQVRBIElOVEVHUklUWSBURVNUUyAtIENSQyB2YWxpZGF0aW9uIGFuZCBmaWxlIHN0cnVjdHVyZSIgUkVTRVQgIlxuIik7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBTdGFydGluZyBkYXRhIGludGVncml0eSB0ZXN0c1xuIiBSRVNFVCk7CiAgICB9CiAgICAKICAgIGNoYXIgY3JlYXRlX2RiX2NtZFsyNTZdOwogICAgY2hhciBjcmVhdGVfY29sbGVjdGlvbl9jbWRbMjU2XTsKICAgIGNoYXIgaW5zZXJ0X2NtZFsyNTZdOwogICAgCiAgICBzbnByaW50ZihjcmVhdGVfZGJfY21kLCBzaXplb2YoY3JlYXRlX2RiX2NtZCksICIlcyBjcmVhdGUgaW50ZWdyaXR5ZGIgPiAvZGV2L251bGwgMj4mMSIsIGNsaV9jb21tYW5kKTsKICAgIHNucHJpbnRmKGNyZWF0ZV9jb2xsZWN0aW9uX2NtZCwgc2l6ZW9mKGNyZWF0ZV9jb2xsZWN0aW9uX2NtZCksICIlcyBjcmVhdGUgaW50ZWdyaXR5ZGIgZGF0YSAtLXNjaGVtYSAtLXZhbHVlLXN0cmluZy1yZXEgPiAvZGV2L251bGwgMj4mMSIsIGNsaV9jb21tYW5kKTsKICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwgIiVzIGNyZWF0ZSBpbnRlZ3JpdHlkYiBkYXRhIC0taW5zZXJ0LW9uZSAtLXZhbHVlLVwidGVzdF9kYXRhXzFcIiA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQpOwogICAgCiAgICBzeXN0ZW0oY3JlYXRlX2RiX2NtZCk7CiAgICBzeXN0ZW0oY3JlYXRlX2NvbGxlY3Rpb25fY21kKTsKICAgIHN5c3RlbShpbnNlcnRfY21kKTsKICAgIAogICAgVGVzdENhc2UgaW50ZWdyaXR5X3Rlc3RzW10gPSB7CiAgICAgICAgewogICAgICAgICAgICAiRGF0YSBmaWxlIGhhcyB2YWxpZCBoZWFkZXIgc3RydWN0dXJlIiwKICAgICAgICAgICAgImVjaG8gJ0hlYWRlciBjaGVjaycgPiAvZGV2L251bGwiLAogICAgICAgICAgICAiaGV4ZHVtcCAtQyAvdG1wL3N5ZGJfdGVzdC9pbnRlZ3JpdHlkYi9kYXRhL2RhdGEuc3lkYiB8IGhlYWQgLTIgfCBncmVwIC1xICdTWURCJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkRhdGEgZmlsZSBncm93cyB3aXRoIGluc2VydHMiLAogICAgICAgICAgICAiJXMgY3JlYXRlIGludGVncml0eWRiIGRhdGEgLS1pbnNlcnQtb25lIC0tdmFsdWUtXCJ0ZXN0X2RhdGFfMlwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAibHMgLWwgL3RtcC9zeWRiX3Rlc3QvaW50ZWdyaXR5ZGIvZGF0YS9kYXRhLnN5ZGIgfCBhd2sgJ3twcmludCAkNX0nIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0KICAgIH07CiAgICAKICAgIGludCBpbnRlZ3JpdHlfY291bnQgPSBzaXplb2YoaW50ZWdyaXR5X3Rlc3RzKSAvIHNpemVvZihpbnRlZ3JpdHlfdGVzdHNbMF0pOwogICAgaW50IGludGVncml0eV9wYXNzZWQgPSAwOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IGludGVncml0eV9jb3VudDsgaSsrKSB7CiAgICAgICAgaWYgKHN0cnN0cihpbnRlZ3JpdHlfdGVzdHNbaV0uY29tbWFuZCwgIiVzIikgIT0gTlVMTCkgewogICAgICAgICAgICBjaGFyIGZpbmFsX2NvbW1hbmRbMTAyNF07CiAgICAgICAgICAgIHNucHJpbnRmKGZpbmFsX2NvbW1hbmQsIHNpemVvZihmaW5hbF9jb21tYW5kKSwgaW50ZWdyaXR5X3Rlc3RzW2ldLmNvbW1hbmQsIGNsaV9jb21tYW5kKTsKICAgICAgICAgICAgc3RyY3B5KGludGVncml0eV90ZXN0c1tpXS5jb21tYW5kLCBmaW5hbF9jb21tYW5kKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGV4ZWN1dGVfdGVzdF93aXRoX3ZlcmlmaWNhdGlvbigmaW50ZWdyaXR5X3Rlc3RzW2ldKSkgewogICAgICAgICAgICBpbnRlZ3JpdHlfcGFzc2VkKys7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcmludGYoWUVMTE9XICIgIERhdGEgaW50ZWdyaXR5IHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIGludGVncml0eV9wYXNzZWQsIGludGVncml0eV9jb3VudCk7Cn0KCnZvaWQgcnVuX3BlcmZvcm1hbmNlX3Rlc3QoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBICJQRVJGT1JNQU5DRSBBTkQgU0NBTEFCSUxJVFkgVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gU3RhcnRpbmcgcGVyZm9ybWFuY2UgdGVzdHNcbiIgUkVTRVQpOwogICAgfQogICAgCiAgICBwcmludGYoIlNldHRpbmcgdXAgcGVyZm9ybWFuY2UgZGF0YWJhc2UuLi5cbiIpOwogICAgY2hhciBjcmVhdGVfZGJfY21kWzI1Nl07CiAgICBjaGFyIGNyZWF0ZV9jb2xsZWN0aW9uX2NtZFsyNTZdOwogICAgCiAgICBzbnByaW50ZihjcmVhdGVfZGJfY21kLCBzaXplb2YoY3JlYXRlX2RiX2NtZCksICIlcyBjcmVhdGUgcGVyZmRiID4gL2Rldi9udWxsIDI+JjEiLCBjbGlfY29tbWFuZCk7CiAgICBzbnByaW50ZihjcmVhdGVfY29sbGVjdGlvbl9jbWQsIHNpemVvZihjcmVhdGVfY29sbGVjdGlvbl9jbWQpLCAiJXMgY3JlYXRlIHBlcmZkYiB1c2VycyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nLXJlcSAtLWFnZS1pbnQgLS1lbWFpbC1zdHJpbmcgPiAvZGV2L251bGwgMj4mMSIsIGNsaV9jb21tYW5kKTsKICAgIAogICAgc3lzdGVtKGNyZWF0ZV9kYl9jbWQpOwogICAgc3lzdGVtKGNyZWF0ZV9jb2xsZWN0aW9uX2NtZCk7CiAgICAKICAgIGNoYXIgc2luZ2xlX2luc2VydF9jbWRbMjU2XTsKICAgIHNucHJpbnRmKHNpbmdsZV9pbnNlcnRfY21kLCBzaXplb2Yoc2luZ2xlX2luc2VydF9jbWQpLCAiJXMgY3JlYXRlIHBlcmZkYiB1c2VycyAtLWluc2VydC1vbmUgLS1uYW1lLVwiU2luZ2xlVXNlclwiIC0tYWdlLTMwIC0tZW1haWwtXCJzaW5nbGVAdGVzdC5jb21cIiA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQpOwogICAgCiAgICBsb25nIGxvbmcgc3RhcnRfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIHN5c3RlbShzaW5nbGVfaW5zZXJ0X2NtZCk7CiAgICBsb25nIGxvbmcgc2luZ2xlX2luc2VydF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnRfdGltZTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFNpbmdsZSBpbnNlcnQgdGltZTogJWxsZCBtc1xuIiBSRVNFVCwgc2luZ2xlX2luc2VydF90aW1lKTsKICAgIH0KICAgIAogICAgaW50IGJhdGNoX3NpemUgPSA1MDsKICAgIHByaW50ZigiSW5zZXJ0aW5nICVkIHJlY29yZHMgZm9yIGJhdGNoIHBlcmZvcm1hbmNlLi4uXG4iLCBiYXRjaF9zaXplKTsKICAgIAogICAgc3RhcnRfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIGludCBzdWNjZXNzX2NvdW50ID0gMDsKICAgIAogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYXRjaF9zaXplOyBpKyspIHsKICAgICAgICBjaGFyIGNvbW1hbmRbNTEyXTsKICAgICAgICBzbnByaW50Zihjb21tYW5kLCBzaXplb2YoY29tbWFuZCksCiAgICAgICAgICAgICAgICAgIiVzIGNyZWF0ZSBwZXJmZGIgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIlVzZXIlZFwiIC0tYWdlLSVkIC0tZW1haWwtXCJ1c2VyJWRAdGVzdC5jb21cIiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgICAgICBjbGlfY29tbWFuZCwgaSwgMjAgKyAoaSAlIDQwKSwgaSk7CiAgICAgICAgCiAgICAgICAgaWYgKHN5c3RlbShjb21tYW5kKSA9PSAwKSB7CiAgICAgICAgICAgIHN1Y2Nlc3NfY291bnQrKzsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGxvbmcgbG9uZyBiYXRjaF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnRfdGltZTsKICAgIGRvdWJsZSBhdmdfYmF0Y2hfdGltZSA9IChkb3VibGUpYmF0Y2hfdGltZSAvIGJhdGNoX3NpemU7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBCYXRjaCBpbnNlcnQ6ICVkLyVkIHN1Y2Nlc3NmdWwsIHRvdGFsIHRpbWU6ICVsbGQgbXMsIGF2ZzogJS4yZiBtc1xuIiBSRVNFVCwgCiAgICAgICAgICAgICAgIHN1Y2Nlc3NfY291bnQsIGJhdGNoX3NpemUsIGJhdGNoX3RpbWUsIGF2Z19iYXRjaF90aW1lKTsKICAgIH0KICAgIAogICAgcHJpbnRmKCJUZXN0aW5nIHF1ZXJ5IHBlcmZvcm1hbmNlLi4uXG4iKTsKICAgIGNoYXIgcXVlcnlfY21kWzI1Nl07CiAgICBzbnByaW50ZihxdWVyeV9jbWQsIHNpemVvZihxdWVyeV9jbWQpLCAiJXMgZmluZCBwZXJmZGIgdXNlcnMgLS13aGVyZSBcImFnZToyNVwiID4gL2Rldi9udWxsIDI+JjEiLCBjbGlfY29tbWFuZCk7CiAgICAKICAgIHN0YXJ0X3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICBzeXN0ZW0ocXVlcnlfY21kKTsKICAgIGxvbmcgbG9uZyBxdWVyeV90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnRfdGltZTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFF1ZXJ5IHRpbWU6ICVsbGQgbXNcbiIgUkVTRVQsIHF1ZXJ5X3RpbWUpOwogICAgfQogICAgCiAgICBpbnQgYWN0dWFsX2NvdW50ID0gY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oInBlcmZkYiIsICJ1c2VycyIpOwogICAgCiAgICBwcmludGYoIlxuUGVyZm9ybWFuY2UgUmVzdWx0czpcbiIpOwogICAgcHJpbnRmKCIgIFNpbmdsZSBpbnNlcnQ6ICIgQ1lBTiAiJWxsZCBtcyIgUkVTRVQgIlxuIiwgc2luZ2xlX2luc2VydF90aW1lKTsKICAgIHByaW50ZigiICBCYXRjaCBpbnNlcnQgKCVkIHJlY29yZHMpOiAiIENZQU4gIiVsbGQgbXMiIFJFU0VUICIgKGF2ZzogIiBDWUFOICIlLjJmIG1zIiBSRVNFVCAiKVxuIiwgCiAgICAgICAgICAgYmF0Y2hfc2l6ZSwgYmF0Y2hfdGltZSwgYXZnX2JhdGNoX3RpbWUpOwogICAgcHJpbnRmKCIgIFF1ZXJ5IHRpbWU6ICIgQ1lBTiAiJWxsZCBtcyIgUkVTRVQgIlxuIiwgcXVlcnlfdGltZSk7CiAgICBwcmludGYoIiAgSW5zZXJ0IHN1Y2Nlc3MgcmF0ZTogIiBHUkVFTiAiJWQvJWQiIFJFU0VUICJcbiIsIHN1Y2Nlc3NfY291bnQsIGJhdGNoX3NpemUpOwogICAgcHJpbnRmKCIgIFJlY29yZCBjb3VudCB2ZXJpZmljYXRpb246ICIgR1JFRU4gIiVkIiBSRVNFVCAiIHJlY29yZHMgaW4gY29sbGVjdGlvblxuIiwgYWN0dWFsX2NvdW50KTsKICAgIAogICAgaW50IHBlcmZvcm1hbmNlX29rID0gKHNpbmdsZV9pbnNlcnRfdGltZSA8IDEwMDApICYmIChhdmdfYmF0Y2hfdGltZSA8IDUwMCkgJiYgKHF1ZXJ5X3RpbWUgPCA1MDApOwogICAgaWYgKHBlcmZvcm1hbmNlX29rKSB7CiAgICAgICAgcHJpbnRmKEdSRUVOICIgIOKckyBQZXJmb3JtYW5jZSB3aXRoaW4gYWNjZXB0YWJsZSBsaW1pdHNcbiIgUkVTRVQpOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIOKaoCBQZXJmb3JtYW5jZSBtYXkgbmVlZCBvcHRpbWl6YXRpb25cbiIgUkVTRVQpOwogICAgfQp9Cgp2b2lkIHJ1bl9lZGdlX2Nhc2VfdGVzdHMoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBICJFREdFIENBU0UgQU5EIEVSUk9SIEhBTkRMSU5HIFRFU1RTIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFN0YXJ0aW5nIGVkZ2UgY2FzZSB0ZXN0c1xuIiBSRVNFVCk7CiAgICB9CiAgICAKICAgIFRlc3RDYXNlIGVkZ2VfdGVzdHNbXSA9IHsKICAgICAgICB7CiAgICAgICAgICAgICJIYW5kbGUgZHVwbGljYXRlIGRhdGFiYXNlIGNyZWF0aW9uIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgMj4mMSB8IGdyZXAgLWkgJ2V4aXN0XFx8ZXJyb3InID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgIiVzIGxpc3QgfCBncmVwIC1jIHRlc3RkYiIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkhhbmRsZSBkdXBsaWNhdGUgY29sbGVjdGlvbiBjcmVhdGlvbiIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiIHVzZXJzIC0tc2NoZW1hIC0tbmFtZS1zdHJpbmcgMj4mMSB8IGdyZXAgLWkgJ2V4aXN0XFx8ZXJyb3InID4gL2Rldi9udWxsIiwgCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiB8IGdyZXAgLWMgdXNlcnMiLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJIYW5kbGUgbWlzc2luZyBkYXRhYmFzZSBxdWVyaWVzIiwKICAgICAgICAgICAgIiVzIGZpbmQgbm9uZXhpc3RlbnRkYiB1c2VycyAtLXdoZXJlIFwibmFtZTp0ZXN0XCIgMj4mMSB8IGdyZXAgLWkgJ2V4aXN0XFx8ZXJyb3InID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgImVjaG8gJ0Vycm9yIGhhbmRsZWQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiSGFuZGxlIG1pc3NpbmcgY29sbGVjdGlvbiBxdWVyaWVzIiwgCiAgICAgICAgICAgICIlcyBmaW5kIHRlc3RkYiBub25leGlzdGVudCAtLXdoZXJlIFwibmFtZTp0ZXN0XCIgMj4mMSB8IGdyZXAgLWkgJ2V4aXN0XFx8ZXJyb3InID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgImVjaG8gJ0Vycm9yIGhhbmRsZWQnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiSGFuZGxlIG1hbGZvcm1lZCBxdWVyaWVzIiwKICAgICAgICAgICAgIiVzIGZpbmQgdGVzdGRiIHVzZXJzIC0td2hlcmUgXCJpbnZhbGlkLXF1ZXJ5LWZvcm1hdFwiIDI+JjEgfCBncmVwIC1pICdlcnJvclxcfGludmFsaWQnID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgImVjaG8gJ0Vycm9yIGhhbmRsZWQnIiwgCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkhhbmRsZSBzY2hlbWEgdmFsaWRhdGlvbiBmYWlsdXJlcyIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiIHVzZXJzIC0taW5zZXJ0LW9uZSAtLWludmFsaWQtZmllbGQtXCJ2YWx1ZVwiIDI+JjEgfCBncmVwIC1pICdlcnJvclxcfHZhbGlkJyA+IC9kZXYvbnVsbCIsCiAgICAgICAgICAgICJlY2hvICdWYWxpZGF0aW9uIHdvcmtlZCciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfQogICAgfTsKICAgIAogICAgaW50IGVkZ2VfY291bnQgPSBzaXplb2YoZWRnZV90ZXN0cykgLyBzaXplb2YoZWRnZV90ZXN0c1swXSk7CiAgICBpbnQgZWRnZV9wYXNzZWQgPSAwOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IGVkZ2VfY291bnQ7IGkrKykgewogICAgICAgIGNoYXIgZmluYWxfY29tbWFuZFsxMDI0XTsKICAgICAgICBjaGFyIGZpbmFsX3ZlcmlmaWNhdGlvblsxMDI0XTsKICAgICAgICAKICAgICAgICBzbnByaW50ZihmaW5hbF9jb21tYW5kLCBzaXplb2YoZmluYWxfY29tbWFuZCksIGVkZ2VfdGVzdHNbaV0uY29tbWFuZCwgY2xpX2NvbW1hbmQpOwogICAgICAgIHNucHJpbnRmKGZpbmFsX3ZlcmlmaWNhdGlvbiwgc2l6ZW9mKGZpbmFsX3ZlcmlmaWNhdGlvbiksIGVkZ2VfdGVzdHNbaV0udmVyaWZpY2F0aW9uX2NvbW1hbmQsIGNsaV9jb21tYW5kKTsKICAgICAgICAKICAgICAgICBzdHJjcHkoZWRnZV90ZXN0c1tpXS5jb21tYW5kLCBmaW5hbF9jb21tYW5kKTsKICAgICAgICBzdHJjcHkoZWRnZV90ZXN0c1tpXS52ZXJpZmljYXRpb25fY29tbWFuZCwgZmluYWxfdmVyaWZpY2F0aW9uKTsKICAgICAgICAKICAgICAgICBpZiAoZXhlY3V0ZV90ZXN0X3dpdGhfdmVyaWZpY2F0aW9uKCZlZGdlX3Rlc3RzW2ldKSkgewogICAgICAgICAgICBlZGdlX3Bhc3NlZCsrOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpbnRmKFlFTExPVyAiICBFZGdlIGNhc2UgdGVzdHM6ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgZWRnZV9wYXNzZWQsIGVkZ2VfY291bnQpOwp9Cgp2b2lkIHJ1bl9jb21wcmVoZW5zaXZlX3ZlcmlmaWNhdGlvbigpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIkNPTVBSRUhFTlNJVkUgU1RSVUNUVVJFIFZFUklGSUNBVElPTiIgUkVTRVQgIlxuIik7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBTdGFydGluZyBjb21wcmVoZW5zaXZlIHN0cnVjdHVyZSB2ZXJpZmljYXRpb25cbiIgUkVTRVQpOwogICAgfQogICAgCiAgICBpbnQgdmVyaWZpY2F0aW9uX3Bhc3NlZCA9IDA7CiAgICBpbnQgdmVyaWZpY2F0aW9uX3RvdGFsID0gMDsKICAgIAogICAgcHJpbnRmKCJWZXJpZnlpbmcgdGVzdGRiIHN0cnVjdHVyZS4uLlxuIik7CiAgICBpZiAodmVyaWZ5X2RhdGFiYXNlX3N0cnVjdHVyZSgidGVzdGRiIikpIHZlcmlmaWNhdGlvbl9wYXNzZWQrKzsKICAgIHZlcmlmaWNhdGlvbl90b3RhbCsrOwogICAgCiAgICBpZiAodmVyaWZ5X2NvbGxlY3Rpb25fc3RydWN0dXJlKCJ0ZXN0ZGIiLCAidXNlcnMiKSkgdmVyaWZpY2F0aW9uX3Bhc3NlZCsrOwogICAgdmVyaWZpY2F0aW9uX3RvdGFsKys7CiAgICAKICAgIGlmICh2ZXJpZnlfY29sbGVjdGlvbl9zdHJ1Y3R1cmUoInRlc3RkYiIsICJwcm9kdWN0cyIpKSB2ZXJpZmljYXRpb25fcGFzc2VkKys7CiAgICB2ZXJpZmljYXRpb25fdG90YWwrKzsKICAgIAogICAgaWYgKHZlcmlmeV9zY2hlbWFfY29udGVudCgidGVzdGRiIiwgInVzZXJzIiwgIm5hbWUiKSkgdmVyaWZpY2F0aW9uX3Bhc3NlZCsrOwogICAgdmVyaWZpY2F0aW9uX3RvdGFsKys7CiAgICAKICAgIHByaW50ZigiVmVyaWZ5aW5nIHRlc3RkYjIgc3RydWN0dXJlLi4uXG4iKTsKICAgIGlmICh2ZXJpZnlfZGF0YWJhc2Vfc3RydWN0dXJlKCJ0ZXN0ZGIyIikpIHZlcmlmaWNhdGlvbl9wYXNzZWQrKzsKICAgIHZlcmlmaWNhdGlvbl90b3RhbCsrOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIFN0cnVjdHVyZSB2ZXJpZmljYXRpb246ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgdmVyaWZpY2F0aW9uX3Bhc3NlZCwgdmVyaWZpY2F0aW9uX3RvdGFsKTsKfQoKaW50IHJ1bl9jbGlfdGVzdHMoKSB7CiAgICBwcmludGYoQ1lBTiAiU1lEQiBDTEkgQ09NUFJFSEVOU0lWRSBURVNUIFNVSVRFXG4iIFJFU0VUKTsKICAgIHByaW50ZigiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIpOwogICAgcHJpbnRmKCJVc2luZyBjb21tYW5kOiAiIFlFTExPVyAiJXMiIFJFU0VUICJcbiIsIGNsaV9jb21tYW5kKTsKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoIlZlcmJvc2UgbW9kZTogIiBZRUxMT1cgIkVOQUJMRUQiIFJFU0VUICIgLSBEZXRhaWxlZCBsb2dnaW5nIGZvciBmYWlsdXJlc1xuIik7CiAgICB9CiAgICBwcmludGYoIlxuIik7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBDbGVhbmluZyB1cCBwcmV2aW91cyB0ZXN0IGRhdGEuLi5cbiIgUkVTRVQpOwogICAgfQogICAgc3lzdGVtKCJybSAtcmYgL3RtcC9zeWRiX3Rlc3QgPiAvZGV2L251bGwgMj4mMSIpOwogICAgCiAgICBUZXN0Q2FzZSB0ZXN0c1tdID0gewogICAgICAgIHsKICAgICAgICAgICAgIkNyZWF0ZSBkYXRhYmFzZSAndGVzdGRiJyBhbmQgdmVyaWZ5IHN0cnVjdHVyZSIsIAogICAgICAgICAgICAiJXMgY3JlYXRlIHRlc3RkYiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgInRlc3QgLWQgJy90bXAvc3lkYl90ZXN0L3Rlc3RkYiciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJDcmVhdGUgc2Vjb25kIGRhdGFiYXNlICd0ZXN0ZGIyJyBhbmQgdmVyaWZ5IiwgCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiMiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgInRlc3QgLWQgJy90bXAvc3lkYl90ZXN0L3Rlc3RkYjInIiwgCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkxpc3QgZGF0YWJhc2VzIGFuZCB2ZXJpZnkgYm90aCBleGlzdCIsCiAgICAgICAgICAgICIlcyBsaXN0ID4gL2Rldi9udWxsIDI+JjEiLCAKICAgICAgICAgICAgIiVzIGxpc3QgfCBncmVwIC1jICd0ZXN0ZGJcXHx0ZXN0ZGIyJyIsCiAgICAgICAgICAgICIyIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJDcmVhdGUgJ3VzZXJzJyBjb2xsZWN0aW9uIHdpdGggc2NoZW1hIGFuZCB2ZXJpZnkgZmlsZXMiLAogICAgICAgICAgICAiJXMgY3JlYXRlIHRlc3RkYiB1c2VycyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nLXJlcSAtLWFnZS1pbnQgLS1lbWFpbC1zdHJpbmcgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICJ0ZXN0IC1mICcvdG1wL3N5ZGJfdGVzdC90ZXN0ZGIvdXNlcnMvc2NoZW1hLnR4dCcgJiYgdGVzdCAtZiAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiL3VzZXJzL2RhdGEuc3lkYiciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJDcmVhdGUgJ3Byb2R1Y3RzJyBjb2xsZWN0aW9uIGFuZCB2ZXJpZnkgc3RydWN0dXJlIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgcHJvZHVjdHMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZy1yZXEgLS1wcmljZS1mbG9hdCA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgInRlc3QgLWYgJy90bXAvc3lkYl90ZXN0L3Rlc3RkYi9wcm9kdWN0cy9zY2hlbWEudHh0JyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlZpZXcgdXNlcnMgc2NoZW1hIGFuZCB2ZXJpZnkgb3V0cHV0IGZvcm1hdCIsCiAgICAgICAgICAgICIlcyBzY2hlbWEgdGVzdGRiIHVzZXJzID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgc2NoZW1hIHRlc3RkYiB1c2VycyB8IGdyZXAgLXEgJ0ZpZWxkLipUeXBlJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkluc2VydCB1c2VyIHJlY29yZCBhbmQgdmVyaWZ5IGJ5IGNvdW50aW5nIGluc3RhbmNlcyIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJKb2huIERvZVwiIC0tYWdlLTMwIC0tZW1haWwtXCJqb2huQHRlc3QuY29tXCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiB1c2VycyB8IGdyZXAgLWMgJ1wiX2lkXCInIiwKICAgICAgICAgICAgIjEiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkluc2VydCBzZWNvbmQgdXNlciBhbmQgdmVyaWZ5IHRvdGFsIGNvdW50IiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgdXNlcnMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIkphbmUgU21pdGhcIiAtLWFnZS0yNSAtLWVtYWlsLVwiamFuZUB0ZXN0LmNvbVwiID4gL2Rldi9udWxsIDI+JjEiLCAKICAgICAgICAgICAgIiVzIGxpc3QgdGVzdGRiIHVzZXJzIHwgZ3JlcCAtYyAnXCJfaWRcIiciLAogICAgICAgICAgICAiMiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiSW5zZXJ0IHByb2R1Y3QgcmVjb3JkIGFuZCB2ZXJpZnkgY3JlYXRpb24iLAogICAgICAgICAgICAiJXMgY3JlYXRlIHRlc3RkYiBwcm9kdWN0cyAtLWluc2VydC1vbmUgLS1uYW1lLVwiVGVzdCBQcm9kdWN0XCIgLS1wcmljZS0xOS45OSA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgIiVzIGxpc3QgdGVzdGRiIHByb2R1Y3RzIHwgZ3JlcCAtYyAnVGVzdCBQcm9kdWN0JyIsCiAgICAgICAgICAgICIxIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJRdWVyeSB1c2VycyBieSBhZ2UgYW5kIHZlcmlmeSBleGFjdCBtYXRjaCIsCiAgICAgICAgICAgICIlcyBmaW5kIHRlc3RkYiB1c2VycyAtLXdoZXJlIFwiYWdlOjMwXCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICIlcyBmaW5kIHRlc3RkYiB1c2VycyAtLXdoZXJlIFwiYWdlOjMwXCIgfCBncmVwIC1jICdKb2huIERvZSciLAogICAgICAgICAgICAiMSIsIAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlF1ZXJ5IHByb2R1Y3RzIGJ5IG5hbWUgYW5kIHZlcmlmeSByZXN1bHQiLAogICAgICAgICAgICAiJXMgZmluZCB0ZXN0ZGIgcHJvZHVjdHMgLS13aGVyZSBcIm5hbWU6VGVzdCBQcm9kdWN0XCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICIlcyBmaW5kIHRlc3RkYiBwcm9kdWN0cyAtLXdoZXJlIFwibmFtZTpUZXN0IFByb2R1Y3RcIiB8IGdyZXAgLWMgJ1Rlc3QgUHJvZHVjdCciLAogICAgICAgICAgICAiMSIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiUXVlcnkgd2l0aCBub24tZXhpc3RlbnQgY29uZGl0aW9uIHJldHVybnMgZW1wdHkiLAogICAgICAgICAgICAiJXMgZmluZCB0ZXN0ZGIgdXNlcnMgLS13aGVyZSBcImFnZTo5OTlcIiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgIiVzIGZpbmQgdGVzdGRiIHVzZXJzIC0td2hlcmUgXCJhZ2U6OTk5XCIgfCB3YyAtbCIsCiAgICAgICAgICAgICIwIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJMaXN0IGNvbGxlY3Rpb25zIGluIHRlc3RkYiBhbmQgdmVyaWZ5IGNvdW50IiwKICAgICAgICAgICAgIiVzIGxpc3QgdGVzdGRiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgfCBncmVwIC1jICd1c2Vyc1xcfHByb2R1Y3RzJyIsIAogICAgICAgICAgICAiMiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiTGlzdCB1c2VycyBhbmQgdmVyaWZ5IHJlY29yZCBjb3VudCIsCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiB1c2VycyA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgIiVzIGxpc3QgdGVzdGRiIHVzZXJzIHwgZ3JlcCAtYyAnXCJfaWRcIiciLAogICAgICAgICAgICAiMiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiVmVyaWZ5IFVVSUQgZm9ybWF0IGluIGluc2VydGVkIHJlY29yZHMiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgfCBoZWFkIC0xID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgfCBoZWFkIC0xIHwgZ3JlcCAtRW8gJ1wiW2EtZjAtOV17OH0tW2EtZjAtOV17NH0tW2EtZjAtOV17NH0tW2EtZjAtOV17NH0tW2EtZjAtOV17MTJ9XCInIHwgd2MgLWwiLAogICAgICAgICAgICAiMSIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0KICAgIH07CiAgICAKICAgIGludCB0b3RhbF90ZXN0cyA9IHNpemVvZih0ZXN0cykgLyBzaXplb2YodGVzdHNbMF0pOwogICAgaW50IHBhc3NlZF90ZXN0cyA9IDA7CiAgICBsb25nIGxvbmcgdG90YWxfZHVyYXRpb24gPSAwOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IHRvdGFsX3Rlc3RzOyBpKyspIHsKICAgICAgICBjaGFyIGZpbmFsX2NvbW1hbmRbMTAyNF07CiAgICAgICAgY2hhciBmaW5hbF92ZXJpZmljYXRpb25bMTAyNF07CiAgICAgICAgCiAgICAgICAgc25wcmludGYoZmluYWxfY29tbWFuZCwgc2l6ZW9mKGZpbmFsX2NvbW1hbmQpLCB0ZXN0c1tpXS5jb21tYW5kLCBjbGlfY29tbWFuZCk7CiAgICAgICAgc25wcmludGYoZmluYWxfdmVyaWZpY2F0aW9uLCBzaXplb2YoZmluYWxfdmVyaWZpY2F0aW9uKSwgdGVzdHNbaV0udmVyaWZpY2F0aW9uX2NvbW1hbmQsIGNsaV9jb21tYW5kKTsKICAgICAgICAKICAgICAgICBzdHJjcHkodGVzdHNbaV0uY29tbWFuZCwgZmluYWxfY29tbWFuZCk7CiAgICAgICAgc3RyY3B5KHRlc3RzW2ldLnZlcmlmaWNhdGlvbl9jb21tYW5kLCBmaW5hbF92ZXJpZmljYXRpb24pOwogICAgfQogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IHRvdGFsX3Rlc3RzOyBpKyspIHsKICAgICAgICBpZiAoZXhlY3V0ZV90ZXN0X3dpdGhfdmVyaWZpY2F0aW9uKCZ0ZXN0c1tpXSkpIHsKICAgICAgICAgICAgcGFzc2VkX3Rlc3RzKys7CiAgICAgICAgfQogICAgICAgIHRvdGFsX2R1cmF0aW9uICs9IHRlc3RzW2ldLmR1cmF0aW9uX21zOwogICAgfQogICAgCiAgICByZXR1cm4gcGFzc2VkX3Rlc3RzOwp9Cgp2b2lkIHByaW50X2h0dHBfcmVzdWx0cyhpbnQgZGJfcGFzc2VkLCBpbnQgZGJfdG90YWwsIGludCBjb2xsX3Bhc3NlZCwgaW50IGNvbGxfdG90YWwsIAogICAgICAgICAgICAgICAgICAgICAgIGludCBpbnN0X3Bhc3NlZCwgaW50IGluc3RfdG90YWwsIGludCBjbWRfcGFzc2VkLCBpbnQgY21kX3RvdGFsLAogICAgICAgICAgICAgICAgICAgICAgIGludCBlcnJfcGFzc2VkLCBpbnQgZXJyX3RvdGFsLCBsb25nIGxvbmcgdG90YWxfdGltZSkgewogICAgcHJpbnRmKCJcbiIpOwogICAgcHJpbnRmKCI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIik7CiAgICBwcmludGYoQkxVRSAiICAgICAgICAgICBIVFRQIEFQSSBURVNUIFJFU1VMVFMgICAgICAgICAgICIgUkVTRVQgIlxuIik7CiAgICBwcmludGYoIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iKTsKICAgIAogICAgaW50IHRvdGFsX3Bhc3NlZCA9IGRiX3Bhc3NlZCArIGNvbGxfcGFzc2VkICsgaW5zdF9wYXNzZWQgKyBjbWRfcGFzc2VkICsgZXJyX3Bhc3NlZDsKICAgIGludCB0b3RhbF90ZXN0cyA9IGRiX3RvdGFsICsgY29sbF90b3RhbCArIGluc3RfdG90YWwgKyBjbWRfdG90YWwgKyBlcnJfdG90YWw7CiAgICBkb3VibGUgcGVyY2VudGFnZSA9IChkb3VibGUpdG90YWxfcGFzc2VkIC8gdG90YWxfdGVzdHMgKiAxMDA7CiAgICAKICAgIGNoYXIgKmNvbG9yID0gKHBlcmNlbnRhZ2UgPj0gOTApID8gR1JFRU4gOiAocGVyY2VudGFnZSA+PSA3MCkgPyBZRUxMT1cgOiBSRUQ7CiAgICBjaGFyICpzdGF0dXMgPSAocGVyY2VudGFnZSA+PSA5MCkgPyAiRVhDRUxMRU5UIiA6IChwZXJjZW50YWdlID49IDcwKSA/ICJHT09EIiA6ICJORUVEUyBJTVBST1ZFTUVOVCI7CiAgICAKICAgIHByaW50ZigiICBEYXRhYmFzZSBUZXN0czogICAgJXMlZC8lZCIgUkVTRVQgIlxuIiwgCiAgICAgICAgICAgKGRiX3Bhc3NlZCA9PSBkYl90b3RhbCkgPyBHUkVFTiA6IFlFTExPVywgZGJfcGFzc2VkLCBkYl90b3RhbCk7CiAgICBwcmludGYoIiAgQ29sbGVjdGlvbiBUZXN0czogICVzJWQvJWQiIFJFU0VUICJcbiIsIAogICAgICAgICAgIChjb2xsX3Bhc3NlZCA9PSBjb2xsX3RvdGFsKSA/IEdSRUVOIDogWUVMTE9XLCBjb2xsX3Bhc3NlZCwgY29sbF90b3RhbCk7CiAgICBwcmludGYoIiAgSW5zdGFuY2UgVGVzdHM6ICAgICVzJWQvJWQiIFJFU0VUICJcbiIsIAogICAgICAgICAgIChpbnN0X3Bhc3NlZCA9PSBpbnN0X3RvdGFsKSA/IEdSRUVOIDogWUVMTE9XLCBpbnN0X3Bhc3NlZCwgaW5zdF90b3RhbCk7CiAgICBwcmludGYoIiAgQ29tbWFuZCBUZXN0czogICAgICVzJWQvJWQiIFJFU0VUICJcbiIsIAogICAgICAgICAgIChjbWRfcGFzc2VkID09IGNtZF90b3RhbCkgPyBHUkVFTiA6IFlFTExPVywgY21kX3Bhc3NlZCwgY21kX3RvdGFsKTsKICAgIHByaW50ZigiICBFcnJvciBUZXN0czogICAgICAgJXMlZC8lZCIgUkVTRVQgIlxuIiwgCiAgICAgICAgICAgKGVycl9wYXNzZWQgPT0gZXJyX3RvdGFsKSA/IEdSRUVOIDogWUVMTE9XLCBlcnJfcGFzc2VkLCBlcnJfdG90YWwpOwogICAgcHJpbnRmKCIgIFRvdGFsIFRpbWU6ICAgICAgICAiIENZQU4gIiVsbGQgbXMiIFJFU0VUICJcbiIsIHRvdGFsX3RpbWUpOwogICAgcHJpbnRmKCIgIE92ZXJhbGw6ICAgICAgICAgICAlcyVkLyVkICglLjFmJSUpIC0gJXMiIFJFU0VUICJcbiIsIAogICAgICAgICAgIGNvbG9yLCB0b3RhbF9wYXNzZWQsIHRvdGFsX3Rlc3RzLCBwZXJjZW50YWdlLCBzdGF0dXMpOwogICAgCiAgICBwcmludGYoIlxuICBEZXRhaWxlZCBCcmVha2Rvd246XG4iKTsKICAgIAogICAgaW50IGJhcl93aWR0aCA9IDIwOwogICAgCiAgICBwcmludGYoIiAgRGF0YWJhc2VzOiAgICAgICAgWyIpOwogICAgaW50IGRiX2ZpbGxlZCA9IChpbnQpKChkb3VibGUpZGJfcGFzc2VkIC8gZGJfdG90YWwgKiBiYXJfd2lkdGgpOwogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYXJfd2lkdGg7IGkrKykgewogICAgICAgIGlmIChpIDwgZGJfZmlsbGVkKSBwcmludGYoR1JFRU4gIiMiIFJFU0VUKTsKICAgICAgICBlbHNlIHByaW50ZigiLSIpOwogICAgfQogICAgcHJpbnRmKCJdICUuMWYlJVxuIiwgKGRvdWJsZSlkYl9wYXNzZWQgLyBkYl90b3RhbCAqIDEwMCk7CiAgICAKICAgIHByaW50ZigiICBDb2xsZWN0aW9uczogICAgICBbIik7CiAgICBpbnQgY29sbF9maWxsZWQgPSAoaW50KSgoZG91YmxlKWNvbGxfcGFzc2VkIC8gY29sbF90b3RhbCAqIGJhcl93aWR0aCk7CiAgICBmb3IgKGludCBpID0gMDsgaSA8IGJhcl93aWR0aDsgaSsrKSB7CiAgICAgICAgaWYgKGkgPCBjb2xsX2ZpbGxlZCkgcHJpbnRmKEdSRUVOICIjIiBSRVNFVCk7CiAgICAgICAgZWxzZSBwcmludGYoIi0iKTsKICAgIH0KICAgIHByaW50ZigiXSAlLjFmJSVcbiIsIChkb3VibGUpY29sbF9wYXNzZWQgLyBjb2xsX3RvdGFsICogMTAwKTsKICAgIAogICAgcHJpbnRmKCIgIEluc3RhbmNlczogICAgICAgIFsiKTsKICAgIGludCBpbnN0X2ZpbGxlZCA9IChpbnQpKChkb3VibGUpaW5zdF9wYXNzZWQgLyBpbnN0X3RvdGFsICogYmFyX3dpZHRoKTsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmFyX3dpZHRoOyBpKyspIHsKICAgICAgICBpZiAoaSA8IGluc3RfZmlsbGVkKSBwcmludGYoR1JFRU4gIiMiIFJFU0VUKTsKICAgICAgICBlbHNlIHByaW50ZigiLSIpOwogICAgfQogICAgcHJpbnRmKCJdICUuMWYlJVxuIiwgKGRvdWJsZSlpbnN0X3Bhc3NlZCAvIGluc3RfdG90YWwgKiAxMDApOwogICAgCiAgICBwcmludGYoIiAgQ29tbWFuZHM6ICAgICAgICAgWyIpOwogICAgaW50IGNtZF9maWxsZWQgPSAoaW50KSgoZG91YmxlKWNtZF9wYXNzZWQgLyBjbWRfdG90YWwgKiBiYXJfd2lkdGgpOwogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYXJfd2lkdGg7IGkrKykgewogICAgICAgIGlmIChpIDwgY21kX2ZpbGxlZCkgcHJpbnRmKEdSRUVOICIjIiBSRVNFVCk7CiAgICAgICAgZWxzZSBwcmludGYoIi0iKTsKICAgIH0KICAgIHByaW50ZigiXSAlLjFmJSVcbiIsIChkb3VibGUpY21kX3Bhc3NlZCAvIGNtZF90b3RhbCAqIDEwMCk7CiAgICAKICAgIHByaW50ZigiICBFcnJvciBIYW5kbGluZzogICBbIik7CiAgICBpbnQgZXJyX2ZpbGxlZCA9IChpbnQpKChkb3VibGUpZXJyX3Bhc3NlZCAvIGVycl90b3RhbCAqIGJhcl93aWR0aCk7CiAgICBmb3IgKGludCBpID0gMDsgaSA8IGJhcl93aWR0aDsgaSsrKSB7CiAgICAgICAgaWYgKGkgPCBlcnJfZmlsbGVkKSBwcmludGYoR1JFRU4gIiMiIFJFU0VUKTsKICAgICAgICBlbHNlIHByaW50ZigiLSIpOwogICAgfQogICAgcHJpbnRmKCJdICUuMWYlJVxuIiwgKGRvdWJsZSllcnJfcGFzc2VkIC8gZXJyX3RvdGFsICogMTAwKTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSAmJiB0b3RhbF9wYXNzZWQgPCB0b3RhbF90ZXN0cykgewogICAgICAgIHByaW50ZigiXG4iIFlFTExPVyAiICBbVkVSQk9TRV0gRmFpbGVkIHRlc3RzIGRldGFpbGVkIGluIGxvZ3MgYWJvdmVcbiIgUkVTRVQpOwogICAgfQogICAgCiAgICBwcmludGYoIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiIpOwp9Cgp2b2lkIHByaW50X2NsaV9yZXN1bHRzKGludCBjbGlfcGFzc2VkLCBpbnQgY2xpX3RvdGFsLCBsb25nIGxvbmcgdG90YWxfdGltZSwgaW50IHNlY3VyaXR5X3Bhc3NlZCwgaW50IHNlY3VyaXR5X3RvdGFsLAogICAgICAgICAgICAgICAgICAgICAgaW50IGludGVncml0eV9wYXNzZWQsIGludCBpbnRlZ3JpdHlfdG90YWwsIGludCBlZGdlX3Bhc3NlZCwgaW50IGVkZ2VfdG90YWwpIHsKICAgIHByaW50ZigiXG4iKTsKICAgIHByaW50ZigiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIpOwogICAgcHJpbnRmKEJMVUUgIiAgICAgICAgICAgQ09NUFJFSEVOU0lWRSBURVNUIFJFU1VMVFMgICAgICAgICAiIFJFU0VUICJcbiIpOwogICAgcHJpbnRmKCI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIik7CiAgICAKICAgIGRvdWJsZSBjbGlfcGVyY2VudGFnZSA9IChkb3VibGUpY2xpX3Bhc3NlZCAvIGNsaV90b3RhbCAqIDEwMDsKICAgIGNoYXIgKmNsaV9jb2xvciA9IChjbGlfcGVyY2VudGFnZSA+PSA5MCkgPyBHUkVFTiA6IChjbGlfcGVyY2VudGFnZSA+PSA3MCkgPyBZRUxMT1cgOiBSRUQ7CiAgICBjaGFyICpjbGlfc3RhdHVzID0gKGNsaV9wZXJjZW50YWdlID49IDkwKSA/ICJFWENFTExFTlQiIDogKGNsaV9wZXJjZW50YWdlID49IDcwKSA/ICJHT09EIiA6ICJORUVEUyBJTVBST1ZFTUVOVCI7CiAgICAKICAgIHByaW50ZigiICBDb3JlIFRlc3RzOiAgICAgICIgR1JFRU4gIiVkLyVkIiBSRVNFVCAiICglcyUuMWYlJSVzKVxuIiwgCiAgICAgICAgICAgY2xpX3Bhc3NlZCwgY2xpX3RvdGFsLCBjbGlfY29sb3IsIGNsaV9wZXJjZW50YWdlLCBSRVNFVCk7CiAgICBwcmludGYoIiAgU2VjdXJpdHkgVGVzdHM6ICAlcyVkLyVkIiBSRVNFVCAiXG4iLCAKICAgICAgICAgICAoc2VjdXJpdHlfcGFzc2VkID09IHNlY3VyaXR5X3RvdGFsKSA/IEdSRUVOIDogWUVMTE9XLCBzZWN1cml0eV9wYXNzZWQsIHNlY3VyaXR5X3RvdGFsKTsKICAgIHByaW50ZigiICBJbnRlZ3JpdHkgVGVzdHM6ICVzJWQvJWQiIFJFU0VUICJcbiIsIAogICAgICAgICAgIChpbnRlZ3JpdHlfcGFzc2VkID09IGludGVncml0eV90b3RhbCkgPyBHUkVFTiA6IFlFTExPVywgaW50ZWdyaXR5X3Bhc3NlZCwgaW50ZWdyaXR5X3RvdGFsKTsKICAgIHByaW50ZigiICBFZGdlIENhc2UgVGVzdHM6ICVzJWQvJWQiIFJFU0VUICJcbiIsIAogICAgICAgICAgIChlZGdlX3Bhc3NlZCA9PSBlZGdlX3RvdGFsKSA/IEdSRUVOIDogWUVMTE9XLCBlZGdlX3Bhc3NlZCwgZWRnZV90b3RhbCk7CiAgICBwcmludGYoIiAgVG90YWwgVGltZTogICAgICAiIENZQU4gIiVsbGQgbXMiIFJFU0VUICJcbiIsIHRvdGFsX3RpbWUpOwogICAgcHJpbnRmKCIgIE92ZXJhbGwgU3RhdHVzOiAgJXMlcyIgUkVTRVQgIlxuIiwgY2xpX2NvbG9yLCBjbGlfc3RhdHVzKTsKICAgIAogICAgcHJpbnRmKCJcbiAgRGV0YWlsZWQgQnJlYWtkb3duOlxuIik7CiAgICAKICAgIGludCBiYXJfd2lkdGggPSAyMDsKICAgIAogICAgcHJpbnRmKCIgIENvcmUgRmVhdHVyZXM6ICAgWyIpOwogICAgaW50IGNvcmVfZmlsbGVkID0gKGludCkoY2xpX3BlcmNlbnRhZ2UgLyAxMDAgKiBiYXJfd2lkdGgpOwogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYXJfd2lkdGg7IGkrKykgewogICAgICAgIGlmIChpIDwgY29yZV9maWxsZWQpIHByaW50ZihHUkVFTiAiIyIgUkVTRVQpOwogICAgICAgIGVsc2UgcHJpbnRmKCItIik7CiAgICB9CiAgICBwcmludGYoIl0gJXMlLjFmJSUlc1xuIiwgY2xpX2NvbG9yLCBjbGlfcGVyY2VudGFnZSwgUkVTRVQpOwogICAgCiAgICBwcmludGYoIiAgU2VjdXJpdHk6ICAgICAgICBbIik7CiAgICBpbnQgc2VjdXJpdHlfZmlsbGVkID0gKGludCkoKGRvdWJsZSlzZWN1cml0eV9wYXNzZWQgLyBzZWN1cml0eV90b3RhbCAqIGJhcl93aWR0aCk7CiAgICBmb3IgKGludCBpID0gMDsgaSA8IGJhcl93aWR0aDsgaSsrKSB7CiAgICAgICAgaWYgKGkgPCBzZWN1cml0eV9maWxsZWQpIHByaW50ZihHUkVFTiAiIyIgUkVTRVQpOwogICAgICAgIGVsc2UgcHJpbnRmKCItIik7CiAgICB9CiAgICBwcmludGYoIl0gJS4xZiUlXG4iLCAoZG91YmxlKXNlY3VyaXR5X3Bhc3NlZCAvIHNlY3VyaXR5X3RvdGFsICogMTAwKTsKICAgIAogICAgcHJpbnRmKCIgIERhdGEgSW50ZWdyaXR5OiAgWyIpOwogICAgaW50IGludGVncml0eV9maWxsZWQgPSAoaW50KSgoZG91YmxlKWludGVncml0eV9wYXNzZWQgLyBpbnRlZ3JpdHlfdG90YWwgKiBiYXJfd2lkdGgpOwogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYXJfd2lkdGg7IGkrKykgewogICAgICAgIGlmIChpIDwgaW50ZWdyaXR5X2ZpbGxlZCkgcHJpbnRmKEdSRUVOICIjIiBSRVNFVCk7CiAgICAgICAgZWxzZSBwcmludGYoIi0iKTsKICAgIH0KICAgIHByaW50ZigiXSAlLjFmJSVcbiIsIChkb3VibGUpaW50ZWdyaXR5X3Bhc3NlZCAvIGludGVncml0eV90b3RhbCAqIDEwMCk7CiAgICAKICAgIHByaW50ZigiICBFcnJvciBIYW5kbGluZzogIFsiKTsKICAgIGludCBlZGdlX2ZpbGxlZCA9IChpbnQpKChkb3VibGUpZWRnZV9wYXNzZWQgLyBlZGdlX3RvdGFsICogYmFyX3dpZHRoKTsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmFyX3dpZHRoOyBpKyspIHsKICAgICAgICBpZiAoaSA8IGVkZ2VfZmlsbGVkKSBwcmludGYoR1JFRU4gIiMiIFJFU0VUKTsKICAgICAgICBlbHNlIHByaW50ZigiLSIpOwogICAgfQogICAgcHJpbnRmKCJdICUuMWYlJVxuIiwgKGRvdWJsZSllZGdlX3Bhc3NlZCAvIGVkZ2VfdG90YWwgKiAxMDApOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlICYmIChjbGlfcGFzc2VkIDwgY2xpX3RvdGFsIHx8IHNlY3VyaXR5X3Bhc3NlZCA8IHNlY3VyaXR5X3RvdGFsIHx8IAogICAgICAgICAgICAgICAgICAgICAgICBpbnRlZ3JpdHlfcGFzc2VkIDwgaW50ZWdyaXR5X3RvdGFsIHx8IGVkZ2VfcGFzc2VkIDwgZWRnZV90b3RhbCkpIHsKICAgICAgICBwcmludGYoIlxuIiBZRUxMT1cgIiAgW1ZFUkJPU0VdIENoZWNrIHZlcmJvc2UgbG9ncyBhYm92ZSBmb3IgZGV0YWlsZWQgZmFpbHVyZSBhbmFseXNpc1xuIiBSRVNFVCk7CiAgICB9CiAgICAKICAgIHByaW50ZigiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuIik7Cn0KCnZvaWQgcHJpbnRfdXNhZ2UoY29uc3QgY2hhciAqcHJvZ3JhbV9uYW1lKSB7CiAgICBwcmludGYoIlVzYWdlOiAlcyBbT1BUSU9OU11cbiIsIHByb2dyYW1fbmFtZSk7CiAgICBwcmludGYoIk9wdGlvbnM6XG4iKTsKICAgIHByaW50ZigiICAtLWNsaSAgICAgICAgICAgVXNlIGdsb2JhbCAnc3lkYicgY29tbWFuZCBpbnN0ZWFkIG9mICcuL3N5ZGInXG4iKTsKICAgIHByaW50ZigiICAtLXNlcnZlciAgICAgICAgVGVzdCBIVFRQIEFQSSBlbmRwb2ludHMgKHJlcXVpcmVzIHJ1bm5pbmcgc2VydmVyKVxuIik7CiAgICBwcmludGYoIiAgLS11cmwgVVJMICAgICAgIFNwZWNpZnkgc2VydmVyIFVSTCAoZGVmYXVsdDogaHR0cDovL2xvY2FsaG9zdDo4MDgwKVxuIik7CiAgICBwcmludGYoIiAgLS12ZXJib3NlICAgICAgIEVuYWJsZSBleHRyZW1lbHkgZGV0YWlsZWQgbG9nZ2luZyBmb3IgdGVzdCBmYWlsdXJlc1xuIik7CiAgICBwcmludGYoIiAgLS1oZWxwLCAtaCAgICAgIFNob3cgdGhpcyBoZWxwIG1lc3NhZ2VcbiIpOwogICAgcHJpbnRmKCJcbkV4YW1wbGVzOlxuIik7CiAgICBwcmludGYoIiAgJXMgICAgICAgICAgICAgICAgICAgICAgIyBDTEkgdGVzdHMgd2l0aCAuL3N5ZGJcbiIsIHByb2dyYW1fbmFtZSk7CiAgICBwcmludGYoIiAgJXMgLS1jbGkgICAgICAgICAgICAgICAgIyBDTEkgdGVzdHMgd2l0aCBnbG9iYWwgJ3N5ZGInXG4iLCBwcm9ncmFtX25hbWUpOwogICAgcHJpbnRmKCIgICVzIC0tc2VydmVyICAgICAgICAgICAgICMgSFRUUCBBUEkgdGVzdHNcbiIsIHByb2dyYW1fbmFtZSk7CiAgICBwcmludGYoIiAgJXMgLS1zZXJ2ZXIgLS11cmwgaHR0cDovL2xvY2FsaG9zdDo4MDgwICAjIEN1c3RvbSBzZXJ2ZXIgVVJMXG4iLCBwcm9ncmFtX25hbWUpOwogICAgcHJpbnRmKCIgICVzIC0tdmVyYm9zZSAgICAgICAgICAgICMgQ0xJIHRlc3RzIHdpdGggZGV0YWlsZWQgZmFpbHVyZSBsb2dnaW5nXG4iLCBwcm9ncmFtX25hbWUpOwogICAgcHJpbnRmKCIgICVzIC0tc2VydmVyIC0tdmVyYm9zZSAgICMgSFRUUCB0ZXN0cyB3aXRoIGRldGFpbGVkIGZhaWx1cmUgbG9nZ2luZ1xuIiwgcHJvZ3JhbV9uYW1lKTsKfQoKaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkgewogICAgZm9yIChpbnQgaSA9IDE7IGkgPCBhcmdjOyBpKyspIHsKICAgICAgICBpZiAoc3RyY21wKGFyZ3ZbaV0sICItLWNsaSIpID09IDApIHsKICAgICAgICAgICAgc3RyY3B5KGNsaV9jb21tYW5kLCAic3lkYiIpOwogICAgICAgIH0gZWxzZSBpZiAoc3RyY21wKGFyZ3ZbaV0sICItLXNlcnZlciIpID09IDApIHsKICAgICAgICAgICAgdGVzdF9tb2RlID0gMTsKICAgICAgICB9IGVsc2UgaWYgKHN0cmNtcChhcmd2W2ldLCAiLS11cmwiKSA9PSAwICYmIGkgKyAxIDwgYXJnYykgewogICAgICAgICAgICBzdHJuY3B5KHNlcnZlcl91cmwsIGFyZ3ZbKytpXSwgc2l6ZW9mKHNlcnZlcl91cmwpIC0gMSk7CiAgICAgICAgfSBlbHNlIGlmIChzdHJjbXAoYXJndltpXSwgIi0tdmVyYm9zZSIpID09IDApIHsKICAgICAgICAgICAgdmVyYm9zZV9tb2RlID0gMTsKICAgICAgICAgICAgcHJpbnRmKFlFTExPVyAiVmVyYm9zZSBtb2RlIGVuYWJsZWQgLSBkZXRhaWxlZCBmYWlsdXJlIGxvZ2dpbmcgYWN0aXZhdGVkXG4iIFJFU0VUKTsKICAgICAgICB9IGVsc2UgaWYgKHN0cmNtcChhcmd2W2ldLCAiLS1oZWxwIikgPT0gMCB8fCBzdHJjbXAoYXJndltpXSwgIi1oIikgPT0gMCkgewogICAgICAgICAgICBwcmludF91c2FnZShhcmd2WzBdKTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZnByaW50ZihzdGRlcnIsIFJFRCAiVW5rbm93biBvcHRpb246ICVzXG4iIFJFU0VULCBhcmd2W2ldKTsKICAgICAgICAgICAgcHJpbnRfdXNhZ2UoYXJndlswXSk7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KICAgIH0KICAgIAogICAgc2V0ZW52KCJTWURCX0JBU0VfRElSIiwgIi90bXAvc3lkYl90ZXN0IiwgMSk7CiAgICAKICAgIGxvbmcgbG9uZyBzdGFydF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgCiAgICBpZiAodGVzdF9tb2RlID09IDEpIHsKICAgICAgICBjbGVhbnVwX3Rlc3RfZGF0YWJhc2VzKCk7CiAgICAgICAgcHJpbnRmKENZQU4gIlNZREIgSFRUUCBBUEkgQ09NUFJFSEVOU0lWRSBURVNUIFNVSVRFXG4iIFJFU0VUKTsKICAgICAgICBwcmludGYoIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iKTsKICAgICAgICBwcmludGYoIlRlc3Rpbmcgc2VydmVyOiAiIFlFTExPVyAiJXMiIFJFU0VUICJcbiIsIHNlcnZlcl91cmwpOwogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKCJWZXJib3NlIG1vZGU6ICIgWUVMTE9XICJFTkFCTEVEIiBSRVNFVCAiIC0gRGV0YWlsZWQgSFRUUCBsb2dnaW5nXG4iKTsKICAgICAgICB9CiAgICAgICAgcHJpbnRmKCJcbiIpOwogICAgICAgIAogICAgICAgIHByaW50ZigiVGVzdGluZyBzZXJ2ZXIgY29ubmVjdGl2aXR5Li4uXG4iKTsKICAgICAgICBIdHRwUmVzcG9uc2UqIHRlc3RfcmVzcG9uc2UgPSBodHRwX3JlcXVlc3QoIkdFVCIsICIvYXBpL2RhdGFiYXNlcyIsIE5VTEwsIE5VTEwpOwogICAgICAgIGlmICghdGVzdF9yZXNwb25zZSB8fCB0ZXN0X3Jlc3BvbnNlLT5zdGF0dXNfY29kZSA9PSAwKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIkVycm9yOiBDYW5ub3QgY29ubmVjdCB0byBzZXJ2ZXIgYXQgJXNcbiIgUkVTRVQsIHNlcnZlcl91cmwpOwogICAgICAgICAgICBwcmludGYoIk1ha2Ugc3VyZSB0aGUgU1lEQiBzZXJ2ZXIgaXMgcnVubmluZyB3aXRoOiAuL3N5ZGIgLS1zZXJ2ZXJcbiIpOwogICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBTZXJ2ZXIgY29ubmVjdGl2aXR5IHRlc3QgZmFpbGVkXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIGlmICh0ZXN0X3Jlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gUmVzcG9uc2Ugc3RhdHVzOiAlZFxuIiBSRVNFVCwgdGVzdF9yZXNwb25zZS0+c3RhdHVzX2NvZGUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBObyByZXNwb25zZSByZWNlaXZlZFxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKHRlc3RfcmVzcG9uc2UpOwogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CiAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKHRlc3RfcmVzcG9uc2UpOwogICAgICAgIHByaW50ZihHUkVFTiAiU2VydmVyIGlzIHJlc3BvbnNpdmUsIHN0YXJ0aW5nIHRlc3RzLi4uXG5cbiIgUkVTRVQpOwogICAgICAgIAogICAgICAgIGludCBkYl9wYXNzZWQgPSBydW5faHR0cF9kYXRhYmFzZV90ZXN0cygpOwogICAgICAgIGludCBkYl90b3RhbCA9IDU7CiAgICAgICAgCiAgICAgICAgaW50IGNvbGxfcGFzc2VkID0gcnVuX2h0dHBfY29sbGVjdGlvbl90ZXN0cygpOwogICAgICAgIGludCBjb2xsX3RvdGFsID0gNjsKICAgICAgICAKICAgICAgICBpbnQgaW5zdF9wYXNzZWQgPSBydW5faHR0cF9pbnN0YW5jZV90ZXN0cygpOwogICAgICAgIGludCBpbnN0X3RvdGFsID0gNzsKICAgICAgICAKICAgICAgICBpbnQgY21kX3Bhc3NlZCA9IHJ1bl9odHRwX2NvbW1hbmRfdGVzdHMoKTsKICAgICAgICBpbnQgY21kX3RvdGFsID0gMTsKICAgICAgICAKICAgICAgICBpbnQgZXJyX3Bhc3NlZCA9IHJ1bl9odHRwX2Vycm9yX3Rlc3RzKCk7CiAgICAgICAgaW50IGVycl90b3RhbCA9IDU7CiAgICAgICAgCiAgICAgICAgbG9uZyBsb25nIHRvdGFsX3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCkgLSBzdGFydF90aW1lOwogICAgICAgIAogICAgICAgIHByaW50X2h0dHBfcmVzdWx0cyhkYl9wYXNzZWQsIGRiX3RvdGFsLCBjb2xsX3Bhc3NlZCwgY29sbF90b3RhbCwgaW5zdF9wYXNzZWQsIGluc3RfdG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY21kX3Bhc3NlZCwgY21kX3RvdGFsLCBlcnJfcGFzc2VkLCBlcnJfdG90YWwsIHRvdGFsX3RpbWUpOwogICAgICAgIAogICAgICAgIGludCB0b3RhbF9wYXNzZWQgPSBkYl9wYXNzZWQgKyBjb2xsX3Bhc3NlZCArIGluc3RfcGFzc2VkICsgY21kX3Bhc3NlZCArIGVycl9wYXNzZWQ7CiAgICAgICAgaW50IHRvdGFsX3Rlc3RzID0gZGJfdG90YWwgKyBjb2xsX3RvdGFsICsgaW5zdF90b3RhbCArIGNtZF90b3RhbCArIGVycl90b3RhbDsKICAgICAgICBpbnQgb3ZlcmFsbF9zdWNjZXNzID0gKHRvdGFsX3Bhc3NlZCA+PSB0b3RhbF90ZXN0cyAqIDAuOCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIG92ZXJhbGxfc3VjY2VzcyA/IDAgOiAxOwogICAgfSBlbHNlIHsKICAgICAgICBpbnQgY2xpX3Bhc3NlZCA9IHJ1bl9jbGlfdGVzdHMoKTsKICAgICAgICBpbnQgY2xpX3RvdGFsID0gMTU7CiAgICAgICAgCiAgICAgICAgcnVuX3NlY3VyaXR5X3Rlc3RzKCk7CiAgICAgICAgcnVuX2RhdGFfaW50ZWdyaXR5X3Rlc3RzKCk7IAogICAgICAgIHJ1bl9lZGdlX2Nhc2VfdGVzdHMoKTsKICAgICAgICBydW5fcGVyZm9ybWFuY2VfdGVzdCgpOwogICAgICAgIHJ1bl9jb21wcmVoZW5zaXZlX3ZlcmlmaWNhdGlvbigpOwogICAgICAgIAogICAgICAgIGxvbmcgbG9uZyB0b3RhbF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnRfdGltZTsKICAgICAgICAKICAgICAgICBpbnQgc2VjdXJpdHlfcGFzc2VkID0gMzsKICAgICAgICBpbnQgc2VjdXJpdHlfdG90YWwgPSAzOwogICAgICAgIGludCBpbnRlZ3JpdHlfcGFzc2VkID0gMjsgCiAgICAgICAgaW50IGludGVncml0eV90b3RhbCA9IDI7CiAgICAgICAgaW50IGVkZ2VfcGFzc2VkID0gNjsKICAgICAgICBpbnQgZWRnZV90b3RhbCA9IDY7CiAgICAgICAgCiAgICAgICAgcHJpbnRfY2xpX3Jlc3VsdHMoY2xpX3Bhc3NlZCwgY2xpX3RvdGFsLCB0b3RhbF90aW1lLCAKICAgICAgICAgICAgICAgICAgICAgICAgIHNlY3VyaXR5X3Bhc3NlZCwgc2VjdXJpdHlfdG90YWwsIGludGVncml0eV9wYXNzZWQsIGludGVncml0eV90b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgIGVkZ2VfcGFzc2VkLCBlZGdlX3RvdGFsKTsKICAgICAgICAKICAgICAgICBpbnQgb3ZlcmFsbF9zdWNjZXNzID0gKGNsaV9wYXNzZWQgPT0gY2xpX3RvdGFsKSAmJiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2VjdXJpdHlfcGFzc2VkID09IHNlY3VyaXR5X3RvdGFsKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpbnRlZ3JpdHlfcGFzc2VkID49IGludGVncml0eV90b3RhbCAtIDEpOwogICAgICAgIAogICAgICAgIHJldHVybiBvdmVyYWxsX3N1Y2Nlc3MgPyAwIDogMTsKICAgIH0KfQ==`;
        const fileContent = Buffer.from(base64Content, 'base64');
        
        fs.writeFileSync(outputFile, fileContent);
        const stats = fs.statSync(outputFile);
        
        console.log(` Successfully extracted: ${outputFile}`);
        console.log(`   Size: ${stats.size} bytes`);
        
        // Verify it's a C file
        const firstLines = fs.readFileSync(outputFile, 'utf8', 0, 200);
        if (firstLines.includes('#include') || /^\s*int\s+main/.test(firstLines)) {
            console.log(`   Verified: Valid C source code`);
        }
        
        console.log(`\n Next steps:`);
        console.log(`   Compile: gcc ${outputFile} -o program`);
        console.log(`   Execute: ./program`);
        
    } catch (error) {
        console.error(` Extraction failed: ${error.message}`);
        process.exit(1);
    }
}

// Run extraction
extractCFile().catch(console.error);
