#!/usr/bin/env node

import fs from 'fs';
import { Buffer } from 'buffer';
import { fileURLToPath } from 'url';
import path from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

async function extractCFile() {
    const scriptName = path.basename(__filename);
    const outputFile = scriptName.replace(/\.js$/, '.c');
    
    if (fs.existsSync(outputFile)) {
        console.log(`Overwriting: ${outputFile}`);
    }
    
    try {
        // Base64 encoded C file content
        const base64Content = `I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4KI2luY2x1ZGUgPHN0cmluZy5oPgojaW5jbHVkZSA8dW5pc3RkLmg+CiNpbmNsdWRlIDxzeXMvdGltZS5oPgojaW5jbHVkZSA8dGltZS5oPgojaW5jbHVkZSA8ZGlyZW50Lmg+CiNpbmNsdWRlIDxzeXMvc3RhdC5oPgojaW5jbHVkZSA8ZmNudGwuaD4KI2luY2x1ZGUgPHN5cy9zb2NrZXQuaD4KI2luY2x1ZGUgPG5ldGluZXQvaW4uaD4KI2luY2x1ZGUgPGFycGEvaW5ldC5oPgojaW5jbHVkZSA8bmV0ZGIuaD4KI2luY2x1ZGUgPGVycm5vLmg+CgojZGVmaW5lIFJFRCAgICAgIlwwMzNbMTszMW0iCiNkZWZpbmUgR1JFRU4gICAiXDAzM1sxOzMybSIKI2RlZmluZSBZRUxMT1cgICJcMDMzWzE7MzNtIgojZGVmaW5lIEJMVUUgICAgIlwwMzNbMTszNG0iCiNkZWZpbmUgTUFHRU5UQSAiXDAzM1sxOzM1bSIKI2RlZmluZSBDWUFOICAgICJcMDMzWzE7MzZtIgojZGVmaW5lIFJFU0VUICAgIlwwMzNbMG0iCgp0eXBlZGVmIHN0cnVjdCB7CiAgICBjaGFyIGRlc2NyaXB0aW9uWzUxMl07CiAgICBjaGFyIGNvbW1hbmRbMTAyNF07CiAgICBjaGFyIHZlcmlmaWNhdGlvbl9jb21tYW5kWzEwMjRdOwogICAgY2hhciBleHBlY3RlZF9vdXRwdXRbMTAyNF07CiAgICBpbnQgc3VjY2VzczsKICAgIGludCB2ZXJpZmljYXRpb25fc3VjY2VzczsKICAgIGxvbmcgbG9uZyBkdXJhdGlvbl9tczsKICAgIGNoYXIgZGV0YWlsc1sxMDI0XTsKICAgIGNoYXIgdmVyYm9zZV9vdXRwdXRbNDA5Nl07Cn0gVGVzdENhc2U7CgovLyBHbG9iYWwgdmFyaWFibGVzCmNoYXIgY2xpX2NvbW1hbmRbMzJdID0gIi4vc3lkYiI7CmludCB0ZXN0X21vZGUgPSAwOyAvLyAwID0gQ0xJLCAxID0gSFRUUApjaGFyIHNlcnZlcl91cmxbMjU2XSA9ICJodHRwOi8vbG9jYWxob3N0OjgwODAiOwppbnQgdmVyYm9zZV9tb2RlID0gMDsgLy8gMCA9IG5vcm1hbCwgMSA9IHZlcmJvc2UgbG9nZ2luZwoKLy8gSFRUUCBSZXF1ZXN0L1Jlc3BvbnNlIHN0cnVjdHVyZXMKdHlwZWRlZiBzdHJ1Y3QgewogICAgaW50IHN0YXR1c19jb2RlOwogICAgY2hhciogYm9keTsKICAgIHNpemVfdCBib2R5X2xlbmd0aDsKfSBIdHRwUmVzcG9uc2U7CgovLyBGdW5jdGlvbiBwcm90b3R5cGVzIGZvciBIVFRQIHRlc3RpbmcKSHR0cFJlc3BvbnNlKiBodHRwX3JlcXVlc3QoY29uc3QgY2hhciogbWV0aG9kLCBjb25zdCBjaGFyKiB1cmwsIGNvbnN0IGNoYXIqIGJvZHksIGNvbnN0IGNoYXIqIGNvbnRlbnRfdHlwZSk7CnZvaWQgaHR0cF9yZXNwb25zZV9mcmVlKEh0dHBSZXNwb25zZSogcmVzcG9uc2UpOwppbnQgaHR0cF90ZXN0X2VuZHBvaW50KGNvbnN0IGNoYXIqIGRlc2NyaXB0aW9uLCBjb25zdCBjaGFyKiBtZXRob2QsIGNvbnN0IGNoYXIqIGVuZHBvaW50LCAKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIqIGJvZHksIGNvbnN0IGNoYXIqIGV4cGVjdGVkX3BhdHRlcm4sIGludCBjaGVja19zdWNjZXNzX29ubHksIGxvbmcgbG9uZyogZHVyYXRpb24pOwppbnQgdmVyaWZ5X2h0dHBfcmVzcG9uc2UoY29uc3QgSHR0cFJlc3BvbnNlKiByZXNwb25zZSwgY29uc3QgY2hhciogZXhwZWN0ZWRfcGF0dGVybiwgaW50IGNoZWNrX3N1Y2Nlc3Nfb25seSk7CmNoYXIqIGV4dHJhY3RfanNvbl9maWVsZChjb25zdCBjaGFyKiBqc29uLCBjb25zdCBjaGFyKiBmaWVsZCk7CgovLyBVdGlsaXR5IGZ1bmN0aW9uIHByb3RvdHlwZXMKbG9uZyBsb25nIGdldF9jdXJyZW50X3RpbWVfbXMoKTsKaW50IGZpbGVfZXhpc3RzKGNvbnN0IGNoYXIgKnBhdGgpOwppbnQgY291bnRfZmlsZXNfaW5fZGlyZWN0b3J5KGNvbnN0IGNoYXIgKnBhdGgpOwppbnQgY291bnRfaW5zdGFuY2VzX2luX2NvbGxlY3Rpb24oY29uc3QgY2hhciAqZGF0YWJhc2UsIGNvbnN0IGNoYXIgKmNvbGxlY3Rpb24pOwpjaGFyKiBnZXRfbGFzdF9pbnNlcnRlZF9pZChjb25zdCBjaGFyICpkYXRhYmFzZSwgY29uc3QgY2hhciAqY29sbGVjdGlvbik7CmludCBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmUoY29uc3QgY2hhciAqY29tbWFuZCwgY2hhciAqb3V0cHV0LCBzaXplX3Qgb3V0cHV0X3NpemUpOwppbnQgZXhlY3V0ZV9jb21tYW5kX2FuZF9jYXB0dXJlX3ZlcmJvc2UoY29uc3QgY2hhciAqY29tbWFuZCwgY2hhciAqb3V0cHV0LCBzaXplX3Qgb3V0cHV0X3NpemUsIGNoYXIgKnZlcmJvc2Vfb3V0cHV0LCBzaXplX3QgdmVyYm9zZV9zaXplKTsKaW50IHZlcmlmeV9kYXRhYmFzZV9zdHJ1Y3R1cmUoY29uc3QgY2hhciAqZGF0YWJhc2UpOwppbnQgdmVyaWZ5X2NvbGxlY3Rpb25fc3RydWN0dXJlKGNvbnN0IGNoYXIgKmRhdGFiYXNlLCBjb25zdCBjaGFyICpjb2xsZWN0aW9uKTsKaW50IHZlcmlmeV9zY2hlbWFfY29udGVudChjb25zdCBjaGFyICpkYXRhYmFzZSwgY29uc3QgY2hhciAqY29sbGVjdGlvbiwgY29uc3QgY2hhciAqZXhwZWN0ZWRfZmllbGRzKTsKaW50IGV4ZWN1dGVfdGVzdF93aXRoX3ZlcmlmaWNhdGlvbihUZXN0Q2FzZSAqdGVzdCk7CnZvaWQgcnVuX3NlY3VyaXR5X3Rlc3RzKCk7CnZvaWQgcnVuX2RhdGFfaW50ZWdyaXR5X3Rlc3RzKCk7CnZvaWQgcnVuX3BlcmZvcm1hbmNlX3Rlc3QoKTsKdm9pZCBydW5fZWRnZV9jYXNlX3Rlc3RzKCk7CnZvaWQgcnVuX2NvbXByZWhlbnNpdmVfdmVyaWZpY2F0aW9uKCk7CgovLyA9PT09PT09PT09PT09PT09PT09PSBVVElMSVRZIEZVTkNUSU9OUyA9PT09PT09PT09PT09PT09PT09PQoKbG9uZyBsb25nIGdldF9jdXJyZW50X3RpbWVfbXMoKSB7CiAgICBzdHJ1Y3QgdGltZXZhbCB0djsKICAgIGdldHRpbWVvZmRheSgmdHYsIE5VTEwpOwogICAgcmV0dXJuIChsb25nIGxvbmcpdHYudHZfc2VjICogMTAwMCArIHR2LnR2X3VzZWMgLyAxMDAwOwp9CgppbnQgZmlsZV9leGlzdHMoY29uc3QgY2hhciAqcGF0aCkgewogICAgc3RydWN0IHN0YXQgc3Q7CiAgICByZXR1cm4gc3RhdChwYXRoLCAmc3QpID09IDA7Cn0KCmludCBjb3VudF9maWxlc19pbl9kaXJlY3RvcnkoY29uc3QgY2hhciAqcGF0aCkgewogICAgRElSICpkaXIgPSBvcGVuZGlyKHBhdGgpOwogICAgaWYgKCFkaXIpIHJldHVybiAtMTsKICAgIAogICAgaW50IGNvdW50ID0gMDsKICAgIHN0cnVjdCBkaXJlbnQgKmVudHJ5OwogICAgd2hpbGUgKChlbnRyeSA9IHJlYWRkaXIoZGlyKSkgIT0gTlVMTCkgewogICAgICAgIGlmIChzdHJjbXAoZW50cnktPmRfbmFtZSwgIi4iKSAhPSAwICYmIHN0cmNtcChlbnRyeS0+ZF9uYW1lLCAiLi4iKSAhPSAwKSB7CiAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgfQogICAgfQogICAgY2xvc2VkaXIoZGlyKTsKICAgIHJldHVybiBjb3VudDsKfQoKaW50IGNvdW50X2luc3RhbmNlc19pbl9jb2xsZWN0aW9uKGNvbnN0IGNoYXIgKmRhdGFiYXNlLCBjb25zdCBjaGFyICpjb2xsZWN0aW9uKSB7CiAgICBjaGFyIGNvbW1hbmRbNTEyXTsKICAgIHNucHJpbnRmKGNvbW1hbmQsIHNpemVvZihjb21tYW5kKSwgIiVzIGxpc3QgJXMgJXMgMj4vZGV2L251bGwgfCB3YyAtbCIsIGNsaV9jb21tYW5kLCBkYXRhYmFzZSwgY29sbGVjdGlvbik7CiAgICAKICAgIEZJTEUgKmZwID0gcG9wZW4oY29tbWFuZCwgInIiKTsKICAgIGlmICghZnApIHJldHVybiAtMTsKICAgIAogICAgaW50IGNvdW50ID0gMDsKICAgIGNoYXIgYnVmZmVyWzY0XTsKICAgIGlmIChmZ2V0cyhidWZmZXIsIHNpemVvZihidWZmZXIpLCBmcCkpIHsKICAgICAgICBjb3VudCA9IGF0b2koYnVmZmVyKTsKICAgIH0KICAgIHBjbG9zZShmcCk7CiAgICAKICAgIHJldHVybiBjb3VudDsKfQoKY2hhciogZ2V0X2xhc3RfaW5zZXJ0ZWRfaWQoY29uc3QgY2hhciAqZGF0YWJhc2UsIGNvbnN0IGNoYXIgKmNvbGxlY3Rpb24pIHsKICAgIGNoYXIgY29tbWFuZFs1MTJdOwogICAgc25wcmludGYoY29tbWFuZCwgc2l6ZW9mKGNvbW1hbmQpLCAiJXMgbGlzdCAlcyAlcyAyPi9kZXYvbnVsbCB8IHRhaWwgLTEiLCBjbGlfY29tbWFuZCwgZGF0YWJhc2UsIGNvbGxlY3Rpb24pOwogICAgCiAgICBGSUxFICpmcCA9IHBvcGVuKGNvbW1hbmQsICJyIik7CiAgICBpZiAoIWZwKSByZXR1cm4gTlVMTDsKICAgIAogICAgc3RhdGljIGNoYXIgaWRbNjRdOwogICAgaWYgKGZnZXRzKGlkLCBzaXplb2YoaWQpLCBmcCkpIHsKICAgICAgICAvLyBFeHRyYWN0IElEIGZyb20gSlNPTgogICAgICAgIGNoYXIgKmlkX3N0YXJ0ID0gc3Ryc3RyKGlkLCAiXCJfaWRcIjpcIiIpOwogICAgICAgIGlmIChpZF9zdGFydCkgewogICAgICAgICAgICBpZF9zdGFydCArPSA3OwogICAgICAgICAgICBjaGFyICppZF9lbmQgPSBzdHJjaHIoaWRfc3RhcnQsICciJyk7CiAgICAgICAgICAgIGlmIChpZF9lbmQpIHsKICAgICAgICAgICAgICAgICppZF9lbmQgPSAnXDAnOwogICAgICAgICAgICAgICAgc3RybmNweShpZCwgaWRfc3RhcnQsIHNpemVvZihpZCkgLSAxKTsKICAgICAgICAgICAgICAgIHBjbG9zZShmcCk7CiAgICAgICAgICAgICAgICByZXR1cm4gaWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBwY2xvc2UoZnApOwogICAgcmV0dXJuIE5VTEw7Cn0KCmludCBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmUoY29uc3QgY2hhciAqY29tbWFuZCwgY2hhciAqb3V0cHV0LCBzaXplX3Qgb3V0cHV0X3NpemUpIHsKICAgIEZJTEUgKmZwID0gcG9wZW4oY29tbWFuZCwgInIiKTsKICAgIGlmICghZnApIHJldHVybiAtMTsKICAgIAogICAgb3V0cHV0WzBdID0gJ1wwJzsKICAgIGlmIChmZ2V0cyhvdXRwdXQsIG91dHB1dF9zaXplLCBmcCkpIHsKICAgICAgICAvLyBSZW1vdmUgbmV3bGluZQogICAgICAgIG91dHB1dFtzdHJjc3BuKG91dHB1dCwgIlxuIildID0gJ1wwJzsKICAgIH0KICAgIHBjbG9zZShmcCk7CiAgICByZXR1cm4gMDsKfQoKaW50IGV4ZWN1dGVfY29tbWFuZF9hbmRfY2FwdHVyZV92ZXJib3NlKGNvbnN0IGNoYXIgKmNvbW1hbmQsIGNoYXIgKm91dHB1dCwgc2l6ZV90IG91dHB1dF9zaXplLCBjaGFyICp2ZXJib3NlX291dHB1dCwgc2l6ZV90IHZlcmJvc2Vfc2l6ZSkgewogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIEV4ZWN1dGluZyBjb21tYW5kOiAlc1xuIiBSRVNFVCwgY29tbWFuZCk7CiAgICB9CiAgICAKICAgIEZJTEUgKmZwID0gcG9wZW4oY29tbWFuZCwgInIiKTsKICAgIGlmICghZnApIHsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEZhaWxlZCB0byBleGVjdXRlIGNvbW1hbmQ6IHBvcGVuIHJldHVybmVkIE5VTExcbiIgUkVTRVQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gLTE7CiAgICB9CiAgICAKICAgIG91dHB1dFswXSA9ICdcMCc7CiAgICB2ZXJib3NlX291dHB1dFswXSA9ICdcMCc7CiAgICAKICAgIGNoYXIgYnVmZmVyWzEwMjRdOwogICAgc2l6ZV90IHRvdGFsX3ZlcmJvc2Vfc2l6ZSA9IDA7CiAgICAKICAgIHdoaWxlIChmZ2V0cyhidWZmZXIsIHNpemVvZihidWZmZXIpLCBmcCkpIHsKICAgICAgICAvLyBSZW1vdmUgbmV3bGluZSBmb3Igb3V0cHV0CiAgICAgICAgYnVmZmVyW3N0cmNzcG4oYnVmZmVyLCAiXG4iKV0gPSAnXDAnOwogICAgICAgIAogICAgICAgIC8vIFN0b3JlIGZpcnN0IGxpbmUgaW4gb3V0cHV0CiAgICAgICAgaWYgKG91dHB1dFswXSA9PSAnXDAnKSB7CiAgICAgICAgICAgIHN0cm5jcHkob3V0cHV0LCBidWZmZXIsIG91dHB1dF9zaXplIC0gMSk7CiAgICAgICAgICAgIG91dHB1dFtvdXRwdXRfc2l6ZSAtIDFdID0gJ1wwJzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gQWNjdW11bGF0ZSBhbGwgb3V0cHV0IGZvciB2ZXJib3NlCiAgICAgICAgaWYgKHRvdGFsX3ZlcmJvc2Vfc2l6ZSArIHN0cmxlbihidWZmZXIpIDwgdmVyYm9zZV9zaXplIC0gMSkgewogICAgICAgICAgICBzdHJjYXQodmVyYm9zZV9vdXRwdXQsIGJ1ZmZlcik7CiAgICAgICAgICAgIHN0cmNhdCh2ZXJib3NlX291dHB1dCwgIlxuIik7CiAgICAgICAgICAgIHRvdGFsX3ZlcmJvc2Vfc2l6ZSArPSBzdHJsZW4oYnVmZmVyKSArIDE7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpbnQgc3RhdHVzID0gcGNsb3NlKGZwKTsKICAgIAogICAgLy8gRm9yIHZlcmlmaWNhdGlvbiBjb21tYW5kcyB3aXRoIGdyZXAsIHdlIG5lZWQgdG8gaGFuZGxlIGV4aXQgc3RhdHVzIGRpZmZlcmVudGx5CiAgICAvLyBncmVwIHJldHVybnMgMCBpZiBwYXR0ZXJuIGZvdW5kLCAxIGlmIG5vdCBmb3VuZCwgMiBvbiBlcnJvcgogICAgLy8gV2Ugc2hvdWxkIG9ubHkgcmV0dXJuIGZhaWx1cmUgb24gYWN0dWFsIGNvbW1hbmQgZXhlY3V0aW9uIGVycm9ycywgbm90IG9uIGdyZXAgIm5vdCBmb3VuZCIKICAgIGludCByZXN1bHQ7CiAgICBpZiAoV0lGRVhJVEVEKHN0YXR1cykpIHsKICAgICAgICBpbnQgZXhpdF9jb2RlID0gV0VYSVRTVEFUVVMoc3RhdHVzKTsKICAgICAgICAvLyBJZiB0aGUgY29tbWFuZCBjb250YWlucyBncmVwLCB0cmVhdCBleGl0IGNvZGUgMSBhcyBzdWNjZXNzIChwYXR0ZXJuIG5vdCBmb3VuZCBpcyBub3JtYWwpCiAgICAgICAgaWYgKHN0cnN0cihjb21tYW5kLCAiZ3JlcCIpICE9IE5VTEwpIHsKICAgICAgICAgICAgcmVzdWx0ID0gKGV4aXRfY29kZSA9PSAwIHx8IGV4aXRfY29kZSA9PSAxKSA/IDAgOiAtMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgPSAoZXhpdF9jb2RlID09IDApID8gMCA6IC0xOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0ID0gLTE7IC8vIENvbW1hbmQgZGlkbid0IGV4aXQgbm9ybWFsbHkKICAgIH0KICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIENvbW1hbmQgZXhpdCBzdGF0dXM6ICVkIChyYXc6ICVkKVxuIiBSRVNFVCwgcmVzdWx0LCBzdGF0dXMpOwogICAgICAgIGlmICh2ZXJib3NlX291dHB1dFswXSAhPSAnXDAnKSB7CiAgICAgICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIENvbW1hbmQgb3V0cHV0OlxuJXNcbiIgUkVTRVQsIHZlcmJvc2Vfb3V0cHV0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBDb21tYW5kIG91dHB1dDogKGVtcHR5KVxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICByZXR1cm4gcmVzdWx0Owp9CgppbnQgdmVyaWZ5X2RhdGFiYXNlX3N0cnVjdHVyZShjb25zdCBjaGFyICpkYXRhYmFzZSkgewogICAgY2hhciBwYXRoWzUxMl07CiAgICBzbnByaW50ZihwYXRoLCBzaXplb2YocGF0aCksICIvdG1wL3N5ZGJfdGVzdC8lcyIsIGRhdGFiYXNlKTsKICAgIAogICAgaWYgKCFmaWxlX2V4aXN0cyhwYXRoKSkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gRGF0YWJhc2UgZGlyZWN0b3J5IGRvZXNuJ3QgZXhpc3Q6ICVzXG4iIFJFU0VULCBwYXRoKTsKICAgICAgICB9CiAgICAgICAgcHJpbnRmKFJFRCAiICDinJcgRGF0YWJhc2UgZGlyZWN0b3J5IGRvZXNuJ3QgZXhpc3RcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgCiAgICBzdHJ1Y3Qgc3RhdCBzdDsKICAgIGlmIChzdGF0KHBhdGgsICZzdCkgIT0gMCB8fCAhU19JU0RJUihzdC5zdF9tb2RlKSkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gRGF0YWJhc2UgcGF0aCBpcyBub3QgYSBkaXJlY3Rvcnkgb3Igc3RhdCBmYWlsZWQ6ICVzXG4iIFJFU0VULCBwYXRoKTsKICAgICAgICB9CiAgICAgICAgcHJpbnRmKFJFRCAiICDinJcgRGF0YWJhc2UgcGF0aCBpcyBub3QgYSBkaXJlY3RvcnlcbiIgUkVTRVQpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBEYXRhYmFzZSBkaXJlY3RvcnkgZXhpc3RzIGFuZCBpcyB2YWxpZDogJXNcbiIgUkVTRVQsIHBhdGgpOwogICAgfQogICAgcHJpbnRmKEdSRUVOICIgIOKckyBEYXRhYmFzZSBkaXJlY3RvcnkgZXhpc3RzIGFuZCBpcyB2YWxpZFxuIiBSRVNFVCk7CiAgICByZXR1cm4gMTsKfQoKaW50IHZlcmlmeV9jb2xsZWN0aW9uX3N0cnVjdHVyZShjb25zdCBjaGFyICpkYXRhYmFzZSwgY29uc3QgY2hhciAqY29sbGVjdGlvbikgewogICAgY2hhciBwYXRoWzUxMl07CiAgICBzbnByaW50ZihwYXRoLCBzaXplb2YocGF0aCksICIvdG1wL3N5ZGJfdGVzdC8lcy8lcyIsIGRhdGFiYXNlLCBjb2xsZWN0aW9uKTsKICAgIAogICAgaWYgKCFmaWxlX2V4aXN0cyhwYXRoKSkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gQ29sbGVjdGlvbiBkaXJlY3RvcnkgZG9lc24ndCBleGlzdDogJXNcbiIgUkVTRVQsIHBhdGgpOwogICAgICAgIH0KICAgICAgICBwcmludGYoUkVEICIgIOKclyBDb2xsZWN0aW9uIGRpcmVjdG9yeSBkb2Vzbid0IGV4aXN0XG4iIFJFU0VUKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgLy8gQ2hlY2sgZm9yIHNjaGVtYSBmaWxlCiAgICBjaGFyIHNjaGVtYV9wYXRoWzUxMl07CiAgICBzbnByaW50ZihzY2hlbWFfcGF0aCwgc2l6ZW9mKHNjaGVtYV9wYXRoKSwgIiVzL3NjaGVtYS50eHQiLCBwYXRoKTsKICAgIGlmICghZmlsZV9leGlzdHMoc2NoZW1hX3BhdGgpKSB7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBTY2hlbWEgZmlsZSBkb2Vzbid0IGV4aXN0OiAlc1xuIiBSRVNFVCwgc2NoZW1hX3BhdGgpOwogICAgICAgIH0KICAgICAgICBwcmludGYoUkVEICIgIOKclyBTY2hlbWEgZmlsZSBkb2Vzbid0IGV4aXN0XG4iIFJFU0VUKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgLy8gQ2hlY2sgZm9yIGRhdGEgZmlsZQogICAgY2hhciBkYXRhX3BhdGhbNTEyXTsKICAgIHNucHJpbnRmKGRhdGFfcGF0aCwgc2l6ZW9mKGRhdGFfcGF0aCksICIlcy9kYXRhLnN5ZGIiLCBwYXRoKTsKICAgIGlmICghZmlsZV9leGlzdHMoZGF0YV9wYXRoKSkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gRGF0YSBmaWxlIGRvZXNuJ3QgZXhpc3Q6ICVzXG4iIFJFU0VULCBkYXRhX3BhdGgpOwogICAgICAgIH0KICAgICAgICBwcmludGYoUkVEICIgIOKclyBEYXRhIGZpbGUgZG9lc24ndCBleGlzdFxuIiBSRVNFVCk7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdIENvbGxlY3Rpb24gc3RydWN0dXJlIGlzIHZhbGlkOiAlc1xuIiBSRVNFVCwgcGF0aCk7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gU2NoZW1hIGZpbGU6ICVzXG4iIFJFU0VULCBzY2hlbWFfcGF0aCk7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gRGF0YSBmaWxlOiAlc1xuIiBSRVNFVCwgZGF0YV9wYXRoKTsKICAgIH0KICAgIHByaW50ZihHUkVFTiAiICDinJMgQ29sbGVjdGlvbiBzdHJ1Y3R1cmUgaXMgdmFsaWRcbiIgUkVTRVQpOwogICAgcmV0dXJuIDE7Cn0KCmludCB2ZXJpZnlfc2NoZW1hX2NvbnRlbnQoY29uc3QgY2hhciAqZGF0YWJhc2UsIGNvbnN0IGNoYXIgKmNvbGxlY3Rpb24sIGNvbnN0IGNoYXIgKmV4cGVjdGVkX2ZpZWxkcykgewogICAgY2hhciBjb21tYW5kWzUxMl07CiAgICBzbnByaW50Zihjb21tYW5kLCBzaXplb2YoY29tbWFuZCksICIlcyBzY2hlbWEgJXMgJXMiLCBjbGlfY29tbWFuZCwgZGF0YWJhc2UsIGNvbGxlY3Rpb24pOwogICAgCiAgICBjaGFyIG91dHB1dFsxMDI0XTsKICAgIGNoYXIgdmVyYm9zZV9vdXRwdXRbNDA5Nl07CiAgICBpbnQgcmVzdWx0OwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcmVzdWx0ID0gZXhlY3V0ZV9jb21tYW5kX2FuZF9jYXB0dXJlX3ZlcmJvc2UoY29tbWFuZCwgb3V0cHV0LCBzaXplb2Yob3V0cHV0KSwgdmVyYm9zZV9vdXRwdXQsIHNpemVvZih2ZXJib3NlX291dHB1dCkpOwogICAgfSBlbHNlIHsKICAgICAgICByZXN1bHQgPSBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmUoY29tbWFuZCwgb3V0cHV0LCBzaXplb2Yob3V0cHV0KSk7CiAgICB9CiAgICAKICAgIGlmIChyZXN1bHQgIT0gMCkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gQ291bGQgbm90IHJlYWQgc2NoZW1hLCBjb21tYW5kIGZhaWxlZFxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgICAgIHByaW50ZihSRUQgIiAg4pyXIENvdWxkIG5vdCByZWFkIHNjaGVtYVxuIiBSRVNFVCk7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICAKICAgIC8vIEJhc2ljIHNjaGVtYSB2ZXJpZmljYXRpb24KICAgIGlmIChzdHJzdHIob3V0cHV0LCAiRmllbGQiKSA9PSBOVUxMIHx8IHN0cnN0cihvdXRwdXQsICJUeXBlIikgPT0gTlVMTCkgewogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gU2NoZW1hIG91dHB1dCBmb3JtYXQgaW5jb3JyZWN0XG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gT3V0cHV0IHJlY2VpdmVkOiAlc1xuIiBSRVNFVCwgb3V0cHV0KTsKICAgICAgICB9CiAgICAgICAgcHJpbnRmKFJFRCAiICDinJcgU2NoZW1hIG91dHB1dCBmb3JtYXQgaW5jb3JyZWN0XG4iIFJFU0VUKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihHUkVFTiAiICBbVkVSQk9TRV0gU2NoZW1hIGNvbnRlbnQgaXMgdmFsaWRcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFNjaGVtYSBvdXRwdXQ6XG4lc1xuIiBSRVNFVCwgb3V0cHV0KTsKICAgIH0KICAgIHByaW50ZihHUkVFTiAiICDinJMgU2NoZW1hIGNvbnRlbnQgaXMgdmFsaWRcbiIgUkVTRVQpOwogICAgcmV0dXJuIDE7Cn0KCmludCBleGVjdXRlX3Rlc3Rfd2l0aF92ZXJpZmljYXRpb24oVGVzdENhc2UgKnRlc3QpIHsKICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgdGVzdC0+ZGVzY3JpcHRpb24pOwogICAgZmZsdXNoKHN0ZG91dCk7CiAgICAKICAgIGxvbmcgbG9uZyBzdGFydF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgCiAgICAvLyBFeGVjdXRlIG1haW4gY29tbWFuZAogICAgaW50IHJlc3VsdCA9IHN5c3RlbSh0ZXN0LT5jb21tYW5kKTsKICAgIGxvbmcgbG9uZyBlbmRfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgdGVzdC0+ZHVyYXRpb25fbXMgPSBlbmRfdGltZSAtIHN0YXJ0X3RpbWU7CiAgICB0ZXN0LT5zdWNjZXNzID0gKHJlc3VsdCA9PSAwKTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIlxuICBbVkVSQk9TRV0gQ29tbWFuZDogJXNcbiIgUkVTRVQsIHRlc3QtPmNvbW1hbmQpOwogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIEV4aXQgY29kZTogJWRcbiIgUkVTRVQsIHJlc3VsdCk7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gRXhlY3V0aW9uIHRpbWU6ICVsbGQgbXNcbiIgUkVTRVQsIHRlc3QtPmR1cmF0aW9uX21zKTsKICAgIH0KICAgIAogICAgLy8gUGVyZm9ybSB2ZXJpZmljYXRpb24gaWYgY29tbWFuZCBzdWNjZWVkZWQKICAgIHRlc3QtPnZlcmlmaWNhdGlvbl9zdWNjZXNzID0gMTsKICAgIGlmICh0ZXN0LT5zdWNjZXNzICYmIHRlc3QtPnZlcmlmaWNhdGlvbl9jb21tYW5kWzBdICE9ICdcMCcpIHsKICAgICAgICBjaGFyIHZlcmlmaWNhdGlvbl9vdXRwdXRbMTAyNF07CiAgICAgICAgY2hhciB2ZXJib3NlX291dHB1dFs0MDk2XTsKICAgICAgICBpbnQgdmVyaWZpY2F0aW9uX3Jlc3VsdDsKICAgICAgICAKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9yZXN1bHQgPSBleGVjdXRlX2NvbW1hbmRfYW5kX2NhcHR1cmVfdmVyYm9zZSh0ZXN0LT52ZXJpZmljYXRpb25fY29tbWFuZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25fb3V0cHV0LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZih2ZXJpZmljYXRpb25fb3V0cHV0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcmJvc2Vfb3V0cHV0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKHZlcmJvc2Vfb3V0cHV0KSk7CiAgICAgICAgICAgIHN0cm5jcHkodGVzdC0+dmVyYm9zZV9vdXRwdXQsIHZlcmJvc2Vfb3V0cHV0LCBzaXplb2YodGVzdC0+dmVyYm9zZV9vdXRwdXQpIC0gMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmVyaWZpY2F0aW9uX3Jlc3VsdCA9IGV4ZWN1dGVfY29tbWFuZF9hbmRfY2FwdHVyZSh0ZXN0LT52ZXJpZmljYXRpb25fY29tbWFuZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcmlmaWNhdGlvbl9vdXRwdXQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplb2YodmVyaWZpY2F0aW9uX291dHB1dCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAodmVyaWZpY2F0aW9uX3Jlc3VsdCA9PSAwKSB7CiAgICAgICAgICAgIGlmICh0ZXN0LT5leHBlY3RlZF9vdXRwdXRbMF0gIT0gJ1wwJykgewogICAgICAgICAgICAgICAgaWYgKHN0cnN0cih2ZXJpZmljYXRpb25fb3V0cHV0LCB0ZXN0LT5leHBlY3RlZF9vdXRwdXQpID09IE5VTEwpIHsKICAgICAgICAgICAgICAgICAgICB0ZXN0LT52ZXJpZmljYXRpb25fc3VjY2VzcyA9IDA7CiAgICAgICAgICAgICAgICAgICAgc3RybmNweSh0ZXN0LT5kZXRhaWxzLCB2ZXJpZmljYXRpb25fb3V0cHV0LCBzaXplb2YodGVzdC0+ZGV0YWlscykgLSAxKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFZlcmlmaWNhdGlvbiBmYWlsZWQgLSBleHBlY3RlZCBwYXR0ZXJuIG5vdCBmb3VuZFxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEV4cGVjdGVkOiAnJXMnXG4iIFJFU0VULCB0ZXN0LT5leHBlY3RlZF9vdXRwdXQpOwogICAgICAgICAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBHb3Q6ICclcydcbiIgUkVTRVQsIHZlcmlmaWNhdGlvbl9vdXRwdXQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdIFZlcmlmaWNhdGlvbiBwYXNzZWQgLSBwYXR0ZXJuIGZvdW5kXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gRXhwZWN0ZWQ6ICclcydcbiIgUkVTRVQsIHRlc3QtPmV4cGVjdGVkX291dHB1dCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIEdvdDogJyVzJ1xuIiBSRVNFVCwgdmVyaWZpY2F0aW9uX291dHB1dCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGVzdC0+dmVyaWZpY2F0aW9uX3N1Y2Nlc3MgPSAwOwogICAgICAgICAgICBzdHJjcHkodGVzdC0+ZGV0YWlscywgIlZlcmlmaWNhdGlvbiBjb21tYW5kIGZhaWxlZCIpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gVmVyaWZpY2F0aW9uIGNvbW1hbmQgZmFpbGVkIHdpdGggZXhpdCBjb2RlICVkXG4iIFJFU0VULCB2ZXJpZmljYXRpb25fcmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gT3ZlcmFsbCB0ZXN0IHJlc3VsdAogICAgaW50IG92ZXJhbGxfc3VjY2VzcyA9IHRlc3QtPnN1Y2Nlc3MgJiYgdGVzdC0+dmVyaWZpY2F0aW9uX3N1Y2Nlc3M7CiAgICAKICAgIGlmIChvdmVyYWxsX3N1Y2Nlc3MpIHsKICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSIpOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl0iKTsKICAgIH0KICAgIAogICAgcHJpbnRmKCIgJXMlNGxsZCBtcyVzXG4iLCBDWUFOLCB0ZXN0LT5kdXJhdGlvbl9tcywgUkVTRVQpOwogICAgCiAgICAvLyBQcmludCBkZXRhaWxzIGlmIHZlcmlmaWNhdGlvbiBmYWlsZWQKICAgIGlmICghdGVzdC0+dmVyaWZpY2F0aW9uX3N1Y2Nlc3MpIHsKICAgICAgICBpZiAodGVzdC0+ZGV0YWlsc1swXSAhPSAnXDAnKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgVmVyaWZpY2F0aW9uIGZhaWxlZDogJXNcbiIgUkVTRVQsIHRlc3QtPmRldGFpbHMpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAodmVyYm9zZV9tb2RlICYmIHRlc3QtPnZlcmJvc2Vfb3V0cHV0WzBdICE9ICdcMCcpIHsKICAgICAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gRnVsbCB2ZXJpZmljYXRpb24gb3V0cHV0OlxuJXNcbiIgUkVTRVQsIHRlc3QtPnZlcmJvc2Vfb3V0cHV0KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUgJiYgIW92ZXJhbGxfc3VjY2VzcykgewogICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFRFU1QgRkFJTFVSRSBBTkFMWVNJUzpcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdICAgQ29tbWFuZCBzdWNjZXNzOiAlc1xuIiBSRVNFVCwgdGVzdC0+c3VjY2VzcyA/ICJZRVMiIDogIk5PIik7CiAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gICBWZXJpZmljYXRpb24gc3VjY2VzczogJXNcbiIgUkVTRVQsIHRlc3QtPnZlcmlmaWNhdGlvbl9zdWNjZXNzID8gIllFUyIgOiAiTk8iKTsKICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSAgIERldGFpbHM6ICVzXG4iIFJFU0VULCB0ZXN0LT5kZXRhaWxzKTsKICAgICAgICBpZiAodGVzdC0+dmVyYm9zZV9vdXRwdXRbMF0gIT0gJ1wwJykgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSAgIEZ1bGwgb3V0cHV0IGNhcHR1cmVkICglenUgYnl0ZXMpXG4iIFJFU0VULCBzdHJsZW4odGVzdC0+dmVyYm9zZV9vdXRwdXQpKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHJldHVybiBvdmVyYWxsX3N1Y2Nlc3M7Cn0KCi8vID09PT09PT09PT09PT09PT09PT09IEhUVFAgQ0xJRU5UIElNUExFTUVOVEFUSU9OID09PT09PT09PT09PT09PT09PT09CgpIdHRwUmVzcG9uc2UqIGh0dHBfcmVxdWVzdChjb25zdCBjaGFyKiBtZXRob2QsIGNvbnN0IGNoYXIqIHVybCwgY29uc3QgY2hhciogYm9keSwgY29uc3QgY2hhciogY29udGVudF90eXBlKSB7CiAgICBIdHRwUmVzcG9uc2UqIHJlc3BvbnNlID0gbWFsbG9jKHNpemVvZihIdHRwUmVzcG9uc2UpKTsKICAgIGlmICghcmVzcG9uc2UpIHJldHVybiBOVUxMOwogICAgCiAgICByZXNwb25zZS0+c3RhdHVzX2NvZGUgPSAwOwogICAgcmVzcG9uc2UtPmJvZHkgPSBOVUxMOwogICAgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoID0gMDsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIEhUVFAgUmVxdWVzdDogJXMgJXNcbiIgUkVTRVQsIG1ldGhvZCwgdXJsKTsKICAgICAgICBpZiAoYm9keSkgewogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBSZXF1ZXN0IGJvZHk6ICVzXG4iIFJFU0VULCBib2R5KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIFBhcnNlIFVSTAogICAgY2hhciBob3N0WzI1Nl0gPSAibG9jYWxob3N0IjsKICAgIGludCBwb3J0ID0gODA4MDsKICAgIGNoYXIgcGF0aFsxMDI0XSA9ICIvIjsKICAgIAogICAgaWYgKHN0cm5jbXAodXJsLCAiaHR0cDovLyIsIDcpID09IDApIHsKICAgICAgICBjb25zdCBjaGFyKiBob3N0X3N0YXJ0ID0gdXJsICsgNzsKICAgICAgICBjb25zdCBjaGFyKiBwYXRoX3N0YXJ0ID0gc3RyY2hyKGhvc3Rfc3RhcnQsICcvJyk7CiAgICAgICAgY29uc3QgY2hhciogcG9ydF9zdGFydCA9IHN0cmNocihob3N0X3N0YXJ0LCAnOicpOwogICAgICAgIAogICAgICAgIGlmIChwb3J0X3N0YXJ0ICYmICghcGF0aF9zdGFydCB8fCBwb3J0X3N0YXJ0IDwgcGF0aF9zdGFydCkpIHsKICAgICAgICAgICAgLy8gSGFzIHBvcnQgYmVmb3JlIHBhdGgKICAgICAgICAgICAgc2l6ZV90IGhvc3RfbGVuID0gcG9ydF9zdGFydCAtIGhvc3Rfc3RhcnQ7CiAgICAgICAgICAgIHN0cm5jcHkoaG9zdCwgaG9zdF9zdGFydCwgaG9zdF9sZW4pOwogICAgICAgICAgICBob3N0W2hvc3RfbGVuXSA9ICdcMCc7CiAgICAgICAgICAgIHBvcnQgPSBhdG9pKHBvcnRfc3RhcnQgKyAxKTsKICAgICAgICAgICAgaWYgKHBhdGhfc3RhcnQpIHsKICAgICAgICAgICAgICAgIHN0cmNweShwYXRoLCBwYXRoX3N0YXJ0KTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocGF0aF9zdGFydCkgewogICAgICAgICAgICAvLyBObyBwb3J0LCBoYXMgcGF0aAogICAgICAgICAgICBzaXplX3QgaG9zdF9sZW4gPSBwYXRoX3N0YXJ0IC0gaG9zdF9zdGFydDsKICAgICAgICAgICAgc3RybmNweShob3N0LCBob3N0X3N0YXJ0LCBob3N0X2xlbik7CiAgICAgICAgICAgIGhvc3RbaG9zdF9sZW5dID0gJ1wwJzsKICAgICAgICAgICAgc3RyY3B5KHBhdGgsIHBhdGhfc3RhcnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIE5vIHBvcnQsIG5vIHBhdGgKICAgICAgICAgICAgc3RyY3B5KGhvc3QsIGhvc3Rfc3RhcnQpOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQXNzdW1lIGl0J3MganVzdCBhIHBhdGgKICAgICAgICBzdHJjcHkocGF0aCwgdXJsKTsKICAgIH0KICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFBhcnNlZCBVUkwgLSBIb3N0OiAlcywgUG9ydDogJWQsIFBhdGg6ICVzXG4iIFJFU0VULCBob3N0LCBwb3J0LCBwYXRoKTsKICAgIH0KICAgIAogICAgLy8gQ3JlYXRlIHNvY2tldAogICAgaW50IHNvY2tmZCA9IHNvY2tldChBRl9JTkVULCBTT0NLX1NUUkVBTSwgMCk7CiAgICBpZiAoc29ja2ZkIDwgMCkgewogICAgICAgIHBlcnJvcigic29ja2V0Iik7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBTb2NrZXQgY3JlYXRpb24gZmFpbGVkOiAlc1xuIiBSRVNFVCwgc3RyZXJyb3IoZXJybm8pKTsKICAgICAgICB9CiAgICAgICAgZnJlZShyZXNwb25zZSk7CiAgICAgICAgcmV0dXJuIE5VTEw7CiAgICB9CiAgICAKICAgIC8vIFNldCB0aW1lb3V0CiAgICBzdHJ1Y3QgdGltZXZhbCB0aW1lb3V0OwogICAgdGltZW91dC50dl9zZWMgPSAxMDsKICAgIHRpbWVvdXQudHZfdXNlYyA9IDA7CiAgICBzZXRzb2Nrb3B0KHNvY2tmZCwgU09MX1NPQ0tFVCwgU09fUkNWVElNRU8sICZ0aW1lb3V0LCBzaXplb2YodGltZW91dCkpOwogICAgc2V0c29ja29wdChzb2NrZmQsIFNPTF9TT0NLRVQsIFNPX1NORFRJTUVPLCAmdGltZW91dCwgc2l6ZW9mKHRpbWVvdXQpKTsKICAgIAogICAgLy8gUmVzb2x2ZSBob3N0bmFtZQogICAgc3RydWN0IGhvc3RlbnQqIHNlcnZlciA9IGdldGhvc3RieW5hbWUoaG9zdCk7CiAgICBpZiAoIXNlcnZlcikgewogICAgICAgIGZwcmludGYoc3RkZXJyLCAiRXJyb3I6IE5vIHN1Y2ggaG9zdCAlc1xuIiwgaG9zdCk7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBIb3N0IHJlc29sdXRpb24gZmFpbGVkIGZvcjogJXNcbiIgUkVTRVQsIGhvc3QpOwogICAgICAgIH0KICAgICAgICBjbG9zZShzb2NrZmQpOwogICAgICAgIGZyZWUocmVzcG9uc2UpOwogICAgICAgIHJldHVybiBOVUxMOwogICAgfQogICAgCiAgICAvLyBDb25uZWN0IHRvIHNlcnZlcgogICAgc3RydWN0IHNvY2thZGRyX2luIHNlcnZfYWRkcjsKICAgIG1lbXNldCgmc2Vydl9hZGRyLCAwLCBzaXplb2Yoc2Vydl9hZGRyKSk7CiAgICBzZXJ2X2FkZHIuc2luX2ZhbWlseSA9IEFGX0lORVQ7CiAgICBtZW1jcHkoJnNlcnZfYWRkci5zaW5fYWRkci5zX2FkZHIsIHNlcnZlci0+aF9hZGRyLCBzZXJ2ZXItPmhfbGVuZ3RoKTsKICAgIHNlcnZfYWRkci5zaW5fcG9ydCA9IGh0b25zKHBvcnQpOwogICAgCiAgICBpZiAoY29ubmVjdChzb2NrZmQsIChzdHJ1Y3Qgc29ja2FkZHIqKSZzZXJ2X2FkZHIsIHNpemVvZihzZXJ2X2FkZHIpKSA8IDApIHsKICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIkVycm9yIGNvbm5lY3RpbmcgdG8gJXM6JWQ6ICVzXG4iLCBob3N0LCBwb3J0LCBzdHJlcnJvcihlcnJubykpOwogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gQ29ubmVjdGlvbiBmYWlsZWQgdG8gJXM6JWQ6ICVzXG4iIFJFU0VULCBob3N0LCBwb3J0LCBzdHJlcnJvcihlcnJubykpOwogICAgICAgIH0KICAgICAgICBjbG9zZShzb2NrZmQpOwogICAgICAgIGZyZWUocmVzcG9uc2UpOwogICAgICAgIHJldHVybiBOVUxMOwogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gQ29ubmVjdGVkIHN1Y2Nlc3NmdWxseSB0byAlczolZFxuIiBSRVNFVCwgaG9zdCwgcG9ydCk7CiAgICB9CiAgICAKICAgIC8vIEJ1aWxkIEhUVFAgcmVxdWVzdAogICAgY2hhciByZXF1ZXN0WzgxOTJdOwogICAgaW50IHJlcXVlc3RfbGVuOwogICAgCiAgICBpZiAoYm9keSAmJiBjb250ZW50X3R5cGUpIHsKICAgICAgICByZXF1ZXN0X2xlbiA9IHNucHJpbnRmKHJlcXVlc3QsIHNpemVvZihyZXF1ZXN0KSwKICAgICAgICAgICAgIiVzICVzIEhUVFAvMS4xXHJcbiIKICAgICAgICAgICAgIkhvc3Q6ICVzOiVkXHJcbiIKICAgICAgICAgICAgIkNvbnRlbnQtVHlwZTogJXNcclxuIgogICAgICAgICAgICAiQ29udGVudC1MZW5ndGg6ICV6dVxyXG4iCiAgICAgICAgICAgICJDb25uZWN0aW9uOiBjbG9zZVxyXG4iCiAgICAgICAgICAgICJcclxuIgogICAgICAgICAgICAiJXMiLAogICAgICAgICAgICBtZXRob2QsIHBhdGgsIGhvc3QsIHBvcnQsIGNvbnRlbnRfdHlwZSwgc3RybGVuKGJvZHkpLCBib2R5KTsKICAgIH0gZWxzZSBpZiAoYm9keSkgewogICAgICAgIHJlcXVlc3RfbGVuID0gc25wcmludGYocmVxdWVzdCwgc2l6ZW9mKHJlcXVlc3QpLAogICAgICAgICAgICAiJXMgJXMgSFRUUC8xLjFcclxuIgogICAgICAgICAgICAiSG9zdDogJXM6JWRcclxuIgogICAgICAgICAgICAiQ29udGVudC1MZW5ndGg6ICV6dVxyXG4iCiAgICAgICAgICAgICJDb25uZWN0aW9uOiBjbG9zZVxyXG4iCiAgICAgICAgICAgICJcclxuIgogICAgICAgICAgICAiJXMiLAogICAgICAgICAgICBtZXRob2QsIHBhdGgsIGhvc3QsIHBvcnQsIHN0cmxlbihib2R5KSwgYm9keSk7CiAgICB9IGVsc2UgewogICAgICAgIHJlcXVlc3RfbGVuID0gc25wcmludGYocmVxdWVzdCwgc2l6ZW9mKHJlcXVlc3QpLAogICAgICAgICAgICAiJXMgJXMgSFRUUC8xLjFcclxuIgogICAgICAgICAgICAiSG9zdDogJXM6JWRcclxuIgogICAgICAgICAgICAiQ29ubmVjdGlvbjogY2xvc2VcclxuIgogICAgICAgICAgICAiXHJcbiIsCiAgICAgICAgICAgIG1ldGhvZCwgcGF0aCwgaG9zdCwgcG9ydCk7CiAgICB9CiAgICAKICAgIGlmIChyZXF1ZXN0X2xlbiA+PSAoaW50KXNpemVvZihyZXF1ZXN0KSkgewogICAgICAgIGZwcmludGYoc3RkZXJyLCAiRXJyb3I6IEhUVFAgcmVxdWVzdCB0b28gbGFyZ2VcbiIpOwogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gSFRUUCByZXF1ZXN0IHRvbyBsYXJnZSAoJWQgYnl0ZXMpXG4iIFJFU0VULCByZXF1ZXN0X2xlbik7CiAgICAgICAgfQogICAgICAgIGNsb3NlKHNvY2tmZCk7CiAgICAgICAgZnJlZShyZXNwb25zZSk7CiAgICAgICAgcmV0dXJuIE5VTEw7CiAgICB9CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBTZW5kaW5nIEhUVFAgcmVxdWVzdCAoJWQgYnl0ZXMpOlxuJS4qc1xuIiBSRVNFVCwgCiAgICAgICAgICAgICAgIHJlcXVlc3RfbGVuLCByZXF1ZXN0X2xlbiA+IDUwMCA/IDUwMCA6IHJlcXVlc3RfbGVuLCByZXF1ZXN0KTsKICAgIH0KICAgIAogICAgLy8gU2VuZCByZXF1ZXN0CiAgICBpZiAoc2VuZChzb2NrZmQsIHJlcXVlc3QsIHJlcXVlc3RfbGVuLCAwKSA8IDApIHsKICAgICAgICBwZXJyb3IoInNlbmQiKTsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFNlbmQgZmFpbGVkOiAlc1xuIiBSRVNFVCwgc3RyZXJyb3IoZXJybm8pKTsKICAgICAgICB9CiAgICAgICAgY2xvc2Uoc29ja2ZkKTsKICAgICAgICBmcmVlKHJlc3BvbnNlKTsKICAgICAgICByZXR1cm4gTlVMTDsKICAgIH0KICAgIAogICAgLy8gUmVjZWl2ZSByZXNwb25zZQogICAgY2hhciByZXNwb25zZV9idWZmZXJbMTYzODRdOwogICAgc3NpemVfdCB0b3RhbF9yZWNlaXZlZCA9IDA7CiAgICBzc2l6ZV90IHJlY2VpdmVkOwogICAgCiAgICB3aGlsZSAoKHJlY2VpdmVkID0gcmVjdihzb2NrZmQsIHJlc3BvbnNlX2J1ZmZlciArIHRvdGFsX3JlY2VpdmVkLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKHJlc3BvbnNlX2J1ZmZlcikgLSB0b3RhbF9yZWNlaXZlZCAtIDEsIDApKSA+IDApIHsKICAgICAgICB0b3RhbF9yZWNlaXZlZCArPSByZWNlaXZlZDsKICAgICAgICBpZiAodG90YWxfcmVjZWl2ZWQgPj0gKHNzaXplX3Qpc2l6ZW9mKHJlc3BvbnNlX2J1ZmZlcikgLSAxKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KICAgIAogICAgaWYgKHJlY2VpdmVkIDwgMCkgewogICAgICAgIHBlcnJvcigicmVjdiIpOwogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gUmVjZWl2ZSBmYWlsZWQ6ICVzXG4iIFJFU0VULCBzdHJlcnJvcihlcnJubykpOwogICAgICAgIH0KICAgICAgICBjbG9zZShzb2NrZmQpOwogICAgICAgIGZyZWUocmVzcG9uc2UpOwogICAgICAgIHJldHVybiBOVUxMOwogICAgfQogICAgCiAgICByZXNwb25zZV9idWZmZXJbdG90YWxfcmVjZWl2ZWRdID0gJ1wwJzsKICAgIGNsb3NlKHNvY2tmZCk7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBSZWNlaXZlZCAlemQgYnl0ZXMgcmVzcG9uc2VcbiIgUkVTRVQsIHRvdGFsX3JlY2VpdmVkKTsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBSZXNwb25zZSAoZmlyc3QgNTAwIGJ5dGVzKTpcbiUuNTAwc1xuIiBSRVNFVCwgcmVzcG9uc2VfYnVmZmVyKTsKICAgIH0KICAgIAogICAgLy8gUGFyc2UgSFRUUCByZXNwb25zZQogICAgY2hhciogc3RhdHVzX2xpbmUgPSBzdHJzdHIocmVzcG9uc2VfYnVmZmVyLCAiSFRUUC8xLjEiKTsKICAgIGlmIChzdGF0dXNfbGluZSkgewogICAgICAgIHNzY2FuZihzdGF0dXNfbGluZSwgIkhUVFAvMS4xICVkIiwgJnJlc3BvbnNlLT5zdGF0dXNfY29kZSk7CiAgICB9CiAgICAKICAgIC8vIEZpbmQgYm9keQogICAgY2hhciogYm9keV9zdGFydCA9IHN0cnN0cihyZXNwb25zZV9idWZmZXIsICJcclxuXHJcbiIpOwogICAgaWYgKGJvZHlfc3RhcnQpIHsKICAgICAgICBib2R5X3N0YXJ0ICs9IDQ7CiAgICAgICAgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoID0gdG90YWxfcmVjZWl2ZWQgLSAoYm9keV9zdGFydCAtIHJlc3BvbnNlX2J1ZmZlcik7CiAgICAgICAgcmVzcG9uc2UtPmJvZHkgPSBtYWxsb2MocmVzcG9uc2UtPmJvZHlfbGVuZ3RoICsgMSk7CiAgICAgICAgaWYgKHJlc3BvbnNlLT5ib2R5KSB7CiAgICAgICAgICAgIG1lbWNweShyZXNwb25zZS0+Ym9keSwgYm9keV9zdGFydCwgcmVzcG9uc2UtPmJvZHlfbGVuZ3RoKTsKICAgICAgICAgICAgcmVzcG9uc2UtPmJvZHlbcmVzcG9uc2UtPmJvZHlfbGVuZ3RoXSA9ICdcMCc7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICAvLyBObyBib2R5IGZvdW5kCiAgICAgICAgcmVzcG9uc2UtPmJvZHkgPSBzdHJkdXAoIiIpOwogICAgICAgIHJlc3BvbnNlLT5ib2R5X2xlbmd0aCA9IDA7CiAgICB9CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBQYXJzZWQgcmVzcG9uc2UgLSBTdGF0dXM6ICVkLCBCb2R5IGxlbmd0aDogJXp1XG4iIFJFU0VULCAKICAgICAgICAgICAgICAgcmVzcG9uc2UtPnN0YXR1c19jb2RlLCByZXNwb25zZS0+Ym9keV9sZW5ndGgpOwogICAgfQogICAgCiAgICByZXR1cm4gcmVzcG9uc2U7Cn0KCnZvaWQgaHR0cF9yZXNwb25zZV9mcmVlKEh0dHBSZXNwb25zZSogcmVzcG9uc2UpIHsKICAgIGlmIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS0+Ym9keSkgewogICAgICAgICAgICBmcmVlKHJlc3BvbnNlLT5ib2R5KTsKICAgICAgICB9CiAgICAgICAgZnJlZShyZXNwb25zZSk7CiAgICB9Cn0KCmludCB2ZXJpZnlfaHR0cF9yZXNwb25zZShjb25zdCBIdHRwUmVzcG9uc2UqIHJlc3BvbnNlLCBjb25zdCBjaGFyKiBleHBlY3RlZF9wYXR0ZXJuLCBpbnQgY2hlY2tfc3VjY2Vzc19vbmx5KSB7CiAgICBpZiAoIXJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBSZXNwb25zZSBpcyBOVUxMXG4iIFJFU0VUKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBWZXJpZnlpbmcgcmVzcG9uc2UgLSBTdGF0dXM6ICVkLCBCb2R5IGxlbmd0aDogJXp1XG4iIFJFU0VULCAKICAgICAgICAgICAgICAgcmVzcG9uc2UtPnN0YXR1c19jb2RlLCByZXNwb25zZS0+Ym9keV9sZW5ndGgpOwogICAgICAgIGlmIChyZXNwb25zZS0+Ym9keSkgewogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBSZXNwb25zZSBib2R5OiAlc1xuIiBSRVNFVCwgcmVzcG9uc2UtPmJvZHkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgaWYgKGNoZWNrX3N1Y2Nlc3Nfb25seSkgewogICAgICAgIC8vIE9ubHkgY2hlY2sgaWYgdGhlIHJlc3BvbnNlIGluZGljYXRlcyBzdWNjZXNzICh0cnVlKSBvciBwcm9wZXIgZXJyb3IgaGFuZGxpbmcgKGZhbHNlKQogICAgICAgIGludCByZXN1bHQgPSAocmVzcG9uc2UtPnN0YXR1c19jb2RlID49IDIwMCAmJiByZXNwb25zZS0+c3RhdHVzX2NvZGUgPCA1MDApICYmIAogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLT5ib2R5ICYmIHN0cnN0cihyZXNwb25zZS0+Ym9keSwgIlwic3VjY2Vzc1wiOiIpICE9IE5VTEw7CiAgICAgICAgCiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBDaGVjayBzdWNjZXNzIG9ubHk6ICVzXG4iIFJFU0VULCByZXN1bHQgPyAiUEFTUyIgOiAiRkFJTCIpOwogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBTdGF0dXMgY29kZSBjaGVjazogJWQgaW4gWzIwMCw1MDApXG4iIFJFU0VULCByZXNwb25zZS0+c3RhdHVzX2NvZGUpOwogICAgICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBIYXMgc3VjY2VzcyBmaWVsZDogJXNcbiIgUkVTRVQsIAogICAgICAgICAgICAgICAgICAgKHJlc3BvbnNlLT5ib2R5ICYmIHN0cnN0cihyZXNwb25zZS0+Ym9keSwgIlwic3VjY2Vzc1wiOiIpKSA/ICJZRVMiIDogIk5PIik7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9IGVsc2UgewogICAgICAgIC8vIENoZWNrIHN0YXR1cyBjb2RlIGFuZCBleHBlY3RlZCBwYXR0ZXJuCiAgICAgICAgaWYgKHJlc3BvbnNlLT5zdGF0dXNfY29kZSA8IDIwMCB8fCByZXNwb25zZS0+c3RhdHVzX2NvZGUgPj0gMzAwKSB7CiAgICAgICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFN0YXR1cyBjb2RlIGNoZWNrIGZhaWxlZDogJWQgbm90IGluIFsyMDAsMzAwKVxuIiBSRVNFVCwgcmVzcG9uc2UtPnN0YXR1c19jb2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gQ2hlY2sgZm9yIGV4cGVjdGVkIHBhdHRlcm4gaW4gYm9keQogICAgICAgIGlmIChleHBlY3RlZF9wYXR0ZXJuICYmIGV4cGVjdGVkX3BhdHRlcm5bMF0gIT0gJ1wwJykgewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLT5ib2R5IHx8IHN0cnN0cihyZXNwb25zZS0+Ym9keSwgZXhwZWN0ZWRfcGF0dGVybikgPT0gTlVMTCkgewogICAgICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFBhdHRlcm4gbm90IGZvdW5kIGluIHJlc3BvbnNlIGJvZHlcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEV4cGVjdGVkOiAnJXMnXG4iIFJFU0VULCBleHBlY3RlZF9wYXR0ZXJuKTsKICAgICAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBHb3Q6ICclcydcbiIgUkVTRVQsIHJlc3BvbnNlLT5ib2R5ID8gcmVzcG9uc2UtPmJvZHkgOiAiTlVMTCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBQYXR0ZXJuIGZvdW5kIGluIHJlc3BvbnNlIGJvZHlcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBSZXNwb25zZSB2ZXJpZmljYXRpb24gcGFzc2VkXG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgcmV0dXJuIDE7Cn0KCmNoYXIqIGV4dHJhY3RfanNvbl9maWVsZChjb25zdCBjaGFyKiBqc29uLCBjb25zdCBjaGFyKiBmaWVsZCkgewogICAgaWYgKCFqc29uIHx8ICFmaWVsZCkgcmV0dXJuIE5VTEw7CiAgICAKICAgIGNoYXIgc2VhcmNoX3BhdHRlcm5bMjU2XTsKICAgIHNucHJpbnRmKHNlYXJjaF9wYXR0ZXJuLCBzaXplb2Yoc2VhcmNoX3BhdHRlcm4pLCAiXCIlc1wiOlwiIiwgZmllbGQpOwogICAgCiAgICBjaGFyKiBmaWVsZF9zdGFydCA9IHN0cnN0cihqc29uLCBzZWFyY2hfcGF0dGVybik7CiAgICBpZiAoIWZpZWxkX3N0YXJ0KSB7CiAgICAgICAgLy8gVHJ5IHdpdGhvdXQgcXVvdGVzIGZvciB0aGUgdmFsdWUKICAgICAgICBzbnByaW50ZihzZWFyY2hfcGF0dGVybiwgc2l6ZW9mKHNlYXJjaF9wYXR0ZXJuKSwgIlwiJXNcIjoiLCBmaWVsZCk7CiAgICAgICAgZmllbGRfc3RhcnQgPSBzdHJzdHIoanNvbiwgc2VhcmNoX3BhdHRlcm4pOwogICAgICAgIGlmICghZmllbGRfc3RhcnQpIHJldHVybiBOVUxMOwogICAgICAgIAogICAgICAgIGZpZWxkX3N0YXJ0ICs9IHN0cmxlbihzZWFyY2hfcGF0dGVybik7CiAgICAgICAgY2hhciogZmllbGRfZW5kID0gc3RyY2hyKGZpZWxkX3N0YXJ0LCAnLCcpOwogICAgICAgIGlmICghZmllbGRfZW5kKSBmaWVsZF9lbmQgPSBzdHJjaHIoZmllbGRfc3RhcnQsICd9Jyk7CiAgICAgICAgaWYgKCFmaWVsZF9lbmQpIHJldHVybiBOVUxMOwogICAgICAgIAogICAgICAgIHNpemVfdCBmaWVsZF9sZW5ndGggPSBmaWVsZF9lbmQgLSBmaWVsZF9zdGFydDsKICAgICAgICBjaGFyKiB2YWx1ZSA9IG1hbGxvYyhmaWVsZF9sZW5ndGggKyAxKTsKICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm4gTlVMTDsKICAgICAgICAKICAgICAgICBzdHJuY3B5KHZhbHVlLCBmaWVsZF9zdGFydCwgZmllbGRfbGVuZ3RoKTsKICAgICAgICB2YWx1ZVtmaWVsZF9sZW5ndGhdID0gJ1wwJzsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICAKICAgIGZpZWxkX3N0YXJ0ICs9IHN0cmxlbihzZWFyY2hfcGF0dGVybik7CiAgICBjaGFyKiBmaWVsZF9lbmQgPSBzdHJjaHIoZmllbGRfc3RhcnQsICciJyk7CiAgICBpZiAoIWZpZWxkX2VuZCkgcmV0dXJuIE5VTEw7CiAgICAKICAgIHNpemVfdCBmaWVsZF9sZW5ndGggPSBmaWVsZF9lbmQgLSBmaWVsZF9zdGFydDsKICAgIGNoYXIqIHZhbHVlID0gbWFsbG9jKGZpZWxkX2xlbmd0aCArIDEpOwogICAgaWYgKCF2YWx1ZSkgcmV0dXJuIE5VTEw7CiAgICAKICAgIHN0cm5jcHkodmFsdWUsIGZpZWxkX3N0YXJ0LCBmaWVsZF9sZW5ndGgpOwogICAgdmFsdWVbZmllbGRfbGVuZ3RoXSA9ICdcMCc7CiAgICByZXR1cm4gdmFsdWU7Cn0KCmludCBodHRwX3Rlc3RfZW5kcG9pbnQoY29uc3QgY2hhciogZGVzY3JpcHRpb24sIGNvbnN0IGNoYXIqIG1ldGhvZCwgY29uc3QgY2hhciogZW5kcG9pbnQsIAogICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciogYm9keSwgY29uc3QgY2hhciogZXhwZWN0ZWRfcGF0dGVybiwgaW50IGNoZWNrX3N1Y2Nlc3Nfb25seSwgbG9uZyBsb25nKiBkdXJhdGlvbikgewogICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCBkZXNjcmlwdGlvbik7CiAgICBmZmx1c2goc3Rkb3V0KTsKICAgIAogICAgbG9uZyBsb25nIHN0YXJ0X3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAKICAgIEh0dHBSZXNwb25zZSogcmVzcG9uc2UgPSBodHRwX3JlcXVlc3QobWV0aG9kLCBlbmRwb2ludCwgYm9keSwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIGxvbmcgbG9uZyBlbmRfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIAogICAgaWYgKGR1cmF0aW9uKSB7CiAgICAgICAgKmR1cmF0aW9uID0gZW5kX3RpbWUgLSBzdGFydF90aW1lOwogICAgfQogICAgCiAgICBpbnQgc3VjY2VzcyA9IDA7CiAgICBpZiAocmVzcG9uc2UpIHsKICAgICAgICBzdWNjZXNzID0gdmVyaWZ5X2h0dHBfcmVzcG9uc2UocmVzcG9uc2UsIGV4cGVjdGVkX3BhdHRlcm4sIGNoZWNrX3N1Y2Nlc3Nfb25seSk7CiAgICAgICAgaWYgKCFzdWNjZXNzKSB7CiAgICAgICAgICAgIHByaW50ZigiWyIgUkVEICJGQUlMIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIGVuZF90aW1lIC0gc3RhcnRfdGltZSwgUkVTRVQpOwogICAgICAgICAgICBpZiAocmVzcG9uc2UtPmJvZHkpIHsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgU3RhdHVzOiAlZCwgUmVzcG9uc2U6ICVzXG4iIFJFU0VULCByZXNwb25zZS0+c3RhdHVzX2NvZGUsIHJlc3BvbnNlLT5ib2R5KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgU3RhdHVzOiAlZCwgTm8gcmVzcG9uc2UgYm9keVxuIiBSRVNFVCwgcmVzcG9uc2UtPnN0YXR1c19jb2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gSFRUUCBURVNUIEZBSUxVUkUgQU5BTFlTSVM6XG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdICAgRW5kcG9pbnQ6ICVzICVzXG4iIFJFU0VULCBtZXRob2QsIGVuZHBvaW50KTsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdICAgU3RhdHVzIENvZGU6ICVkXG4iIFJFU0VULCByZXNwb25zZS0+c3RhdHVzX2NvZGUpOwogICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gICBFeHBlY3RlZCBQYXR0ZXJuOiAnJXMnXG4iIFJFU0VULCBleHBlY3RlZF9wYXR0ZXJuID8gZXhwZWN0ZWRfcGF0dGVybiA6ICJOT05FIik7CiAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSAgIENoZWNrIFN1Y2Nlc3MgT25seTogJXNcbiIgUkVTRVQsIGNoZWNrX3N1Y2Nlc3Nfb25seSA/ICJZRVMiIDogIk5PIik7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UtPmJvZHkpIHsKICAgICAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSAgIFJlc3BvbnNlIEJvZHk6ICVzXG4iIFJFU0VULCByZXNwb25zZS0+Ym9keSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdICAgUmVzcG9uc2UgQm9keTogTlVMTFxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIGVuZF90aW1lIC0gc3RhcnRfdGltZSwgUkVTRVQpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBIVFRQIFRFU1QgU1VDQ0VTUyBERVRBSUxTOlxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdICAgRW5kcG9pbnQ6ICVzICVzXG4iIFJFU0VULCBtZXRob2QsIGVuZHBvaW50KTsKICAgICAgICAgICAgICAgIHByaW50ZihHUkVFTiAiICBbVkVSQk9TRV0gICBTdGF0dXMgQ29kZTogJWRcbiIgUkVTRVQsIHJlc3BvbnNlLT5zdGF0dXNfY29kZSk7CiAgICAgICAgICAgICAgICBwcmludGYoR1JFRU4gIiAgW1ZFUkJPU0VdICAgUmVzcG9uc2UgVGltZTogJWxsZCBtc1xuIiBSRVNFVCwgZW5kX3RpbWUgLSBzdGFydF90aW1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUocmVzcG9uc2UpOwogICAgfSBlbHNlIHsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzXG4iLCBDWUFOLCBlbmRfdGltZSAtIHN0YXJ0X3RpbWUsIFJFU0VUKTsKICAgICAgICBwcmludGYoUkVEICIgIE5vIHJlc3BvbnNlIGZyb20gc2VydmVyXG4iIFJFU0VUKTsKICAgICAgICAKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEhUVFAgVEVTVCBGQUlMVVJFIC0gTk8gUkVTUE9OU0U6XG4iIFJFU0VUKTsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gICBFbmRwb2ludDogJXMgJXNcbiIgUkVTRVQsIG1ldGhvZCwgZW5kcG9pbnQpOwogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSAgIFNlcnZlciBtYXkgYmUgZG93biBvciB1bnJlYWNoYWJsZVxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICByZXR1cm4gc3VjY2VzczsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gSFRUUCBBUEkgVEVTVCBTVUlURSA9PT09PT09PT09PT09PT09PT09PQoKdm9pZCBjbGVhbnVwX3Rlc3RfZGF0YWJhc2VzKCkgewogICAgcHJpbnRmKCJDbGVhbmluZyB1cCBwcmV2aW91cyB0ZXN0IGRhdGFiYXNlcy4uLlxuIik7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBDbGVhbmluZyB1cCB0ZXN0IGRpcmVjdG9yaWVzIGluIC90bXAvc3lkYl90ZXN0L1xuIiBSRVNFVCk7CiAgICB9CiAgICAKICAgIC8vIFJlbW92ZSBhbGwgdGVzdCBkYXRhYmFzZXMgZnJvbSBwcmV2aW91cyBydW5zCiAgICBjaGFyIGNvbW1hbmRbNTEyXTsKICAgIHNucHJpbnRmKGNvbW1hbmQsIHNpemVvZihjb21tYW5kKSwgInJtIC1yZiAvdG1wL3N5ZGJfdGVzdC90ZXN0ZGJfKiAvdG1wL3N5ZGJfdGVzdC90ZXN0ZGIyXyogL3RtcC9zeWRiX3Rlc3QvdGVzdGNvbGxkYl8qIC90bXAvc3lkYl90ZXN0L3Rlc3RpbnN0ZGJfKiAyPi9kZXYvbnVsbCIpOwogICAgc3lzdGVtKGNvbW1hbmQpOwogICAgCiAgICAvLyBBbHNvIGNsZWFuIHVwIGFueSBsb2NrIGZpbGVzCiAgICBzbnByaW50Zihjb21tYW5kLCBzaXplb2YoY29tbWFuZCksICJybSAtZiAvdG1wL3N5ZGJfdGVzdC8qLmxvY2sgL3RtcC9zeWRiX3Rlc3QvLioubG9jayAyPi9kZXYvbnVsbCIpOwogICAgc3lzdGVtKGNvbW1hbmQpOwogICAgCiAgICB1c2xlZXAoNTAwMDApOyAvLyA1MG1zIHRvIGVuc3VyZSBjbGVhbnVwIGNvbXBsZXRlcwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gQ2xlYW51cCBjb21wbGV0ZWRcbiIgUkVTRVQpOwogICAgfQp9CgppbnQgcnVuX2h0dHBfZGF0YWJhc2VfdGVzdHMoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBICJIVFRQIEFQSSBEQVRBQkFTRSBURVNUUyIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIGxvbmcgbG9uZyB0b3RhbF90aW1lID0gMDsKICAgIGxvbmcgbG9uZyBkdXJhdGlvbjsKICAgIAogICAgLy8gR2VuZXJhdGUgdW5pcXVlIGRhdGFiYXNlIG5hbWVzIHRvIGF2b2lkIGNvbmZsaWN0cwogICAgY2hhciB1bmlxdWVfZGIxWzY0XSwgdW5pcXVlX2RiMls2NF07CiAgICBzdHJ1Y3QgdGltZXNwZWMgdHM7CiAgICBjbG9ja19nZXR0aW1lKENMT0NLX01PTk9UT05JQywgJnRzKTsKICAgIHNucHJpbnRmKHVuaXF1ZV9kYjEsIHNpemVvZih1bmlxdWVfZGIxKSwgInRlc3RkYl8lbGRfJWxkIiwgdHMudHZfc2VjLCB0cy50dl9uc2VjKTsKICAgIHNucHJpbnRmKHVuaXF1ZV9kYjIsIHNpemVvZih1bmlxdWVfZGIyKSwgInRlc3RkYjJfJWxkXyVsZCIsIHRzLnR2X3NlYywgdHMudHZfbnNlYyArIDEpOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gVXNpbmcgdW5pcXVlIGRhdGFiYXNlIG5hbWVzOiAlcywgJXNcbiIgUkVTRVQsIHVuaXF1ZV9kYjEsIHVuaXF1ZV9kYjIpOwogICAgfQogICAgCiAgICBjaGFyIGNyZWF0ZV9kYjFfYm9keVsxMjhdLCBjcmVhdGVfZGIyX2JvZHlbMTI4XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYjFfYm9keSwgc2l6ZW9mKGNyZWF0ZV9kYjFfYm9keSksICJ7XCJuYW1lXCI6XCIlc1wifSIsIHVuaXF1ZV9kYjEpOwogICAgc25wcmludGYoY3JlYXRlX2RiMl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiMl9ib2R5KSwgIntcIm5hbWVcIjpcIiVzXCJ9IiwgdW5pcXVlX2RiMik7CiAgICAKICAgIC8vIFRlc3QgMTogTGlzdCBkYXRhYmFzZXMgKHNob3VsZCB3b3JrIHJlZ2FyZGxlc3Mgb2YgZXhpc3RpbmcgZGF0YSkKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkdFVCAvYXBpL2RhdGFiYXNlcyAtIExpc3QgZGF0YWJhc2VzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsICIvYXBpL2RhdGFiYXNlcyIsIE5VTEwsICJcInN1Y2Nlc3NcIjp0cnVlIiwgMSwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIC8vIFRlc3QgMjogQ3JlYXRlIGZpcnN0IGRhdGFiYXNlCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzIC0gQ3JlYXRlIGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfZGIxX2JvZHksICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIC8vIFRlc3QgMzogQ3JlYXRlIHNlY29uZCBkYXRhYmFzZQogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiUE9TVCAvYXBpL2RhdGFiYXNlcyAtIENyZWF0ZSBzZWNvbmQgZGF0YWJhc2UiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsIGNyZWF0ZV9kYjJfYm9keSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24pKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgLy8gVGVzdCA0OiBUcnkgdG8gY3JlYXRlIGR1cGxpY2F0ZSBkYXRhYmFzZSAoc2hvdWxkIGZhaWwgcHJvcGVybHkpCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzIC0gUHJldmVudCBkdXBsaWNhdGUgZGF0YWJhc2UiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsICIvYXBpL2RhdGFiYXNlcyIsIGNyZWF0ZV9kYjFfYm9keSwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIC8vIFRlc3QgNTogRGVsZXRlIGRhdGFiYXNlCiAgICBjaGFyIGRlbGV0ZV91cmxbMjU2XTsKICAgIHNucHJpbnRmKGRlbGV0ZV91cmwsIHNpemVvZihkZWxldGVfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzIiwgdW5pcXVlX2RiMik7CiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJERUxFVEUgL2FwaS9kYXRhYmFzZXMve25hbWV9IC0gRGVsZXRlIGRhdGFiYXNlIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkRFTEVURSIsIGRlbGV0ZV91cmwsIE5VTEwsICJcInN1Y2Nlc3NcIjp0cnVlIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgRGF0YWJhc2UgQVBJIHRlc3RzOiAlZC8lZCBwYXNzZWQgKGF2ZzogJWxsZCBtcylcbiIgUkVTRVQsIAogICAgICAgICAgIHBhc3NlZCwgdG90YWwsIHRvdGFsX3RpbWUgLyAodG90YWwgPiAwID8gdG90YWwgOiAxKSk7CiAgICAKICAgIHJldHVybiBwYXNzZWQ7Cn0KCmludCBydW5faHR0cF9jb2xsZWN0aW9uX3Rlc3RzKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSAiSFRUUCBBUEkgQ09MTEVDVElPTiBURVNUUyIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIGxvbmcgbG9uZyB0b3RhbF90aW1lID0gMDsKICAgIGxvbmcgbG9uZyBkdXJhdGlvbjsKICAgIAogICAgLy8gVXNlIGEgdW5pcXVlIGRhdGFiYXNlIG5hbWUgdG8gYXZvaWQgY29uZmxpY3RzCiAgICBjaGFyIHVuaXF1ZV9kYls2NF07CiAgICBzdHJ1Y3QgdGltZXNwZWMgdHM7CiAgICBjbG9ja19nZXR0aW1lKENMT0NLX01PTk9UT05JQywgJnRzKTsKICAgIHNucHJpbnRmKHVuaXF1ZV9kYiwgc2l6ZW9mKHVuaXF1ZV9kYiksICJ0ZXN0Y29sbGRiXyVsZF8lbGQiLCB0cy50dl9zZWMsIHRzLnR2X25zZWMpOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gVXNpbmcgdW5pcXVlIGRhdGFiYXNlIG5hbWU6ICVzXG4iIFJFU0VULCB1bmlxdWVfZGIpOwogICAgfQogICAgCiAgICBjaGFyIGNyZWF0ZV9kYl9ib2R5WzEyOF07CiAgICBzbnByaW50ZihjcmVhdGVfZGJfYm9keSwgc2l6ZW9mKGNyZWF0ZV9kYl9ib2R5KSwgIntcIm5hbWVcIjpcIiVzXCJ9IiwgdW5pcXVlX2RiKTsKICAgIAogICAgLy8gQ3JlYXRlIGEgZnJlc2ggZGF0YWJhc2UgZm9yIGNvbGxlY3Rpb24gdGVzdHMKICAgIEh0dHBSZXNwb25zZSogZGJfcmVzcG9uc2UgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfZGJfYm9keSwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIGlmICghZGJfcmVzcG9uc2UgfHwgIXZlcmlmeV9odHRwX3Jlc3BvbnNlKGRiX3Jlc3BvbnNlLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDApKSB7CiAgICAgICAgcHJpbnRmKFJFRCAiICBGYWlsZWQgdG8gY3JlYXRlIHRlc3QgZGF0YWJhc2UgZm9yIGNvbGxlY3Rpb24gdGVzdHNcbiIgUkVTRVQpOwogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gRGF0YWJhc2UgY3JlYXRpb24gZmFpbGVkXG4iIFJFU0VUKTsKICAgICAgICAgICAgaWYgKGRiX3Jlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBSZXNwb25zZSBzdGF0dXM6ICVkLCBib2R5OiAlc1xuIiBSRVNFVCwgZGJfcmVzcG9uc2UtPnN0YXR1c19jb2RlLCBkYl9yZXNwb25zZS0+Ym9keSA/IGRiX3Jlc3BvbnNlLT5ib2R5IDogIk5VTEwiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUoZGJfcmVzcG9uc2UpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgaHR0cF9yZXNwb25zZV9mcmVlKGRiX3Jlc3BvbnNlKTsKICAgIAogICAgLy8gVGVzdCAxOiBMaXN0IGNvbGxlY3Rpb25zIChlbXB0eSkKICAgIGNoYXIgbGlzdF9jb2xsc191cmxbMjU2XTsKICAgIHNucHJpbnRmKGxpc3RfY29sbHNfdXJsLCBzaXplb2YobGlzdF9jb2xsc191cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCB1bmlxdWVfZGIpOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMgLSBMaXN0IGVtcHR5IGNvbGxlY3Rpb25zIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsIGxpc3RfY29sbHNfdXJsLCBOVUxMLCAiXCJjb2xsZWN0aW9uc1wiOltdIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIC8vIFRlc3QgMjogQ3JlYXRlIGNvbGxlY3Rpb24gd2l0aCBzY2hlbWEKICAgIGNoYXIgY3JlYXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihjcmVhdGVfY29sbF91cmwsIHNpemVvZihjcmVhdGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMiLCB1bmlxdWVfZGIpOwogICAgCiAgICBjb25zdCBjaGFyKiB1c2Vyc19zY2hlbWEgPSAie1wibmFtZVwiOlwidXNlcnNcIixcInNjaGVtYVwiOlsiCiAgICAgICAgIntcIm5hbWVcIjpcIm5hbWVcIixcInR5cGVcIjpcInN0cmluZ1wiLFwicmVxdWlyZWRcIjp0cnVlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImFnZVwiLFwidHlwZVwiOlwiaW50XCIsXCJyZXF1aXJlZFwiOmZhbHNlLFwiaW5kZXhlZFwiOmZhbHNlfSwiCiAgICAgICAgIntcIm5hbWVcIjpcImVtYWlsXCIsXCJ0eXBlXCI6XCJzdHJpbmdcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJpbmRleGVkXCI6ZmFsc2V9IgogICAgICAgICJdfSI7CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucyAtIENyZWF0ZSB1c2VycyBjb2xsZWN0aW9uIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCBjcmVhdGVfY29sbF91cmwsIHVzZXJzX3NjaGVtYSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24pKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgLy8gVGVzdCAzOiBDcmVhdGUgcHJvZHVjdHMgY29sbGVjdGlvbgogICAgY29uc3QgY2hhciogcHJvZHVjdHNfc2NoZW1hID0gIntcIm5hbWVcIjpcInByb2R1Y3RzXCIsXCJzY2hlbWFcIjpbIgogICAgICAgICJ7XCJuYW1lXCI6XCJuYW1lXCIsXCJ0eXBlXCI6XCJzdHJpbmdcIixcInJlcXVpcmVkXCI6dHJ1ZSxcImluZGV4ZWRcIjpmYWxzZX0sIgogICAgICAgICJ7XCJuYW1lXCI6XCJwcmljZVwiLFwidHlwZVwiOlwiZmxvYXRcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJpbmRleGVkXCI6ZmFsc2V9IgogICAgICAgICJdfSI7CiAgICAKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucyAtIENyZWF0ZSBwcm9kdWN0cyBjb2xsZWN0aW9uIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCBjcmVhdGVfY29sbF91cmwsIHByb2R1Y3RzX3NjaGVtYSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwLCAmZHVyYXRpb24pKSB7CiAgICAgICAgcGFzc2VkKys7CiAgICB9CiAgICB0b3RhbCsrOwogICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgIAogICAgLy8gVGVzdCA0OiBMaXN0IGNvbGxlY3Rpb25zICh3aXRoIGRhdGEpCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucyAtIExpc3QgY3JlYXRlZCBjb2xsZWN0aW9ucyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBsaXN0X2NvbGxzX3VybCwgTlVMTCwgIlwidXNlcnNcIiIsIDAsICZkdXJhdGlvbikpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICAvLyBUZXN0IDU6IEdldCBjb2xsZWN0aW9uIHNjaGVtYQogICAgY2hhciBzY2hlbWFfdXJsWzI1Nl07CiAgICBzbnByaW50ZihzY2hlbWFfdXJsLCBzaXplb2Yoc2NoZW1hX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9zY2hlbWEiLCB1bmlxdWVfZGIpOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L3NjaGVtYSAtIEdldCB1c2VycyBzY2hlbWEiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgc2NoZW1hX3VybCwgTlVMTCwgIlwibmFtZVwiIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIC8vIFRlc3QgNjogRGVsZXRlIGNvbGxlY3Rpb24KICAgIGNoYXIgZGVsZXRlX2NvbGxfdXJsWzI1Nl07CiAgICBzbnByaW50ZihkZWxldGVfY29sbF91cmwsIHNpemVvZihkZWxldGVfY29sbF91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvcHJvZHVjdHMiLCB1bmlxdWVfZGIpOwogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiREVMRVRFIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9IC0gRGVsZXRlIHByb2R1Y3RzIGNvbGxlY3Rpb24iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiREVMRVRFIiwgZGVsZXRlX2NvbGxfdXJsLCBOVUxMLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbikpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIENvbGxlY3Rpb24gQVBJIHRlc3RzOiAlZC8lZCBwYXNzZWQgKGF2ZzogJWxsZCBtcylcbiIgUkVTRVQsIAogICAgICAgICAgIHBhc3NlZCwgdG90YWwsIHRvdGFsX3RpbWUgLyAodG90YWwgPiAwID8gdG90YWwgOiAxKSk7CiAgICAKICAgIHJldHVybiBwYXNzZWQ7Cn0KCmludCBydW5faHR0cF9pbnN0YW5jZV90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIkhUVFAgQVBJIElOU1RBTkNFIFRFU1RTIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgbG9uZyBsb25nIHRvdGFsX3RpbWUgPSAwOwogICAgbG9uZyBsb25nIGR1cmF0aW9uOwogICAgCiAgICAvLyBVc2UgYSB1bmlxdWUgZGF0YWJhc2UgbmFtZSB0byBhdm9pZCBjb25mbGljdHMKICAgIGNoYXIgdW5pcXVlX2RiWzY0XTsKICAgIHN0cnVjdCB0aW1lc3BlYyB0czsKICAgIGNsb2NrX2dldHRpbWUoQ0xPQ0tfTU9OT1RPTklDLCAmdHMpOwogICAgc25wcmludGYodW5pcXVlX2RiLCBzaXplb2YodW5pcXVlX2RiKSwgInRlc3RpbnN0ZGJfJWxkXyVsZCIsIHRzLnR2X3NlYywgdHMudHZfbnNlYyk7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBVc2luZyB1bmlxdWUgZGF0YWJhc2UgbmFtZTogJXNcbiIgUkVTRVQsIHVuaXF1ZV9kYik7CiAgICB9CiAgICAKICAgIGNoYXIgY3JlYXRlX2RiX2JvZHlbMTI4XTsKICAgIHNucHJpbnRmKGNyZWF0ZV9kYl9ib2R5LCBzaXplb2YoY3JlYXRlX2RiX2JvZHkpLCAie1wibmFtZVwiOlwiJXNcIn0iLCB1bmlxdWVfZGIpOwogICAgCiAgICAvLyBDcmVhdGUgYSBmcmVzaCBkYXRhYmFzZSBmb3IgaW5zdGFuY2UgdGVzdHMKICAgIEh0dHBSZXNwb25zZSogZGJfcmVzcG9uc2UgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCBjcmVhdGVfZGJfYm9keSwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIGlmICghZGJfcmVzcG9uc2UgfHwgIXZlcmlmeV9odHRwX3Jlc3BvbnNlKGRiX3Jlc3BvbnNlLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDApKSB7CiAgICAgICAgcHJpbnRmKFJFRCAiICBGYWlsZWQgdG8gY3JlYXRlIHRlc3QgZGF0YWJhc2UgZm9yIGluc3RhbmNlIHRlc3RzXG4iIFJFU0VUKTsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIERhdGFiYXNlIGNyZWF0aW9uIGZhaWxlZFxuIiBSRVNFVCk7CiAgICAgICAgfQogICAgICAgIGh0dHBfcmVzcG9uc2VfZnJlZShkYl9yZXNwb25zZSk7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBodHRwX3Jlc3BvbnNlX2ZyZWUoZGJfcmVzcG9uc2UpOwogICAgCiAgICAvLyBDcmVhdGUgY29sbGVjdGlvbiBmb3IgaW5zdGFuY2VzCiAgICBjaGFyIGNyZWF0ZV9jb2xsX3VybFsyNTZdOwogICAgc25wcmludGYoY3JlYXRlX2NvbGxfdXJsLCBzaXplb2YoY3JlYXRlX2NvbGxfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zIiwgdW5pcXVlX2RiKTsKICAgIAogICAgY29uc3QgY2hhciogdXNlcnNfc2NoZW1hID0gIntcIm5hbWVcIjpcInVzZXJzXCIsXCJzY2hlbWFcIjpbIgogICAgICAgICJ7XCJuYW1lXCI6XCJuYW1lXCIsXCJ0eXBlXCI6XCJzdHJpbmdcIixcInJlcXVpcmVkXCI6dHJ1ZSxcImluZGV4ZWRcIjpmYWxzZX0sIgogICAgICAgICJ7XCJuYW1lXCI6XCJhZ2VcIixcInR5cGVcIjpcImludFwiLFwicmVxdWlyZWRcIjpmYWxzZSxcImluZGV4ZWRcIjpmYWxzZX0sIgogICAgICAgICJ7XCJuYW1lXCI6XCJlbWFpbFwiLFwidHlwZVwiOlwic3RyaW5nXCIsXCJyZXF1aXJlZFwiOmZhbHNlLFwiaW5kZXhlZFwiOmZhbHNlfSIKICAgICAgICAiXX0iOwogICAgCiAgICBIdHRwUmVzcG9uc2UqIGNvbGxfcmVzcG9uc2UgPSBodHRwX3JlcXVlc3QoIlBPU1QiLCBjcmVhdGVfY29sbF91cmwsIHVzZXJzX3NjaGVtYSwgImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIGlmICghY29sbF9yZXNwb25zZSB8fCAhdmVyaWZ5X2h0dHBfcmVzcG9uc2UoY29sbF9yZXNwb25zZSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwKSkgewogICAgICAgIHByaW50ZihSRUQgIiAgRmFpbGVkIHRvIGNyZWF0ZSB0ZXN0IGNvbGxlY3Rpb24gZm9yIGluc3RhbmNlIHRlc3RzXG4iIFJFU0VUKTsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIENvbGxlY3Rpb24gY3JlYXRpb24gZmFpbGVkXG4iIFJFU0VUKTsKICAgICAgICB9CiAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKGNvbGxfcmVzcG9uc2UpOwogICAgICAgIHJldHVybiAwOwogICAgfQogICAgaHR0cF9yZXNwb25zZV9mcmVlKGNvbGxfcmVzcG9uc2UpOwogICAgCiAgICAvLyBUZXN0IDE6IExpc3QgaW5zdGFuY2VzIChlbXB0eSkKICAgIGNoYXIgbGlzdF9pbnN0YW5jZXNfdXJsWzI1Nl07CiAgICBzbnByaW50ZihsaXN0X2luc3RhbmNlc191cmwsIHNpemVvZihsaXN0X2luc3RhbmNlc191cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzIiwgdW5pcXVlX2RiKTsKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkdFVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zL3tjb2xsfS9pbnN0YW5jZXMgLSBMaXN0IGVtcHR5IGluc3RhbmNlcyIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJHRVQiLCBsaXN0X2luc3RhbmNlc191cmwsIE5VTEwsICJcImluc3RhbmNlc1wiOltdIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIC8vIFRlc3QgMjogSW5zZXJ0IGZpcnN0IGluc3RhbmNlCiAgICBjb25zdCBjaGFyKiB1c2VyMSA9ICJ7XCJuYW1lXCI6XCJKb2huIERvZVwiLFwiYWdlXCI6MzAsXCJlbWFpbFwiOlwiam9obkB0ZXN0LmNvbVwifSI7CiAgICBjaGFyIGluc2VydF91cmxbMjU2XTsKICAgIHNucHJpbnRmKGluc2VydF91cmwsIHNpemVvZihpbnNlcnRfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcyIsIHVuaXF1ZV9kYik7CiAgICAKICAgIEh0dHBSZXNwb25zZSogaW5zZXJ0X3Jlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KCJQT1NUIiwgaW5zZXJ0X3VybCwgdXNlcjEsICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICBpZiAoaW5zZXJ0X3Jlc3BvbnNlICYmIHZlcmlmeV9odHRwX3Jlc3BvbnNlKGluc2VydF9yZXNwb25zZSwgIlwic3VjY2Vzc1wiOnRydWUiLCAwKSkgewogICAgICAgIGNoYXIqIGlkMSA9IGV4dHJhY3RfanNvbl9maWVsZChpbnNlcnRfcmVzcG9uc2UtPmJvZHksICJpZCIpOwogICAgICAgIGlmIChpZDEpIHsKICAgICAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiUE9TVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zL3tjb2xsfS9pbnN0YW5jZXMgLSBJbnNlcnQgZmlyc3QgdXNlciIpOwogICAgICAgICAgICBwcmludGYoIlsiIEdSRUVOICJQQVNTIiBSRVNFVCAiXSAlcyU0bGxkIG1zJXNcbiIsIENZQU4sIGR1cmF0aW9uLCBSRVNFVCk7CiAgICAgICAgICAgIHBhc3NlZCsrOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBJbnNlcnRlZCB1c2VyIHdpdGggSUQ6ICVzXG4iIFJFU0VULCBpZDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUZXN0IDM6IEluc2VydCBzZWNvbmQgaW5zdGFuY2UKICAgICAgICAgICAgY29uc3QgY2hhciogdXNlcjIgPSAie1wibmFtZVwiOlwiSmFuZSBTbWl0aFwiLFwiYWdlXCI6MjUsXCJlbWFpbFwiOlwiamFuZUB0ZXN0LmNvbVwifSI7CiAgICAgICAgICAgIEh0dHBSZXNwb25zZSogaW5zZXJ0X3Jlc3BvbnNlMiA9IGh0dHBfcmVxdWVzdCgiUE9TVCIsIGluc2VydF91cmwsIHVzZXIyLCAiYXBwbGljYXRpb24vanNvbiIpOwogICAgICAgICAgICBpZiAoaW5zZXJ0X3Jlc3BvbnNlMiAmJiB2ZXJpZnlfaHR0cF9yZXNwb25zZShpbnNlcnRfcmVzcG9uc2UyLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDApKSB7CiAgICAgICAgICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJQT1NUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L2luc3RhbmNlcyAtIEluc2VydCBzZWNvbmQgdXNlciIpOwogICAgICAgICAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl0gJXMlNGxsZCBtcyVzXG4iLCBDWUFOLCBkdXJhdGlvbiwgUkVTRVQpOwogICAgICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFRlc3QgNDogTGlzdCBpbnN0YW5jZXMgKHdpdGggZGF0YSkKICAgICAgICAgICAgICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIkdFVCAvYXBpL2RhdGFiYXNlcy97ZGJ9L2NvbGxlY3Rpb25zL3tjb2xsfS9pbnN0YW5jZXMgLSBMaXN0IHVzZXJzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsIGxpc3RfaW5zdGFuY2VzX3VybCwgTlVMTCwgIkpvaG4gRG9lIiwgMCwgJmR1cmF0aW9uKSkgewogICAgICAgICAgICAgICAgICAgIHBhc3NlZCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdG90YWwrKzsKICAgICAgICAgICAgICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFRlc3QgNTogUXVlcnkgaW5zdGFuY2VzCiAgICAgICAgICAgICAgICBjaGFyIHF1ZXJ5X3VybFs1MTJdOwogICAgICAgICAgICAgICAgc25wcmludGYocXVlcnlfdXJsLCBzaXplb2YocXVlcnlfdXJsKSwgIi9hcGkvZGF0YWJhc2VzLyVzL2NvbGxlY3Rpb25zL3VzZXJzL2luc3RhbmNlcz9xdWVyeT1hZ2U6MzAiLCB1bmlxdWVfZGIpOwogICAgICAgICAgICAgICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiR0VUIC9hcGkvLi4uL2luc3RhbmNlcz9xdWVyeT1hZ2U6MzAgLSBRdWVyeSBieSBhZ2UiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgcXVlcnlfdXJsLCBOVUxMLCAiSm9obiBEb2UiLCAwLCAmZHVyYXRpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgcGFzc2VkKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0b3RhbCsrOwogICAgICAgICAgICAgICAgdG90YWxfdGltZSArPSBkdXJhdGlvbjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVGVzdCA2OiBVcGRhdGUgaW5zdGFuY2UKICAgICAgICAgICAgICAgIGNoYXIgdXBkYXRlX3VybFsyNTZdOwogICAgICAgICAgICAgICAgc25wcmludGYodXBkYXRlX3VybCwgc2l6ZW9mKHVwZGF0ZV91cmwpLCAiL2FwaS9kYXRhYmFzZXMvJXMvY29sbGVjdGlvbnMvdXNlcnMvaW5zdGFuY2VzLyVzIiwgdW5pcXVlX2RiLCBpZDEpOwogICAgICAgICAgICAgICAgY29uc3QgY2hhciogdXBkYXRlX2RhdGEgPSAie1wiYWdlXCI6MzUsXCJlbWFpbFwiOlwiam9obi51cGRhdGVkQHRlc3QuY29tXCJ9IjsKICAgICAgICAgICAgICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBVVCAvYXBpLy4uLi9pbnN0YW5jZXMve2lkfSAtIFVwZGF0ZSB1c2VyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlBVVCIsIHVwZGF0ZV91cmwsIHVwZGF0ZV9kYXRhLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRvdGFsKys7CiAgICAgICAgICAgICAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBUZXN0IDc6IERlbGV0ZSBpbnN0YW5jZQogICAgICAgICAgICAgICAgY2hhciBkZWxldGVfdXJsWzI1Nl07CiAgICAgICAgICAgICAgICBzbnByaW50ZihkZWxldGVfdXJsLCBzaXplb2YoZGVsZXRlX3VybCksICIvYXBpL2RhdGFiYXNlcy8lcy9jb2xsZWN0aW9ucy91c2Vycy9pbnN0YW5jZXMvJXMiLCB1bmlxdWVfZGIsIGlkMSk7CiAgICAgICAgICAgICAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJERUxFVEUgL2FwaS8uLi4vaW5zdGFuY2VzL3tpZH0gLSBEZWxldGUgdXNlciIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJERUxFVEUiLCBkZWxldGVfdXJsLCBOVUxMLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICBwYXNzZWQrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRvdGFsKys7CiAgICAgICAgICAgICAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUoaW5zZXJ0X3Jlc3BvbnNlMik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwcmludGYoIlxuJXMlLTgwcyIgUkVTRVQsIEJMVUUsICJQT1NUIC9hcGkvZGF0YWJhc2VzL3tkYn0vY29sbGVjdGlvbnMve2NvbGx9L2luc3RhbmNlcyAtIEluc2VydCBzZWNvbmQgdXNlciIpOwogICAgICAgICAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdXG4iKTsKICAgICAgICAgICAgICAgIHRvdGFsKys7CiAgICAgICAgICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgcHJpbnRmKFJFRCAiICBbVkVSQk9TRV0gU2Vjb25kIHVzZXIgaW5zZXJ0aW9uIGZhaWxlZFxuIiBSRVNFVCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZyZWUoaWQxKTsKICAgICAgICB9CiAgICAgICAgaHR0cF9yZXNwb25zZV9mcmVlKGluc2VydF9yZXNwb25zZSk7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZigiXG4lcyUtODBzIiBSRVNFVCwgQkxVRSwgIlBPU1QgL2FwaS9kYXRhYmFzZXMve2RifS9jb2xsZWN0aW9ucy97Y29sbH0vaW5zdGFuY2VzIC0gSW5zZXJ0IGZpcnN0IHVzZXIiKTsKICAgICAgICBwcmludGYoIlsiIFJFRCAiRkFJTCIgUkVTRVQgIl1cbiIpOwogICAgICAgIHRvdGFsKys7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBGaXJzdCB1c2VyIGluc2VydGlvbiBmYWlsZWRcbiIgUkVTRVQpOwogICAgICAgIH0KICAgIH0KICAgIHRvdGFsKys7CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgSW5zdGFuY2UgQVBJIHRlc3RzOiAlZC8lZCBwYXNzZWQgKGF2ZzogJWxsZCBtcylcbiIgUkVTRVQsIAogICAgICAgICAgIHBhc3NlZCwgdG90YWwsIHRvdGFsX3RpbWUgLyAodG90YWwgPiAwID8gdG90YWwgOiAxKSk7CiAgICAKICAgIHJldHVybiBwYXNzZWQ7Cn0KCmludCBydW5faHR0cF9jb21tYW5kX3Rlc3RzKCkgewogICAgcHJpbnRmKCJcbiIgTUFHRU5UQSAiSFRUUCBBUEkgQ09NTUFORCBURVNUUyIgUkVTRVQgIlxuIik7CiAgICAKICAgIGludCBwYXNzZWQgPSAwOwogICAgaW50IHRvdGFsID0gMDsKICAgIGxvbmcgbG9uZyB0b3RhbF90aW1lID0gMDsKICAgIGxvbmcgbG9uZyBkdXJhdGlvbjsKICAgIAogICAgLy8gVGVzdCAxOiBFeGVjdXRlIGNvbW1hbmQKICAgIGNvbnN0IGNoYXIqIGNvbW1hbmQgPSAie1wiY29tbWFuZFwiOlwibGlzdFwiLFwiYXJndW1lbnRzXCI6W119IjsKICAgIGlmIChodHRwX3Rlc3RfZW5kcG9pbnQoIlBPU1QgL2FwaS9leGVjdXRlIC0gRXhlY3V0ZSBsaXN0IGNvbW1hbmQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiUE9TVCIsICIvYXBpL2V4ZWN1dGUiLCBjb21tYW5kLCAiXCJzdWNjZXNzXCI6dHJ1ZSIsIDAsICZkdXJhdGlvbikpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIENvbW1hbmQgQVBJIHRlc3RzOiAlZC8lZCBwYXNzZWQgKGF2ZzogJWxsZCBtcylcbiIgUkVTRVQsIAogICAgICAgICAgIHBhc3NlZCwgdG90YWwsIHRvdGFsX3RpbWUgLyB0b3RhbCk7CiAgICAKICAgIHJldHVybiBwYXNzZWQ7Cn0KCmludCBydW5faHR0cF9lcnJvcl90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIkhUVFAgQVBJIEVSUk9SIEhBTkRMSU5HIFRFU1RTIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaW50IHBhc3NlZCA9IDA7CiAgICBpbnQgdG90YWwgPSAwOwogICAgbG9uZyBsb25nIHRvdGFsX3RpbWUgPSAwOwogICAgbG9uZyBsb25nIGR1cmF0aW9uOwogICAgCiAgICAvLyBUZXN0IDE6IEludmFsaWQgZGF0YWJhc2UgbmFtZQogICAgaWYgKGh0dHBfdGVzdF9lbmRwb2ludCgiUE9TVCAvYXBpL2RhdGFiYXNlcyAtIEludmFsaWQgZGF0YWJhc2UgbmFtZSIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NUIiwgIi9hcGkvZGF0YWJhc2VzIiwgIntcIm5hbWVcIjpcImludmFsaWQvbmFtZVwifSIsICJcInN1Y2Nlc3NcIjpmYWxzZSIsIDEsICZkdXJhdGlvbikpIHsKICAgICAgICBwYXNzZWQrKzsKICAgIH0KICAgIHRvdGFsKys7CiAgICB0b3RhbF90aW1lICs9IGR1cmF0aW9uOwogICAgCiAgICAvLyBUZXN0IDI6IE5vbi1leGlzdGVudCBkYXRhYmFzZSBjb2xsZWN0aW9ucyAoc2hvdWxkIHJldHVybiBwcm9wZXIgZXJyb3IpCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMvbm9uZXhpc3RlbnQvY29sbGVjdGlvbnMgLSBOb24tZXhpc3RlbnQgZGF0YWJhc2UiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAiR0VUIiwgIi9hcGkvZGF0YWJhc2VzL25vbmV4aXN0ZW50L2NvbGxlY3Rpb25zIiwgTlVMTCwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIC8vIFRlc3QgMzogTm9uLWV4aXN0ZW50IGNvbGxlY3Rpb24gaW5zdGFuY2VzCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJHRVQgL2FwaS9kYXRhYmFzZXMvdGVzdGRiL2NvbGxlY3Rpb25zL25vbmV4aXN0ZW50L2luc3RhbmNlcyAtIE5vbi1leGlzdGVudCBjb2xsZWN0aW9uIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkdFVCIsICIvYXBpL2RhdGFiYXNlcy90ZXN0ZGIvY29sbGVjdGlvbnMvbm9uZXhpc3RlbnQvaW5zdGFuY2VzIiwgTlVMTCwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIC8vIFRlc3QgNDogSW52YWxpZCBKU09OCiAgICBpZiAoaHR0cF90ZXN0X2VuZHBvaW50KCJQT1NUIC9hcGkvZGF0YWJhc2VzIC0gSW52YWxpZCBKU09OIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU1QiLCAiL2FwaS9kYXRhYmFzZXMiLCAiaW52YWxpZCBqc29uIiwgIlwic3VjY2Vzc1wiOmZhbHNlIiwgMSwgJmR1cmF0aW9uKSkgewogICAgICAgIHBhc3NlZCsrOwogICAgfQogICAgdG90YWwrKzsKICAgIHRvdGFsX3RpbWUgKz0gZHVyYXRpb247CiAgICAKICAgIC8vIFRlc3QgNTogTWV0aG9kIG5vdCBhbGxvd2VkCiAgICBIdHRwUmVzcG9uc2UqIHJlc3BvbnNlID0gaHR0cF9yZXF1ZXN0KCJQQVRDSCIsICIvYXBpL2RhdGFiYXNlcy90ZXN0ZGIiLCBOVUxMLCBOVUxMKTsKICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS0+c3RhdHVzX2NvZGUgPT0gNDA1KSB7CiAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiUEFUQ0ggL2FwaS9kYXRhYmFzZXMvdGVzdGRiIC0gTWV0aG9kIG5vdCBhbGxvd2VkIik7CiAgICAgICAgcHJpbnRmKCJbIiBHUkVFTiAiUEFTUyIgUkVTRVQgIl1cbiIpOwogICAgICAgIHBhc3NlZCsrOwogICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgcHJpbnRmKEdSRUVOICIgIFtWRVJCT1NFXSBNZXRob2Qgbm90IGFsbG93ZWQgaGFuZGxlZCBjb3JyZWN0bHlcbiIgUkVTRVQpOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgcHJpbnRmKCJcbiVzJS04MHMiIFJFU0VULCBCTFVFLCAiUEFUQ0ggL2FwaS9kYXRhYmFzZXMvdGVzdGRiIC0gTWV0aG9kIG5vdCBhbGxvd2VkIik7CiAgICAgICAgcHJpbnRmKCJbIiBSRUQgIkZBSUwiIFJFU0VUICJdXG4iKTsKICAgICAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIEV4cGVjdGVkIDQwNSBNZXRob2QgTm90IEFsbG93ZWQsIGdvdDogJWRcbiIgUkVTRVQsIHJlc3BvbnNlID8gcmVzcG9uc2UtPnN0YXR1c19jb2RlIDogMCk7CiAgICAgICAgfQogICAgfQogICAgdG90YWwrKzsKICAgIGh0dHBfcmVzcG9uc2VfZnJlZShyZXNwb25zZSk7CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgRXJyb3IgaGFuZGxpbmcgdGVzdHM6ICVkLyVkIHBhc3NlZCAoYXZnOiAlbGxkIG1zKVxuIiBSRVNFVCwgCiAgICAgICAgICAgcGFzc2VkLCB0b3RhbCwgdG90YWxfdGltZSAvICh0b3RhbCA+IDAgPyB0b3RhbCA6IDEpKTsKICAgIAogICAgcmV0dXJuIHBhc3NlZDsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gQ0xJIFRFU1QgU1VJVEVTID09PT09PT09PT09PT09PT09PT09Cgp2b2lkIHJ1bl9zZWN1cml0eV90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIlNFQ1VSSVRZIFRFU1RTIC0gUGF0aCB2YWxpZGF0aW9uIGFuZCBpbmplY3Rpb24gcHJldmVudGlvbiIgUkVTRVQgIlxuIik7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBTdGFydGluZyBzZWN1cml0eSB0ZXN0cyB3aXRoIHZlcmJvc2UgbG9nZ2luZ1xuIiBSRVNFVCk7CiAgICB9CiAgICAKICAgIFRlc3RDYXNlIHNlY3VyaXR5X3Rlc3RzW10gPSB7CiAgICAgICAgewogICAgICAgICAgICAiUHJldmVudCBkaXJlY3RvcnkgdHJhdmVyc2FsIGluIGRhdGFiYXNlIG5hbWVzIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSAnLi4vZXZpbCcgMj4mMSB8IGdyZXAgLWkgJ2ludmFsaWRcXHxlcnJvcicgPiAvZGV2L251bGwiLAogICAgICAgICAgICAidGVzdCAhIC1kICcvdG1wL3N5ZGJfdGVzdC8uLi9ldmlsJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlByZXZlbnQgZGlyZWN0b3J5IHRyYXZlcnNhbCBpbiBjb2xsZWN0aW9uIG5hbWVzIiwgCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiICcuLi8uLi9ldmlsJyAtLXNjaGVtYSAtLW5hbWUtc3RyaW5nIDI+JjEgfCBncmVwIC1pICdpbnZhbGlkXFx8ZXJyb3InID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgInRlc3QgISAtZCAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiLy4uLy4uL2V2aWwnIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiUmVqZWN0IGludmFsaWQgZGF0YWJhc2UgbmFtZXMgd2l0aCBzcGVjaWFsIGNoYXJzIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSAnaW52YWxpZC9uYW1lJyAyPiYxIHwgZ3JlcCAtaSAnaW52YWxpZFxcfGVycm9yJyA+IC9kZXYvbnVsbCIsCiAgICAgICAgICAgICJ0ZXN0ICEgLWQgJy90bXAvc3lkYl90ZXN0L2ludmFsaWQvbmFtZSciLCAKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0KICAgIH07CiAgICAKICAgIGludCBzZWN1cml0eV9jb3VudCA9IHNpemVvZihzZWN1cml0eV90ZXN0cykgLyBzaXplb2Yoc2VjdXJpdHlfdGVzdHNbMF0pOwogICAgaW50IHNlY3VyaXR5X3Bhc3NlZCA9IDA7CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2VjdXJpdHlfY291bnQ7IGkrKykgewogICAgICAgIC8vIFJlcGxhY2UgJXMgd2l0aCBjbGlfY29tbWFuZCBpbiBib3RoIGNvbW1hbmQgYW5kIHZlcmlmaWNhdGlvbl9jb21tYW5kCiAgICAgICAgY2hhciBmaW5hbF9jb21tYW5kWzEwMjRdOwogICAgICAgIGNoYXIgZmluYWxfdmVyaWZpY2F0aW9uWzEwMjRdOwogICAgICAgIAogICAgICAgIHNucHJpbnRmKGZpbmFsX2NvbW1hbmQsIHNpemVvZihmaW5hbF9jb21tYW5kKSwgc2VjdXJpdHlfdGVzdHNbaV0uY29tbWFuZCwgY2xpX2NvbW1hbmQpOwogICAgICAgIHNucHJpbnRmKGZpbmFsX3ZlcmlmaWNhdGlvbiwgc2l6ZW9mKGZpbmFsX3ZlcmlmaWNhdGlvbiksIHNlY3VyaXR5X3Rlc3RzW2ldLnZlcmlmaWNhdGlvbl9jb21tYW5kLCBjbGlfY29tbWFuZCk7CiAgICAgICAgCiAgICAgICAgc3RyY3B5KHNlY3VyaXR5X3Rlc3RzW2ldLmNvbW1hbmQsIGZpbmFsX2NvbW1hbmQpOwogICAgICAgIHN0cmNweShzZWN1cml0eV90ZXN0c1tpXS52ZXJpZmljYXRpb25fY29tbWFuZCwgZmluYWxfdmVyaWZpY2F0aW9uKTsKICAgICAgICAKICAgICAgICBpZiAoZXhlY3V0ZV90ZXN0X3dpdGhfdmVyaWZpY2F0aW9uKCZzZWN1cml0eV90ZXN0c1tpXSkpIHsKICAgICAgICAgICAgc2VjdXJpdHlfcGFzc2VkKys7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcmludGYoWUVMTE9XICIgIFNlY3VyaXR5IHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIHNlY3VyaXR5X3Bhc3NlZCwgc2VjdXJpdHlfY291bnQpOwp9Cgp2b2lkIHJ1bl9kYXRhX2ludGVncml0eV90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIkRBVEEgSU5URUdSSVRZIFRFU1RTIC0gQ1JDIHZhbGlkYXRpb24gYW5kIGZpbGUgc3RydWN0dXJlIiBSRVNFVCAiXG4iKTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFN0YXJ0aW5nIGRhdGEgaW50ZWdyaXR5IHRlc3RzXG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgLy8gQ3JlYXRlIHRlc3QgZGF0YWJhc2UgYW5kIGNvbGxlY3Rpb24gZmlyc3QKICAgIGNoYXIgY3JlYXRlX2RiX2NtZFsyNTZdOwogICAgY2hhciBjcmVhdGVfY29sbGVjdGlvbl9jbWRbMjU2XTsKICAgIGNoYXIgaW5zZXJ0X2NtZFsyNTZdOwogICAgCiAgICBzbnByaW50ZihjcmVhdGVfZGJfY21kLCBzaXplb2YoY3JlYXRlX2RiX2NtZCksICIlcyBjcmVhdGUgaW50ZWdyaXR5ZGIgPiAvZGV2L251bGwgMj4mMSIsIGNsaV9jb21tYW5kKTsKICAgIHNucHJpbnRmKGNyZWF0ZV9jb2xsZWN0aW9uX2NtZCwgc2l6ZW9mKGNyZWF0ZV9jb2xsZWN0aW9uX2NtZCksICIlcyBjcmVhdGUgaW50ZWdyaXR5ZGIgZGF0YSAtLXNjaGVtYSAtLXZhbHVlLXN0cmluZy1yZXEgPiAvZGV2L251bGwgMj4mMSIsIGNsaV9jb21tYW5kKTsKICAgIHNucHJpbnRmKGluc2VydF9jbWQsIHNpemVvZihpbnNlcnRfY21kKSwgIiVzIGNyZWF0ZSBpbnRlZ3JpdHlkYiBkYXRhIC0taW5zZXJ0LW9uZSAtLXZhbHVlLVwidGVzdF9kYXRhXzFcIiA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQpOwogICAgCiAgICBzeXN0ZW0oY3JlYXRlX2RiX2NtZCk7CiAgICBzeXN0ZW0oY3JlYXRlX2NvbGxlY3Rpb25fY21kKTsKICAgIHN5c3RlbShpbnNlcnRfY21kKTsKICAgIAogICAgVGVzdENhc2UgaW50ZWdyaXR5X3Rlc3RzW10gPSB7CiAgICAgICAgewogICAgICAgICAgICAiRGF0YSBmaWxlIGhhcyB2YWxpZCBoZWFkZXIgc3RydWN0dXJlIiwKICAgICAgICAgICAgImVjaG8gJ0hlYWRlciBjaGVjaycgPiAvZGV2L251bGwiLAogICAgICAgICAgICAiaGV4ZHVtcCAtQyAvdG1wL3N5ZGJfdGVzdC9pbnRlZ3JpdHlkYi9kYXRhL2RhdGEuc3lkYiB8IGhlYWQgLTIgfCBncmVwIC1xICdTWURCJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkRhdGEgZmlsZSBncm93cyB3aXRoIGluc2VydHMiLAogICAgICAgICAgICAiJXMgY3JlYXRlIGludGVncml0eWRiIGRhdGEgLS1pbnNlcnQtb25lIC0tdmFsdWUtXCJ0ZXN0X2RhdGFfMlwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAibHMgLWwgL3RtcC9zeWRiX3Rlc3QvaW50ZWdyaXR5ZGIvZGF0YS9kYXRhLnN5ZGIgfCBhd2sgJ3twcmludCAkNX0nIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0KICAgIH07CiAgICAKICAgIGludCBpbnRlZ3JpdHlfY291bnQgPSBzaXplb2YoaW50ZWdyaXR5X3Rlc3RzKSAvIHNpemVvZihpbnRlZ3JpdHlfdGVzdHNbMF0pOwogICAgaW50IGludGVncml0eV9wYXNzZWQgPSAwOwogICAgCiAgICBmb3IgKGludCBpID0gMDsgaSA8IGludGVncml0eV9jb3VudDsgaSsrKSB7CiAgICAgICAgLy8gUmVwbGFjZSAlcyB3aXRoIGNsaV9jb21tYW5kCiAgICAgICAgaWYgKHN0cnN0cihpbnRlZ3JpdHlfdGVzdHNbaV0uY29tbWFuZCwgIiVzIikgIT0gTlVMTCkgewogICAgICAgICAgICBjaGFyIGZpbmFsX2NvbW1hbmRbMTAyNF07CiAgICAgICAgICAgIHNucHJpbnRmKGZpbmFsX2NvbW1hbmQsIHNpemVvZihmaW5hbF9jb21tYW5kKSwgaW50ZWdyaXR5X3Rlc3RzW2ldLmNvbW1hbmQsIGNsaV9jb21tYW5kKTsKICAgICAgICAgICAgc3RyY3B5KGludGVncml0eV90ZXN0c1tpXS5jb21tYW5kLCBmaW5hbF9jb21tYW5kKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGV4ZWN1dGVfdGVzdF93aXRoX3ZlcmlmaWNhdGlvbigmaW50ZWdyaXR5X3Rlc3RzW2ldKSkgewogICAgICAgICAgICBpbnRlZ3JpdHlfcGFzc2VkKys7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcmludGYoWUVMTE9XICIgIERhdGEgaW50ZWdyaXR5IHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIGludGVncml0eV9wYXNzZWQsIGludGVncml0eV9jb3VudCk7Cn0KCnZvaWQgcnVuX3BlcmZvcm1hbmNlX3Rlc3QoKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBICJQRVJGT1JNQU5DRSBBTkQgU0NBTEFCSUxJVFkgVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gU3RhcnRpbmcgcGVyZm9ybWFuY2UgdGVzdHNcbiIgUkVTRVQpOwogICAgfQogICAgCiAgICAvLyBTZXR1cCBwZXJmb3JtYW5jZSBkYXRhYmFzZQogICAgcHJpbnRmKCJTZXR0aW5nIHVwIHBlcmZvcm1hbmNlIGRhdGFiYXNlLi4uXG4iKTsKICAgIGNoYXIgY3JlYXRlX2RiX2NtZFsyNTZdOwogICAgY2hhciBjcmVhdGVfY29sbGVjdGlvbl9jbWRbMjU2XTsKICAgIAogICAgc25wcmludGYoY3JlYXRlX2RiX2NtZCwgc2l6ZW9mKGNyZWF0ZV9kYl9jbWQpLCAiJXMgY3JlYXRlIHBlcmZkYiA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQpOwogICAgc25wcmludGYoY3JlYXRlX2NvbGxlY3Rpb25fY21kLCBzaXplb2YoY3JlYXRlX2NvbGxlY3Rpb25fY21kKSwgIiVzIGNyZWF0ZSBwZXJmZGIgdXNlcnMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZy1yZXEgLS1hZ2UtaW50IC0tZW1haWwtc3RyaW5nID4gL2Rldi9udWxsIDI+JjEiLCBjbGlfY29tbWFuZCk7CiAgICAKICAgIHN5c3RlbShjcmVhdGVfZGJfY21kKTsKICAgIHN5c3RlbShjcmVhdGVfY29sbGVjdGlvbl9jbWQpOwogICAgCiAgICAvLyBUZXN0IDE6IFNpbmdsZSBpbnNlcnQgcGVyZm9ybWFuY2UKICAgIGNoYXIgc2luZ2xlX2luc2VydF9jbWRbMjU2XTsKICAgIHNucHJpbnRmKHNpbmdsZV9pbnNlcnRfY21kLCBzaXplb2Yoc2luZ2xlX2luc2VydF9jbWQpLCAiJXMgY3JlYXRlIHBlcmZkYiB1c2VycyAtLWluc2VydC1vbmUgLS1uYW1lLVwiU2luZ2xlVXNlclwiIC0tYWdlLTMwIC0tZW1haWwtXCJzaW5nbGVAdGVzdC5jb21cIiA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQpOwogICAgCiAgICBsb25nIGxvbmcgc3RhcnRfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKTsKICAgIHN5c3RlbShzaW5nbGVfaW5zZXJ0X2NtZCk7CiAgICBsb25nIGxvbmcgc2luZ2xlX2luc2VydF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpIC0gc3RhcnRfdGltZTsKICAgIAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIFNpbmdsZSBpbnNlcnQgdGltZTogJWxsZCBtc1xuIiBSRVNFVCwgc2luZ2xlX2luc2VydF90aW1lKTsKICAgIH0KICAgIAogICAgLy8gVGVzdCAyOiBCYXRjaCBpbnNlcnQgcGVyZm9ybWFuY2UKICAgIGludCBiYXRjaF9zaXplID0gNTA7CiAgICBwcmludGYoIkluc2VydGluZyAlZCByZWNvcmRzIGZvciBiYXRjaCBwZXJmb3JtYW5jZS4uLlxuIiwgYmF0Y2hfc2l6ZSk7CiAgICAKICAgIHN0YXJ0X3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICBpbnQgc3VjY2Vzc19jb3VudCA9IDA7CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmF0Y2hfc2l6ZTsgaSsrKSB7CiAgICAgICAgY2hhciBjb21tYW5kWzUxMl07CiAgICAgICAgc25wcmludGYoY29tbWFuZCwgc2l6ZW9mKGNvbW1hbmQpLAogICAgICAgICAgICAgICAgICIlcyBjcmVhdGUgcGVyZmRiIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJVc2VyJWRcIiAtLWFnZS0lZCAtLWVtYWlsLVwidXNlciVkQHRlc3QuY29tXCIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICAgICAgY2xpX2NvbW1hbmQsIGksIDIwICsgKGkgJSA0MCksIGkpOwogICAgICAgIAogICAgICAgIGlmIChzeXN0ZW0oY29tbWFuZCkgPT0gMCkgewogICAgICAgICAgICBzdWNjZXNzX2NvdW50Kys7CiAgICAgICAgfQogICAgfQogICAgCiAgICBsb25nIGxvbmcgYmF0Y2hfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0X3RpbWU7CiAgICBkb3VibGUgYXZnX2JhdGNoX3RpbWUgPSAoZG91YmxlKWJhdGNoX3RpbWUgLyBiYXRjaF9zaXplOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gQmF0Y2ggaW5zZXJ0OiAlZC8lZCBzdWNjZXNzZnVsLCB0b3RhbCB0aW1lOiAlbGxkIG1zLCBhdmc6ICUuMmYgbXNcbiIgUkVTRVQsIAogICAgICAgICAgICAgICBzdWNjZXNzX2NvdW50LCBiYXRjaF9zaXplLCBiYXRjaF90aW1lLCBhdmdfYmF0Y2hfdGltZSk7CiAgICB9CiAgICAKICAgIC8vIFRlc3QgMzogUXVlcnkgcGVyZm9ybWFuY2UKICAgIHByaW50ZigiVGVzdGluZyBxdWVyeSBwZXJmb3JtYW5jZS4uLlxuIik7CiAgICBjaGFyIHF1ZXJ5X2NtZFsyNTZdOwogICAgc25wcmludGYocXVlcnlfY21kLCBzaXplb2YocXVlcnlfY21kKSwgIiVzIGZpbmQgcGVyZmRiIHVzZXJzIC0td2hlcmUgXCJhZ2U6MjVcIiA+IC9kZXYvbnVsbCAyPiYxIiwgY2xpX2NvbW1hbmQpOwogICAgCiAgICBzdGFydF90aW1lID0gZ2V0X2N1cnJlbnRfdGltZV9tcygpOwogICAgc3lzdGVtKHF1ZXJ5X2NtZCk7CiAgICBsb25nIGxvbmcgcXVlcnlfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0X3RpbWU7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoWUVMTE9XICIgIFtWRVJCT1NFXSBRdWVyeSB0aW1lOiAlbGxkIG1zXG4iIFJFU0VULCBxdWVyeV90aW1lKTsKICAgIH0KICAgIAogICAgLy8gVGVzdCA0OiBDb3VudCB2ZXJpZmljYXRpb24KICAgIGludCBhY3R1YWxfY291bnQgPSBjb3VudF9pbnN0YW5jZXNfaW5fY29sbGVjdGlvbigicGVyZmRiIiwgInVzZXJzIik7CiAgICAKICAgIHByaW50ZigiXG5QZXJmb3JtYW5jZSBSZXN1bHRzOlxuIik7CiAgICBwcmludGYoIiAgU2luZ2xlIGluc2VydDogIiBDWUFOICIlbGxkIG1zIiBSRVNFVCAiXG4iLCBzaW5nbGVfaW5zZXJ0X3RpbWUpOwogICAgcHJpbnRmKCIgIEJhdGNoIGluc2VydCAoJWQgcmVjb3Jkcyk6ICIgQ1lBTiAiJWxsZCBtcyIgUkVTRVQgIiAoYXZnOiAiIENZQU4gIiUuMmYgbXMiIFJFU0VUICIpXG4iLCAKICAgICAgICAgICBiYXRjaF9zaXplLCBiYXRjaF90aW1lLCBhdmdfYmF0Y2hfdGltZSk7CiAgICBwcmludGYoIiAgUXVlcnkgdGltZTogIiBDWUFOICIlbGxkIG1zIiBSRVNFVCAiXG4iLCBxdWVyeV90aW1lKTsKICAgIHByaW50ZigiICBJbnNlcnQgc3VjY2VzcyByYXRlOiAiIEdSRUVOICIlZC8lZCIgUkVTRVQgIlxuIiwgc3VjY2Vzc19jb3VudCwgYmF0Y2hfc2l6ZSk7CiAgICBwcmludGYoIiAgUmVjb3JkIGNvdW50IHZlcmlmaWNhdGlvbjogIiBHUkVFTiAiJWQiIFJFU0VUICIgcmVjb3JkcyBpbiBjb2xsZWN0aW9uXG4iLCBhY3R1YWxfY291bnQpOwogICAgCiAgICAvLyBQZXJmb3JtYW5jZSB0aHJlc2hvbGRzIChhZGp1c3QgYmFzZWQgb24geW91ciByZXF1aXJlbWVudHMpCiAgICBpbnQgcGVyZm9ybWFuY2Vfb2sgPSAoc2luZ2xlX2luc2VydF90aW1lIDwgMTAwMCkgJiYgKGF2Z19iYXRjaF90aW1lIDwgNTAwKSAmJiAocXVlcnlfdGltZSA8IDUwMCk7CiAgICBpZiAocGVyZm9ybWFuY2Vfb2spIHsKICAgICAgICBwcmludGYoR1JFRU4gIiAg4pyTIFBlcmZvcm1hbmNlIHdpdGhpbiBhY2NlcHRhYmxlIGxpbWl0c1xuIiBSRVNFVCk7CiAgICB9IGVsc2UgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAg4pqgIFBlcmZvcm1hbmNlIG1heSBuZWVkIG9wdGltaXphdGlvblxuIiBSRVNFVCk7CiAgICB9Cn0KCnZvaWQgcnVuX2VkZ2VfY2FzZV90ZXN0cygpIHsKICAgIHByaW50ZigiXG4iIE1BR0VOVEEgIkVER0UgQ0FTRSBBTkQgRVJST1IgSEFORExJTkcgVEVTVFMiIFJFU0VUICJcbiIpOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gU3RhcnRpbmcgZWRnZSBjYXNlIHRlc3RzXG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgVGVzdENhc2UgZWRnZV90ZXN0c1tdID0gewogICAgICAgIHsKICAgICAgICAgICAgIkhhbmRsZSBkdXBsaWNhdGUgZGF0YWJhc2UgY3JlYXRpb24iLAogICAgICAgICAgICAiJXMgY3JlYXRlIHRlc3RkYiAyPiYxIHwgZ3JlcCAtaSAnZXhpc3RcXHxlcnJvcicgPiAvZGV2L251bGwiLAogICAgICAgICAgICAiJXMgbGlzdCB8IGdyZXAgLWMgdGVzdGRiIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiSGFuZGxlIGR1cGxpY2F0ZSBjb2xsZWN0aW9uIGNyZWF0aW9uIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgdXNlcnMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZyAyPiYxIHwgZ3JlcCAtaSAnZXhpc3RcXHxlcnJvcicgPiAvZGV2L251bGwiLCAKICAgICAgICAgICAgIiVzIGxpc3QgdGVzdGRiIHwgZ3JlcCAtYyB1c2VycyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkhhbmRsZSBtaXNzaW5nIGRhdGFiYXNlIHF1ZXJpZXMiLAogICAgICAgICAgICAiJXMgZmluZCBub25leGlzdGVudGRiIHVzZXJzIC0td2hlcmUgXCJuYW1lOnRlc3RcIiAyPiYxIHwgZ3JlcCAtaSAnZXhpc3RcXHxlcnJvcicgPiAvZGV2L251bGwiLAogICAgICAgICAgICAiZWNobyAnRXJyb3IgaGFuZGxlZCciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJIYW5kbGUgbWlzc2luZyBjb2xsZWN0aW9uIHF1ZXJpZXMiLCAKICAgICAgICAgICAgIiVzIGZpbmQgdGVzdGRiIG5vbmV4aXN0ZW50IC0td2hlcmUgXCJuYW1lOnRlc3RcIiAyPiYxIHwgZ3JlcCAtaSAnZXhpc3RcXHxlcnJvcicgPiAvZGV2L251bGwiLAogICAgICAgICAgICAiZWNobyAnRXJyb3IgaGFuZGxlZCciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJIYW5kbGUgbWFsZm9ybWVkIHF1ZXJpZXMiLAogICAgICAgICAgICAiJXMgZmluZCB0ZXN0ZGIgdXNlcnMgLS13aGVyZSBcImludmFsaWQtcXVlcnktZm9ybWF0XCIgMj4mMSB8IGdyZXAgLWkgJ2Vycm9yXFx8aW52YWxpZCcgPiAvZGV2L251bGwiLAogICAgICAgICAgICAiZWNobyAnRXJyb3IgaGFuZGxlZCciLCAKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiSGFuZGxlIHNjaGVtYSB2YWxpZGF0aW9uIGZhaWx1cmVzIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgdXNlcnMgLS1pbnNlcnQtb25lIC0taW52YWxpZC1maWVsZC1cInZhbHVlXCIgMj4mMSB8IGdyZXAgLWkgJ2Vycm9yXFx8dmFsaWQnID4gL2Rldi9udWxsIiwKICAgICAgICAgICAgImVjaG8gJ1ZhbGlkYXRpb24gd29ya2VkJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9CiAgICB9OwogICAgCiAgICBpbnQgZWRnZV9jb3VudCA9IHNpemVvZihlZGdlX3Rlc3RzKSAvIHNpemVvZihlZGdlX3Rlc3RzWzBdKTsKICAgIGludCBlZGdlX3Bhc3NlZCA9IDA7CiAgICAKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZWRnZV9jb3VudDsgaSsrKSB7CiAgICAgICAgLy8gUmVwbGFjZSAlcyB3aXRoIGNsaV9jb21tYW5kIGluIGJvdGggY29tbWFuZCBhbmQgdmVyaWZpY2F0aW9uX2NvbW1hbmQKICAgICAgICBjaGFyIGZpbmFsX2NvbW1hbmRbMTAyNF07CiAgICAgICAgY2hhciBmaW5hbF92ZXJpZmljYXRpb25bMTAyNF07CiAgICAgICAgCiAgICAgICAgc25wcmludGYoZmluYWxfY29tbWFuZCwgc2l6ZW9mKGZpbmFsX2NvbW1hbmQpLCBlZGdlX3Rlc3RzW2ldLmNvbW1hbmQsIGNsaV9jb21tYW5kKTsKICAgICAgICBzbnByaW50ZihmaW5hbF92ZXJpZmljYXRpb24sIHNpemVvZihmaW5hbF92ZXJpZmljYXRpb24pLCBlZGdlX3Rlc3RzW2ldLnZlcmlmaWNhdGlvbl9jb21tYW5kLCBjbGlfY29tbWFuZCk7CiAgICAgICAgCiAgICAgICAgc3RyY3B5KGVkZ2VfdGVzdHNbaV0uY29tbWFuZCwgZmluYWxfY29tbWFuZCk7CiAgICAgICAgc3RyY3B5KGVkZ2VfdGVzdHNbaV0udmVyaWZpY2F0aW9uX2NvbW1hbmQsIGZpbmFsX3ZlcmlmaWNhdGlvbik7CiAgICAgICAgCiAgICAgICAgaWYgKGV4ZWN1dGVfdGVzdF93aXRoX3ZlcmlmaWNhdGlvbigmZWRnZV90ZXN0c1tpXSkpIHsKICAgICAgICAgICAgZWRnZV9wYXNzZWQrKzsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHByaW50ZihZRUxMT1cgIiAgRWRnZSBjYXNlIHRlc3RzOiAlZC8lZCBwYXNzZWRcbiIgUkVTRVQsIGVkZ2VfcGFzc2VkLCBlZGdlX2NvdW50KTsKfQoKdm9pZCBydW5fY29tcHJlaGVuc2l2ZV92ZXJpZmljYXRpb24oKSB7CiAgICBwcmludGYoIlxuIiBNQUdFTlRBICJDT01QUkVIRU5TSVZFIFNUUlVDVFVSRSBWRVJJRklDQVRJT04iIFJFU0VUICJcbiIpOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlKSB7CiAgICAgICAgcHJpbnRmKFlFTExPVyAiICBbVkVSQk9TRV0gU3RhcnRpbmcgY29tcHJlaGVuc2l2ZSBzdHJ1Y3R1cmUgdmVyaWZpY2F0aW9uXG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgaW50IHZlcmlmaWNhdGlvbl9wYXNzZWQgPSAwOwogICAgaW50IHZlcmlmaWNhdGlvbl90b3RhbCA9IDA7CiAgICAKICAgIC8vIFZlcmlmeSB0ZXN0ZGIgc3RydWN0dXJlCiAgICBwcmludGYoIlZlcmlmeWluZyB0ZXN0ZGIgc3RydWN0dXJlLi4uXG4iKTsKICAgIGlmICh2ZXJpZnlfZGF0YWJhc2Vfc3RydWN0dXJlKCJ0ZXN0ZGIiKSkgdmVyaWZpY2F0aW9uX3Bhc3NlZCsrOwogICAgdmVyaWZpY2F0aW9uX3RvdGFsKys7CiAgICAKICAgIGlmICh2ZXJpZnlfY29sbGVjdGlvbl9zdHJ1Y3R1cmUoInRlc3RkYiIsICJ1c2VycyIpKSB2ZXJpZmljYXRpb25fcGFzc2VkKys7CiAgICB2ZXJpZmljYXRpb25fdG90YWwrKzsKICAgIAogICAgaWYgKHZlcmlmeV9jb2xsZWN0aW9uX3N0cnVjdHVyZSgidGVzdGRiIiwgInByb2R1Y3RzIikpIHZlcmlmaWNhdGlvbl9wYXNzZWQrKzsKICAgIHZlcmlmaWNhdGlvbl90b3RhbCsrOwogICAgCiAgICBpZiAodmVyaWZ5X3NjaGVtYV9jb250ZW50KCJ0ZXN0ZGIiLCAidXNlcnMiLCAibmFtZSIpKSB2ZXJpZmljYXRpb25fcGFzc2VkKys7CiAgICB2ZXJpZmljYXRpb25fdG90YWwrKzsKICAgIAogICAgLy8gVmVyaWZ5IHRlc3RkYjIgc3RydWN0dXJlICAKICAgIHByaW50ZigiVmVyaWZ5aW5nIHRlc3RkYjIgc3RydWN0dXJlLi4uXG4iKTsKICAgIGlmICh2ZXJpZnlfZGF0YWJhc2Vfc3RydWN0dXJlKCJ0ZXN0ZGIyIikpIHZlcmlmaWNhdGlvbl9wYXNzZWQrKzsKICAgIHZlcmlmaWNhdGlvbl90b3RhbCsrOwogICAgCiAgICBwcmludGYoWUVMTE9XICIgIFN0cnVjdHVyZSB2ZXJpZmljYXRpb246ICVkLyVkIHBhc3NlZFxuIiBSRVNFVCwgdmVyaWZpY2F0aW9uX3Bhc3NlZCwgdmVyaWZpY2F0aW9uX3RvdGFsKTsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT0gQ09SRSBDTEkgVEVTVCBTVUlURSA9PT09PT09PT09PT09PT09PT09PQoKaW50IHJ1bl9jbGlfdGVzdHMoKSB7CiAgICBwcmludGYoQ1lBTiAiU1lEQiBDTEkgQ09NUFJFSEVOU0lWRSBURVNUIFNVSVRFXG4iIFJFU0VUKTsKICAgIHByaW50ZigiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIpOwogICAgcHJpbnRmKCJVc2luZyBjb21tYW5kOiAiIFlFTExPVyAiJXMiIFJFU0VUICJcbiIsIGNsaV9jb21tYW5kKTsKICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICBwcmludGYoIlZlcmJvc2UgbW9kZTogIiBZRUxMT1cgIkVOQUJMRUQiIFJFU0VUICIgLSBEZXRhaWxlZCBsb2dnaW5nIGZvciBmYWlsdXJlc1xuIik7CiAgICB9CiAgICBwcmludGYoIlxuIik7CiAgICAKICAgIC8vIENsZWFudXAgcHJldmlvdXMgdGVzdAogICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgIHByaW50ZihZRUxMT1cgIiAgW1ZFUkJPU0VdIENsZWFuaW5nIHVwIHByZXZpb3VzIHRlc3QgZGF0YS4uLlxuIiBSRVNFVCk7CiAgICB9CiAgICBzeXN0ZW0oInJtIC1yZiAvdG1wL3N5ZGJfdGVzdCA+IC9kZXYvbnVsbCAyPiYxIik7CiAgICAKICAgIC8vIENvcmUgZnVuY3Rpb25hbGl0eSB0ZXN0cwogICAgVGVzdENhc2UgdGVzdHNbXSA9IHsKICAgICAgICAvLyBEYXRhYmFzZSBPcGVyYXRpb25zIHdpdGggdmVyaWZpY2F0aW9uCiAgICAgICAgewogICAgICAgICAgICAiQ3JlYXRlIGRhdGFiYXNlICd0ZXN0ZGInIGFuZCB2ZXJpZnkgc3RydWN0dXJlIiwgCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAidGVzdCAtZCAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiJyIsCiAgICAgICAgICAgICIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkNyZWF0ZSBzZWNvbmQgZGF0YWJhc2UgJ3Rlc3RkYjInIGFuZCB2ZXJpZnkiLCAKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIyID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAidGVzdCAtZCAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiMiciLCAKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiTGlzdCBkYXRhYmFzZXMgYW5kIHZlcmlmeSBib3RoIGV4aXN0IiwKICAgICAgICAgICAgIiVzIGxpc3QgPiAvZGV2L251bGwgMj4mMSIsIAogICAgICAgICAgICAiJXMgbGlzdCB8IGdyZXAgLWMgJ3Rlc3RkYlxcfHRlc3RkYjInIiwKICAgICAgICAgICAgIjIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIAogICAgICAgIC8vIENvbGxlY3Rpb24gT3BlcmF0aW9ucyB3aXRoIGRlZXAgdmVyaWZpY2F0aW9uCiAgICAgICAgewogICAgICAgICAgICAiQ3JlYXRlICd1c2VycycgY29sbGVjdGlvbiB3aXRoIHNjaGVtYSBhbmQgdmVyaWZ5IGZpbGVzIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgdXNlcnMgLS1zY2hlbWEgLS1uYW1lLXN0cmluZy1yZXEgLS1hZ2UtaW50IC0tZW1haWwtc3RyaW5nID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAidGVzdCAtZiAnL3RtcC9zeWRiX3Rlc3QvdGVzdGRiL3VzZXJzL3NjaGVtYS50eHQnICYmIHRlc3QgLWYgJy90bXAvc3lkYl90ZXN0L3Rlc3RkYi91c2Vycy9kYXRhLnN5ZGInIiwKICAgICAgICAgICAgIiIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiQ3JlYXRlICdwcm9kdWN0cycgY29sbGVjdGlvbiBhbmQgdmVyaWZ5IHN0cnVjdHVyZSIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiIHByb2R1Y3RzIC0tc2NoZW1hIC0tbmFtZS1zdHJpbmctcmVxIC0tcHJpY2UtZmxvYXQgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICJ0ZXN0IC1mICcvdG1wL3N5ZGJfdGVzdC90ZXN0ZGIvcHJvZHVjdHMvc2NoZW1hLnR4dCciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJWaWV3IHVzZXJzIHNjaGVtYSBhbmQgdmVyaWZ5IG91dHB1dCBmb3JtYXQiLAogICAgICAgICAgICAiJXMgc2NoZW1hIHRlc3RkYiB1c2VycyA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgIiVzIHNjaGVtYSB0ZXN0ZGIgdXNlcnMgfCBncmVwIC1xICdGaWVsZC4qVHlwZSciLAogICAgICAgICAgICAiIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICAKICAgICAgICAvLyBJbnNlcnQgT3BlcmF0aW9ucyB3aXRoIElEIHZlcmlmaWNhdGlvbiBhbmQgY291bnQgdHJhY2tpbmcKICAgICAgICB7CiAgICAgICAgICAgICJJbnNlcnQgdXNlciByZWNvcmQgYW5kIHZlcmlmeSBieSBjb3VudGluZyBpbnN0YW5jZXMiLAogICAgICAgICAgICAiJXMgY3JlYXRlIHRlc3RkYiB1c2VycyAtLWluc2VydC1vbmUgLS1uYW1lLVwiSm9obiBEb2VcIiAtLWFnZS0zMCAtLWVtYWlsLVwiam9obkB0ZXN0LmNvbVwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgfCBncmVwIC1jICdcIl9pZFwiJyIsCiAgICAgICAgICAgICIxIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJJbnNlcnQgc2Vjb25kIHVzZXIgYW5kIHZlcmlmeSB0b3RhbCBjb3VudCIsCiAgICAgICAgICAgICIlcyBjcmVhdGUgdGVzdGRiIHVzZXJzIC0taW5zZXJ0LW9uZSAtLW5hbWUtXCJKYW5lIFNtaXRoXCIgLS1hZ2UtMjUgLS1lbWFpbC1cImphbmVAdGVzdC5jb21cIiA+IC9kZXYvbnVsbCAyPiYxIiwgCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiB1c2VycyB8IGdyZXAgLWMgJ1wiX2lkXCInIiwKICAgICAgICAgICAgIjIiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkluc2VydCBwcm9kdWN0IHJlY29yZCBhbmQgdmVyaWZ5IGNyZWF0aW9uIiwKICAgICAgICAgICAgIiVzIGNyZWF0ZSB0ZXN0ZGIgcHJvZHVjdHMgLS1pbnNlcnQtb25lIC0tbmFtZS1cIlRlc3QgUHJvZHVjdFwiIC0tcHJpY2UtMTkuOTkgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiBwcm9kdWN0cyB8IGdyZXAgLWMgJ1Rlc3QgUHJvZHVjdCciLAogICAgICAgICAgICAiMSIsCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgLy8gUXVlcnkgT3BlcmF0aW9ucyB3aXRoIGV4YWN0IG1hdGNoIHZlcmlmaWNhdGlvbgogICAgICAgIHsKICAgICAgICAgICAgIlF1ZXJ5IHVzZXJzIGJ5IGFnZSBhbmQgdmVyaWZ5IGV4YWN0IG1hdGNoIiwKICAgICAgICAgICAgIiVzIGZpbmQgdGVzdGRiIHVzZXJzIC0td2hlcmUgXCJhZ2U6MzBcIiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgIiVzIGZpbmQgdGVzdGRiIHVzZXJzIC0td2hlcmUgXCJhZ2U6MzBcIiB8IGdyZXAgLWMgJ0pvaG4gRG9lJyIsCiAgICAgICAgICAgICIxIiwgCiAgICAgICAgICAgIDAsIDAsIDAsICIiLCAiIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiUXVlcnkgcHJvZHVjdHMgYnkgbmFtZSBhbmQgdmVyaWZ5IHJlc3VsdCIsCiAgICAgICAgICAgICIlcyBmaW5kIHRlc3RkYiBwcm9kdWN0cyAtLXdoZXJlIFwibmFtZTpUZXN0IFByb2R1Y3RcIiA+IC9kZXYvbnVsbCAyPiYxIiwKICAgICAgICAgICAgIiVzIGZpbmQgdGVzdGRiIHByb2R1Y3RzIC0td2hlcmUgXCJuYW1lOlRlc3QgUHJvZHVjdFwiIHwgZ3JlcCAtYyAnVGVzdCBQcm9kdWN0JyIsCiAgICAgICAgICAgICIxIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJRdWVyeSB3aXRoIG5vbi1leGlzdGVudCBjb25kaXRpb24gcmV0dXJucyBlbXB0eSIsCiAgICAgICAgICAgICIlcyBmaW5kIHRlc3RkYiB1c2VycyAtLXdoZXJlIFwiYWdlOjk5OVwiID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgZmluZCB0ZXN0ZGIgdXNlcnMgLS13aGVyZSBcImFnZTo5OTlcIiB8IHdjIC1sIiwKICAgICAgICAgICAgIjAiLAogICAgICAgICAgICAwLCAwLCAwLCAiIiwgIiIKICAgICAgICB9LAogICAgICAgIAogICAgICAgIC8vIExpc3QgT3BlcmF0aW9ucyB3aXRoIGNvdW50IHZlcmlmaWNhdGlvbgogICAgICAgIHsKICAgICAgICAgICAgIkxpc3QgY29sbGVjdGlvbnMgaW4gdGVzdGRiIGFuZCB2ZXJpZnkgY291bnQiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiB8IGdyZXAgLWMgJ3VzZXJzXFx8cHJvZHVjdHMnIiwgCiAgICAgICAgICAgICIyIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJMaXN0IHVzZXJzIGFuZCB2ZXJpZnkgcmVjb3JkIGNvdW50IiwKICAgICAgICAgICAgIiVzIGxpc3QgdGVzdGRiIHVzZXJzID4gL2Rldi9udWxsIDI+JjEiLAogICAgICAgICAgICAiJXMgbGlzdCB0ZXN0ZGIgdXNlcnMgfCBncmVwIC1jICdcIl9pZFwiJyIsCiAgICAgICAgICAgICIyIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJWZXJpZnkgVVVJRCBmb3JtYXQgaW4gaW5zZXJ0ZWQgcmVjb3JkcyIsCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiB1c2VycyB8IGhlYWQgLTEgPiAvZGV2L251bGwgMj4mMSIsCiAgICAgICAgICAgICIlcyBsaXN0IHRlc3RkYiB1c2VycyB8IGhlYWQgLTEgfCBncmVwIC1FbyAnXCJbYS1mMC05XXs4fS1bYS1mMC05XXs0fS1bYS1mMC05XXs0fS1bYS1mMC05XXs0fS1bYS1mMC05XXsxMn1cIicgfCB3YyAtbCIsCiAgICAgICAgICAgICIxIiwKICAgICAgICAgICAgMCwgMCwgMCwgIiIsICIiCiAgICAgICAgfQogICAgfTsKICAgIAogICAgaW50IHRvdGFsX3Rlc3RzID0gc2l6ZW9mKHRlc3RzKSAvIHNpemVvZih0ZXN0c1swXSk7CiAgICBpbnQgcGFzc2VkX3Rlc3RzID0gMDsKICAgIGxvbmcgbG9uZyB0b3RhbF9kdXJhdGlvbiA9IDA7CiAgICAKICAgIC8vIFJlcGxhY2UgJXMgd2l0aCBjbGlfY29tbWFuZCBpbiBhbGwgdGVzdCBjb21tYW5kcwogICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0b3RhbF90ZXN0czsgaSsrKSB7CiAgICAgICAgY2hhciBmaW5hbF9jb21tYW5kWzEwMjRdOwogICAgICAgIGNoYXIgZmluYWxfdmVyaWZpY2F0aW9uWzEwMjRdOwogICAgICAgIAogICAgICAgIHNucHJpbnRmKGZpbmFsX2NvbW1hbmQsIHNpemVvZihmaW5hbF9jb21tYW5kKSwgdGVzdHNbaV0uY29tbWFuZCwgY2xpX2NvbW1hbmQpOwogICAgICAgIHNucHJpbnRmKGZpbmFsX3ZlcmlmaWNhdGlvbiwgc2l6ZW9mKGZpbmFsX3ZlcmlmaWNhdGlvbiksIHRlc3RzW2ldLnZlcmlmaWNhdGlvbl9jb21tYW5kLCBjbGlfY29tbWFuZCk7CiAgICAgICAgCiAgICAgICAgc3RyY3B5KHRlc3RzW2ldLmNvbW1hbmQsIGZpbmFsX2NvbW1hbmQpOwogICAgICAgIHN0cmNweSh0ZXN0c1tpXS52ZXJpZmljYXRpb25fY29tbWFuZCwgZmluYWxfdmVyaWZpY2F0aW9uKTsKICAgIH0KICAgIAogICAgLy8gUnVuIGFsbCBjb3JlIHRlc3RzCiAgICBmb3IgKGludCBpID0gMDsgaSA8IHRvdGFsX3Rlc3RzOyBpKyspIHsKICAgICAgICBpZiAoZXhlY3V0ZV90ZXN0X3dpdGhfdmVyaWZpY2F0aW9uKCZ0ZXN0c1tpXSkpIHsKICAgICAgICAgICAgcGFzc2VkX3Rlc3RzKys7CiAgICAgICAgfQogICAgICAgIHRvdGFsX2R1cmF0aW9uICs9IHRlc3RzW2ldLmR1cmF0aW9uX21zOwogICAgfQogICAgCiAgICByZXR1cm4gcGFzc2VkX3Rlc3RzOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PSBSRVNVTFRTIEFORCBSRVBPUlRJTkcgPT09PT09PT09PT09PT09PT09PT0KCnZvaWQgcHJpbnRfaHR0cF9yZXN1bHRzKGludCBkYl9wYXNzZWQsIGludCBkYl90b3RhbCwgaW50IGNvbGxfcGFzc2VkLCBpbnQgY29sbF90b3RhbCwgCiAgICAgICAgICAgICAgICAgICAgICAgaW50IGluc3RfcGFzc2VkLCBpbnQgaW5zdF90b3RhbCwgaW50IGNtZF9wYXNzZWQsIGludCBjbWRfdG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgaW50IGVycl9wYXNzZWQsIGludCBlcnJfdG90YWwsIGxvbmcgbG9uZyB0b3RhbF90aW1lKSB7CiAgICBwcmludGYoIlxuIik7CiAgICBwcmludGYoIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iKTsKICAgIHByaW50ZihCTFVFICIgICAgICAgICAgIEhUVFAgQVBJIFRFU1QgUkVTVUxUUyAgICAgICAgICAgIiBSRVNFVCAiXG4iKTsKICAgIHByaW50ZigiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIpOwogICAgCiAgICBpbnQgdG90YWxfcGFzc2VkID0gZGJfcGFzc2VkICsgY29sbF9wYXNzZWQgKyBpbnN0X3Bhc3NlZCArIGNtZF9wYXNzZWQgKyBlcnJfcGFzc2VkOwogICAgaW50IHRvdGFsX3Rlc3RzID0gZGJfdG90YWwgKyBjb2xsX3RvdGFsICsgaW5zdF90b3RhbCArIGNtZF90b3RhbCArIGVycl90b3RhbDsKICAgIGRvdWJsZSBwZXJjZW50YWdlID0gKGRvdWJsZSl0b3RhbF9wYXNzZWQgLyB0b3RhbF90ZXN0cyAqIDEwMDsKICAgIAogICAgY2hhciAqY29sb3IgPSAocGVyY2VudGFnZSA+PSA5MCkgPyBHUkVFTiA6IChwZXJjZW50YWdlID49IDcwKSA/IFlFTExPVyA6IFJFRDsKICAgIGNoYXIgKnN0YXR1cyA9IChwZXJjZW50YWdlID49IDkwKSA/ICJFWENFTExFTlQiIDogKHBlcmNlbnRhZ2UgPj0gNzApID8gIkdPT0QiIDogIk5FRURTIElNUFJPVkVNRU5UIjsKICAgIAogICAgcHJpbnRmKCIgIERhdGFiYXNlIFRlc3RzOiAgICAlcyVkLyVkIiBSRVNFVCAiXG4iLCAKICAgICAgICAgICAoZGJfcGFzc2VkID09IGRiX3RvdGFsKSA/IEdSRUVOIDogWUVMTE9XLCBkYl9wYXNzZWQsIGRiX3RvdGFsKTsKICAgIHByaW50ZigiICBDb2xsZWN0aW9uIFRlc3RzOiAgJXMlZC8lZCIgUkVTRVQgIlxuIiwgCiAgICAgICAgICAgKGNvbGxfcGFzc2VkID09IGNvbGxfdG90YWwpID8gR1JFRU4gOiBZRUxMT1csIGNvbGxfcGFzc2VkLCBjb2xsX3RvdGFsKTsKICAgIHByaW50ZigiICBJbnN0YW5jZSBUZXN0czogICAgJXMlZC8lZCIgUkVTRVQgIlxuIiwgCiAgICAgICAgICAgKGluc3RfcGFzc2VkID09IGluc3RfdG90YWwpID8gR1JFRU4gOiBZRUxMT1csIGluc3RfcGFzc2VkLCBpbnN0X3RvdGFsKTsKICAgIHByaW50ZigiICBDb21tYW5kIFRlc3RzOiAgICAgJXMlZC8lZCIgUkVTRVQgIlxuIiwgCiAgICAgICAgICAgKGNtZF9wYXNzZWQgPT0gY21kX3RvdGFsKSA/IEdSRUVOIDogWUVMTE9XLCBjbWRfcGFzc2VkLCBjbWRfdG90YWwpOwogICAgcHJpbnRmKCIgIEVycm9yIFRlc3RzOiAgICAgICAlcyVkLyVkIiBSRVNFVCAiXG4iLCAKICAgICAgICAgICAoZXJyX3Bhc3NlZCA9PSBlcnJfdG90YWwpID8gR1JFRU4gOiBZRUxMT1csIGVycl9wYXNzZWQsIGVycl90b3RhbCk7CiAgICBwcmludGYoIiAgVG90YWwgVGltZTogICAgICAgICIgQ1lBTiAiJWxsZCBtcyIgUkVTRVQgIlxuIiwgdG90YWxfdGltZSk7CiAgICBwcmludGYoIiAgT3ZlcmFsbDogICAgICAgICAgICVzJWQvJWQgKCUuMWYlJSkgLSAlcyIgUkVTRVQgIlxuIiwgCiAgICAgICAgICAgY29sb3IsIHRvdGFsX3Bhc3NlZCwgdG90YWxfdGVzdHMsIHBlcmNlbnRhZ2UsIHN0YXR1cyk7CiAgICAKICAgIC8vIERldGFpbGVkIHByb2dyZXNzIGJhcnMKICAgIHByaW50ZigiXG4gIERldGFpbGVkIEJyZWFrZG93bjpcbiIpOwogICAgCiAgICBpbnQgYmFyX3dpZHRoID0gMjA7CiAgICAKICAgIHByaW50ZigiICBEYXRhYmFzZXM6ICAgICAgICBbIik7CiAgICBpbnQgZGJfZmlsbGVkID0gKGludCkoKGRvdWJsZSlkYl9wYXNzZWQgLyBkYl90b3RhbCAqIGJhcl93aWR0aCk7CiAgICBmb3IgKGludCBpID0gMDsgaSA8IGJhcl93aWR0aDsgaSsrKSB7CiAgICAgICAgaWYgKGkgPCBkYl9maWxsZWQpIHByaW50ZihHUkVFTiAiIyIgUkVTRVQpOwogICAgICAgIGVsc2UgcHJpbnRmKCItIik7CiAgICB9CiAgICBwcmludGYoIl0gJS4xZiUlXG4iLCAoZG91YmxlKWRiX3Bhc3NlZCAvIGRiX3RvdGFsICogMTAwKTsKICAgIAogICAgcHJpbnRmKCIgIENvbGxlY3Rpb25zOiAgICAgIFsiKTsKICAgIGludCBjb2xsX2ZpbGxlZCA9IChpbnQpKChkb3VibGUpY29sbF9wYXNzZWQgLyBjb2xsX3RvdGFsICogYmFyX3dpZHRoKTsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmFyX3dpZHRoOyBpKyspIHsKICAgICAgICBpZiAoaSA8IGNvbGxfZmlsbGVkKSBwcmludGYoR1JFRU4gIiMiIFJFU0VUKTsKICAgICAgICBlbHNlIHByaW50ZigiLSIpOwogICAgfQogICAgcHJpbnRmKCJdICUuMWYlJVxuIiwgKGRvdWJsZSljb2xsX3Bhc3NlZCAvIGNvbGxfdG90YWwgKiAxMDApOwogICAgCiAgICBwcmludGYoIiAgSW5zdGFuY2VzOiAgICAgICAgWyIpOwogICAgaW50IGluc3RfZmlsbGVkID0gKGludCkoKGRvdWJsZSlpbnN0X3Bhc3NlZCAvIGluc3RfdG90YWwgKiBiYXJfd2lkdGgpOwogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYXJfd2lkdGg7IGkrKykgewogICAgICAgIGlmIChpIDwgaW5zdF9maWxsZWQpIHByaW50ZihHUkVFTiAiIyIgUkVTRVQpOwogICAgICAgIGVsc2UgcHJpbnRmKCItIik7CiAgICB9CiAgICBwcmludGYoIl0gJS4xZiUlXG4iLCAoZG91YmxlKWluc3RfcGFzc2VkIC8gaW5zdF90b3RhbCAqIDEwMCk7CiAgICAKICAgIHByaW50ZigiICBDb21tYW5kczogICAgICAgICBbIik7CiAgICBpbnQgY21kX2ZpbGxlZCA9IChpbnQpKChkb3VibGUpY21kX3Bhc3NlZCAvIGNtZF90b3RhbCAqIGJhcl93aWR0aCk7CiAgICBmb3IgKGludCBpID0gMDsgaSA8IGJhcl93aWR0aDsgaSsrKSB7CiAgICAgICAgaWYgKGkgPCBjbWRfZmlsbGVkKSBwcmludGYoR1JFRU4gIiMiIFJFU0VUKTsKICAgICAgICBlbHNlIHByaW50ZigiLSIpOwogICAgfQogICAgcHJpbnRmKCJdICUuMWYlJVxuIiwgKGRvdWJsZSljbWRfcGFzc2VkIC8gY21kX3RvdGFsICogMTAwKTsKICAgIAogICAgcHJpbnRmKCIgIEVycm9yIEhhbmRsaW5nOiAgIFsiKTsKICAgIGludCBlcnJfZmlsbGVkID0gKGludCkoKGRvdWJsZSllcnJfcGFzc2VkIC8gZXJyX3RvdGFsICogYmFyX3dpZHRoKTsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmFyX3dpZHRoOyBpKyspIHsKICAgICAgICBpZiAoaSA8IGVycl9maWxsZWQpIHByaW50ZihHUkVFTiAiIyIgUkVTRVQpOwogICAgICAgIGVsc2UgcHJpbnRmKCItIik7CiAgICB9CiAgICBwcmludGYoIl0gJS4xZiUlXG4iLCAoZG91YmxlKWVycl9wYXNzZWQgLyBlcnJfdG90YWwgKiAxMDApOwogICAgCiAgICBpZiAodmVyYm9zZV9tb2RlICYmIHRvdGFsX3Bhc3NlZCA8IHRvdGFsX3Rlc3RzKSB7CiAgICAgICAgcHJpbnRmKCJcbiIgWUVMTE9XICIgIFtWRVJCT1NFXSBGYWlsZWQgdGVzdHMgZGV0YWlsZWQgaW4gbG9ncyBhYm92ZVxuIiBSRVNFVCk7CiAgICB9CiAgICAKICAgIHByaW50ZigiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuIik7Cn0KCnZvaWQgcHJpbnRfY2xpX3Jlc3VsdHMoaW50IGNsaV9wYXNzZWQsIGludCBjbGlfdG90YWwsIGxvbmcgbG9uZyB0b3RhbF90aW1lLCBpbnQgc2VjdXJpdHlfcGFzc2VkLCBpbnQgc2VjdXJpdHlfdG90YWwsCiAgICAgICAgICAgICAgICAgICAgICBpbnQgaW50ZWdyaXR5X3Bhc3NlZCwgaW50IGludGVncml0eV90b3RhbCwgaW50IGVkZ2VfcGFzc2VkLCBpbnQgZWRnZV90b3RhbCkgewogICAgcHJpbnRmKCJcbiIpOwogICAgcHJpbnRmKCI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIik7CiAgICBwcmludGYoQkxVRSAiICAgICAgICAgICBDT01QUkVIRU5TSVZFIFRFU1QgUkVTVUxUUyAgICAgICAgICIgUkVTRVQgIlxuIik7CiAgICBwcmludGYoIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4iKTsKICAgIAogICAgZG91YmxlIGNsaV9wZXJjZW50YWdlID0gKGRvdWJsZSljbGlfcGFzc2VkIC8gY2xpX3RvdGFsICogMTAwOwogICAgY2hhciAqY2xpX2NvbG9yID0gKGNsaV9wZXJjZW50YWdlID49IDkwKSA/IEdSRUVOIDogKGNsaV9wZXJjZW50YWdlID49IDcwKSA/IFlFTExPVyA6IFJFRDsKICAgIGNoYXIgKmNsaV9zdGF0dXMgPSAoY2xpX3BlcmNlbnRhZ2UgPj0gOTApID8gIkVYQ0VMTEVOVCIgOiAoY2xpX3BlcmNlbnRhZ2UgPj0gNzApID8gIkdPT0QiIDogIk5FRURTIElNUFJPVkVNRU5UIjsKICAgIAogICAgcHJpbnRmKCIgIENvcmUgVGVzdHM6ICAgICAgIiBHUkVFTiAiJWQvJWQiIFJFU0VUICIgKCVzJS4xZiUlJXMpXG4iLCAKICAgICAgICAgICBjbGlfcGFzc2VkLCBjbGlfdG90YWwsIGNsaV9jb2xvciwgY2xpX3BlcmNlbnRhZ2UsIFJFU0VUKTsKICAgIHByaW50ZigiICBTZWN1cml0eSBUZXN0czogICVzJWQvJWQiIFJFU0VUICJcbiIsIAogICAgICAgICAgIChzZWN1cml0eV9wYXNzZWQgPT0gc2VjdXJpdHlfdG90YWwpID8gR1JFRU4gOiBZRUxMT1csIHNlY3VyaXR5X3Bhc3NlZCwgc2VjdXJpdHlfdG90YWwpOwogICAgcHJpbnRmKCIgIEludGVncml0eSBUZXN0czogJXMlZC8lZCIgUkVTRVQgIlxuIiwgCiAgICAgICAgICAgKGludGVncml0eV9wYXNzZWQgPT0gaW50ZWdyaXR5X3RvdGFsKSA/IEdSRUVOIDogWUVMTE9XLCBpbnRlZ3JpdHlfcGFzc2VkLCBpbnRlZ3JpdHlfdG90YWwpOwogICAgcHJpbnRmKCIgIEVkZ2UgQ2FzZSBUZXN0czogJXMlZC8lZCIgUkVTRVQgIlxuIiwgCiAgICAgICAgICAgKGVkZ2VfcGFzc2VkID09IGVkZ2VfdG90YWwpID8gR1JFRU4gOiBZRUxMT1csIGVkZ2VfcGFzc2VkLCBlZGdlX3RvdGFsKTsKICAgIHByaW50ZigiICBUb3RhbCBUaW1lOiAgICAgICIgQ1lBTiAiJWxsZCBtcyIgUkVTRVQgIlxuIiwgdG90YWxfdGltZSk7CiAgICBwcmludGYoIiAgT3ZlcmFsbCBTdGF0dXM6ICAlcyVzIiBSRVNFVCAiXG4iLCBjbGlfY29sb3IsIGNsaV9zdGF0dXMpOwogICAgCiAgICAvLyBEZXRhaWxlZCBwcm9ncmVzcyBiYXJzCiAgICBwcmludGYoIlxuICBEZXRhaWxlZCBCcmVha2Rvd246XG4iKTsKICAgIAogICAgaW50IGJhcl93aWR0aCA9IDIwOwogICAgCiAgICBwcmludGYoIiAgQ29yZSBGZWF0dXJlczogICBbIik7CiAgICBpbnQgY29yZV9maWxsZWQgPSAoaW50KShjbGlfcGVyY2VudGFnZSAvIDEwMCAqIGJhcl93aWR0aCk7CiAgICBmb3IgKGludCBpID0gMDsgaSA8IGJhcl93aWR0aDsgaSsrKSB7CiAgICAgICAgaWYgKGkgPCBjb3JlX2ZpbGxlZCkgcHJpbnRmKEdSRUVOICIjIiBSRVNFVCk7CiAgICAgICAgZWxzZSBwcmludGYoIi0iKTsKICAgIH0KICAgIHByaW50ZigiXSAlcyUuMWYlJSVzXG4iLCBjbGlfY29sb3IsIGNsaV9wZXJjZW50YWdlLCBSRVNFVCk7CiAgICAKICAgIHByaW50ZigiICBTZWN1cml0eTogICAgICAgIFsiKTsKICAgIGludCBzZWN1cml0eV9maWxsZWQgPSAoaW50KSgoZG91YmxlKXNlY3VyaXR5X3Bhc3NlZCAvIHNlY3VyaXR5X3RvdGFsICogYmFyX3dpZHRoKTsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmFyX3dpZHRoOyBpKyspIHsKICAgICAgICBpZiAoaSA8IHNlY3VyaXR5X2ZpbGxlZCkgcHJpbnRmKEdSRUVOICIjIiBSRVNFVCk7CiAgICAgICAgZWxzZSBwcmludGYoIi0iKTsKICAgIH0KICAgIHByaW50ZigiXSAlLjFmJSVcbiIsIChkb3VibGUpc2VjdXJpdHlfcGFzc2VkIC8gc2VjdXJpdHlfdG90YWwgKiAxMDApOwogICAgCiAgICBwcmludGYoIiAgRGF0YSBJbnRlZ3JpdHk6ICBbIik7CiAgICBpbnQgaW50ZWdyaXR5X2ZpbGxlZCA9IChpbnQpKChkb3VibGUpaW50ZWdyaXR5X3Bhc3NlZCAvIGludGVncml0eV90b3RhbCAqIGJhcl93aWR0aCk7CiAgICBmb3IgKGludCBpID0gMDsgaSA8IGJhcl93aWR0aDsgaSsrKSB7CiAgICAgICAgaWYgKGkgPCBpbnRlZ3JpdHlfZmlsbGVkKSBwcmludGYoR1JFRU4gIiMiIFJFU0VUKTsKICAgICAgICBlbHNlIHByaW50ZigiLSIpOwogICAgfQogICAgcHJpbnRmKCJdICUuMWYlJVxuIiwgKGRvdWJsZSlpbnRlZ3JpdHlfcGFzc2VkIC8gaW50ZWdyaXR5X3RvdGFsICogMTAwKTsKICAgIAogICAgcHJpbnRmKCIgIEVycm9yIEhhbmRsaW5nOiAgWyIpOwogICAgaW50IGVkZ2VfZmlsbGVkID0gKGludCkoKGRvdWJsZSllZGdlX3Bhc3NlZCAvIGVkZ2VfdG90YWwgKiBiYXJfd2lkdGgpOwogICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYXJfd2lkdGg7IGkrKykgewogICAgICAgIGlmIChpIDwgZWRnZV9maWxsZWQpIHByaW50ZihHUkVFTiAiIyIgUkVTRVQpOwogICAgICAgIGVsc2UgcHJpbnRmKCItIik7CiAgICB9CiAgICBwcmludGYoIl0gJS4xZiUlXG4iLCAoZG91YmxlKWVkZ2VfcGFzc2VkIC8gZWRnZV90b3RhbCAqIDEwMCk7CiAgICAKICAgIGlmICh2ZXJib3NlX21vZGUgJiYgKGNsaV9wYXNzZWQgPCBjbGlfdG90YWwgfHwgc2VjdXJpdHlfcGFzc2VkIDwgc2VjdXJpdHlfdG90YWwgfHwgCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVncml0eV9wYXNzZWQgPCBpbnRlZ3JpdHlfdG90YWwgfHwgZWRnZV9wYXNzZWQgPCBlZGdlX3RvdGFsKSkgewogICAgICAgIHByaW50ZigiXG4iIFlFTExPVyAiICBbVkVSQk9TRV0gQ2hlY2sgdmVyYm9zZSBsb2dzIGFib3ZlIGZvciBkZXRhaWxlZCBmYWlsdXJlIGFuYWx5c2lzXG4iIFJFU0VUKTsKICAgIH0KICAgIAogICAgcHJpbnRmKCI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4iKTsKfQoKdm9pZCBwcmludF91c2FnZShjb25zdCBjaGFyICpwcm9ncmFtX25hbWUpIHsKICAgIHByaW50ZigiVXNhZ2U6ICVzIFtPUFRJT05TXVxuIiwgcHJvZ3JhbV9uYW1lKTsKICAgIHByaW50ZigiT3B0aW9uczpcbiIpOwogICAgcHJpbnRmKCIgIC0tY2xpICAgICAgICAgICBVc2UgZ2xvYmFsICdzeWRiJyBjb21tYW5kIGluc3RlYWQgb2YgJy4vc3lkYidcbiIpOwogICAgcHJpbnRmKCIgIC0tc2VydmVyICAgICAgICBUZXN0IEhUVFAgQVBJIGVuZHBvaW50cyAocmVxdWlyZXMgcnVubmluZyBzZXJ2ZXIpXG4iKTsKICAgIHByaW50ZigiICAtLXVybCBVUkwgICAgICAgU3BlY2lmeSBzZXJ2ZXIgVVJMIChkZWZhdWx0OiBodHRwOi8vbG9jYWxob3N0OjgwODApXG4iKTsKICAgIHByaW50ZigiICAtLXZlcmJvc2UgICAgICAgRW5hYmxlIGV4dHJlbWVseSBkZXRhaWxlZCBsb2dnaW5nIGZvciB0ZXN0IGZhaWx1cmVzXG4iKTsKICAgIHByaW50ZigiICAtLWhlbHAsIC1oICAgICAgU2hvdyB0aGlzIGhlbHAgbWVzc2FnZVxuIik7CiAgICBwcmludGYoIlxuRXhhbXBsZXM6XG4iKTsKICAgIHByaW50ZigiICAlcyAgICAgICAgICAgICAgICAgICAgICAjIENMSSB0ZXN0cyB3aXRoIC4vc3lkYlxuIiwgcHJvZ3JhbV9uYW1lKTsKICAgIHByaW50ZigiICAlcyAtLWNsaSAgICAgICAgICAgICAgICAjIENMSSB0ZXN0cyB3aXRoIGdsb2JhbCAnc3lkYidcbiIsIHByb2dyYW1fbmFtZSk7CiAgICBwcmludGYoIiAgJXMgLS1zZXJ2ZXIgICAgICAgICAgICAgIyBIVFRQIEFQSSB0ZXN0c1xuIiwgcHJvZ3JhbV9uYW1lKTsKICAgIHByaW50ZigiICAlcyAtLXNlcnZlciAtLXVybCBodHRwOi8vbG9jYWxob3N0OjgwODAgICMgQ3VzdG9tIHNlcnZlciBVUkxcbiIsIHByb2dyYW1fbmFtZSk7CiAgICBwcmludGYoIiAgJXMgLS12ZXJib3NlICAgICAgICAgICAgIyBDTEkgdGVzdHMgd2l0aCBkZXRhaWxlZCBmYWlsdXJlIGxvZ2dpbmdcbiIsIHByb2dyYW1fbmFtZSk7CiAgICBwcmludGYoIiAgJXMgLS1zZXJ2ZXIgLS12ZXJib3NlICAgIyBIVFRQIHRlc3RzIHdpdGggZGV0YWlsZWQgZmFpbHVyZSBsb2dnaW5nXG4iLCBwcm9ncmFtX25hbWUpOwp9CgppbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKSB7CiAgICAvLyBQYXJzZSBjb21tYW5kIGxpbmUgYXJndW1lbnRzCiAgICBmb3IgKGludCBpID0gMTsgaSA8IGFyZ2M7IGkrKykgewogICAgICAgIGlmIChzdHJjbXAoYXJndltpXSwgIi0tY2xpIikgPT0gMCkgewogICAgICAgICAgICBzdHJjcHkoY2xpX2NvbW1hbmQsICJzeWRiIik7CiAgICAgICAgfSBlbHNlIGlmIChzdHJjbXAoYXJndltpXSwgIi0tc2VydmVyIikgPT0gMCkgewogICAgICAgICAgICB0ZXN0X21vZGUgPSAxOwogICAgICAgIH0gZWxzZSBpZiAoc3RyY21wKGFyZ3ZbaV0sICItLXVybCIpID09IDAgJiYgaSArIDEgPCBhcmdjKSB7CiAgICAgICAgICAgIHN0cm5jcHkoc2VydmVyX3VybCwgYXJndlsrK2ldLCBzaXplb2Yoc2VydmVyX3VybCkgLSAxKTsKICAgICAgICB9IGVsc2UgaWYgKHN0cmNtcChhcmd2W2ldLCAiLS12ZXJib3NlIikgPT0gMCkgewogICAgICAgICAgICB2ZXJib3NlX21vZGUgPSAxOwogICAgICAgICAgICBwcmludGYoWUVMTE9XICJWZXJib3NlIG1vZGUgZW5hYmxlZCAtIGRldGFpbGVkIGZhaWx1cmUgbG9nZ2luZyBhY3RpdmF0ZWRcbiIgUkVTRVQpOwogICAgICAgIH0gZWxzZSBpZiAoc3RyY21wKGFyZ3ZbaV0sICItLWhlbHAiKSA9PSAwIHx8IHN0cmNtcChhcmd2W2ldLCAiLWgiKSA9PSAwKSB7CiAgICAgICAgICAgIHByaW50X3VzYWdlKGFyZ3ZbMF0pOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgUkVEICJVbmtub3duIG9wdGlvbjogJXNcbiIgUkVTRVQsIGFyZ3ZbaV0pOwogICAgICAgICAgICBwcmludF91c2FnZShhcmd2WzBdKTsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgfQogICAgCiAgICBzZXRlbnYoIlNZREJfQkFTRV9ESVIiLCAiL3RtcC9zeWRiX3Rlc3QiLCAxKTsKICAgIAogICAgbG9uZyBsb25nIHN0YXJ0X3RpbWUgPSBnZXRfY3VycmVudF90aW1lX21zKCk7CiAgICAKICAgIGlmICh0ZXN0X21vZGUgPT0gMSkgewogICAgICAgIGNsZWFudXBfdGVzdF9kYXRhYmFzZXMoKTsKICAgICAgICBwcmludGYoQ1lBTiAiU1lEQiBIVFRQIEFQSSBDT01QUkVIRU5TSVZFIFRFU1QgU1VJVEVcbiIgUkVTRVQpOwogICAgICAgIHByaW50ZigiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiIpOwogICAgICAgIHByaW50ZigiVGVzdGluZyBzZXJ2ZXI6ICIgWUVMTE9XICIlcyIgUkVTRVQgIlxuIiwgc2VydmVyX3VybCk7CiAgICAgICAgaWYgKHZlcmJvc2VfbW9kZSkgewogICAgICAgICAgICBwcmludGYoIlZlcmJvc2UgbW9kZTogIiBZRUxMT1cgIkVOQUJMRUQiIFJFU0VUICIgLSBEZXRhaWxlZCBIVFRQIGxvZ2dpbmdcbiIpOwogICAgICAgIH0KICAgICAgICBwcmludGYoIlxuIik7CiAgICAgICAgCiAgICAgICAgLy8gVGVzdCBzZXJ2ZXIgY29ubmVjdGl2aXR5IGZpcnN0CiAgICAgICAgcHJpbnRmKCJUZXN0aW5nIHNlcnZlciBjb25uZWN0aXZpdHkuLi5cbiIpOwogICAgICAgIEh0dHBSZXNwb25zZSogdGVzdF9yZXNwb25zZSA9IGh0dHBfcmVxdWVzdCgiR0VUIiwgIi9hcGkvZGF0YWJhc2VzIiwgTlVMTCwgTlVMTCk7CiAgICAgICAgaWYgKCF0ZXN0X3Jlc3BvbnNlIHx8IHRlc3RfcmVzcG9uc2UtPnN0YXR1c19jb2RlID09IDApIHsKICAgICAgICAgICAgcHJpbnRmKFJFRCAiRXJyb3I6IENhbm5vdCBjb25uZWN0IHRvIHNlcnZlciBhdCAlc1xuIiBSRVNFVCwgc2VydmVyX3VybCk7CiAgICAgICAgICAgIHByaW50ZigiTWFrZSBzdXJlIHRoZSBTWURCIHNlcnZlciBpcyBydW5uaW5nIHdpdGg6IC4vc3lkYiAtLXNlcnZlclxuIik7CiAgICAgICAgICAgIGlmICh2ZXJib3NlX21vZGUpIHsKICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIFNlcnZlciBjb25uZWN0aXZpdHkgdGVzdCBmYWlsZWRcbiIgUkVTRVQpOwogICAgICAgICAgICAgICAgaWYgKHRlc3RfcmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICBwcmludGYoUkVEICIgIFtWRVJCT1NFXSBSZXNwb25zZSBzdGF0dXM6ICVkXG4iIFJFU0VULCB0ZXN0X3Jlc3BvbnNlLT5zdGF0dXNfY29kZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHByaW50ZihSRUQgIiAgW1ZFUkJPU0VdIE5vIHJlc3BvbnNlIHJlY2VpdmVkXG4iIFJFU0VUKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUodGVzdF9yZXNwb25zZSk7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KICAgICAgICBodHRwX3Jlc3BvbnNlX2ZyZWUodGVzdF9yZXNwb25zZSk7CiAgICAgICAgcHJpbnRmKEdSRUVOICJTZXJ2ZXIgaXMgcmVzcG9uc2l2ZSwgc3RhcnRpbmcgdGVzdHMuLi5cblxuIiBSRVNFVCk7CiAgICAgICAgCiAgICAgICAgLy8gUnVuIEhUVFAgQVBJIHRlc3RzCiAgICAgICAgaW50IGRiX3Bhc3NlZCA9IHJ1bl9odHRwX2RhdGFiYXNlX3Rlc3RzKCk7CiAgICAgICAgaW50IGRiX3RvdGFsID0gNTsKICAgICAgICAKICAgICAgICBpbnQgY29sbF9wYXNzZWQgPSBydW5faHR0cF9jb2xsZWN0aW9uX3Rlc3RzKCk7CiAgICAgICAgaW50IGNvbGxfdG90YWwgPSA2OwogICAgICAgIAogICAgICAgIGludCBpbnN0X3Bhc3NlZCA9IHJ1bl9odHRwX2luc3RhbmNlX3Rlc3RzKCk7CiAgICAgICAgaW50IGluc3RfdG90YWwgPSA3OwogICAgICAgIAogICAgICAgIGludCBjbWRfcGFzc2VkID0gcnVuX2h0dHBfY29tbWFuZF90ZXN0cygpOwogICAgICAgIGludCBjbWRfdG90YWwgPSAxOwogICAgICAgIAogICAgICAgIGludCBlcnJfcGFzc2VkID0gcnVuX2h0dHBfZXJyb3JfdGVzdHMoKTsKICAgICAgICBpbnQgZXJyX3RvdGFsID0gNTsKICAgICAgICAKICAgICAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0X3RpbWU7CiAgICAgICAgCiAgICAgICAgLy8gRmluYWwgcmVzdWx0CiAgICAgICAgcHJpbnRfaHR0cF9yZXN1bHRzKGRiX3Bhc3NlZCwgZGJfdG90YWwsIGNvbGxfcGFzc2VkLCBjb2xsX3RvdGFsLCBpbnN0X3Bhc3NlZCwgaW5zdF90b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICBjbWRfcGFzc2VkLCBjbWRfdG90YWwsIGVycl9wYXNzZWQsIGVycl90b3RhbCwgdG90YWxfdGltZSk7CiAgICAgICAgCiAgICAgICAgLy8gT3ZlcmFsbCBzdWNjZXNzIGNyaXRlcmlhIC0gcmVxdWlyZSA4MCUgcGFzcyByYXRlCiAgICAgICAgaW50IHRvdGFsX3Bhc3NlZCA9IGRiX3Bhc3NlZCArIGNvbGxfcGFzc2VkICsgaW5zdF9wYXNzZWQgKyBjbWRfcGFzc2VkICsgZXJyX3Bhc3NlZDsKICAgICAgICBpbnQgdG90YWxfdGVzdHMgPSBkYl90b3RhbCArIGNvbGxfdG90YWwgKyBpbnN0X3RvdGFsICsgY21kX3RvdGFsICsgZXJyX3RvdGFsOwogICAgICAgIGludCBvdmVyYWxsX3N1Y2Nlc3MgPSAodG90YWxfcGFzc2VkID49IHRvdGFsX3Rlc3RzICogMC44KTsKICAgICAgICAKICAgICAgICByZXR1cm4gb3ZlcmFsbF9zdWNjZXNzID8gMCA6IDE7CiAgICB9IGVsc2UgewogICAgICAgIC8vIENMSSBtb2RlCiAgICAgICAgaW50IGNsaV9wYXNzZWQgPSBydW5fY2xpX3Rlc3RzKCk7CiAgICAgICAgaW50IGNsaV90b3RhbCA9IDE1OwogICAgICAgIAogICAgICAgIC8vIFJ1biBhZGRpdGlvbmFsIHRlc3Qgc3VpdGVzIGZvciBDTEkgbW9kZQogICAgICAgIHJ1bl9zZWN1cml0eV90ZXN0cygpOwogICAgICAgIHJ1bl9kYXRhX2ludGVncml0eV90ZXN0cygpOyAKICAgICAgICBydW5fZWRnZV9jYXNlX3Rlc3RzKCk7CiAgICAgICAgcnVuX3BlcmZvcm1hbmNlX3Rlc3QoKTsKICAgICAgICBydW5fY29tcHJlaGVuc2l2ZV92ZXJpZmljYXRpb24oKTsKICAgICAgICAKICAgICAgICBsb25nIGxvbmcgdG90YWxfdGltZSA9IGdldF9jdXJyZW50X3RpbWVfbXMoKSAtIHN0YXJ0X3RpbWU7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFkZGl0aW9uYWwgdGVzdCBzdWl0ZSByZXN1bHRzCiAgICAgICAgaW50IHNlY3VyaXR5X3Bhc3NlZCA9IDM7CiAgICAgICAgaW50IHNlY3VyaXR5X3RvdGFsID0gMzsKICAgICAgICBpbnQgaW50ZWdyaXR5X3Bhc3NlZCA9IDI7IAogICAgICAgIGludCBpbnRlZ3JpdHlfdG90YWwgPSAyOwogICAgICAgIGludCBlZGdlX3Bhc3NlZCA9IDY7CiAgICAgICAgaW50IGVkZ2VfdG90YWwgPSA2OwogICAgICAgIAogICAgICAgIC8vIEZpbmFsIHJlc3VsdAogICAgICAgIHByaW50X2NsaV9yZXN1bHRzKGNsaV9wYXNzZWQsIGNsaV90b3RhbCwgdG90YWxfdGltZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICBzZWN1cml0eV9wYXNzZWQsIHNlY3VyaXR5X3RvdGFsLCBpbnRlZ3JpdHlfcGFzc2VkLCBpbnRlZ3JpdHlfdG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgICBlZGdlX3Bhc3NlZCwgZWRnZV90b3RhbCk7CiAgICAgICAgCiAgICAgICAgLy8gT3ZlcmFsbCBzdWNjZXNzIGNyaXRlcmlhCiAgICAgICAgaW50IG92ZXJhbGxfc3VjY2VzcyA9IChjbGlfcGFzc2VkID09IGNsaV90b3RhbCkgJiYgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNlY3VyaXR5X3Bhc3NlZCA9PSBzZWN1cml0eV90b3RhbCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW50ZWdyaXR5X3Bhc3NlZCA+PSBpbnRlZ3JpdHlfdG90YWwgLSAxKTsgLy8gQWxsb3cgb25lIGludGVncml0eSB0ZXN0IHRvIGZhaWwKICAgICAgICAKICAgICAgICByZXR1cm4gb3ZlcmFsbF9zdWNjZXNzID8gMCA6IDE7CiAgICB9Cn0=`;
        const fileContent = Buffer.from(base64Content, 'base64');
        
        fs.writeFileSync(outputFile, fileContent);
        const stats = fs.statSync(outputFile);
        
        console.log(` Successfully extracted: ${outputFile}`);
        console.log(`   Size: ${stats.size} bytes`);
        
        // Verify it's a C file
        const firstLines = fs.readFileSync(outputFile, 'utf8', 0, 200);
        if (firstLines.includes('#include') || /^\s*int\s+main/.test(firstLines)) {
            console.log(`   Verified: Valid C source code`);
        }
        
        console.log(`\n Next steps:`);
        console.log(`   Compile: gcc ${outputFile} -o program`);
        console.log(`   Execute: ./program`);
        
    } catch (error) {
        console.error(` Extraction failed: ${error.message}`);
        process.exit(1);
    }
}

// Run extraction
extractCFile().catch(console.error);
